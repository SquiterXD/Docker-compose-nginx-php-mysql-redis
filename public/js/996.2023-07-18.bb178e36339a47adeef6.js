(self.webpackChunk=self.webpackChunk||[]).push([[996],{51546:(t,e,s)=>{"use strict";function n(t){return new Promise((function(e){swal({title:t,type:"warning",dangerMode:!0,showCancelButton:!0,closeOnCancel:!0,cancelButtonText:"ยกเลิก",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ยืนยัน"},(function(t){e(t)}))}))}function o(){return new Promise((function(t){swal({title:"\nคุณแน่ใจไหม?",text:"มีการเปลี่ยนแปลงข้อมูลโดยที่ยังไม่ได้บันทึก คุณต้องการดำเนินการต่อหรือไม่",type:"warning",dangerMode:!0,showCancelButton:!0,closeOnCancel:!0,cancelButtonText:"ยกเลิก",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ดำเนินการต่อ",allowClickOutside:!0,closeOnClickOutside:!0},(function(e){t(e)}))}))}function i(t){var e='<div style="text-align:left;">ข้อมูลที่คุณใส่ไม่ถูกต้องหรือไม่ครบถ้วน กรุณาตรวจสอบข้อมูลและลองใหม่อีกครั้ง<br/><br/></div>';return e+='<div style="text-align:left;color:red">',e+="<ul>",t.forEach((function(t){e+="<li>".concat(t,"<br/></li>")})),e+="</ul>",e+="</div>",new Promise((function(t){swal({title:"\nเกิดข้อผิดพลาด",text:e,type:"error",html:!0,showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ตกลง"},(function(e){t(e)}))}))}function a(){return console.debug("showLoadingDialog"),new Promise((function(t){swal({title:'\n                    <div class="sk-spinner sk-spinner-wave mb-4">\n                        <div class="sk-rect1"></div>\n                        <div class="sk-rect2"></div>\n                        <div class="sk-rect3"></div>\n                        <div class="sk-rect4"></div>\n                        <div class="sk-rect5"></div>\n                    </div>\n                    กำลังดำเนินการ\n                    ',html:!0,showConfirmButton:!1,closeOnConfirm:!1},(function(e){t(e)}))}))}function l(){return new Promise((function(t){swal({title:"\nสำเร็จ",text:"บันทึกข้อมูลเรียบร้อย",type:"success",dangerMode:!1,showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ปิด"},(function(e){t(e)}))}))}function r(){return new Promise((function(t){swal({title:"\nมีข้อผิดพลาด",text:"มีข้อผิดพลาดเกิดขึ้น ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง\n",type:"error",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ปิด"},(function(e){t(e)}))}))}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"มีข้อผิดพลาดเกิดขึ้น กรุณาลองใหม่อีกครั้ง\n";return new Promise((function(e){swal({title:"\nเกิดข้อผิดพลาด",text:t,type:"error",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ปิด"},(function(t){e(t)}))}))}function d(t){return new Promise((function(e){swal({title:"\nคุณต้องการลบข้อมูลที่ถูกเลือกทั้งหมด ".concat(t," แถวใช่หรือไม่?"),type:"warning",dangerMode:!0,showCancelButton:!0,closeOnCancel:!0,cancelButtonText:"ยกเลิก",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ยืนยัน"},(function(t){e(t)}))}))}s.d(e,{Y6:()=>n,HR:()=>o,BT:()=>i,ZD:()=>a,xK:()=>l,YM:()=>r,qV:()=>c,gC:()=>d})},30996:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>f});var n=s(87757),o=s.n(n),i=s(51546),a=s(50361),l=s.n(a),r=s(30381),c=s.n(r);function d(t,e,s,n,o,i,a){try{var l=t[i](a),r=l.value}catch(t){return void s(t)}l.done?e(r):Promise.resolve(r).then(n,o)}Vue.filter("formatDate",(function(t){if(t)return c()(c()(String(t)).add(543,"years").toDate()).format("DD/MM/YYYY")}));const u={created:function(){var t=this;Vue.nextTick((function(){t.setDefaultValue()}))},props:["pHeaders","url","transBtn","transDate"],data:function(){return{lodash:{cloneDeep:l()},headers:this.pHeaders,headerBlendNumbers:{},headerOpts:{},selectedBlendNo:{},selectedOpt:{},selectedJob:{},jobHeaderLines:{},jobLines:{},lossQty:null,batchNo:null,itemNumber:null,itemDesc:null,uom:null,wipStep:null,wipStepDesc:null,isLoading:!1,isEditing:!1,isShowLines:!1,isOpenFlag:!1,transactionDate:c()().add(543,"years").toDate(),notAfterDate:c()(c()().add(543,"years").toDate()).format(this.transDate["js-format"]),transactDate:null}},mounted:function(){console.log("Component mounted.")},methods:{indexPage:function(){location.href=this.url.wip_loss_quantity_index},setdate:function(t,e){var s,n=this;return(s=o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.transactionDate=t;case 2:case"end":return e.stop()}}),e)})),function(){var t=this,e=arguments;return new Promise((function(n,o){var i=s.apply(t,e);function a(t){d(i,n,o,a,l,"next",t)}function l(t){d(i,n,o,a,l,"throw",t)}a(void 0)}))})()},setDefaultValue:function(){this.transactDate=c()(c()(this.transactionDate).subtract(543,"years").toDate()).format("YYYY-MM-D"),this.transactDate&&this.filterBlendNumbers(this.transactDate)},onDateChanged:function(){this.transactionDate?(this.transactDate=c()(c()(this.transactionDate).subtract(543,"years").toDate()).format("YYYY-MM-DD"),this.filterBlendNumbers(this.transactDate)):this.emptyBlendNoAndOpt()},filterBlendNumbers:function(t){this.headerBlendNumbers=this.headers.filter((function(e){return e.transaction_date==t})),console.debug("count.......",Object.keys(this.headerBlendNumbers).length),Object.keys(this.headerBlendNumbers).length>0?(this.headerBlendNumbers=_.orderBy(this.headerBlendNumbers,"blend_no","asc"),this.selectedBlendNo=this.headerBlendNumbers[0].blend_no,this.selectedBlendNo&&this.filterOpts(this.selectedBlendNo)):this.emptyBlendNoAndOpt()},onBlendNoChanged:function(){console.debug("onBlendNoChanged",this.selectedBlendNo),this.selectedBlendNo?this.filterOpts(this.selectedBlendNo):this.emptyOpt()},filterOpts:function(t){console.debug("filterOpts(blendNo)",t),this.headerOpts=this.headers.filter((function(e){return e.blend_no==t})),this.headerOpts&&(this.headerOpts=_.orderBy(this.headerOpts,"opt","asc"),this.selectedOpt=this.headerOpts[0].opt,this.selectedOpt&&this.changeSelectedJob(this.selectedOpt))},onOptChanged:function(){console.debug("onOptChanged",this.selectedOpt),this.selectedOpt?this.changeSelectedJob(this.selectedOpt):this.emptyDatas()},changeSelectedJob:function(t){console.debug("changeSelectedJob",t),this.selectedOpt=t,this.selectedJob=this.headers.find((function(e){return e.opt===t})),Object.keys(this.selectedJob).length>0?(this.batchNo=this.selectedJob.batch_no,this.lossQty=this.selectedJob.loss_qty,this.itemNumber=this.selectedJob.item_data.item_number,this.itemDesc=this.selectedJob.item_data.item_desc,this.uom=this.selectedJob.item_data.primary_unit_of_measure,this.wipStep=this.selectedJob.wip_steps[0].oprn_class_desc,this.wipStepDesc=this.selectedJob.wip_steps[0].oprn_desc,this.isShowLines=!0,this.jobLines=this.selectedJob.jobLines,this.isOpenFlag="Y"==this.selectedJob.open_flag):this.emptyDatas()},emptyOpt:function(){this.headerOpts={},this.selectedBlendNo=null,this.selectedOpt=null,this.selectedJob=null,this.emptyDatas()},emptyBlendNoAndOpt:function(){this.headerBlendNumbers={},this.headerOpts={},this.selectedBlendNo=null,this.selectedOpt=null,this.selectedJob=null,this.emptyDatas()},emptyDatas:function(){this.batchNo=null,this.lossQty=null,this.itemNumber=null,this.itemDesc=null,this.uom=null,this.wipStep=null,this.wipStepDesc=null,this.isShowLines=!1,this.jobLines={}},onEditButtonClicked:function(){var t=this;console.debug("onEditButtonClicked"),this.isEditing=!0,Vue.nextTick((function(){t.$refs["input-confirm-quantity-ref"][0].focus()}))},onSaveButtonClicked:function(){var t=this;console.debug("onSaveButtonClicked"),this.jobHeaderLines.jobHeader=this.lodash.cloneDeep(this.selectedJob),console.debug("cloneDeep this.jobHeaderLines",this.jobHeaderLines);var e=this.jobHeaderLines.jobHeader.jobLines,s=0;e.forEach((function(e){t.isOpenFlag?s+=parseInt(null===e.loss_qty?0:e.loss_qty):s+=parseInt(null===e.attribute1?0:e.attribute1)})),s>this.lossQty?swal({title:"\nมีข้อผิดพลาด",text:"รายการที่ระบุไม่สามารถบันทึกเกินจำนวนสูญเสียได้",type:"error",showConfirmButton:!0,closeOnConfirm:!0,confirmButtonText:"ปิด"}):((0,i.ZD)(),axios.put(this.url.ajax_store,{isOpenFlag:this.isOpenFlag,jobHeaderLines:this.jobHeaderLines}).then((function(e){console.debug(e,e.data),t.isShowLines=!0,t.isEditing=!1,t.jobHeaderLines=e.data,t.jobLines=t.jobHeaderLines.jobLines,(0,i.xK)()})).catch((function(e){console.debug(e),swal.close(),t.isEditing=!1,(0,i.YM)()})))}}};const f=(0,s(51900).Z)(u,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"ibox float-e-margins"},[t._m(0),t._v(" "),s("div",{staticClass:"ibox-content"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-12"},[s("div",{staticClass:"form-group row"},[t._m(1),t._v(" "),s("div",{staticClass:"col-lg-3"},[s("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%"},attrs:{name:"transaction_date",id:"transaction_date",placeholder:"โปรดเลือกวันที่","not-after-date":t.notAfterDate,value:t.transactionDate,format:t.transDate["js-format"]},on:{dateWasSelected:function(e){for(var s=arguments.length,n=Array(s);s--;)n[s]=arguments[s];t.setdate.apply(void 0,n.concat(["transaction_date"])),t.onDateChanged(e)}}})],1)])]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("div",{staticClass:"form-group row"},[t._m(2),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"",filterable:"",clearable:""},on:{change:function(e){return t.onBlendNoChanged(e)}},model:{value:t.selectedBlendNo,callback:function(e){t.selectedBlendNo=e},expression:"selectedBlendNo"}},t._l(t.headerBlendNumbers,(function(t){return s("el-option",{key:t.blend_no,attrs:{label:t.blend_no,value:t.blend_no}})})),1)],1)]),t._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-lg-4 font-weight-bold col-form-label text-right",attrs:{for:"lb-3"}},[t._v("เลขที่คำสั่งผลิต: ")]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("input",{staticClass:"form-control",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:t.batchNo}})])]),t._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-lg-4 font-weight-bold col-form-label text-right"},[t._v("จำนวนที่สูญเสีย:")]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-6 pr-0"},[s("input",{staticClass:"form-control pr-0",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:Number(t.lossQty).toLocaleString()}})]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("input",{staticClass:"form-control",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:t.uom}})])])])])]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("div",{staticClass:"form-group row"},[t._m(3),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"",filterable:"",clearable:""},on:{change:function(e){return t.onOptChanged(e)}},model:{value:t.selectedOpt,callback:function(e){t.selectedOpt=e},expression:"selectedOpt"}},t._l(t.headerOpts,(function(t){return s("el-option",{key:t.opt,attrs:{label:t.opt,value:t.opt}})})),1)],1)]),t._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-lg-4 font-weight-bold col-form-label text-right",attrs:{for:"lb-2"}},[t._v("รหัสวัตถุดิบ: ")]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-5"},[s("input",{staticClass:"form-control pr-0",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:t.itemNumber}})]),t._v(" "),s("div",{staticClass:"col-lg-7 pl-0"},[s("input",{staticClass:"form-control pr-0",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:t.itemDesc}})])])])]),t._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-lg-4 font-weight-bold col-form-label text-right",attrs:{for:"lb-2"}},[t._v("ขั้นตอนการทำงาน: ")]),t._v(" "),s("div",{staticClass:"col-lg-6"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-lg-5"},[s("input",{staticClass:"form-control pr-0",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:t.wipStep}})]),t._v(" "),s("div",{staticClass:"col-lg-7 pl-0"},[s("input",{staticClass:"form-control pr-0",attrs:{type:"text",autocomplete:"off",disabled:"disabled"},domProps:{value:t.wipStepDesc}})])])])])])])])]),t._v(" "),s("div",{staticClass:"ibox float-e-margins"},[s("div",{staticClass:"ibox-content"},[s("div",{staticClass:"table-responsive"},[t.isShowLines&&Object.keys(t.jobLines).length>0?s("table",{staticClass:"table text-nowrap table-bordered"},[t._m(4),t._v(" "),s("tbody",t._l(t.jobLines,(function(e,n){return s("tr",{staticStyle:{"text-align":"center"}},[s("td",{staticClass:"col-readonly"},[t.isOpenFlag?s("span",[e.loss_data?s("span",[t._v("\n                                        "+t._s(e.loss_data.meaning)+"\n                                    ")]):s("span",[t._v("-")])]):t._e(),t._v(" "),!t.isOpenFlag&&e.meaning?s("span",[t._v("\n                                    "+t._s(e.meaning)+"\n                                ")]):t._e()]),t._v(" "),s("td",[t.isOpenFlag?s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.loss_qty,expression:"jobLine.loss_qty"}],ref:"input-confirm-quantity-ref",refInFor:!0,staticClass:"form-control",attrs:{id:"input-confirm-quantity",type:"number",min:"0",autocomplete:"off",disabled:!t.isEditing},domProps:{value:e.loss_qty},on:{input:function(s){s.target.composing||t.$set(e,"loss_qty",s.target.value)}}})]):t._e(),t._v(" "),t.isOpenFlag?t._e():s("span",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.attribute1,expression:"jobLine.attribute1"}],ref:"input-confirm-quantity-ref",refInFor:!0,staticClass:"form-control",attrs:{id:"input-confirm-quantity",type:"number",min:"0",autocomplete:"off"},domProps:{value:e.attribute1},on:{input:function(s){s.target.composing||t.$set(e,"attribute1",s.target.value)}}})])]),t._v(" "),s("td",{staticClass:"col-readonly"},[t.uom?s("span",[t._v("\n                                    "+t._s(t.uom)+"\n                                ")]):t._e()])])})),0)]):t._e()]),t._v(" "),t.isShowLines?t._e():s("div",{staticClass:"text-center mb-5"},[s("h2",{staticStyle:{color:"red"}},[t._v("ไม่พบข้อมูล")])]),t._v(" "),t.isShowLines&&Object.keys(t.jobLines).length>0?s("div",{staticClass:"text-center m-t"},[s("button",{staticClass:"btn btn-w-m btn-warning",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.onEditButtonClicked(e)}}},[s("i",{staticClass:"fa fa-pencil-square-o"}),t._v(" \n                    แก้ไข\n                ")]),t._v(" "),s("button",{staticClass:"btn btn-w-m btn-primary",attrs:{type:"button",disabled:!t.isEditing},on:{click:function(e){return e.preventDefault(),t.onSaveButtonClicked(e)}}},[s("i",{staticClass:"fa fa-save (alias)"}),t._v(" \n                    บันทึก\n                ")])]):t._e()])])])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ibox-content"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-3"},[s("h3",{staticClass:"no-margins"},[t._v(" บันทึกสูญเสีย ")])])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",{staticClass:"col-lg-2 font-weight-bold col-form-label text-right",attrs:{for:"lb-1"}},[t._v("วันที่บันทึกสูญเสีย"),s("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v(": ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",{staticClass:"col-lg-4 font-weight-bold col-form-label text-right",attrs:{for:"lb-2"}},[t._v("Blend no"),s("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v(": ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("label",{staticClass:"col-lg-4 font-weight-bold col-form-label text-right",attrs:{for:"lb-2"}},[t._v("OPT."),s("span",{staticStyle:{color:"red"}},[t._v("*")]),t._v(": ")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{staticClass:"text-center"},[t._v("รายการสูญเสีย")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("จำนวนสูญเสีย")]),t._v(" "),s("th",{staticClass:"text-center"},[t._v("หน่วยนับ")])])])}],!1,null,null,null).exports}}]);