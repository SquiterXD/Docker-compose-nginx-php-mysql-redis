(self.webpackChunk=self.webpackChunk||[]).push([[3018],{3018:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var s=a(87757),i=a.n(s);a(30381);function n(e,t,a,s,i,n,c){try{var l=e[n](c),r=l.value}catch(e){return void a(e)}l.done?t(r):Promise.resolve(r).then(s,i)}function c(e){return function(){var t=this,a=arguments;return new Promise((function(s,i){var c=e.apply(t,a);function l(e){n(c,s,i,l,r,"next",e)}function r(e){n(c,s,i,l,r,"throw",e)}l(void 0)}))}}const l={props:["machineGroups","assets","defaultValue","old","organizationCode","org","urlSave","urlReset"],data:function(){return{machine_group:this.old.machine_group?this.old.machine_group:this.defaultValue?this.defaultValue.machine_group:"",machine_set:this.old.machine_set?this.old.machine_set:this.defaultValue?this.defaultValue.machine_set:"",machine_name:this.old.machine_name?this.old.machine_name:this.defaultValue?this.defaultValue.machine_name:"",pm_enable_flag:this.old.pm_enable_flag?!!this.old.pm_enable_flag:!this.defaultValue||"Y"==this.defaultValue.pm_enable_flag,machine_description:"",machine_type:"",step_num:"",step_description:"",machine_speed:"",machine_eamperformance:"",machine_speed_unit:"",assetList:[],organization_code:this.organizationCode,csrf:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),loading:!1,machine_relation_id:this.defaultValue?this.defaultValue.machine_relation_id:""}},mounted:function(){this.machine_name?this.getAsset(this.machine_name):this.getAsset(),this.machine_description=this.defaultValue?this.defaultValue.machine_description:"",this.machine_type=this.defaultValue?this.defaultValue.machine_type.description:"",this.step_num=this.defaultValue?this.defaultValue.step_num:"",this.step_description=this.defaultValue?this.defaultValue.step_description:"",this.machine_speed=this.defaultValue?this.defaultValue.machine_speed.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"",this.machine_eamperformance=this.defaultValue?this.defaultValue.machine_eamperformance:"",this.machine_speed_unit=this.defaultValue?this.defaultValue.machine_speed_unit:"",console.log("organizationCode <--\x3e "+this.organizationCode),console.log("org <--\x3e "+this.org)},methods:{onlyNumeric:function(){this.machine_set=this.machine_set.replace(/[^0-9 .]/g,"")},getAsset:function(e){var t=this;return c(i().mark((function a(){return i().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.wip_uom="",t.assetList=[],axios.get("/pm/ajax/get-asset",{params:{query:e},beforeSend:function(e){$("#_content_transaction").html('                        <div class="m-t-lg m-b-lg">                            <div class="text-center sk-spinner sk-spinner-wave">                                <div class="sk-rect1"></div>                                <div class="sk-rect2"></div>                                <div class="sk-rect3"></div>                                <div class="sk-rect4"></div>                                <div class="sk-rect5"></div>                            </div>                        </div>')}}).then((function(e){t.assetList=e.data})).catch((function(e){console.log(e)}));case 3:case"end":return a.stop()}}),a)})))()},getData:function(){var e=this;this.machine_description="",this.machine_type="",this.step_num="",this.step_description="",this.machine_speed="",this.machine_eamperformance="",this.machine_speed_unit="",this.machine_name&&(this.selected=this.assetList.find((function(t){return t.asset_number==e.machine_name})),this.selected&&(this.machine_description=this.selected.asset_description,this.machine_type=this.selected.machine_type_desc,this.step_num=this.selected.wip_step,this.step_description=this.selected.wip_step_desc,this.machine_speed=this.selected.machine_speed,this.machine_eamperformance=this.selected.performance_percent,this.machine_speed_unit=this.selected.machine_speed_unit))},checkForm:function(e){var t=this;return c(i().mark((function a(){var s;return i().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:s=$("#submitForm"),t,axios.get("/pm/ajax/validate-asset",{params:{machine_name:t.machine_name,pm_enable_flag:t.pm_enable_flag,machine_relation_id:t.machine_relation_id}}).then((function(t){"Y"==t.data.data.status?swal({title:"Warning",text:"มีข้อมูลเครื่องจักรนี้ เปิดใช้งานอยู่แล้ว ต้องการยืนยันเปิดใช้งานข้อมูลนี้แทนหรือไม่?",type:"warning",showCancelButton:!0,closeOnConfirm:!1,closeOnCancel:!0,showLoaderOnConfirm:!0},(function(t){t?s.submit():(e.preventDefault(),swal({title:"มีข้อผิดพลาด",text:"",timer:3e3,type:"success",showCancelButton:!1,showConfirmButton:!1}))})):"N"==t.data.data.status&&s.submit(),e.preventDefault()}));case 3:case"end":return a.stop()}}),a)})))()}}};const r=(0,a(51900).Z)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("form",{attrs:{id:"submitForm",action:e.urlSave,method:"post"},on:{submit:function(t){return t.preventDefault(),e.checkForm(t)}}},[a("input",{attrs:{type:"hidden",name:"_token"},domProps:{value:e.csrf}}),e._v(" "),this.defaultValue?a("div",[a("input",{attrs:{type:"hidden",name:"_method",value:"PUT"}})]):e._e(),e._v(" "),a("div",[a("div",{staticClass:"container"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col"},[e._m(0),e._v(" "),a("input",{attrs:{type:"hidden",name:"machine_group",autocomplete:"off"},domProps:{value:e.machine_group}}),e._v(" "),a("el-select",{staticClass:"w-100",attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:""},model:{value:e.machine_group,callback:function(t){e.machine_group=t},expression:"machine_group"}},e._l(e.machineGroups,(function(e){return a("el-option",{key:e.lookup_code,attrs:{label:e.meaning,value:e.lookup_code}})})),1)],1),e._v(" "),a("div",{staticClass:"col"},[e._m(1),e._v(" "),a("el-input",{attrs:{name:"machine_set"},on:{input:function(t){return e.onlyNumeric()}},model:{value:e.machine_set,callback:function(t){e.machine_set=t},expression:"machine_set"}})],1)]),e._v(" "),a("div",{staticClass:"row mt-3"},[a("div",{staticClass:"col"},[e._m(2),e._v(" "),a("input",{attrs:{type:"hidden",name:"machine_name",autocomplete:"off"},domProps:{value:e.machine_name}}),e._v(" "),a("el-select",{staticClass:"w-100",attrs:{"remote-method":e.getAsset,filterable:"",remote:"","reserve-keyword":"",clearable:""},on:{change:function(t){return e.getData()}},model:{value:e.machine_name,callback:function(t){e.machine_name=t},expression:"machine_name"}},e._l(e.assetList,(function(e){return a("el-option",{key:e.asset_number,attrs:{label:e.asset_number+" : "+e.asset_description,value:e.asset_number}})})),1)],1),e._v(" "),a("div",{staticClass:"col"},[a("label",[e._v(" ประเภทเครื่องจักร ")]),e._v(" "),a("el-input",{attrs:{name:"machine_type",disabled:""},model:{value:e.machine_type,callback:function(t){e.machine_type=t},expression:"machine_type"}})],1)]),e._v(" "),a("div",{staticClass:"row mt-3"},[a("div",{staticClass:"col"},[a("label",[e._v(" ขั้นตอนการทำงาน ")]),e._v(" "),a("el-input",{attrs:{name:"step_description",disabled:""},model:{value:e.step_description,callback:function(t){e.step_description=t},expression:"step_description"}})],1),e._v(" "),a("div",{staticClass:"col"},[a("label",[e._v(" ความเร็วเครื่องจักร ("+e._s(e.machine_speed_unit)+") ")]),e._v(" "),a("el-input",{attrs:{name:"machine_speed",disabled:""},model:{value:e.machine_speed,callback:function(t){e.machine_speed=t},expression:"machine_speed"}})],1)]),e._v(" "),a("div",{staticClass:"row mt-3"},[a("div",{staticClass:"col"},[a("label",[e._v(" % ประสิทธิภาพของ EAM ")]),e._v(" "),a("el-input",{attrs:{name:"machine_eamperformance",disabled:""},model:{value:e.machine_eamperformance,callback:function(t){e.machine_eamperformance=t},expression:"machine_eamperformance"}})],1),e._v(" "),a("div",{staticClass:"col"},[a("label",[e._v(" สถานะการใช้งาน ")]),e._v(" "),a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.pm_enable_flag,expression:"pm_enable_flag"}],attrs:{type:"checkbox",name:"pm_enable_flag"},domProps:{checked:Array.isArray(e.pm_enable_flag)?e._i(e.pm_enable_flag,null)>-1:e.pm_enable_flag},on:{change:function(t){var a=e.pm_enable_flag,s=t.target,i=!!s.checked;if(Array.isArray(a)){var n=e._i(a,null);s.checked?n<0&&(e.pm_enable_flag=a.concat([null])):n>-1&&(e.pm_enable_flag=a.slice(0,n).concat(a.slice(n+1)))}else e.pm_enable_flag=i}}})])])])])]),e._v(" "),a("div",{staticClass:"col-12 mt-3"},[a("hr"),e._v(" "),a("div",{staticClass:"row clearfix m-t-lg text-right"},[a("div",{staticClass:"col-sm-12"},[e._m(3),e._v(" "),a("a",{staticClass:"btn btn-sm btn-warning",attrs:{href:this.urlReset,type:"button"}},[a("i",{staticClass:"fa fa-times"}),e._v(" ยกเลิก\n        ")])])])])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("label",[e._v(" กลุ่มชุดเครื่องจักร "),a("span",{staticClass:"text-danger"},[e._v("*")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("label",[e._v(" เซ็ตเครื่องจักร "),a("span",{staticClass:"text-danger"},[e._v("*")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("label",[e._v(" รหัสเครื่องจักร "),a("span",{staticClass:"text-danger"},[e._v("*")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"submit"}},[a("i",{staticClass:"fa fa-save"}),e._v(" บันทึก\n        ")])}],!1,null,null,null).exports}}]);