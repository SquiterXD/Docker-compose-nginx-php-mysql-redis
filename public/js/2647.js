(self.webpackChunk=self.webpackChunk||[]).push([[2647],{32647:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>u});var n,r=a(87757),s=a.n(r);a(30381);function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e,a,n,r,s,i){try{var o=t[s](i),c=o.value}catch(t){return void a(t)}o.done?e(c):Promise.resolve(c).then(n,r)}function c(t){return function(){var e=this,a=arguments;return new Promise((function(n,r){var s=t.apply(e,a);function i(t){o(s,n,r,i,c,"next",t)}function c(t){o(s,n,r,i,c,"throw",t)}i(void 0)}))}}const l=(i(n={props:["pUrl"],computed:{secondaryUomList:function(){var t=this;if(t.header.inventory_item_id){var e=t.data.item_list.filter((function(e){return e.inventory_item_id==t.header.inventory_item_id}));if(e.length)return t.header.attribute1||(t.header.attribute1=e[0].primary_uom_code),e[0].secondary_uom_list}return[]}},watch:{}},"computed",{}),i(n,"data",(function(){return{url:this.pUrl,data:!1,header:!1,profile:!1,searchTransactionDateFormat:"",transBtn:{},transDate:{},biweekly:{},lines:[],loading:{page:!1,before_mount:!1},firstLoad:!0,countOpen:0}})),i(n,"beforeMount",(function(){console.log("beforeMount"),this.getInfo()})),i(n,"mounted",(function(){console.log("Component mounted.")})),i(n,"methods",{show:function(t){var e=this;return c(s().mark((function a(){return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:console.log("show header",t),e.header=t,e.getLines(!1,"show");case 3:case"end":return a.stop()}}),a)})))()},adjQty:function(t){var e=arguments,a=this;return c(s().mark((function n(){var r,i,o;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=!(e.length>1&&void 0!==e[1])||e[1],i=a,r&&(t.transaction_qty=Math.ceil(parseFloat(t.ratio_require_per_unit)*parseFloat(i.header.request_quantity)),t.ca_qty=Math.trunc(parseFloat(t.transaction_qty)/parseFloat(t.ca_convert_rate)),o=parseFloat(t.transaction_qty)/parseFloat(t.ca_convert_rate)-t.ca_qty,o=Math.ceil(o*t.ca_convert_rate)/t.a3_convert_rate,t.a3_qty=o),t.transaction_qty=t.ca_qty*t.ca_convert_rate+t.a3_qty*t.a3_convert_rate,t.transaction_qty=Math.ceil(t.transaction_qty),t.transaction_qty<=0?t.is_selected=!1:t.is_selected=!0;case 6:case"end":return n.stop()}}),n)})))()},resetQty:function(){var t=this;return c(s().mark((function e(){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t,t.lines.forEach(function(){var t=c(s().mark((function t(e,n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.adjQty(e);case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})))()},getInfo:function(){var t=this;return c(s().mark((function e(){var a,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,n=window.location.search,r=!1,a.loading.page=!0,a.loading.before_mount=!0,a.lines=[],e.next=8,axios.get(a.url.index+n).then((function(t){"S"==(r=t.data.data).status&&(r=r.info),a.loading.page=!1}));case 8:r&&(a.data=r.data,a.header=r.header,a.profile=r.profile,a.transBtn=r.transBtn,a.transDate=r.transDate,a.url=r.url),a.loading.before_mount=!1;case 10:case"end":return e.stop()}}),e)})))()},selectInventoryItem:function(t){var e=this;return c(s().mark((function a(){var n,r,i,o;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=e,"blend_no"==t&&(n.header.inventory_item_id="",n.header.product_unit_of_measure="",n.header.blend_no&&(r=n.data.item_list.filter((function(t){return t.blend_no==n.header.blend_no}))).length&&(n.header.inventory_item_id=r[0].inventory_item_id,n.header.product_unit_of_measure=r[0].product_unit_of_measure)),"inventory_item_id"==t&&(n.header.blend_no="",n.header.product_unit_of_measure="",n.header.inventory_item_id&&(i=n.data.item_list.filter((function(t){return t.inventory_item_id==n.header.inventory_item_id})),n.selectProdItem={},i.length&&(n.header.blend_no=i[0].blend_no,n.selectProdItem=i[0],n.header.product_unit_of_measure=i[0].product_unit_of_measure))),n.data.tobacco_type_list=[],n.header.tobacco_type_code="",n.header.inventory_item_id&&(o=n.data.item_list.findIndex((function(t){return t.inventory_item_id==n.header.inventory_item_id})),n.data.tobacco_type_list=n.data.item_list[o].tobacco_type_list,n.header.tobacco_type_code=n.data.tobacco_type_list[0].tobacco_type_code);case 6:case"end":return a.stop()}}),a)})))()},changeRequestQuantity:function(){var t=this;return c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.resetQty(),e.abrupt("return");case 2:case"end":return e.stop()}}),e)})))()},addNewLine:function(){var t=this;return c(s().mark((function e(){var a,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(a=t).lines.length,e.next=4,_.clone(a.data.new_line);case 4:r=e.sent,a.$set(a.lines,n,r);case 6:case"end":return e.stop()}}),e)})))()},itemWasSelected:function(t,e){return c(s().mark((function a(){return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.segment1=t.segment1,e.description=t.description,e.inventory_item_id=t.inventory_item_id,e.organization_id=t.organization_id,console.log("itemWasSelected(item, line)",t,e);case 5:case"end":return a.stop()}}),a)})))()},save:function(){var t=this;return c(s().mark((function e(){var a,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,helperAlert.showProgressConfirm("กรุณายืนยัน บันทึกเรียกใบยา");case 3:if(!e.sent){e.next=9;break}return a.loading.page=!0,n=a.lines.filter((function(t){return 1==t.is_selected})),e.next=9,axios.post(a.url.ajax_store,{header:a.header,lines:n}).then((function(t){var e=t.data.data;"S"==e.status&&(swal({title:"Success",text:"ยืนยันเรียกใบยาสำเร็จ",type:"success",showConfirmButton:!0}),setTimeout(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.getInfo();case 2:case"end":return t.stop()}}),t)}))),500)),"S"!=e.status&&swal({title:"Error !",text:e.msg,type:"error",showConfirmButton:!0})})).catch((function(t){var e=t.response.data;alert(e.message)})).then((function(){a.loading.page=!1}));case 9:case"end":return e.stop()}}),e)})))()},setStatus:function(t){var e=this;return c(s().mark((function a(){var n,r,i;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e,!1,r="","confirmTransfer"==t&&(r="กรุณายืนยันโอนวัถุดิบ"),"cancelTransfer"==t&&(r="กรุณายืนยันยกเลิกโอน"),a.next=7,helperAlert.showProgressConfirm(r);case 7:if(!a.sent){a.next=14;break}return n.loading.page=!0,i=n.url.ajax_set_status,""!=n.header.storage_header_id&&null!=n.header.storage_header_id&&(i=i.replace("-999",n.header.storage_header_id)),a.next=14,axios.post(i,{status:t}).then((function(t){var e=t.data.data;"S"==e.status&&(n.header.request_status=String(e.request_status),n.header.can=e.can),"S"!=t.data.data.status&&swal({title:"Error !",text:t.data.data.msg,type:"error",showConfirmButton:!0})})).catch((function(t){var e=t.response.data;alert(e.message)})).then((function(){n.loading.page=!1}));case 14:case"end":return a.stop()}}),a)})))()},setData:function(){var t=this;return c(s().mark((function e(){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null!=(a=t).header.storage_header_id&&""!=a.header.storage_header_id&&a.getLines(!1,"show"),a.firstLoad=!1;case 3:case"end":return e.stop()}}),e)})))()},indexPage:function(){this.getInfo()},getLines:function(){var t=arguments,e=this;return c(s().mark((function a(){var n,r,i,o;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=!(t.length>0&&void 0!==t[0])||t[0],r=t.length>1&&void 0!==t[1]?t[1]:"search",i=e,o=!0,!n){a.next=8;break}return a.next=7,helperAlert.showProgressConfirm("ต้องการเปลี่ยนแปลงค้นหาเรียกใบยา ?");case 7:o=a.sent;case 8:if(console.log("getLines",n,o),!o){a.next=14;break}return i.loading.page=!0,i.lines=[],a.next=14,axios.get(i.url.ajax_get_lines,{params:{header:i.header,action:r}}).then((function(t){var e=t.data.data;i.lines=e.lines,i.resetQty()})).catch((function(t){var e=t.response.data;alert(e.message)})).then((function(){i.loading.page=!1}));case 14:return a.abrupt("return");case 15:case"end":return a.stop()}}),a)})))()},changeQty:function(t,e){var a=this;return c(s().mark((function n(){var r,i,o;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=a,"cgc_quantity"==e?(i=""!=t.cgc_quantity&&null!=t.cgc_quantity?t.cgc_quantity:0,t.cgk_quantity="",t.cgk_quantity=parseFloat(i)*parseFloat(r.data.convert_rate)):"cgk_quantity"==e&&(o=""!=t.cgk_quantity&&null!=t.cgk_quantity?t.cgk_quantity:0,t.cgc_quantity="",t.cgc_quantity=parseFloat(o)/parseFloat(r.data.convert_rate));case 2:case"end":return n.stop()}}),n)})))()}}),n);const u=(0,a(51900).Z)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.page,expression:"loading.page"}],staticClass:"ibox float-e-margins"},[t.loading.before_mount?t._e():a("div",{staticClass:"ibox-content"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-7 offset-1"},[a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-lg-6 font-weight-bold col-form-label text-right"},[t._v("วันที่เรียกใบยา :")]),t._v(" "),a("div",{staticClass:"col-lg-6"},[a("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%"},attrs:{name:"input_date",disabled:!0,id:"input_date",placeholder:"โปรดเลือกวันที่",value:t.header.transaction_date_format,format:t.transDate["js-format"]},on:{dateWasSelected:function(e){for(var a=arguments.length,n=Array(a);a--;)n[a]=arguments[a];return t.setdate.apply(void 0,n.concat(["transaction_date_format"]))}}})],1)]),t._v(" "),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-lg-6 font-weight-bold col-form-label text-right"},[t._v("Blend No.: ")]),t._v(" "),a("div",{staticClass:"col-lg-6"},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"blend_no",clearable:"",filterable:""},on:{change:function(e){return t.selectInventoryItem("blend_no")}},model:{value:t.header.blend_no,callback:function(e){t.$set(t.header,"blend_no",e)},expression:"header.blend_no"}},t._l(t.data.blend_no_list,(function(t){return a("el-option",{key:JSON.stringify(t),attrs:{label:t,value:t}})})),1)],1)]),t._v(" "),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-lg-6 font-weight-bold col-form-label text-right"},[t._v("สินค้าที่จะผลิต: ")]),t._v(" "),a("div",{staticClass:"col-lg-6"},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"blend_no",clearable:"",filterable:""},on:{change:function(e){return t.selectInventoryItem("inventory_item_id")}},model:{value:t.header.inventory_item_id,callback:function(e){t.$set(t.header,"inventory_item_id",e)},expression:"header.inventory_item_id"}},t._l(t.data.item_list,(function(t){return a("el-option",{key:JSON.stringify(t),attrs:{label:t.display,value:t.inventory_item_id}})})),1)],1)]),t._v(" "),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-lg-6 font-weight-bold col-form-label text-right require"},[t._v("ประเภทใบยาที่ต้องการเรียก *: ")]),t._v(" "),a("div",{staticClass:"col-lg-6"},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"blend_no",clearable:"",filterable:""},model:{value:t.header.tobacco_type_code,callback:function(e){t.$set(t.header,"tobacco_type_code",e)},expression:"header.tobacco_type_code"}},t._l(t.data.tobacco_type_list,(function(t){return a("el-option",{key:JSON.stringify(t),attrs:{label:t.tobacco_type_code+" : "+t.tobacco_type,value:t.tobacco_type_code}})})),1)],1)]),t._v(" "),a("div",{staticClass:"form-group row"},[a("label",{staticClass:"col-lg-6 font-weight-bold col-form-label text-right"},[t._v("จำนวนที่สั่งผลิต: ")]),t._v(" "),a("div",{staticClass:"col-lg-3"},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.header.request_quantity,expression:"header.request_quantity",modifiers:{number:!0}}],staticClass:"form-control text-right",attrs:{type:"number",disabled:!t.header.inventory_item_id},domProps:{value:t.header.request_quantity},on:{change:t.changeRequestQuantity,input:function(e){e.target.composing||t.$set(t.header,"request_quantity",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),a("div",{staticClass:"col-lg-3"},[a("input",{staticClass:"form-control",attrs:{title:t.header.primary_uom_code,disabled:""},domProps:{value:t.header.product_unit_of_measure}})])]),t._v(" "),a("div",{staticClass:"form-group row mb-0"},[a("div",{staticClass:"col-lg-12 text-right"},[a("button",{class:t.transBtn.search.class+" btn-lg tw-w-25",on:{click:function(e){return e.preventDefault(),t.getLines(!1)}}},[a("i",{class:t.transBtn.search.icon}),t._v("\n                                "+t._s(t.transBtn.search.text)+"\n                            ")])])])])])])]),t._v(" "),t.loading.before_mount?t._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.page,expression:"loading.page"}],staticClass:"ibox float-e-margins"},[a("div",{staticClass:"ibox-content"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[t._v("\n                    ค้นหาข้อมูลปักษ์ที่ : "),t.biweekly?a("span",[t._v(" "+t._s(t.biweekly.biweekly)+" ")]):t._e()])]),t._v(" "),a("div",{staticClass:"table-responsive m-t"},[a("table",{staticClass:"table text-nowrap table-bordered"},[t._m(0),t._v(" "),a("tbody",t._l(t.lines,(function(e,n){return t.lines.length?a("tr",[a("td",{staticClass:"align-middle text-center",attrs:{date:n}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.is_selected,expression:"line.is_selected"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.is_selected)?t._i(e.is_selected,null)>-1:e.is_selected},on:{change:function(a){var n=e.is_selected,r=a.target,s=!!r.checked;if(Array.isArray(n)){var i=t._i(n,null);r.checked?i<0&&t.$set(e,"is_selected",n.concat([null])):i>-1&&t.$set(e,"is_selected",n.slice(0,i).concat(n.slice(i+1)))}else t.$set(e,"is_selected",s)}}})]),t._v(" "),a("td",{staticClass:"text-center"},[t._v("\n                                "+t._s(e.leaf_fomula)+"\n                            ")]),t._v(" "),a("td",[t._v("\n                                "+t._s(e.item_number)+"\n                            ")]),t._v(" "),a("td",[t._v("\n                                "+t._s(e.item_desc)+"\n                                ")]),t._v(" "),a("td",{staticClass:"text-right",attrs:{title:e.require_qty}},[t._v("\n                                "+t._s(Math.ceil(e.ratio_require_per_unit*t.header.request_quantity))+"\n                                "+t._s(e.uom.unit_of_measure)+"\n                            ")]),t._v(" "),a("td",{staticClass:"text-right"},[NaN!=e.transaction_qty?a("span",[t._v("\n                                    "+t._s(e.transaction_qty)+"\n                                ")]):t._e(),t._v("\n                                "+t._s(e.uom.unit_of_measure)+"\n                            ")]),t._v(" "),a("td",{staticClass:"text-center"},[a("div",{staticClass:"input-group "},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.ca_qty,expression:"line.ca_qty",modifiers:{number:!0}}],staticClass:"form-control text-right",attrs:{type:"number"},domProps:{value:e.ca_qty},on:{change:function(a){return t.adjQty(e,!1)},input:function(a){a.target.composing||t.$set(e,"ca_qty",t._n(a.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t._m(1,!0)])]),t._v(" "),a("td",{staticClass:"text-center"},[a("div",{staticClass:"input-group "},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.a3_qty,expression:"line.a3_qty",modifiers:{number:!0}}],staticClass:"form-control text-right",attrs:{type:"number"},domProps:{value:e.a3_qty},on:{change:function(a){return t.adjQty(e,!1)},input:function(a){a.target.composing||t.$set(e,"a3_qty",t._n(a.target.value))},blur:function(e){return t.$forceUpdate()}}}),t._v(" "),t._m(2,!0)])])]):t._e()})),0)])]),t._v(" "),0===t.lines.length?a("div",{staticClass:"text-center"},[a("span",{staticClass:"lead"},[t._v("No Data.")])]):t._e(),t._v(" "),a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.lines.length>0&&!t.loading.before_mount?a("div",{staticClass:"text-center"},[a("button",{class:t.transBtn.save.class+" btn-lg tw-w-25",on:{click:function(e){return e.preventDefault(),t.save(e)}}},[a("i",{class:t.transBtn.save.icon}),t._v(" "),t._v("\n                        ยืนยันเรียกใบยา\n                    ")])]):t._e()])],1)])])}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",{attrs:{width:"10px;"}}),t._v(" "),a("th",{staticClass:"text-center",attrs:{width:"50px;"}},[t._v("\n                                กลุ่มใบยา\n                            ")]),t._v(" "),a("th",{attrs:{width:"150px;"}},[t._v("\n                                รหัสวัตถุดิบ\n                            ")]),t._v(" "),a("th",[t._v("รายละเอียด")]),t._v(" "),a("th",{staticClass:"text-center",attrs:{width:"200px;"}},[t._v("\n                                ปริมาณที่ใช้\n                            ")]),t._v(" "),a("th",{staticClass:"text-center",attrs:{width:"200px;"}},[t._v("\n                                ปริมาณเบิก\n                            ")]),t._v(" "),a("th",{staticClass:"text-center",attrs:{width:"400px;"}},[t._v("\n                                ปริมาณ"),a("br"),t._v("\n                                ที่ต้องการเบิก"),a("br"),t._v("\n                                FULL/ASRS\n                            ")]),t._v(" "),a("th",{staticClass:"text-center",attrs:{width:"400px;"}},[t._v("\n                                ปริมาณ"),a("br"),t._v("\n                                ที่ต้องการเบิก"),a("br"),t._v("\n                                Quarter/RGV\n                            ")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-append",attrs:{title:"line.transaction_uom"}},[a("span",{staticClass:"input-group-addon"},[t._v("หีบ")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-append",attrs:{title:"line.transaction_uom"}},[a("span",{staticClass:"input-group-addon"},[t._v("ลูก")])])}],!1,null,null,null).exports}}]);