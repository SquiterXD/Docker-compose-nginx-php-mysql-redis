(self.webpackChunk=self.webpackChunk||[]).push([[5126],{45126:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var a=i(87757),n=i.n(a),r=i(1550);const o={name:"ir-confirm-to-ap-lov-interface-type",data:function(){return{rows:[],loading:!1,result:this.value}},props:["placeholder","name","value","size","popperBody"],methods:{remoteMethod:function(e){this.getDataRows({lookup_code:"",keyword:e})},getDataRows:function(e){var t=this;this.loading=!0,axios.get("/ir/ajax/lov/interface-type",{params:e}).then((function(e){var i=e.data.data;t.loading=!1,t.rows=i})).catch((function(e){swal("Error",e,"error")}))},focus:function(e){this.getDataRows({lookup_code:"",keyword:""})},change:function(e){var t={id:"",code:"",desc:""};if(e)for(var i in this.rows){var a=this.rows[i];a.lookup_code===e&&(t.code=e,t.desc=a.description,t.id=a.meaning)}else t.id="",t.code="",t.desc="";this.$emit("change-lov",t)}},mounted:function(){this.getDataRows({lookup_code:"",keyword:""})},watch:{value:function(e,t){this.result=e}}};var s=i(51900);const c=(0,s.Z)(o,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"el_select"},[i("el-select",{attrs:{placeholder:e.placeholder,name:e.name,"remote-method":e.remoteMethod,loading:e.loading,remote:"",clearable:!0,filterable:"",size:e.size,"popper-append-to-body":e.popperBody},on:{focus:e.focus,change:e.change},model:{value:e.result,callback:function(t){e.result=t},expression:"result"}},e._l(e.rows,(function(e,t){return i("el-option",{key:t,attrs:{label:e.description,value:e.lookup_code}})})),1)],1)}),[],!1,null,null,null).exports;var l=i(30381),d=i.n(l),f=i(67791);function p(e,t,i,a,n,r,o){try{var s=e[r](o),c=s.value}catch(e){return void i(e)}s.done?t(c):Promise.resolve(c).then(a,n)}function u(e){return function(){var t=this,i=arguments;return new Promise((function(a,n){var r=e.apply(t,i);function o(e){p(r,a,n,o,s,"next",e)}function s(e){p(r,a,n,o,s,"throw",e)}o(void 0)}))}}function _(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const h={name:"ir-confirm-to-ap-index",data:function(){return{index:{interface_year:"",interface_type:"",invoice_date:"",invoice_batch:"",group_id:""},vars:f.gR,rules:{interface_year:[{required:!0,message:"กรุณาระบุปี",trigger:"change"}],interface_type:[{required:!0,message:"กรุณาระบุประเภท",trigger:"change"}],invoice_date:[{required:!0,message:"กรุณาระบุวันที่ใบแจ้งหนี้",trigger:"change"}]},funcs:f.sD,disabledInterface:!0,showLoading:!1,groupId:[],errors:{invoice_batch:!1,group_id:!1}}},mounted:function(){this.convertDateThai()},watch:{errors:{handler:function(e){e.invoice_batch?this.setError("invoice_batch"):this.resetError("invoice_batch"),e.group_id?this.setError("group_id"):this.resetError("group_id")},deep:!0}},methods:{clickPrintReport:function(){var e=$("#comfirm-ap"),t="",i=this;i.errors.invoice_batch=!1,i.errors.group_id=!1,$(e).find("div[id='el_explode_invoice_batch']").html(""),$(e).find("div[id='el_explode_group_id']").html(""),i.$refs.index_ap_invoice_interface.validate((function(e){if(!e)return!1;i.getReport(),i.disabledInterface=!1})),""==i.index.invoice_batch&&(i.errors.invoice_batch=!0,!1,t="กรุณาระบุ Invoice Batch",$(e).find("div[id='el_explode_invoice_batch']").html(t))},clickInterface:function(){var e=$("#comfirm-ap"),t=!0,i="",a=this;a.errors.invoice_batch=!1,a.errors.group_id=!1,$(e).find("div[id='el_explode_invoice_batch']").html(""),$(e).find("div[id='el_explode_group_id']").html(""),""==a.index.invoice_batch&&(a.errors.invoice_batch=!0,t=!1,i="กรุณาระบุ Invoice Batch",$(e).find("div[id='el_explode_invoice_batch']").html(i)),a.$refs.index_ap_invoice_interface.validate((function(e){if(!e)return!1;t&&a.getInterface()}))},clickCancel:function(){var e=$("#comfirm-ap"),t=!0,i="",a=this;a.errors.invoice_batch=!1,a.errors.group_id=!1,$(e).find("div[id='el_explode_invoice_batch']").html(""),$(e).find("div[id='el_explode_group_id']").html(""),""==a.index.group_id&&(a.errors.group_id=!0,t=!1,i="กรุณาระบุ Group ID",$(e).find("div[id='el_explode_group_id']").html(i)),a.$refs.index_ap_invoice_interface.validate((function(e){if(!e)return!1;t&&a.getCancel()}))},changeInvoiceDate:function(e){var t=this.vars.formatDate;e?(this.index.invoice_date=d()(e).format(t),this.$refs.index_ap_invoice_interface.fields.find((function(e){return"invoice_date"==e.prop})).clearValidate()):(this.$refs.invoice_date.resetField(),this.$refs.index_ap_invoice_interface.validateField("invoice_date")),""!=this.index.interface_year&&""!=this.index.interface_type&&""!=this.index.invoice_date&&this.getGroupIdVal(),""!=this.index.interface_type&&""!=this.index.invoice_date&&this.getDefaultAPBatch()},getValueInterfaceType:function(e){this.index.interface_type=e.code,""!=this.index.interface_year&&""!=this.index.interface_type&&""!=this.index.invoice_date&&this.getGroupIdVal(),""!=this.index.interface_type&&""!=this.index.invoice_date&&this.getDefaultAPBatch()},getValueInterfaceYear:function(e){var t=this.vars.formatYear;e?(this.index.interface_year=d()(e).format(t),this.$refs.index_ap_invoice_interface.fields.find((function(e){return"interface_year"==e.prop})).clearValidate()):(this.$refs.interface_year.resetField(),this.$refs.index_ap_invoice_interface.validateField("interface_year")),""!=this.index.interface_year&&""!=this.index.interface_type&&""!=this.index.invoice_date&&this.getGroupIdVal()},getInterface:function(){var e=this;this.showLoading=!0;var t={year:this.funcs.setYearCE("year",this.index.interface_year),type:this.index.interface_type,date:this.funcs.setYearCE("date",this.index.invoice_date),invoice_batch:this.index.invoice_batch};axios.get("/ir/ajax/confirm-ap",{params:t}).then((function(t){e.showLoading=!1,window.open(t.data.data.redirect_to_export,"_blank"),swal({title:'<div class="mt-4"> Success </div>',text:'<span style="font-size: 16px; text-align: left;"> ทำการ Interface ข้อมูลเข้า AP เรียบร้อยแล้ว </span>',type:"success",html:!0},(function(e){e&&(window.location.href="/ir/confirm-to-ap")}))})).catch((function(t){e.showLoading=!1,swal({title:'<div class="mt-4"> Warning </div>',text:'<span style="font-size: 16px; text-align: left;">'+t.response.data.message.msg+"</span>",type:"warning",html:!0}),e.disabledInterface=!0}))},getReport:function(){var e=this;this.showLoading=!0;var t={year:this.funcs.setYearCE("year",this.index.interface_year),type:this.index.interface_type,date:this.funcs.setYearCE("date",this.index.invoice_date),invoice_batch:this.index.invoice_batch};axios.get("/ir/ajax/confirm-ap/report",{params:t}).then((function(t){e.showLoading=!1,window.open(t.data.data.redirect_to_export,"_blank")})).catch((function(t){swal({title:'<div class="mt-4"> Warning </div>',text:'<span style="font-size: 16px; text-align: left;">'+t.response.data.message+"</span>",type:"warning",html:!0}),e.disabledInterface=!0,e.showLoading=!1}))},getCancel:function(){var e,t=this;swal((_(e={html:!0,title:"ยกเลิกรายการ Interface AP",text:'<h2 class="m-t-sm m-b-lg"><span style="font-size: 18px"> คุณต้องการยกเลิกรายการ Interface AP ใช่หรือไม่? </span></h2>',showCancelButton:!0,confirmButtonText:"ตกลง",cancelButtonText:"ยกเลิก",confirmButtonClass:"#1ab394",cancelButtonClass:"#e7eaec"},"confirmButtonClass","btn btn-primary btn-lg tw-w-25"),_(e,"cancelButtonClass","btn btn-danger btn-lg tw-w-25"),_(e,"closeOnConfirm",!1),_(e,"closeOnCancel",!0),_(e,"showLoaderOnConfirm",!0),e),function(){var e=u(n().mark((function e(i){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i&&t.cancel();case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())},cancel:function(){var e=this;this.showLoading=!0;var t={year:this.funcs.setYearCE("year",this.index.interface_year),type:this.index.interface_type,date:this.funcs.setYearCE("date",this.index.invoice_date),group_id:this.index.group_id};axios.get("/ir/ajax/confirm-ap/cancel",{params:t}).then((function(t){e.showLoading=!1,window.open(t.data.data.redirect_to_export,"_blank"),swal({title:'<div class="mt-4"> Success </div>',text:'<span style="font-size: 16px; text-align: left;"> ยกเลิกรายการสำเร็จ </span>',type:"success",html:!0},(function(e){e&&(window.location.href="/ir/confirm-to-ap")}))})).catch((function(t){console.log(t.response),e.showLoading=!1,swal({title:'<div class="mt-4"> Warning </div>',text:'<span style="font-size: 16px; text-align: left;">'+t.response.data.message+"</span>",type:"warning",html:!0}),e.disabledInterface=!0}))},clickClear:function(){window.location.href="/ir/confirm-to-ap"},getGroupIdVal:function(){var e=this;return u(n().mark((function t(){var i,a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={interface_year:(i=e).index.interface_year,from_program_code:i.index.interface_type,invoice_date:i.index.invoice_date},t.next=4,axios.post("/ir/ajax/confirm-ap/get-group-id",{params:a}).then((function(e){i.groupId=e.data.data.group_id})).catch((function(e){i.groupId=""}));case 4:case"end":return t.stop()}}),t)})))()},getDefaultAPBatch:function(){var e=this;return u(n().mark((function t(){var i,a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={from_program_code:(i=e).index.interface_type,invoice_date:i.index.invoice_date},t.next=4,axios.post("/ir/ajax/confirm-ap/get-ap-batch",{params:a}).then((function(e){"E"==e.data.data.status?(i.index.invoice_batch="",swal({title:'<div class="mt-4"> มีข้อผิดพลาด </div>',text:'<span style="font-size: 16px; text-align: left;">'+e.data.data.msg+"</span>",type:"warning",html:!0})):i.index.invoice_batch=e.data.data.invoice_batch})).catch((function(e){i.index.invoice_batch=""}));case 4:case"end":return t.stop()}}),t)})))()},convertDateThai:function(){var e=this;return u(n().mark((function t(){var i,a;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=d()().format("DD-MM-YYYY"),t.next=3,helperDate.parseToDateTh(i,"DD-MM-YYYY");case 3:a=t.sent,e.index.invoice_date=d()(a).format("DD-MM-YYYY");case 6:case"end":return t.stop()}}),t)})))()},setError:function(e){(this.$refs[e].$refs.reference?this.$refs[e].$refs.reference.$refs.input:this.$refs[e].$refs.textarea?this.$refs[e].$refs.textarea:this.$refs[e].$refs.input.$refs?this.$refs[e].$refs.input.$refs.input:this.$refs[e].$refs.input).style="border: 1px solid red;"},resetError:function(e){(this.$refs[e].$refs.reference?this.$refs[e].$refs.reference.$refs.input:this.$refs[e].$refs.textarea?this.$refs[e].$refs.textarea:this.$refs[e].$refs.input.$refs?this.$refs[e].$refs.input.$refs.input:this.$refs[e].$refs.input).style=""}},components:{yearInput:r.Z,lovInterfaceType:c}};const v=(0,s.Z)(h,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.showLoading,expression:"showLoading"}]},[i("form",{attrs:{id:"comfirm-ap"}},[i("el-form",{ref:"index_ap_invoice_interface",staticClass:"demo-ruleForm",attrs:{model:e.index,rules:e.rules,"label-width":"120px"}},[i("div",{staticClass:"col-lg-11"},[i("div",{staticClass:"row"},[i("label",{staticClass:"col-md-5 col-form-label lable_align"},[i("strong",[e._v("ปี *")])]),e._v(" "),i("div",{staticClass:"col-xl-4 col-lg-5 col-md-6 el_field"},[i("el-form-item",{ref:"interface_year",attrs:{prop:"interface_year"}},[i("datepicker-th",{staticClass:"el-input__inner",staticStyle:{width:"100%"},attrs:{name:"interface_year",id:"interface_year","p-type":"year",placeholder:"ปี",format:e.vars.formatYear},on:{dateWasSelected:e.getValueInterfaceYear},model:{value:e.index.interface_year,callback:function(t){e.$set(e.index,"interface_year",t)},expression:"index.interface_year"}})],1)],1)]),e._v(" "),i("div",{staticClass:"row"},[i("label",{staticClass:"col-md-5 col-form-label lable_align"},[i("strong",[e._v("ประเภท *")])]),e._v(" "),i("div",{staticClass:"col-xl-4 col-lg-5 col-md-6 el_field"},[i("el-form-item",{attrs:{prop:"interface_type"}},[i("lov-interface-type",{attrs:{placeholder:"ประเภท",name:"interface_type",size:"",popperBody:!0},on:{"change-lov":e.getValueInterfaceType},model:{value:e.index.interface_type,callback:function(t){e.$set(e.index,"interface_type",t)},expression:"index.interface_type"}})],1)],1)]),e._v(" "),i("div",{staticClass:"row"},[i("label",{staticClass:"col-md-5 col-form-label lable_align"},[i("strong",[e._v("วันที่ใบแจ้งหนี้ *")])]),e._v(" "),i("div",{staticClass:"col-xl-4 col-lg-5 col-md-6 el_field"},[i("el-form-item",{ref:"invoice_date",attrs:{prop:"invoice_date"}},[i("datepicker-th",{staticClass:"el-input__inner",staticStyle:{width:"100%"},attrs:{name:"invoice_date",id:"input_date","p-type":"date",placeholder:"วันที่ใบแจ้งหนี้",format:e.vars.formatDate},on:{dateWasSelected:e.changeInvoiceDate},model:{value:e.index.invoice_date,callback:function(t){e.$set(e.index,"invoice_date",t)},expression:"index.invoice_date"}})],1)],1)]),e._v(" "),i("div",{staticClass:"row mb-3"},[i("label",{staticClass:"col-md-5 col-form-label lable_align"},[i("strong",[e._v("Invoice Batch ")])]),e._v(" "),i("div",{staticClass:"col-xl-4 col-lg-5 col-md-6"},[i("el-input",{ref:"invoice_batch",attrs:{placeholder:"Invoice Batch",clearable:""},model:{value:e.index.invoice_batch,callback:function(t){e.$set(e.index,"invoice_batch",t)},expression:"index.invoice_batch"}}),e._v(" "),i("div",{staticClass:"tw-font-bold",staticStyle:{"font-size":"12px",color:"#8d8d8d"}},[e._v("\n              Invoice Batch : ระบุเฉพาะกรณีส่ง Interface AP\n            ")]),e._v(" "),i("div",{staticClass:"error_msg text-left",staticStyle:{"font-size":"12px"},attrs:{id:"el_explode_invoice_batch"}})],1)]),e._v(" "),i("div",{staticClass:"row mb-4"},[i("label",{staticClass:"col-md-5 col-form-label lable_align"},[i("strong",[e._v(" Group ID ")])]),e._v(" "),i("div",{staticClass:"col-xl-4 col-lg-5 col-md-6 el_field"},[i("el-select",{ref:"group_id",attrs:{filterable:"",clearable:"",placeholder:"Group ID"},model:{value:e.index.group_id,callback:function(t){e.$set(e.index,"group_id",t)},expression:"index.group_id"}},e._l(e.groupId,(function(e,t){return i("el-option",{key:t,attrs:{label:e.group_id,value:e.group_id}})})),1),e._v(" "),i("div",{staticClass:"tw-font-bold",staticStyle:{"font-size":"12px",color:"#8d8d8d"}},[e._v("\n              Group ID : ระบุเฉพาะกรณียกเลิก Interface AP\n            ")]),e._v(" "),i("div",{staticClass:"error_msg text-left",staticStyle:{"font-size":"12px"},attrs:{id:"el_explode_group_id"}})],1)])]),e._v(" "),i("div",{staticClass:"text-right el_field"},[i("el-form-item",[i("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:function(t){return e.clickPrintReport()}}},[i("i",{staticClass:"fa fa-print"}),e._v(" พิมพ์รายงาน\n          ")]),e._v(" "),i("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:e.disabledInterface},on:{click:function(t){return e.clickInterface()}}},[i("i",{staticClass:"fa fa-exchange"}),e._v(" ส่ง Interface\n          ")]),e._v(" "),i("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(t){return e.clickCancel()}}},[i("i",{staticClass:"fa fa-times"}),e._v(" ยกเลิก\n          ")]),e._v(" "),i("button",{staticClass:"btn btn-warning",attrs:{type:"button"},on:{click:function(t){return e.clickClear()}}},[i("i",{staticClass:"fa fa-repeat"}),e._v("\n                รีเซต\n              ")])])],1)])],1)])}),[],!1,null,null,null).exports}}]);