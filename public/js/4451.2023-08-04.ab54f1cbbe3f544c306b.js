(self.webpackChunk=self.webpackChunk||[]).push([[4451],{74451:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>v});var a=s(87757),r=s.n(a),n=s(30381),i=s.n(n);const o={props:["product-plan-lines"],data:function(){return{form_lines:[],lines:this.productPlanLines,checked:!1}},mounted:function(){this.setData()},methods:{setData:function(){this.lines.forEach((function(t){"PTN"!==t.uom&"PTN"!==t.uom2&&(t.period_name_request=120*t.period_name_request),t.uom2="PTN",t.input=t.period_name_request}))},onClickButton:function(t){this.$emit("input",this.lines)}},computed:{}};var l=s(51900);const c={props:["product-plan-lines"],data:function(){return{form_lines:[],lines:this.productPlanLines,checked:!1}},mounted:function(){this.setData()},methods:{setData:function(){this.lines.forEach((function(t){"PTN"!==t.uom&&(t.period_name_request=120*t.product_qty),"KG"!==t.uom2&&(t.input=.02*t.period_name_request),t.uom2="KG"}))},onClickButton:function(t){this.$emit("input",this.lines)}},computed:{}};function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function u(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){m(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function m(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function _(t,e,s,a,r,n,i){try{var o=t[n](i),l=o.value}catch(t){return void s(t)}o.done?e(l):Promise.resolve(l).then(a,r)}const h={components:{TableRow:(0,l.Z)(o,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("table",{staticClass:"table table-bordered"},[t._m(0),t._v(" "),s("tbody",t._l(t.lines,(function(e,a){return s("tr",{key:a},[s("td",{staticClass:"text-center"},[s("el-checkbox",{attrs:{disabled:null!=e.request_number,checked:1==e.attribute15||null!==e.request_number,size:"small"},on:{input:t.onClickButton},model:{value:e.attribute15,callback:function(s){t.$set(e,"attribute15",s)},expression:"productPlanLine.attribute15"}})],1),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.item_number_v.item_number))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.item_number_v.item_desc))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.product_qty))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.mtl_uom.unit_of_measure))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.period_name_request))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.uom_ptn.unit_of_measure))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("el-input",{staticClass:"w-auto",attrs:{size:"mini",disabled:null!==e.request_number},on:{input:t.onClickButton},model:{value:e.input,callback:function(s){t.$set(e,"input",s)},expression:"productPlanLine.input"}})],1),t._v(" "),s("td",{staticClass:"text-center"},[s("el-input",{staticClass:"w-auto",attrs:{size:"mini",readonly:""},model:{value:e.uom_ptn.unit_of_measure,callback:function(s){t.$set(e.uom_ptn,"unit_of_measure",s)},expression:"productPlanLine.uom_ptn.unit_of_measure"}})],1),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.request_number))])])])})),0)])])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"3%"}}),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รหัสสินค้า")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รายละเอียด")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ประมาณการจำหน่าย")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ(1)")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("จำนวนซอง")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ(2)")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("จำนวนที่ต้องผลิต")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ(3)")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("เลขที่คำสั่งการผลิต")])])])])}],!1,null,null,null).exports,TableRowMP2:(0,l.Z)(c,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("table",{staticClass:"table table-bordered"},[t._m(0),t._v(" "),s("tbody",t._l(t.lines,(function(e,a){return s("tr",{key:a},[s("td",{staticClass:"text-center"},[s("el-checkbox",{attrs:{disabled:null!=e.request_number,checked:1==e.attribute15||null!==e.request_number,size:"small"},on:{input:t.onClickButton},model:{value:e.attribute15,callback:function(s){t.$set(e,"attribute15",s)},expression:"productPlanLine.attribute15"}})],1),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.item_number_v.item_number))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.item_number_v.item_desc))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.product_qty))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.mtl_uom.unit_of_measure))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.period_name_request))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.uom_ptn.unit_of_measure))])]),t._v(" "),s("td",{staticClass:"text-right"},[s("el-input",{staticClass:"w-auto text-right",attrs:{size:"mini"},on:{input:t.onClickButton},model:{value:e.input,callback:function(s){t.$set(e,"input",s)},expression:"productPlanLine.input"}})],1),t._v(" "),s("td",{staticClass:"text-right"},[s("el-input",{staticClass:"w-auto text-right",attrs:{size:"mini",readonly:""},model:{value:e.uom_kg.unit_of_measure,callback:function(s){t.$set(e.uom_kg,"unit_of_measure",s)},expression:"productPlanLine.uom_kg.unit_of_measure"}})],1),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.request_number))])])])})),0)])])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{attrs:{width:"3%"}}),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รหัสสินค้า")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รายละเอียด")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ประมาณการจำหน่าย")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("จำนวนซอง")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("จำนวนที่ต้องผลิต")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("เลขที่คำสั่งการผลิต")])])])])}],!1,null,null,null).exports},props:["user-profile","trans-date","url","trans-btn","sys-date","program-code","token"],data:function(){return{sysDateTh:i()(this.sysDate).add(543,"years").format(this.transDate["js-format"]),yearTh:i()(this.sysDate).add(543,"years").format(this.transDate["js-year-format"]),year:i()(this.sysDate).format(this.transDate["js-year-format"]),month:i()(this.sysDate).format("MM"),monthTh:i()(this.sysDate).format("MMMM"),monthThDes:i()(this.sysDate).format("MMMM"),dateFirsTofMonth:i()(this.sysDate).add(543,"years").format("01/MM/YYYY"),create_date:"",fortnightly:"",time:"",version:"",start_date:"",end_date:"",saleForecasts:"",saleForecast:"",biweekly:"",biweeklies:[],form_header:{program_code:this.programCode,version:"",period:"",source_version:"",attribute1:"",attribute2:"",year:"",lines:[],pMonth:"",pYear:""},loading:{form:!1,month:!1,biweekly:!1,dateFormTo:!1,table:!1},disable:{form:!1,month:!0,biweekly:!0,dateFormTo:!1},productPlanLines:[],urlTest:"http://web-service-report.test/ir/ajax/ir-report-get-info-attribute?program_code=IRR0001"}},mounted:function(){this.getSaleForecast()},methods:{getSaleForecast:function(){var t=this;this.loading.biweekly=!0,console.log("xxx"),axios.get(this.url.getSaleForecast+"?year="+this.year+"&month="+this.month).then((function(e){var s=e.data.salesForecasts;t.saleForecasts=s,t.version=t.saleForecasts[0].version,t.loading.biweekly=!1,t.disable.month=!1,t.disable.biweekly=!1})).catch((function(e){t.loading.biweekly=!1,t.disable.month=!1,t.disable.biweekly=!1}))},getYear:function(t){this.yearTh=t,this.year=i()(this.yearTh).add(-543,"years").format(this.transDate["js-year-format"])},getMonth:function(t){this.productPlanLines=[],this.monthTh=t,this.month=i()(this.monthTh).add(-543,"years").format("MM"),this.monthThDes=i()(this.month).add(-543,"years").format("MMMM"),this.form_header.pMonth=i()(this.monthTh).add(-543,"years").format("MMM"),this.getSaleForecast(),this.dateFirsTofMonth=i()(this.monthTh).add(543,"years").format("01/MM/YYYY")},createDate:function(t){this.create_date=i()(t).add(-543,"years").format(this.transDate["js-datatime-format"])},startDate:function(t){this.start_date=i()(t).add(-543,"years").format(this.transDate["js-datatime-format"])},endDate:function(t){this.end_date=i()(t).add(-543,"years").format(this.transDate["js-datatime-format"])},findBiweekly:function(){var t=this,e=this.saleForecasts[this.fortnightly].find((function(e){return e.biweekly_no==t.fortnightly}));this.saleForecast=e,this.version=e.version,this.getBiweeklies()},getBiweeklies:function(){var t=this;axios.get(this.url.getBiweeklies+"?year="+this.year+"&month="+this.month+"&biweekly_no="+this.version+"&biweekly_id="+this.saleForecast.biweekly_id).then((function(e){var s=e.data.biweekly;t.biweekly=s,t.start_date=i()(s.start_date).add(543,"years").format(t.transDate["js-format"]),s.start_date,t.end_date=i()(s.end_date).add(543,"years").format(t.transDate["js-format"])}))},updateFormHeader:function(){var t,e=this;return(t=r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.form_header.program_code=e.programCode,e.form_header.version=e.version,e.form_header.biweekly=e.fortnightly,e.form_header.period=e.biweekly.period_name,e.form_header.source_version=e.biweekly.biweekly,e.form_header.attribute1=e.biweekly.start_date,e.form_header.attribute2=e.biweekly.end_date,e.form_header.year=e.year,e.form_header.month=e.month;case 9:case"end":return t.stop()}}),t)})),function(){var e=this,s=arguments;return new Promise((function(a,r){var n=t.apply(e,s);function i(t){_(n,a,r,i,o,"next",t)}function o(t){_(n,a,r,i,o,"throw",t)}i(void 0)}))})()},process:function(){var t=this;this.loading.table=!0,this.productPlanLines=[],this.form_header.lines=[],this.updateFormHeader(),axios.post(this.url.process,u({},this.form_header)).then((function(e){t.productPlanLines=e.data.productPlanLines,t.loading.table=!1,t.form_header.lines=t.productPlanLines})).catch((function(e){t.loading.table=!1}))},openJob:function(){var t=this,e=!1;return this.form_header.lines.filter((function(t){return null==t.attribute15})).length==this.form_header.lines.length?swal({title:"Error !",text:"กรุณาเลือกรายการที่ต้องการเปิดคำสั่งการผลิต",type:"error",showConfirmButton:!0}):(this.form_header.lines.forEach((function(t){null==t.request_number&&(e=!0)})),0==e?swal({title:"Error !",text:"ไม่สามารถเปิดคำสั่งผลิตได้",type:"error",showConfirmButton:!0}):(this.updateFormHeader(),this.loading.table=!0,this.productPlanLines=[],void axios.post(this.url.openJob,u({},this.form_header)).then((function(e){t.productPlanLines=[];var s=e.data.result;"S"===s.status?swal({title:"Success !",text:s.msg,type:"success",showConfirmButton:!0}):(swal({title:"Error !",text:s.msg,type:"error",showConfirmButton:!0}),console.log(s.msg)),t.productPlanLines=e.data.productPlanLines,t.form_header.lines=e.data.productPlanLines,t.loading.table=!1})).catch((function(e){t.loading.table=!1,console.log(e),console.log("log error"),swal({title:"Error !",text:"Error",type:"error",showConfirmButton:!0})}))))},onClickChild:function(t){this.form_header.lines=t,console.log(t)}},computed:{disableOpenJob:function(){if(0==this.productPlanLines.length)return!0}}};const v=(0,l.Z)(h,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.form,expression:"loading.form"}],staticClass:"col-lg-12"},[s("div",{staticClass:"ibox float-e-margins"},[s("div",{staticClass:"ibox-content"},[s("div",{staticClass:"text-right"},[s("button",{class:t.transBtn.createJob.class,on:{click:function(e){return e.preventDefault(),t.process(e)}}},[s("strong",[t._v(" คำนวณปริมาณการผลิต ")])]),t._v(" "),s("button",{class:t.transBtn.createJob.class,attrs:{disabled:t.disableOpenJob},on:{click:function(e){return e.preventDefault(),t.openJob(e)}}},[s("i",{class:t.transBtn.createJob.icon}),t._v("\n                        "+t._s(t.transBtn.createJob.text)+"\n                    ")])]),t._v(" "),s("div",{staticClass:"form-group"},[s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-2"},[t._v("ปีงบประมาณ")]),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%","border-radius":"3px"},attrs:{placeholder:"เลือกวันที่ขอเบิก",name:"input_date",id:"input_date",pType:"year",format:t.transDate["js-year-format"]},on:{dateWasSelected:t.getYear},model:{value:t.yearTh,callback:function(e){t.yearTh=e},expression:"yearTh"}})],1),t._v(" "),s("div",{staticClass:"col-lg-2"},[t._v("หน่วยงาน")]),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("el-input",{staticClass:"w-100",attrs:{placeholder:"0000000",size:"small",value:t.userProfile.department.description,readonly:""}})],1)]),t._v(" "),s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-2"},[t._v("\n                            ประมาณการขายยาเส้นประจำเดือน\n                        ")]),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("datepicker-th",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.month,expression:"loading.month"}],staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%","border-radius":"3px"},attrs:{placeholder:"เลือกวันที่",name:"input_date",id:"input_date",pType:"month",disabled:""==t.year,format:"MMMM"},on:{dateWasSelected:t.getMonth},model:{value:t.monthTh,callback:function(e){t.monthTh=e},expression:"monthTh"}})],1),t._v(" "),s("div",{staticClass:"col-lg-2"},[t._v("วันที่ผลิต")]),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("el-input",{staticClass:"w-100",attrs:{disabled:!0,size:"small"},model:{value:t.dateFirsTofMonth,callback:function(e){t.dateFirsTofMonth=e},expression:"dateFirsTofMonth"}})],1)]),t._v(" "),s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-2"},[t._v("ครั้งที่")]),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("el-input",{staticClass:"w-100",attrs:{disabled:!0,placeholder:"0",size:"small"},model:{value:t.version,callback:function(e){t.version=e},expression:"version"}})],1)]),t._v(" "),t._m(0)]),t._v(" "),t.loading.table?s("div",[t._m(1)]):t._e(),t._v(" "),t.productPlanLines.length>0&"MPG"==t.userProfile.organization_code?s("TableRow",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.table,expression:"loading.table"}],attrs:{"product-plan-lines":t.productPlanLines},on:{input:t.onClickChild}}):t._e(),t._v(" "),t.productPlanLines.length>0&"MP2"==t.userProfile.organization_code?s("TableRowMP2",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.table,expression:"loading.table"}],attrs:{"product-plan-lines":t.productPlanLines},on:{input:t.onClickChild}}):t._e()],1)])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"row m-2"},[e("div",{staticClass:"col-lg-12 text-right"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sk-spinner sk-spinner-wave mb-4"},[s("div",{staticClass:"sk-rect1"}),t._v(" "),s("div",{staticClass:"sk-rect2"}),t._v(" "),s("div",{staticClass:"sk-rect3"}),t._v(" "),s("div",{staticClass:"sk-rect4"}),t._v(" "),s("div",{staticClass:"sk-rect5"})])}],!1,null,null,null).exports}}]);