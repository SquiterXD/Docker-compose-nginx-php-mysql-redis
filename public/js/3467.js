(self.webpackChunk=self.webpackChunk||[]).push([[3467],{13467:(t,a,e)=>{"use strict";e.r(a),e.d(a,{default:()=>i});var s=e(80455);const n={components:{VueNumeric:e.n(s)()},props:["customerLists","bankLists"],data:function(){return{loading:!1,showRequires:!1,saveable:!1,defaultYear:"",year:"",month:"",month_options:[{value:"1",label:"มกราคม"},{value:"2",label:"กุมภาพันธ์"},{value:"3",label:"มีนาคม"},{value:"4",label:"เมษายน"},{value:"5",label:"พฤษภาคม"},{value:"6",label:"มิถุนายน"},{value:"7",label:"กรกฎาคม"},{value:"8",label:"สิงหาคม"},{value:"9",label:"กันยายน"},{value:"10",label:"ตุลาคม"},{value:"11",label:"พฤศจิกายน"},{value:"12",label:"ธันวาคม"}],customer_number:"",customer_name:"",file:"",display_sum:"0.00",pvLists:[],bdLists:[],warningLists:{},requireLists:{},adjustLists:{},bank:""}},mounted:function(){var t=new Date,a=t.getFullYear(),e=t.getMonth(),s=t.getDate();this.defaultYear=new Date(a+543,e,s),$("#band_table, #province_table").DataTable({destroy:!0})},methods:{findCustomer:function(){var t=this,a=this.customerLists.find((function(a){return a.customer_number==t.customer_number}));this.customer_name=a?a.customer_name:""},handleFileUpload:function(){this.file=this.$refs.file.files.length?this.$refs.file.files[0]:""},handleSearch:function(){var t=this;t.showRequires=!1,t.requireLists={},t.year||(t.showRequires=!0,t.requireLists.year="โปรดเลือกปี"),t.showRequires||(t.loading=!0,$("#band_table, #province_table").DataTable().destroy(),axios.get("/om/pao-tax-mt/search",{params:{year:t.year,month:t.month,customer_number:t.customer_number}}).then((function(a){t.bdLists=a.data.result})).catch((function(t){console.log(t)})).then((function(){t.composePvTable(),t.updateTotalPaotax()})).then((function(){$("#band_table, #province_table").DataTable({pageLength:10,responsive:!0,destroy:!0}),t.loading=!1,t.showSuccess()})))},handlePrintEx:function(){var t=this,a="/om/pao-tax-mt/ex-report?year="+t.year+"&month="+t.month+"&customer_number="+t.customer_number;window.open(a,"_blank")},handleStore:function(){var t=this;t.loading=!0;var a=new FormData;a.append("year",t.year),a.append("month",t.month),a.append("customer_number",t.customer_number),a.append("file",t.file),axios.post("/om/pao-tax-mt/store",a,{headers:{"Content-Type":"multipart/form-data"}}).then((function(a){t.$refs.file.value="",t.file=""})).catch((function(t){console.log(t)})).then((function(){t.handleSearch()}))},handleChange:function(t,a){var e=this,s=e.bdLists.find((function(a){return a.pao_tax_mt_id==t}));s.adjust_amount=a.target.value,e.saveable=!0,e.composePvTable(),e.updateTotalPaotax(),e.adjustLists[s.pao_tax_mt_id]=s.adjust_amount},handleSaveData:function(){var t=this;t.loading=!0,axios.patch("/om/pao-tax-mt/update",{adjust_lists:t.adjustLists}).then((function(t){})).catch((function(t){console.log(t)})).then((function(){t.loading=!1,t.saveable=!1,t.showSuccess()}))},validateData:function(){var t=this;if(t.showRequires=!1,t.requireLists={},t.year||(t.showRequires=!0,t.requireLists.year="โปรดเลือกปี"),t.month||(t.showRequires=!0,t.requireLists.month="โปรดเลือกเดือน"),t.file||(t.showRequires=!0,t.requireLists.file="โปรดเลือกไฟล์"),!t.showRequires){t.loading=!0;var a=new FormData;a.append("year",t.year),a.append("month",t.month),a.append("customer_number",t.customer_number),a.append("file",t.file),axios.post("/om/pao-tax-mt/validate",a,{headers:{"Content-Type":"multipart/form-data"}}).then((function(a){"E"==a.data.status?(t.loading=!1,t.showError("ข้อมูลชุดนี้ไม่สามารถนำเข้าข้อมูลได้")):"W"==a.data.status?(t.warningLists=a.data.errors,$("#warningModal").modal({backdrop:"static",keyboard:!1})):t.handleStore()})).catch((function(t){console.log(t)})).then((function(){}))}},handleInterface:function(){var t=this;if(t.showRequires=!1,t.requireLists={},t.year||(t.showRequires=!0,t.requireLists.year="โปรดเลือกปี"),t.month||(t.showRequires=!0,t.requireLists.month="โปรดเลือกเดือน"),t.bank||(t.showRequires=!0,t.requireLists.bank="โปรดเลือกธนาคาร"),!t.showRequires){t.loading=!0;var a=new FormData;a.append("year",t.year),a.append("month",t.month),a.append("customer_number",t.customer_number),a.append("bank",t.bank),axios.post("/om/pao-tax-mt/interface",a).then((function(a){if("S"==a.data.status){var e="group id : "+a.data.group_id;t.showSuccess(e),t.bank=""}else t.showError(a.data.msg)})).catch((function(t){console.log(t)})).then((function(){t.loading=!1}))}},handleClickTab:function(t,a){},updateTotalPaotax:function(){var t=0;this.bdLists.forEach((function(a){t+=parseFloat(a.adjust_amount)})),this.display_sum=t},composePvTable:function(){var t=[];this.bdLists.forEach((function(a){var e=a.customer,s=a.province,n=a.item;t.find((function(t){return t.province_name==s.province_thai&&t.customer_number==e.customer_number}))?t.forEach((function(t){t.province_name==s.province_thai&&t.customer_number==e.customer_number&&(t.quantity+=parseFloat(a.quantity_cg),t.pv_pao_tax+=parseFloat(a.adjust_amount),t.items.push(a))})):t.push({province_name:s.province_thai,customer_number:e.customer_number,customer_name:e.customer_name,quantity:parseFloat(a.quantity_cg),uom:n.uom,pv_pao_tax:parseFloat(a.adjust_amount),items:[a]})})),this.pvLists=t},showSuccess:function(t){swal("Success!",t,"success")},showError:function(t){swal("Error!",t,"error")},numberWithCommas:function(t){return parseFloat(t).toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}}};const i=(0,e(51900).Z)(n,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.showRequires,expression:"showRequires"}],staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[e("div",{staticClass:"col-md-12"},[e("ul",{staticClass:"text-danger"},t._l(t.requireLists,(function(a,s){return e("li",{key:s},[t._v("\n                    "+t._s(a)+"\n                ")])})),0)])]),t._v(" "),e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[e("div",{staticClass:"col-md-12 text-right"},[e("button",{staticClass:"btn btn-light",on:{click:t.handleSearch}},[e("i",{staticClass:"fa fa-search"}),t._v(" Search\n            ")]),t._v(" "),e("button",{staticClass:"btn btn-primary",on:{click:t.handlePrintEx}},[e("i",{staticClass:"fa fa-print"}),t._v(" พิมพ์ตัวอย่าง\n            ")]),t._v(" "),e("button",{staticClass:"btn btn-light",on:{click:t.validateData}},[e("i",{staticClass:"fa fa-upload"}),t._v(" นำเข้าข้อมูล\n            ")]),t._v(" "),t._m(0)])]),t._v(" "),e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[t._m(1),t._v(" "),e("div",{staticClass:"col-md-3"},[e("el-date-picker",{staticClass:"w-100",attrs:{clearable:!1,id:"year",type:"year",placeholder:"ปี พ.ศ.",format:"yyyy","value-format":"yyyy","default-value":t.defaultYear},model:{value:t.year,callback:function(a){t.year=a},expression:"year"}})],1)]),t._v(" "),e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[t._m(2),t._v(" "),e("div",{staticClass:"col-md-3"},[e("el-select",{staticClass:"w-100",attrs:{filterable:"",placeholder:"Select"},model:{value:t.month,callback:function(a){t.month=a},expression:"month"}},t._l(t.month_options,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)]),t._v(" "),e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[t._m(3),t._v(" "),e("div",{staticClass:"col-md-3"},[e("el-select",{staticClass:"w-100",attrs:{placeholder:"Select",filterable:""},on:{change:t.findCustomer},model:{value:t.customer_number,callback:function(a){t.customer_number=a},expression:"customer_number"}},t._l(t.customerLists,(function(a){return e("el-option",{key:a.customer_id,attrs:{label:a.customer_number,value:a.customer_number}},[t._v("\n                    "+t._s(a.customer_number+" : "+a.customer_name)+"\n                ")])})),1)],1),t._v(" "),e("div",{staticClass:"col-md-3"},[e("el-input",{staticClass:"w-100",attrs:{placeholder:"",disabled:!0},model:{value:t.customer_name,callback:function(a){t.customer_name=a},expression:"customer_name"}})],1)]),t._v(" "),e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[t._m(4),t._v(" "),e("div",{staticClass:"col-md-6"},[e("input",{ref:"file",attrs:{type:"file",id:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"},on:{change:function(a){return t.handleFileUpload()}}})])]),t._v(" "),e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[t._m(5),t._v(" "),e("div",{staticClass:"col-md-6"},[e("div",{staticClass:"w-100 el-input"},[e("vue-numeric",{staticClass:"el-input__inner text-right",attrs:{"read-only-class":"el-input__inner text-right",separator:",",precision:2,"read-only":!0},model:{value:t.display_sum,callback:function(a){t.display_sum=a},expression:"display_sum"}})],1)])]),t._v(" "),e("hr"),t._v(" "),t.saveable?e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12 text-right"},[e("button",{staticClass:"btn btn-primary",on:{click:t.handleSaveData}},[e("i",{staticClass:"fa fa-floppy-o"}),t._v(" Save\n            ")])])]):t._e(),t._v(" "),e("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClickTab}},[e("el-tab-pane",{attrs:{label:"แยกรายจังหวัด"}},[e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[e("div",{staticClass:"col-md-12 table-responsive"},[e("table",{staticClass:"table",attrs:{id:"province_table"}},[e("thead",[e("tr",[e("th",{staticClass:"text-center"},[t._v("\n                                    รหัสร้านค้า\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    ชื่อร้านค้า\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    จังหวัด\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    จำนวน\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    หน่วยนับ\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    ค่าภาษีอบจ.\n                                ")])])]),t._v(" "),e("tbody",t._l(t.pvLists,(function(a,s){return e("tr",{key:s},[e("td",{staticClass:"text-center"},[t._v("\n                                    "+t._s(a.customer_number)+"\n                                ")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(a.customer_name)+"\n                                ")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(a.province_name)+"\n                                ")]),t._v(" "),e("td",{staticClass:"text-right"},[t._v("\n                                    "+t._s(t.numberWithCommas(a.quantity))+"\n                                ")]),t._v(" "),e("td",{staticClass:"text-center"},[t._v("\n                                    "+t._s(a.uom)+"\n                                ")]),t._v(" "),e("td",{staticClass:"text-right"},[e("div",{staticClass:"w-100 el-input"},[e("vue-numeric",{staticClass:"el-input__inner text-right",attrs:{"read-only-class":"el-input__inner text-right",separator:",",precision:2,"read-only":!0,value:a.pv_pao_tax}})],1)])])})),0)])])])]),t._v(" "),e("el-tab-pane",{attrs:{label:"แยกรายตรา รายจังหวัด"}},[e("div",{staticClass:"row",staticStyle:{"margin-bottom":"1rem"}},[e("div",{staticClass:"col-md-12 table-responsive"},[e("table",{staticClass:"table",attrs:{id:"band_table"}},[e("thead",[e("tr",[e("th",{staticClass:"text-center"},[t._v("\n                                    รหัสร้านค้า\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    ชื่อร้านค้า\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    จังหวัด\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    รหัสสินค้า\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    ชื่อตราสินค้า\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    จำนวน\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    หน่วยนับ\n                                ")]),t._v(" "),e("th",{staticClass:"text-center"},[t._v("\n                                    ค่าภาษีอบจ.\n                                ")])])]),t._v(" "),e("tbody",t._l(t.bdLists,(function(a){return e("tr",{key:a.pao_tax_mt_id},[e("td",{staticClass:"text-center"},[t._v("\n                                    "+t._s(a.customer?a.customer.customer_number:"")+"\n                                ")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(a.customer?a.customer.customer_name:"")+"\n                                ")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(a.province_name)+"\n                                ")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(a.item_code)+"\n                                ")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(a.item?a.item.item_description:"")+"\n                                ")]),t._v(" "),e("td",{staticClass:"text-right"},[t._v("\n                                    "+t._s(t.numberWithCommas(a.quantity_cg))+"\n                                ")]),t._v(" "),e("td",{staticClass:"text-center"},[t._v("\n                                    "+t._s(a.item?a.item.uom:"")+"\n                                ")]),t._v(" "),e("td",{staticClass:"text-right"},[e("div",{staticClass:"w-100 el-input"},[e("vue-numeric",{staticClass:"el-input__inner text-right",attrs:{separator:",",precision:2,value:a.adjust_amount},on:{change:function(e){return t.handleChange(a.pao_tax_mt_id,e)}}})],1)])])})),0)])])])])],1),t._v(" "),e("div",{staticClass:"modal inmodal fade",attrs:{id:"warningModal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog modal-lg"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(a){t.loading=!1}}},[e("span",{attrs:{"aria-hidden":"true"}},[t._v("×")]),t._v(" "),e("span",{staticClass:"sr-only"},[t._v("Close")])]),t._v(" "),e("h4",[t._v("ดำเนินการต่อ ?")])]),t._v(" "),e("div",{staticClass:"modal-body",staticStyle:{padding:"20px"}},t._l(t.warningLists,(function(a,s){return e("div",{key:s},[e("ul",t._l(a,(function(a,s){return e("li",{key:s},[t._v("\n                                "+t._s(a)+"\n                            ")])})),0)])})),0),t._v(" "),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-danger",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(a){t.loading=!1}}},[t._v("ยกเลิก")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:t.handleStore}},[t._v("ยืนยัน")])])])])]),t._v(" "),e("div",{staticClass:"modal inmodal fade",attrs:{id:"bankModal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog modal-lg"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-body",staticStyle:{padding:"15px"}},[e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[t._v("×")]),t._v(" "),e("h4",[t._v("โปรดเลือก รหัสเจ้าหนี้ หรือธนาคาร ?")]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-md-12"},[e("el-select",{staticClass:"w-100",attrs:{filterable:"",placeholder:"Select","popper-append-to-body":!1},model:{value:t.bank,callback:function(a){t.bank=a},expression:"bank"}},t._l(t.bankLists,(function(t,a){return e("el-option",{key:a,attrs:{label:t.vendor_code+" : "+t.vendor_name+" : "+t.vendor_site_code,value:t.vendor_code+" : "+t.vendor_name+" : "+t.vendor_site_code}})})),1)],1)])]),t._v(" "),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:t.handleInterface}},[t._v("ตกลง")])])])])])],1)}),[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("button",{staticClass:"btn btn-info",attrs:{"data-toggle":"modal","data-target":"#bankModal","data-backdrop":"static","data-keyboard":"false"}},[e("i",{staticClass:"fa fa-exchange"}),t._v(" ส่งรายการ Interface\n            ")])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-md-2 text-right"},[e("label",{staticStyle:{"padding-top":"10px"},attrs:{for:"year"}},[t._v("ปี พ.ศ.")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-md-2 text-right"},[e("label",{staticStyle:{"padding-top":"10px"},attrs:{for:"month"}},[t._v("ประจำเดือน")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-md-2 text-right"},[e("label",{staticStyle:{"padding-top":"10px"},attrs:{for:"customer_number"}},[t._v("รหัสร้านค้า")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-md-2 text-right"},[e("label",{staticStyle:{"padding-top":"10px"},attrs:{for:"file"}},[t._v("ไฟล์ Excel")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-md-2 text-right"},[e("label",{staticStyle:{"padding-top":"10px"},attrs:{for:"display_sum"}},[t._v("รวมค่าภาษีอบจ.ทั้งสิ้น")])])}],!1,null,null,null).exports}}]);