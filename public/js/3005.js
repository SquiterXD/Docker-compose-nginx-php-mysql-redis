(self.webpackChunk=self.webpackChunk||[]).push([[3005],{33005:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>d});var s=i(87757),a=i.n(s),n=i(30381),o=i.n(n),r=i(23570),l=i.n(r);function c(t,e,i,s,a,n,o){try{var r=t[n](o),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(s,a)}const u={props:["departments","uoms","organizations","openClass","defaultValue","old","org","urlSave","urlReset"],data:function(){return{organization_code:this.defaultValue?this.defaultValue.organization_code:this.org,routing_no:this.old.routing_no?this.old.routing_no:this.defaultValue?this.defaultValue.routing_no:"",routing_description:this.old.routing_description?this.old.routing_description:this.defaultValue?this.defaultValue.routing_description:"",active_flag:this.old.active_flag?!!this.old.active_flag:!this.defaultValue||"Y"==this.defaultValue.active_flag,disableEdit:!!this.defaultValue,lines:[],lineDelete:[],csrf:document.querySelector('meta[name="csrf-token"]').getAttribute("content"),check_update:!1,disableActive:!1}},mounted:function(){var t=this;this.defaultValue?(this.defaultValue.wip_steps?_.orderBy(this.defaultValue.wip_steps,"wip_step_id").forEach((function(e){"DELETE"!=e.web_status&&t.lines.push({id:e.routing_step_no,wip_step:e.wip_step,wip_step_desc:e.wip_step_desc,uom_code:e.uom_code,attribute4:"Y"==e.attribute4,status:"update"})})):this.addLine(),"N"==this.defaultValue.active_flag&&(this.disableActive=!0)):this.addLine()},methods:{addLine:function(){var t=new Date;o()(t).format("DDMMyyyy"),String(t.getHours()),String(t.getMinutes()),String(t.getSeconds());this.lines.push({id:l()(),wip_step:"",wip_step_desc:"",uom_code:"",status:"new",attribute4:!0})},removeRow:function(t,e){var i=this;swal({title:"Warning",text:"ต้องการลบขั้นตอนการทำงานหรือไม่?",type:"warning",showCancelButton:!0,closeOnConfirm:!1},(function(s){s&&(i.lineDelete.push({id:t.id,wip_step:t.wip_step,wip_step_desc:t.wip_step_desc,uom_code:t.uom_code,attribute4:t.attribute4,status:"delete"}),i.lines.splice(e,1),i.checkUpdate(),swal({title:"Success",text:"",timer:3e3,type:"success",showCancelButton:!1,showConfirmButton:!1}))}))},checkForm:function(t){var e,i=this;return(e=a().mark((function e(){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(s=$("#submitForm")).serialize(),i.errors=[],i.defaultValue&&i.check_update&&(i.active_flag||(i.errors.push("ไม่สามารถแก้ไขข้อมูลได้ เนื่องจากขั้นตอนการทำงานปิดการใช้งาน"),swal({title:"",text:i.errors,timer:3e3,type:"error",showCancelButton:!1,showConfirmButton:!1}))),i.routing_description||(i.errors.push("คำอธิบายชุดการผลิต"),swal({title:"มีข้อผิดพลาด โปรดระบุข้อมูลดังนี้",text:i.errors,timer:3e3,type:"error",showCancelButton:!1,showConfirmButton:!1})),i.lines.length||(i.errors.push("ขั้นตอนการทำงาน, ชื่อขั้นตอนการทำงาน, หน่วยนับผลผลิต"),console.log("check validate line <---\x3e "+i.lines.length),swal({title:"มีข้อผิดพลาด โปรดระบุข้อมูลดังนี้",text:i.errors,timer:3e3,type:"error",showCancelButton:!1,showConfirmButton:!1})),i.lines.length>0&&i.lines.forEach((function(t){t.wip_step||(i.errors.push("ขั้นตอนการทำงาน"),swal({title:"มีข้อผิดพลาด โปรดระบุข้อมูลดังนี้",text:i.errors,timer:3e3,type:"error",showCancelButton:!1,showConfirmButton:!1})),t.wip_step_desc||(i.errors.push("ชื่อขั้นตอนการทำงาน"),swal({title:"มีข้อผิดพลาด โปรดระบุข้อมูลดังนี้",text:i.errors,timer:3e3,type:"error",showCancelButton:!1,showConfirmButton:!1})),t.uom_code||(i.errors.push("หน่วยนับผลผลิต"),swal({title:"มีข้อผิดพลาด โปรดระบุข้อมูลดังนี้",text:i.errors,timer:3e3,type:"error",showCancelButton:!1,showConfirmButton:!1}))})),i.errors.length||s.submit(),t.preventDefault();case 9:case"end":return e.stop()}}),e)})),function(){var t=this,i=arguments;return new Promise((function(s,a){var n=e.apply(t,i);function o(t){c(n,s,a,o,r,"next",t)}function r(t){c(n,s,a,o,r,"throw",t)}o(void 0)}))})()},checkDup:function(t,e){if(t.wip_step&&e>0)this.lines.find((function(e){e.id!=t.id&&t.wip_step==e.wip_step&&(t.wip_step="",swal({title:"มีข้อผิดพลาด",text:"ไม่สามารถเลือกขั้นตอนการทำงานซ้ำกันได้",type:"error",showCancelButton:!1,showConfirmButton:!0}))}))},checkUpdate:function(){this.check_update=!0}}};const d=(0,i(51900).Z)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{id:"submitForm",action:t.urlSave,method:"post",onkeydown:"return event.key != 'Enter';"},on:{submit:function(e){return e.preventDefault(),t.checkForm(e)}}},[i("input",{attrs:{type:"hidden",name:"_token"},domProps:{value:t.csrf}}),t._v(" "),this.defaultValue?i("input",{attrs:{type:"hidden",name:"_method",value:"PUT"}}):t._e(),t._v(" "),i("div",[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-4"},[t._m(0),t._v(" "),i("el-input",{attrs:{name:"routing_description",disabled:this.disableActive},on:{input:function(e){return t.checkUpdate()}},model:{value:t.routing_description,callback:function(e){t.routing_description=e},expression:"routing_description"}}),t._v(" "),this.disableActive?i("div",[i("input",{attrs:{type:"hidden",name:"routing_description"},domProps:{value:this.routing_description}})]):t._e()],1),t._v(" "),i("div",{staticClass:"col-md-4"},[t._m(1),t._v(" "),i("input",{attrs:{type:"hidden",name:"organization_code",autocomplete:"off"},domProps:{value:t.organization_code}}),t._v(" "),i("el-select",{staticClass:"w-100",attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",disabled:""},model:{value:t.organization_code,callback:function(e){t.organization_code=e},expression:"organization_code"}},t._l(t.organizations,(function(t){return i("el-option",{key:t.organization_code,attrs:{label:t.organization_code+" : "+t.organization_desc,value:t.organization_code}})})),1)],1),t._v(" "),i("div",{staticClass:"col-md-2"},[t._m(2),t._v(" "),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.active_flag,expression:"active_flag"}],attrs:{type:"checkbox",name:"active_flag"},domProps:{checked:Array.isArray(t.active_flag)?t._i(t.active_flag,null)>-1:t.active_flag},on:{change:function(e){var i=t.active_flag,s=e.target,a=!!s.checked;if(Array.isArray(i)){var n=t._i(i,null);s.checked?n<0&&(t.active_flag=i.concat([null])):n>-1&&(t.active_flag=i.slice(0,n).concat(i.slice(n+1)))}else t.active_flag=a}}})])])]),t._v(" "),i("hr"),t._v(" "),i("div",{staticClass:"mt-3"},[i("div",{staticClass:"text-right"},[i("button",{staticClass:"btn btn-sm btn-success",attrs:{type:"submit",disabled:this.disableActive},on:{click:function(e){return e.preventDefault(),t.addLine(e)}}},[i("i",{staticClass:"fa fa-plus"}),t._v(" เพิ่ม ")])]),t._v(" "),i("table",{staticClass:"table table-responsive-sm"},[t._m(3),t._v(" "),i("tbody",[t._l(t.lines,(function(e,s){return i("tr",[i("input",{attrs:{type:"hidden",name:"listLine["+e.id+"][status]",autocomplete:"off"},domProps:{value:e.status}}),t._v(" "),i("td",{staticClass:"text-center"},[t._v(" "+t._s(s+1)+" ")]),t._v(" "),i("td",[i("input",{attrs:{type:"hidden",name:"listLine["+e.id+"][wip_step]",autocomplete:"off"},domProps:{value:e.wip_step}}),t._v(" "),i("el-select",{staticClass:"w-100",attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",disabled:"update"==e.status},on:{change:function(i){return t.checkDup(e,s)}},model:{value:e.wip_step,callback:function(i){t.$set(e,"wip_step",i)},expression:"row.wip_step"}},t._l(t.openClass,(function(t){return i("el-option",{key:t.oprn_class_desc,attrs:{label:t.oprn_class_desc,value:t.oprn_class_desc}})})),1)],1),t._v(" "),i("td",[i("el-input",{attrs:{name:"listLine["+e.id+"][wip_step_desc]",disabled:t.disableActive},on:{input:function(e){return t.checkUpdate()}},model:{value:e.wip_step_desc,callback:function(i){t.$set(e,"wip_step_desc",i)},expression:"row.wip_step_desc"}})],1),t._v(" "),i("td",[i("input",{attrs:{type:"hidden",name:"listLine["+e.id+"][uom_code]",autocomplete:"off"},domProps:{value:e.uom_code}}),t._v(" "),i("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",disabled:t.disableActive},on:{change:function(e){return t.checkUpdate()}},model:{value:e.uom_code,callback:function(i){t.$set(e,"uom_code",i)},expression:"row.uom_code"}},t._l(t.uoms,(function(t){return i("el-option",{key:t.uom_code,attrs:{label:t.unit_of_measure,value:t.uom_code}})})),1)],1),t._v(" "),i("td",{staticClass:"text-center"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.attribute4,expression:"row.attribute4"}],attrs:{type:"checkbox",name:"listLine["+e.id+"][attribute4]",disabled:t.disableActive},domProps:{checked:Array.isArray(e.attribute4)?t._i(e.attribute4,null)>-1:e.attribute4},on:{change:function(i){var s=e.attribute4,a=i.target,n=!!a.checked;if(Array.isArray(s)){var o=t._i(s,null);a.checked?o<0&&t.$set(e,"attribute4",s.concat([null])):o>-1&&t.$set(e,"attribute4",s.slice(0,o).concat(s.slice(o+1)))}else t.$set(e,"attribute4",n)}}})]),t._v(" "),i("td",[e.disabledRow?t._e():i("div",[t.disableActive?t._e():i("div",[i("button",{staticClass:"btn btn-sm btn-danger",on:{click:function(i){return i.preventDefault(),t.removeRow(e,s)}}},[t._v("\n                                    X\n                                    ")])])])]),t._v(" "),t.disableActive?i("div",[i("input",{attrs:{type:"hidden",name:"listLine["+e.id+"][wip_step_desc]",autocomplete:"off"},domProps:{value:e.wip_step_desc}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"listLine["+e.id+"][attribute4]",autocomplete:"off"},domProps:{value:e.attribute4}})]):t._e()])})),t._v(" "),t._l(t.lineDelete,(function(e,s){return i("div",[i("input",{attrs:{type:"hidden",name:"lineDelete["+e.id+"][status]",autocomplete:"off"},domProps:{value:e.status}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"lineDelete["+e.id+"][wip_step]",autocomplete:"off"},domProps:{value:e.wip_step}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"lineDelete["+e.id+"][wip_step_desc]",autocomplete:"off"},domProps:{value:e.wip_step_desc}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"lineDelete["+e.id+"][uom_code]",autocomplete:"off"},domProps:{value:e.uom_code}}),t._v(" "),i("input",{attrs:{type:"hidden",name:"lineDelete["+e.id+"][attribute4]",autocomplete:"off"},domProps:{value:e.attribute4}})])}))],2)])]),t._v(" "),i("div",{staticClass:"col-12 mt-3"},[i("hr"),t._v(" "),i("div",{staticClass:"row clearfix m-t-lg text-right"},[i("div",{staticClass:"col-sm-12"},[t._m(4),t._v(" "),i("a",{staticClass:"btn btn-sm btn-warning",attrs:{href:this.urlReset,type:"button"}},[i("i",{staticClass:"fa fa-times"}),t._v(" ยกเลิก ")])])])])])])}),[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b",[t._v("คำอธิบายชุดการผลิต")]),t._v(" "),i("span",{staticClass:"text-danger"},[t._v("*")]),i("br"),t._v(" "),i("small",{staticClass:"text-danger"},[t._v("(ไม่สามารถใส่คำอธิบายซ้ำกับข้อมูลที่มีในระบบ)")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b",[t._v("Organization")]),t._v(" "),i("span",{staticClass:"text-danger"},[t._v("*")]),t._v(" "),i("br"),t._v(" "),i("br")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b",[t._v("การใช้งาน")]),t._v(" "),i("br"),t._v(" "),i("br")])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",[i("tr",[i("th",{attrs:{width:"3%"}},[t._v(" ลำดับ ")]),t._v(" "),i("th",[t._v(" ขั้นตอนการทำงาน "),i("span",{staticClass:"text-danger"},[t._v("*")])]),t._v(" "),i("th",[t._v(" ชื่อขั้นตอนการทำงาน "),i("span",{staticClass:"text-danger"},[t._v("*")])]),t._v(" "),i("th",{attrs:{width:"20%"}},[t._v(" หน่วยนับผลผลิต "),i("span",{staticClass:"text-danger"},[t._v("*")])]),t._v(" "),i("th",[t._v("WIP ที่ใช้ตัดวัตถุดิบ")]),t._v(" "),i("th")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"submit"}},[i("i",{staticClass:"fa fa-save"}),t._v(" บันทึก ")])}],!1,null,null,null).exports}}]);