(self.webpackChunk=self.webpackChunk||[]).push([[9132],{66038:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var n=a(23645),r=a.n(n)()((function(e){return e[1]}));r.push([e.id,".fruit-table-move[data-v-3336bb77]{transition:transform 1s}",""]);const s=r},54239:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var n=a(23645),r=a.n(n)()((function(e){return e[1]}));r.push([e.id,".fruit-table-move[data-v-98bf464e]{transition:transform 1s}",""]);const s=r},57245:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var n=a(23645),r=a.n(n)()((function(e){return e[1]}));r.push([e.id,".fruit-table-move[data-v-675923e5]{transition:transform 1s}",""]);const s=r},9132:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>be});var n=a(87757),r=a.n(n),s=a(30381),i=a.n(s);function o(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}const l={props:["pHeader","inventoryItemId","url"],computed:{},watch:{},data:function(){return{itemId:null!=this.inventoryItemId&&""!=this.inventoryItemId?parseInt(this.inventoryItemId):"",loading:!1,items:[]}},mounted:function(){console.log("Component mounted."),""!==this.itemId?this.getItems({inventory_item_id:this.itemId,header:this.pHeader}):this.items=[]},methods:{itemWasSelected:function(e){var t,a=this;return(t=r().mark((function t(){var n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(s=(n=a).items.filter((function(t){return t.inventory_item_id==e}))).length&&(s=s[0]),n.$emit("itemWasSelected",s);case 4:case"end":return t.stop()}}),t)})),function(){var e=this,a=arguments;return new Promise((function(n,r){var s=t.apply(e,a);function i(e){o(s,n,r,i,l,"next",e)}function l(e){o(s,n,r,i,l,"throw",e)}i(void 0)}))})()},remoteMethod:function(e){""!==e?this.getItems({number:e,header:this.pHeader}):this.items=[]},getItems:function(e){var t=this;t.loading=!0,axios.get(t.url.ajax_get_item,{params:e}).then((function(e){var a=e.data.data;t.loading=!1,t.items=a.items}))}}};var c=a(51900);const d=(0,c.Z)(l,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-select",{attrs:{filterable:"",remote:"",placeholder:"รหัสวัตถุดิบ","remote-method":e.remoteMethod,loading:e.loading},on:{change:e.itemWasSelected},model:{value:e.itemId,callback:function(t){e.itemId=t},expression:"itemId"}},e._l(e.items,(function(e,t){return a("el-option",{key:parseInt(e.inventory_item_id),attrs:{label:e.display,value:parseInt(e.inventory_item_id)}})})),1)],1)}),[],!1,null,null,null).exports;a(80455);function u(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function f(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){u(s,n,r,i,o,"next",e)}function o(e){u(s,n,r,i,o,"throw",e)}i(void 0)}))}}var p,v;const m={props:["header","leaf","leafProportion","url","transBtn","transDate","pRefresh","data"],computed:{ingredientsCount:function(){if(this.ingredients&&this.ingredients.length){var e=this.ingredients.filter((function(e){return 0==e.is_deleted}));return parseFloat(e.length)}return 0},totalIngredientProp:function(){var e=0;return this.ingredients.forEach((function(t,a){0==t.is_deleted&&(e=parseFloat(e)+parseFloat(t.ingredient_proportions))})),parseFloat(e)},totalQuantityUsed:function(){var e=this,t=0;return e.ingredients.forEach((function(e,a){0==e.is_deleted&&(t=parseFloat(t)+parseFloat(e.quantity_used))})),e.totalQuantityUsedValue=parseFloat(t),e.totalQuantityUsedValue}},watch:{leafProportion:(v=f(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.ingredients&&this.ingredients.length;case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)}),ingredients:(p=f(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("watch ingredients:  emit => syncIngredients"),this.$emit("syncIngredients",t);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)}),"header.quantity":function(e){this.reCalIngredientProportion()},"header.can.leaf_formulas.ingredient.add_lot_number":function(e){e||this.ingredients.forEach((function(e,t){0==e.is_deleted&&(e.lot_number="")}))}},data:function(){return{loading:!1,leafFormulaProportion:this.leaf.leaf_proportion,ingredients:this.leaf.leaf_dtl,totalQuantityUsedValue:0}},mounted:function(){console.log("LeafIngredient: Component mounted.")},methods:{clickSelcet:function(e,t,a){var n=this;return f(r().mark((function s(){var i,o;return r().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i=n,o=new Promise(function(){var n=f(r().mark((function n(s,o){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.is_edit_item=!0,e.loading=!0,n.next=4,i.remoteMethod(" ",e,a);case 4:e.loading=!1,i.$nextTick((function(){i.$refs[a+"_"+t][0].focus()})),s(!0);case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),s.next=4,o;case 4:s.sent;case 5:case"end":return s.stop()}}),s)})))()},addNewLine:function(){var e=this;return f(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(a=e).ingredients.length,t.next=4,_.clone(a.data.ingredient_new_line);case 4:s=t.sent,a.$set(a.ingredients,n,s),a.changeIngredientProportions(s,!1);case 7:case"end":return t.stop()}}),t)})))()},deleteAll:function(){var e=this;return f(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.ingredients.forEach(function(){var e=f(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.is_deleted=!0;case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})))()},selectInventoryItemId:function(e){var t=this;return f(r().mark((function a(){var n;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=e.item_list.findIndex((function(t){return t.value==e.inventory_item_id})),n=e.item_list[n],e.item_code=n.item_number,e.item_desc=n.item_desc,e.validate_lot=n.validate_lot,e.lot_number="",t.remoteMethod(" ",e,"lot_list");case 7:case"end":return a.stop()}}),a)})))()},selectLotNumber:function(e,t){var a=this;return f(r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a.ingredients.forEach(function(){var a=f(r().mark((function a(n,s){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:0==n.is_deleted&&t!=s&&n.inventory_item_id==e.inventory_item_id&&n.lot_number==e.lot_number&&(e.lot_number="");case 1:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}());case 2:case"end":return n.stop()}}),n)})))()},changeIngredientProportions:function(e){var t=arguments,a=this;return f(r().mark((function n(){var s,i,o,l,c;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=!(t.length>1&&void 0!==t[1])||t[1],i=a,s?i.ingredients.length&&i.ingredients.forEach(function(){var e=f(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.changeIngredientProportions(t,!1);case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()):(o=0,l=parseFloat(i.leafProportion),c=parseFloat(e.ingredient_proportions),parseFloat(l)&&parseFloat(c)&&(o=l/100*100*(c/100),o=parseFloat(o)),console.log("else",e),e.quantity_used=o);case 3:case"end":return n.stop()}}),n)})))()},changeQuantityUsed:function(e,t){var a=this;return f(r().mark((function t(){var n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=a,s=(s=parseFloat(e.quantity_used?e.quantity_used:0))<0?0:s,e.quantity_used=s,n.reCalIngredientProportion();case 5:case"end":return t.stop()}}),t)})))()},reCalIngredientProportion:function(){var e=this;return f(r().mark((function t(){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("reCalIngredientProportion"),(a=e).ingredients.forEach(function(){var e=f(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.is_deleted){e.next=4;break}return e.next=3,a.calIngredientProportion(t);case 3:t.ingredient_proportions=e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),e.$emit("syncIngredients",a.ingredients);case 4:case"end":return t.stop()}}),t)})))()},calIngredientProportion:function(e){var t=this;return f(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t,s=e.quantity_used/n.totalQuantityUsedValue*100,a.abrupt("return",1*parseFloat(s||0).toFixed(5));case 3:case"end":return a.stop()}}),a)})))()},remoteMethod:function(e,t,a){var n=this;return f(r().mark((function s(){var i,o;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t[a]=[],i=n,(o=_.clone(t)).item_list=[],""===e){r.next=7;break}return r.next=7,n.getData({header:i.header,number:e,line:o,type:a},t,a);case 7:case"end":return r.stop()}}),s)})))()},getData:function(e,t,a){var n=this;return f(r().mark((function s(){var i;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return(i=n).loading=!0,r.next=4,axios.get(i.url.ajax_get_data,{params:e}).then((function(e){var n=e.data.data;i.loading=!1,t[a]=n[a]}));case 4:case"end":return r.stop()}}),s)})))()}}};function h(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function b(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function w(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){b(s,n,r,i,o,"next",e)}function o(e){b(s,n,r,i,o,"throw",e)}i(void 0)}))}}var x,y;const C={components:{LeafIngredient:(0,c.Z)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("h3",{staticClass:"text-navy"},[e._v("\n            รายการวัตถุดิบทั้งหมด: "+e._s(e.ingredientsCount)+"\n\n            "),a("button",{class:e.transBtn.delete.class+" btn-sm tw-w-25 pull-right  btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.deleteAll(t)}}},[a("i",{class:e.transBtn.delete.icon}),e._v("\n                ลบทั้งหมด\n            ")]),e._v(" "),a("button",{class:e.transBtn.create.class+" btn-sm tw-w-25 pull-right mr-2  btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.addNewLine(t)}}},[a("i",{class:e.transBtn.create.icon}),e._v("\n                เพิ่มรายการ\n            ")])])]),e._v(" "),a("table",{staticClass:"table mb-5 table-hover table-bordered"},[a("thead",[a("tr",[a("th",{attrs:{width:"230px;"}},[e._v("\n                    รหัสวัตถุดิบ\n                ")]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[e._v("\n                    เกรดใบยา\n                ")]),e._v(" "),e.header.can.leaf_formulas.ingredient.add_lot_number?[e._m(0)]:e._e(),e._v(" "),e._m(1),e._v(" "),e._m(2),e._v(" "),a("th",{attrs:{width:"50px;"}})],2)]),e._v(" "),a("tbody",[e._l(e.ingredients,(function(t,n){return e.ingredients.length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_deleted?e._e():a("tr",[a("td",[[t.is_edit_item?e._e():a("input",{staticClass:"form-control",attrs:{type:"text",disabled:!e.header.can.edit},domProps:{value:t.item_code},on:{click:function(a){return e.clickSelcet(t,n,"item_list")}}}),e._v(" "),t.is_edit_item?a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"ingredient.loading"}],ref:"item_list_"+n,refInFor:!0,staticStyle:{width:"100%"},attrs:{filterable:"",remote:"",placeholder:"รหัสวัตถุดิบ",disabled:!e.header.can.edit,loading:e.loading},on:{change:function(a){return e.selectInventoryItemId(t)}},model:{value:t.inventory_item_id,callback:function(a){e.$set(t,"inventory_item_id",a)},expression:"ingredient.inventory_item_id"}},e._l(t.item_list,(function(t,n){return a("el-option",{key:t.value,attrs:{label:t.item_number,value:String(t.value)}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1):e._e()]],2),e._v(" "),a("td",[e._v("\n                        "+e._s(t.item_desc)+"\n                    ")]),e._v(" "),e.header.can.leaf_formulas.ingredient.add_lot_number?[a("td",[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"",disabled:!t.inventory_item_id||!e.header.can.edit,remote:"",placeholder:"Lot Number","remote-method":function(a){return e.remoteMethod(a,t,"lot_list")},loading:e.loading},on:{change:function(a){return e.selectLotNumber(t,n)}},model:{value:t.lot_number,callback:function(a){e.$set(t,"lot_number",a)},expression:"ingredient.lot_number"}},e._l(t.lot_list,(function(e,t){return a("el-option",{key:e.value,attrs:{label:e.label,value:String(e.value)}})})),1)],1)]:e._e(),e._v(" "),a("td",[a("input",{staticClass:"form-control text-right",attrs:{disabled:"",title:t.ingredient_proportions},domProps:{value:Number(t.ingredient_proportions).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}})]),e._v(" "),a("td",{staticClass:"text-right",attrs:{title:t.uom}},[a("vue-numeric",{staticClass:"form-control text-right font-weight-bold text-navy",attrs:{disabled:!t.inventory_item_id||!e.header.can.edit,separator:",",precision:3,minus:!1},on:{change:function(a){return e.changeQuantityUsed(t,n)}},model:{value:t.quantity_used,callback:function(a){e.$set(t,"quantity_used",a)},expression:"ingredient.quantity_used"}})],1),e._v(" "),a("td",{staticClass:"text-center align-middle"},[a("button",{class:e.transBtn.delete.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(e){e.preventDefault(),t.is_deleted=!0}}},[a("i",{class:e.transBtn.delete.icon})])])],2)])]:e._e()})),e._v(" "),a("tr",[a("th",{staticClass:"text-right",attrs:{colspan:e.header.can.leaf_formulas.ingredient.add_lot_number?3:2}},[e._v("\n                    รวม\n                ")]),e._v(" "),a("th",{staticClass:"text-right"},[e._v(e._s(e._f("number2Digit")(e.totalIngredientProp)))]),e._v(" "),a("th",{staticClass:"text-right font-weight-bold tw-text-base text-navy"},[e._v(e._s(e._f("number2Digit")(e.totalQuantityUsed)))]),e._v(" "),a("th")])],2)])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("th",{staticClass:"text-center",attrs:{width:"200px;"}},[a("div",[e._v("Lot")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("th",{staticClass:"text-center",attrs:{width:"130px;"}},[a("div",[e._v("สัดส่วน %")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("th",{staticClass:"text-center",attrs:{width:"130px;"}},[a("div",[e._v("ปริมาณที่ใช้ (กก.)")])])}],!1,null,null,null).exports},props:["header","url","transBtn","transDate","pRefresh","data","leafFormulas","tabs"],computed:{totalProportion:function(){var e=_.sumBy(this.lines,(function(e){if(0==e.is_deleted)return parseFloat(e.leaf_proportion)}));return 1*parseFloat(e||0).toFixed(2)},missingQty:function(){var e=_.sumBy(this.lines,(function(e){if(0==e.is_deleted)return _.sumBy(e.leaf_dtl,(function(e){if(0==e.is_deleted)return parseFloat(e.quantity_used?e.quantity_used:0)}))}));return e=parseFloat(e||0),parseFloat(this.header.quantity?this.header.quantity:0)-e}},watch:{pRefresh:(y=w(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("refresh");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return y.apply(this,arguments)}),leafFormulas:(x=w(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("watch: Leaf",t),this.lines=t;case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},data:function(){return{loading:{page:!1,leaf_formula:!1},lines:[],tab:this.tabs}},mounted:function(){console.log("Leaf Formula: Component mounted.")},methods:{clickSelcet:function(e,t){var a=this;return w(r().mark((function n(){var s,i;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=a,i=new Promise(function(){var a=w(r().mark((function a(n,i){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.is_edit_item=!0,e.loading=!0,a.next=4,s.remoteMethod(" ",e);case 4:e.loading=!1,s.$nextTick((function(){s.$refs["leaf_"+t][0].focus()})),n(!0);case 7:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()),n.next=4,i;case 4:n.sent;case 5:case"end":return n.stop()}}),n)})))()},syncIngredients:function(e,t,a){var n=0;console.log("Leaf Formula: syncIngredients",e,t,a),t.input_ingredients=e,parseFloat(this.header.quantity)>0&&(e.forEach((function(e,t){0==e.is_deleted&&(n=parseFloat(n)+parseFloat(e.quantity_used))})),n=parseFloat(n)/parseFloat(this.header.quantity)*100),t.leaf_proportion=1*parseFloat(n).toFixed(2),this.checkHasChange=!0},addNewLine:function(){var e=this;return w(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(a=e).lines.length,s=JSON.parse(JSON.stringify(a.data.leaf_new_line)),a.$set(a.lines,n,s),a.setHasChange(),a.$set(a.tab.leaf_formula_line,"has_change",a.lines.length),a.header.can.edit;case 7:case"end":return t.stop()}}),t)})))()},selectLeaf:function(e){var t=this;return w(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!((n=t).lines.filter((function(t){return t.leaf_formula==e.leaf_formula&&0==t.is_deleted})).length>1)){a.next=8;break}return e.leaf_formula="",e.formulaline_id="",e.line_no="",e.leaf_formula_desc="",a.abrupt("return");case 8:s=e.leaf_list.findIndex((function(t){return t.value==e.leaf_formula})),s=e.leaf_list[s],e.formulaline_id="",e.line_no="",e.leaf_formula_desc="",s&&(e.leaf_formula_desc=s.leaf_formula_desc,e.formulaline_id=s.formulaline_id,e.line_no=s.line_no),n.setHasChange();case 15:case"end":return a.stop()}}),a)})))()},changeLeafProportion:function(){this.setHasChange()},setHasChange:function(){this.checkHasChange=!0},remoteMethod:function(e,t){if(""!==e){var a=this.lines.filter((function(e){return 0==e.is_deleted})),n=h(new Set(a.map((function(e){return e.leaf_formula}))));this.getLeafInput({number:e,header:this.header,type:"leaf_formula",except:n},t)}else t.leaf_list=[]},getLeafInput:function(e,t){var a=this;a.loading.leaf_formula=!0,t.leaf_list=[],axios.get(a.url.ajax_get_data,{params:e}).then((function(e){var n=e.data.data;a.loading.leaf_formula=!1,t.leaf_list=n.leaf_list}))},getLeafFormulas:function(){var e=this;return w(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e,n={header:e.header,type:"leaf_formula_line"},a.loading.page=!0,axios.get(a.url.ajax_get_data,{params:n}).then((function(e){var t=e.data.data;a.$set(a,"lines",t.leaf_formula_lines),a.loading.page=!1}));case 4:case"end":return t.stop()}}),t)})))()},deleteline:function(e){var t=this;return w(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:n=t,e.is_new_row?e.is_deleted=!0:([],s={header:n.header,type:"casings",leaf_formula:e.leaf_formula},axios.get(n.url.ajax_get_data,{params:s}).then(function(){var t=w(r().mark((function t(a){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.data.data,!n.casings.length){t.next=9;break}return t.next=5,helperAlert.showProgressConfirm("ต้องการลบข้อมูล Casing ที่ผูกกับ Leaf Formula: "+e.leaf_formula+" หรือไม่ ?");case 5:confirm=t.sent,confirm&&(e.is_deleted=!0),t.next=10;break;case 9:e.is_deleted=!0;case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return a.stop()}}),a)})))()}}};const k=(0,c.Z)(C,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.page,expression:"loading.page"}]},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 text-right"},[a("button",{class:e.transBtn.create.class+" btn-sm tw-w-25  btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.addNewLine(t)}}},[a("i",{class:e.transBtn.create.icon}),e._v("\n                เพิ่มรายการ\n            ")])])]),e._v(" "),a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"table",staticStyle:{"margin-bottom":"0px"}},[e._m(0),e._v(" "),a("tbody",{attrs:{id:"accordion"}},[e._l(e.lines,(function(t,n){return e.lines.length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_deleted?e._e():a("tr",{staticStyle:{"background-color":"rgb(252, 252, 252)"}},[a("td",{staticClass:"text-right align-middle"},[t.leaf_formula?[a("a",{attrs:{"data-toggle":"collapse","data-parent":"#accordion",href:"#collapse_"+n},on:{click:function(e){t.is_collapse=!t.is_collapse}}},[t.is_collapse?a("i",{staticClass:"fa fa-caret-down",staticStyle:{"font-size":"20px"}}):a("i",{staticClass:"fa fa-caret-right",staticStyle:{"font-size":"20px"}})])]:e._e()],2),e._v(" "),a("td",{staticStyle:{"min-width":"15px !important","max-width":"15px !important"}},[t.is_edit_item?a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"line.loading"}],ref:"leaf_"+n,refInFor:!0,staticClass:"text-center",staticStyle:{width:"100%"},attrs:{filterable:"",remote:"",placeholder:"Leaf Formula",disabled:!e.header.can.edit,loading:e.loading.leaf_formula},on:{change:function(a){return e.selectLeaf(t)}},model:{value:t.leaf_formula,callback:function(a){e.$set(t,"leaf_formula",a)},expression:"line.leaf_formula"}},e._l(t.leaf_list,(function(t,n){return a("el-option",{key:t.value,attrs:{label:t.value,value:String(t.value)}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1):a("input",{staticClass:"form-control",attrs:{type:"text",disabled:!e.header.can.edit},domProps:{value:t.leaf_formula},on:{click:function(a){return e.clickSelcet(t,n)}}})],1),e._v(" "),a("td",{attrs:{colspan:"3"}},[e._v("\n                        "+e._s(t.leaf_formula_desc)+"\n                    ")]),e._v(" "),a("td",{staticClass:"font-weight-bold text-success tw-text-base text-right"},[e._v("\n                        "+e._s(Number(parseFloat(t.leaf_proportion?t.leaf_proportion:0)).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}))+"\n                    ")]),e._v(" "),a("td",{staticClass:"text-center align-middle"},[a("button",{class:e.transBtn.delete.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(a){return a.preventDefault(),e.deleteline(t)}}},[a("i",{class:e.transBtn.delete.icon})])])])]),e._v(" "),t.is_deleted?e._e():a("tr",{directives:[{name:"show",rawName:"v-show",value:t.is_collapse,expression:"line.is_collapse"}]},[a("td",{attrs:{colspan:"1"}}),e._v(" "),a("td",{attrs:{colspan:"4"}},[a("div",{staticClass:"collapse",attrs:{id:"collapse_"+n}},[a("leaf-ingredient",{attrs:{leaf:t,url:e.url,leafProportion:t.leaf_proportion,transBtn:e.transBtn,transDate:e.transDate,data:e.data,header:e.header},on:{syncIngredients:function(a){for(var r=arguments.length,s=Array(r);r--;)s[r]=arguments[r];return e.syncIngredients.apply(void 0,s.concat([t],[n]))}}})],1)]),e._v(" "),a("td",{attrs:{colspan:"2"}})])]:e._e()}))],2),e._v(" "),e.lines.length?a("tfoot",[a("tr",{},[e._m(1),e._v(" "),a("th",{staticClass:"font-weight-bold align-bottom text-danger tw-text-lg text-right pt-4"},[e._v("\n                        "+e._s(e._f("number2Digit")(e.missingQty))+"\n                    ")]),e._v(" "),e._m(2),e._v(" "),a("th",{staticClass:"font-weight-bold align-bottom text-success tw-text-lg text-right pt-4"},[e._v("\n                        "+e._s(e._f("number2Digit")(e.totalProportion))+"\n                    ")]),e._v(" "),a("th")])]):e._e()]),e._v(" "),0===e.lines.length?a("div",{staticClass:"text-center"},[a("span",{staticClass:"lead"},[e._v("No Data.")])]):e._e()])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"pdp0008-table-th-detail-color"},[a("th",{attrs:{width:"120px"}}),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"240px"}},[a("div",[e._v("Leaf Formula")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[a("div",[e._v("รายละเอียด")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"80px"}},[e._v("\n                         \n                    ")]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"100px"}},[e._v("\n                         \n                    ")]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"80px"}},[a("div",[e._v("สัดส่วน %")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"60px"}})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("th",{staticClass:"text-right align-bottom font-weight-bold tw-text-sm pt-4",attrs:{colspan:"3"}},[a("div",[e._v("ปริมาณที่ขาด")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("th",{staticClass:"text-right align-bottom font-weight-bold tw-text-sm pt-4"},[a("div",[e._v("รวมสัดส่วน")])])}],!1,null,null,null).exports;function S(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function H(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){S(s,n,r,i,o,"next",e)}function o(e){S(s,n,r,i,o,"throw",e)}i(void 0)}))}}var D;const I={props:["header","url","transBtn","transDate","data","casings","tabs"],computed:{},watch:{casings:(D=H(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lines=t;case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},data:function(){return{loading:{page:!1,leaf_formula:!1},lines:[],tab:this.tabs}},mounted:function(){console.log("Casings: Component mounted.")},methods:{syncIngredients:function(e,t){t.input_ingredients=e,this.checkHasChange=!0},addNewLine:function(){var e=this;return H(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(a=e).lines.length,t.next=4,_.clone(a.data.new_line);case 4:s=t.sent,a.$set(a.lines,n,s),a.setHasChange(),a.$set(a.tab.casings,"has_change",a.lines.length),a.header.can.edit&&(a.remoteMethod(" ",a.lines[n],"casing_leaf_formula_list"),a.remoteMethod(" ",a.lines[n],"casing_list"));case 9:case"end":return t.stop()}}),t)})))()},avalidateDup:function(e){return H(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.leaf_formula&&e.casing_id;case 1:case"end":return t.stop()}}),t)})))()},selectLeaf:function(e,t){var a=this;return H(r().mark((function n(){var s,i,o,l;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=a,e.leaf_formula_desc="",!(s.lines.filter((function(t){if(e.casing_id)return t.leaf_formula==e.leaf_formula&&t.casing_id==e.casing_id})).length>1)){n.next=6;break}return e.leaf_formula="",n.abrupt("return");case 6:if(i=e.casing_leaf_formula_list.findIndex((function(t){return t.value==e.leaf_formula})),!(i=e.casing_leaf_formula_list[i])){n.next=16;break}if(e.leaf_formula_desc=i.leaf_formula_desc,o=s.lines.filter((function(a,n){if(e.leaf_formula&&n!=t)return a.leaf_formula==e.leaf_formula&&""!=a.casing_id&&null!=a.casing_id&&0==a.is_deleted})),""!=e.casing_id&&null!=e.casing_id){n.next=16;break}return n.next=14,e.casing_list.filter((function(e,t){if(0==o.filter((function(t){return t.casing_id==e.casing_id})).length)return e}));case 14:l=n.sent,e.casing_list=l;case 16:s.setHasChange();case 17:case"end":return n.stop()}}),n)})))()},selectCasing:function(e){var t=this;return H(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=t,e.casing_no="",e.casing_desc="",e.casing_items=[],""!=e.leaf_formula&&null!=e.leaf_formula){a.next=8;break}return e.casing_id="",helperAlert.showGenericFailureDialog("โปรดระบุ Leaf Formula"),a.abrupt("return");case 8:if(!(n.lines.filter((function(t){if(e.leaf_formula)return t.casing_id==e.casing_id&&t.leaf_formula==e.leaf_formula&&0==t.is_deleted})).length>1)){a.next=12;break}return e.casing_id="",a.abrupt("return");case 12:s=e.casing_list.findIndex((function(t){return t.value==e.casing_id})),(s=e.casing_list[s])&&(e.casing_no=s.casing_no,e.casing_desc=s.casing_desc,e.casing_items=s.casing_items),n.setHasChange();case 16:case"end":return a.stop()}}),a)})))()},changeLeafProportion:function(){this.setHasChange()},setHasChange:function(){this.checkHasChange=!0},remoteMethod:function(e,t,a){var n=this;return H(r().mark((function s(){var i;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t[a]=[],(i=_.clone(t)).casing_leaf_formula_list=[],i.casing_list=[],""!==e&&n.getData({number:e,header:n.header,line:i,type:a},t,a);case 5:case"end":return r.stop()}}),s)})))()},getData:function(e,t,a){var n=this;return H(r().mark((function s(){var i;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=n,t.loading=!0,axios.get(i.url.ajax_get_data,{params:e}).then((function(e){var n=e.data.data;t.loading=!1,t[a]=n[a]}));case 3:case"end":return r.stop()}}),s)})))()}}};var F=a(93379),N=a.n(F),B=a(66038),P={insert:"head",singleton:!1};N()(B.Z,P);B.Z.locals;const L=(0,c.Z)(I,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.page,expression:"loading.page"}]},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 text-right"},[a("button",{class:e.transBtn.create.class+" btn-sm tw-w-25  btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.addNewLine(t)}}},[a("i",{class:e.transBtn.create.icon}),e._v("\n                เพิ่มรายการ\n            ")])])]),e._v(" "),a("div",{staticClass:"table-responsivex"},[a("table",{staticClass:"table",staticStyle:{"margin-bottom":"0px"}},[e._m(0),e._v(" "),a("tbody",{attrs:{id:"accordion"}},[e._l(e.lines,(function(t,n){return e.lines.length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_deleted?e._e():a("tr",{key:n,staticStyle:{"background-color":"rgb(252, 252, 252)"},attrs:{data:n}},[a("td",{staticStyle:{"min-width":"65px !important","max-width":"65px !important"}},[a("el-select",{attrs:{filterable:"",remote:"",placeholder:"Leaf Formula",disabled:!e.header.can.edit||!t.is_new_row,loading:t.loading},on:{change:function(a){return e.selectLeaf(t,n)}},model:{value:t.leaf_formula,callback:function(a){e.$set(t,"leaf_formula",a)},expression:"line.leaf_formula"}},e._l(t.casing_leaf_formula_list,(function(t,n){return a("el-option",{key:t.value,attrs:{label:t.value,value:String(t.value)}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1)],1),e._v(" "),a("td",{staticStyle:{"min-width":"100px !important","max-width":"100px !important"}},[e._v("\n                            "+e._s(t.leaf_formula_desc)+"\n                        ")]),e._v(" "),a("td",{staticStyle:{"min-width":"65px !important","max-width":"65px !important"}},[a("el-select",{attrs:{filterable:"",remote:"",placeholder:"",disabled:!e.header.can.edit,loading:t.loading},on:{change:function(a){return e.selectCasing(t)}},model:{value:t.casing_id,callback:function(a){e.$set(t,"casing_id",a)},expression:"line.casing_id"}},e._l(t.casing_list,(function(t,n){return a("el-option",{key:t.value,attrs:{label:t.casing_no,value:String(t.value)}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1)],1),e._v(" "),a("td",[e._v("\n                            "+e._s(t.casing_desc)+"\n                        ")]),e._v(" "),a("td",{staticClass:"text-right align-middle"},[a("button",{class:e.transBtn.detail.class+" btn-xs mb-0",on:{click:function(e){e.preventDefault(),t.is_collapse=!t.is_collapse}}},[a("i",{class:e.transBtn.detail.icon}),e._v("\n                                "+e._s(e.transBtn.detail.text)+"\n                            ")]),e._v(" "),a("button",{class:e.transBtn.delete.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(e){e.preventDefault(),t.is_deleted=!0}}},[a("i",{class:e.transBtn.delete.icon})])])])]),e._v(" "),a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_collapse&&t.casing_items.length&&!t.is_deleted?a("tr",[a("td",{attrs:{colspan:"5"}},[a("table",{staticClass:"table pl-3"},[a("thead",[a("tr",[a("th",{attrs:{width:"15%"}},[e._v("รหัสวัตถุดิบ")]),e._v(" "),a("th",[e._v("รายละเอียดวัตถุดิบ")]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"20%"}},[e._v("ปริมาณที่ใช้")]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"5%"}},[e._v("หน่วย")])])]),e._v(" "),e._l(t.casing_items,(function(t){return a("tr",[a("td",[e._v(e._s(t.item_code))]),e._v(" "),a("td",[e._v(e._s(t.item_desc))]),e._v(" "),a("td",{staticClass:"text-right"},[e._v(e._s(e._f("number3Digit")(t.calcula_casing_quantity)))]),e._v(" "),a("td",{staticClass:"text-right"},[e._v(e._s(t.uom_name))])])}))],2)])]):e._e()])]:e._e()}))],2)]),e._v(" "),0===e.lines.length?a("div",{staticClass:"text-center"},[a("span",{staticClass:"lead"},[e._v("No Data.")])]):e._e()])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"pdp0008-table-th-detail-color"},[a("th",{staticStyle:{"min-width":"65px !important","max-width":"65px !important"}},[a("div",[e._v("Leaf Formula")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",staticStyle:{"min-width":"100px !important","max-width":"100px !important"}},[a("div",[e._v("รายละเอียด")])]),e._v(" "),a("th",{staticStyle:{"min-width":"65px !important","max-width":"65px !important"}},[a("div",[e._v("Casing No.")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[a("div",[e._v("รายละเอียด")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"15%"}})])])}],!1,null,"3336bb77",null).exports;function T(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return O(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function E(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function A(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){E(s,n,r,i,o,"next",e)}function o(e){E(s,n,r,i,o,"throw",e)}i(void 0)}))}}var q;const M={props:["header","url","transBtn","transDate","data","flavors","tabs"],computed:{},watch:{flavors:(q=A(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lines=t;case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return q.apply(this,arguments)})},data:function(){return{loading:{page:!1,leaf_formula:!1},lines:[],tab:this.tabs}},mounted:function(){console.log("Flavor: Component mounted.")},methods:{clickSelcet:function(e,t,a){var n=this;return A(r().mark((function s(){var i,o;return r().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i=n,o=new Promise(function(){var n=A(r().mark((function n(s,o){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e.is_edit_item=!0,e.loading=!0,n.next=4,i.remoteMethod(" ",e,a);case 4:e.loading=!1,i.$nextTick((function(){i.$refs[a+"_"+t][0].focus()})),s(!0);case 7:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()),s.next=4,o;case 4:s.sent;case 5:case"end":return s.stop()}}),s)})))()},syncIngredients:function(e,t){t.input_ingredients=e,this.checkHasChange=!0},addNewLine:function(){var e=this;return A(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(a=e).lines.length,t.next=4,_.clone(a.data.new_line);case 4:s=t.sent,a.$set(a.lines,n,s),a.setHasChange(),a.$set(a.tab.casings,"has_change",a.lines.length),a.header.can.edit;case 9:case"end":return t.stop()}}),t)})))()},selectFlavor:function(e){var t=this;return A(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=t,e.flavor_no="",e.flavor_desc="",e.flavor_items=[],!(n.lines.filter((function(t){return t.flavor_id==e.flavor_id&&0==t.is_deleted})).length>1)){a.next=8;break}return e.flavor_id="",a.abrupt("return");case 8:s=e.flavor_list.findIndex((function(t){return t.value==e.flavor_id})),(s=e.flavor_list[s])&&(e.flavor_no=s.flavor_no,e.flavor_desc=s.flavor_desc,e.flavor_items=s.flavor_items),n.setHasChange();case 12:case"end":return a.stop()}}),a)})))()},changeLeafProportion:function(){this.setHasChange()},setHasChange:function(){this.checkHasChange=!0},remoteMethod:function(e,t,a){var n=this;return A(r().mark((function s(){var i,o,l,c;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t[a]=[],i=n,(o=_.clone(t)).flavor_list=[],l=i.lines.filter((function(e){return 0==e.is_deleted&&t.flavor_id!=e.flavor_id})),c=T(new Set(l.map((function(e){return e.flavor_id})))),""===e){r.next=9;break}return r.next=9,n.getData({number:e,header:n.header,line:o,type:a,except:c},t,a);case 9:case"end":return r.stop()}}),s)})))()},getData:function(e,t,a){var n=this;return A(r().mark((function s(){var i;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=n,t.loading=!0,r.next=4,axios.get(i.url.ajax_get_data,{params:e}).then((function(e){var n=e.data.data;t.loading=!1,t[a]=n[a]}));case 4:case"end":return r.stop()}}),s)})))()}}};var j=a(57245),U={insert:"head",singleton:!1};N()(j.Z,U);j.Z.locals;const R=(0,c.Z)(M,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.page,expression:"loading.page"}]},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 text-right"},[a("button",{class:e.transBtn.create.class+" btn-sm tw-w-25  btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.addNewLine(t)}}},[a("i",{class:e.transBtn.create.icon}),e._v("\n                เพิ่มรายการ\n            ")])])]),e._v(" "),a("div",{staticClass:"table-responsivex"},[a("table",{staticClass:"table",staticStyle:{"margin-bottom":"0px"}},[e._m(0),e._v(" "),a("tbody",{attrs:{id:"accordion"}},[e._l(e.lines,(function(t,n){return e.lines.length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_deleted?e._e():a("tr",{key:n,staticStyle:{"background-color":"rgb(252, 252, 252)"},attrs:{data:n}},[a("td",{staticClass:"text-center align-middle",staticStyle:{"min-width":"15px !important","max-width":"15px !important"}},[a("el-checkbox",{model:{value:t.flavor_status,callback:function(a){e.$set(t,"flavor_status",a)},expression:"line.flavor_status"}})],1),e._v(" "),a("td",{staticStyle:{"min-width":"30px !important","max-width":"30px !important"}},[t.is_edit_item?e._e():a("input",{staticClass:"form-control",attrs:{type:"text",disabled:!e.header.can.edit},domProps:{value:t.flavor_no},on:{click:function(a){return e.clickSelcet(t,n,"flavor_list")}}}),e._v(" "),t.is_edit_item?a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"line.loading"}],ref:"flavor_list_"+n,refInFor:!0,attrs:{filterable:"",remote:"",placeholder:"",disabled:!e.header.can.edit,loading:t.loading},on:{change:function(a){return e.selectFlavor(t)}},model:{value:t.flavor_id,callback:function(a){e.$set(t,"flavor_id",a)},expression:"line.flavor_id"}},e._l(t.flavor_list,(function(t,n){return a("el-option",{key:t.value,attrs:{label:t.flavor_no,value:String(t.value)}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1):e._e()],1),e._v(" "),a("td",[e._v("\n                            "+e._s(t.flavor_desc)+"\n                        ")]),e._v(" "),a("td",{staticClass:"text-right align-middle"},[a("button",{class:e.transBtn.detail.class+" btn-xs mb-0",on:{click:function(e){e.preventDefault(),t.is_collapse=!t.is_collapse}}},[a("i",{class:e.transBtn.detail.icon}),e._v("\n                                "+e._s(e.transBtn.detail.text)+"\n                            ")]),e._v(" "),a("button",{class:e.transBtn.delete.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(e){e.preventDefault(),t.is_deleted=!0}}},[a("i",{class:e.transBtn.delete.icon})])])])]),e._v(" "),a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_collapse&&t.flavor_items.length&&!t.is_deleted?a("tr",[a("td",{attrs:{colspan:"4"}},[a("table",{staticClass:"table"},[a("thead",[a("tr",[a("th",{attrs:{width:"15%"}},[e._v("รหัสวัตถุดิบ")]),e._v(" "),a("th",[e._v("รายละเอียดวัตถุดิบ")]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"20%"}},[e._v("ปริมาณที่ใช้")]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"5%"}},[e._v("หน่วย")])])]),e._v(" "),e._l(t.flavor_items,(function(t){return a("tr",[a("td",[e._v(e._s(t.item_code))]),e._v(" "),a("td",[e._v(e._s(t.item_desc))]),e._v(" "),a("td",{staticClass:"text-right"},[e._v(e._s(e._f("number3Digit")(t.calcula_flavor_quantity)))]),e._v(" "),a("td",{staticClass:"text-right"},[e._v(e._s(t.uom_name))])])}))],2)])]):e._e()])]:e._e()}))],2)]),e._v(" "),0===e.lines.length?a("div",{staticClass:"text-center"},[a("span",{staticClass:"lead"},[e._v("No Data.")])]):e._e()])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"pdp0008-table-th-detail-color"},[a("th",{staticClass:"text-center align-middle",staticStyle:{"min-width":"15px !important","max-width":"15px !important"}},[e._v("\n                        เปิดใช้งาน\n                    ")]),e._v(" "),a("th",{staticStyle:{"min-width":"30px !important","max-width":"30px !important"}},[a("div",[e._v("Flavor No.")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[a("div",[e._v("รายละเอียด")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"15%"}})])])}],!1,null,"675923e5",null).exports;var Z=a(23570),z=a.n(Z);function J(e){return function(e){if(Array.isArray(e))return Q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Q(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function Y(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function V(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){Y(s,n,r,i,o,"next",e)}function o(e){Y(s,n,r,i,o,"throw",e)}i(void 0)}))}}var W,G;const K={props:["header","url","transBtn","transDate","data","cigarettes","cigarDtl","tabs"],computed:{},watch:{cigarettes:(G=V(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lines=t;case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return G.apply(this,arguments)}),cigarDtl:(W=V(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lineCigarDtl=t;case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return W.apply(this,arguments)})},data:function(){return{loading:{page:!1,leaf_formula:!1},lines:[],lineCigarDtl:[],lineCigarDtlByItem:[],tab:this.tabs,selectLineId:""}},mounted:function(){console.log("Cigarettes: Component mounted.")},methods:{addNewDtlLine:function(){var e=this;return V(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(a=e).lineCigarDtl.length,t.next=4,_.clone(a.data.new_dtl_line);case 4:(s=t.sent).fm_cigar_id=a.selectLineId,a.$set(a.lineCigarDtl,n,s),a.setHasChange(),a.$set(a.tab.cigarettes,"has_change",a.lineCigarDtl.length),a.resetLineNoDtlLine();case 10:case"end":return t.stop()}}),t)})))()},delDtlLine:function(e){var t=this;return V(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.is_deleted=!0,t.resetLineNoDtlLine();case 2:case"end":return a.stop()}}),a)})))()},showLineDetail:function(e){var t=this;return V(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.selectLineId=e.fm_cigar_id;case 1:case"end":return a.stop()}}),a)})))()},resetLineNoDtlLine:function(){var e=this;return V(r().mark((function t(){var a,n,s,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e,n=1,t.next=4,a.filterCigarDetail(a.selectLineId);case 4:return s=t.sent,t.next=7,_.maxBy(s,function(){var e=V(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.is_deleted){e.next=2;break}return e.abrupt("return",t.cigar_line_no);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 7:i=t.sent,n=i.cigar_line_no?parseInt(i.cigar_line_no):1,s.forEach(function(){var e=V(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0==t.is_deleted&&(t.cigar_line_no=n,n+=1);case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 10:case"end":return t.stop()}}),t)})))()},addNewLine:function(){var e=this;return V(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(a=e).lines.length,t.next=4,_.clone(a.data.new_line);case 4:(s=t.sent).fm_cigar_id=z()(),a.$set(a.lines,n,s),a.setHasChange(),a.$set(a.tab.cigarettes,"has_change",a.lines.length),a.header.can.edit&&a.remoteMethod(" ",a.lines[n],"cigar_list"),a.showLineDetail(s),a.$nextTick((function(){a.$refs[s.fm_cigar_id]}));case 12:case"end":return t.stop()}}),t)})))()},deleteCigarItem:function(e){var t=this;return V(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t,s=new Promise(function(){var e=V(r().mark((function e(t,a){var s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.filterCigarDetail(n.selectLineId);case 2:s=e.sent,console.log("xxxx============> ",s,n.selectLineId),s.length&&n.filterCigarDetail(n.selectLineId).forEach(function(){var e=V(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.delDtlLine(t);case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),t(!0);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),a.next=4,s;case 4:a.sent,e.is_deleted=!0;case 6:case"end":return a.stop()}}),a)})))()},selectCigarItemId:function(e){var t=this;return V(r().mark((function a(){var n,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=t,e.cigar_organization_code="",e.cigar_organization_id="",e.cigar_item_code="",e.cigar_item_desc="",!(n.lines.filter((function(t){return t.cigar_item_id==e.cigar_item_id&&0==t.is_deleted})).length>1)){a.next=9;break}return e.cigar_item_id="",a.abrupt("return");case 9:s=e.cigar_list.findIndex((function(t){return t.value==e.cigar_item_id})),(s=e.cigar_list[s])&&(e.cigar_organization_code=s.cigar_organization_code,e.cigar_organization_id=s.cigar_organization_id,e.cigar_item_code=s.cigar_item_code,e.cigar_item_desc=s.cigar_item_desc),n.setHasChange();case 13:case"end":return a.stop()}}),a)})))()},setHasChange:function(){this.checkHasChange=!0},remoteMethod:function(e,t,a){var n=this;return V(r().mark((function s(){var i,o,l,c;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=n,t[a]=[],o=i.lines.filter((function(e){return 0==e.is_deleted})),l=J(new Set(o.map((function(e){return e.cigar_item_id})))),(c=_.clone(t)).cigar_list=[],""!==e&&n.getData({number:e,header:n.header,line:c,type:a,except:l},t,a);case 7:case"end":return r.stop()}}),s)})))()},getData:function(e,t,a){var n=this;return V(r().mark((function s(){var i;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=n,t.loading=!0,axios.get(i.url.ajax_get_data,{params:e}).then((function(e){var n=e.data.data;t.loading=!1,t[a]=n[a]}));case 3:case"end":return r.stop()}}),s)})))()},filterCigarDetail:function(e){return this.lineCigarDtl.filter((function(t){return t.fm_cigar_id==e}))}}};var X=a(54239),ee={insert:"head",singleton:!1};N()(X.Z,ee);X.Z.locals;const te=(0,c.Z)(K,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.page,expression:"loading.page"}]},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-5 b-r"},[a("h3",{staticClass:"no-margins text-center text-navy"},[e._v("\n                รายการบุหรี่\n\n                "),e.header?[e.header.can.cigarettes.multi_cigarettes?a("button",{class:e.transBtn.create.class+" btn-sm tw-w-25 mb-0 btn-outline pull-right",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.addNewLine(t)}}},[a("i",{class:e.transBtn.create.icon}),e._v("\n                        เพิ่มรายการ\n                    ")]):e._e()]:e._e()],2),e._v(" "),a("div",{staticClass:"table-responsivex"},[a("table",{staticClass:"table mt-3  table-hover",staticStyle:{"margin-bottom":"0px"}},[e._m(0),e._v(" "),a("tbody",{attrs:{id:"accordion"}},[e._l(e.lines,(function(t,n){return e.lines.length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_deleted?e._e():a("tr",{key:n,attrs:{data:n}},[a("td",{staticClass:"text-center align-middle"},[e.selectLineId==t.fm_cigar_id?a("i",{staticClass:"fa fa-check-circle text-success"}):e._e()]),e._v(" "),a("td",{class:e.selectLineId==t.fm_cigar_id?"  ":" ",on:{click:function(a){return a.preventDefault(),e.showLineDetail(t)}}},[a("el-select",{ref:t.fm_cigar_id,refInFor:!0,attrs:{filterable:"",remote:"",placeholder:"","remote-method":function(a){return e.remoteMethod(a,t,"cigar_list")},disabled:!e.header.can.edit,loading:t.loading},on:{change:function(a){return e.selectCigarItemId(t)}},model:{value:t.cigar_item_id,callback:function(a){e.$set(t,"cigar_item_id",a)},expression:"line.cigar_item_id"}},e._l(t.cigar_list,(function(e,t){return a("el-option",{key:e.value,attrs:{label:e.label,value:String(e.value)}})})),1)],1),e._v(" "),a("td",{class:e.selectLineId==t.fm_cigar_id?"  ":" ",on:{click:function(a){return a.preventDefault(),e.showLineDetail(t)}}},[e._v("\n                                   "+e._s(t.cigar_item_desc)+"\n                                ")]),e._v(" "),a("td",{staticClass:"text-right align-middle"},[a("button",{class:e.transBtn.delete.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(a){return a.preventDefault(),e.deleteCigarItem(t)}}},[a("i",{class:e.transBtn.delete.icon})]),e._v(" "),a("button",{class:e.transBtn.detail.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(a){return a.preventDefault(),e.showLineDetail(t)}}},[a("i",{class:e.transBtn.detail.icon}),e._v("\n                                        "+e._s(e.transBtn.detail.text)+"\n                                    ")])])])])]:e._e()}))],2)]),e._v(" "),0===e.lines.length?a("div",{staticClass:"text-center"},[a("span",{staticClass:"lead"},[e._v("No Data.")])]):e._e()])]),e._v(" "),a("div",{staticClass:"col-7"},[a("h3",{staticClass:"no-margins text-center text-navy"},[e._v("\n                รายการวัตถุห่อมวน\n\n                "),e.header&&e.selectLineId?[e.header.can.cigarettes.multi_cigarettes?a("button",{class:e.transBtn.create.class+" btn-sm tw-w-25 mb-0 btn-outline pull-right",attrs:{disabled:!e.header.can.edit},on:{click:function(t){return t.preventDefault(),e.addNewDtlLine(t)}}},[a("i",{class:e.transBtn.create.icon}),e._v("\n                        เพิ่มรายการ\n                    ")]):e._e()]:e._e()],2),e._v(" "),a("div",{staticClass:"table-responsivex"},[a("table",{staticClass:"table mt-3",staticStyle:{"margin-bottom":"0px"}},[e._m(1),e._v(" "),a("tbody",{attrs:{id:"accordion"}},[e._l(e.filterCigarDetail(e.selectLineId),(function(t,n,r){return e.filterCigarDetail(e.selectLineId).length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.is_deleted?e._e():a("tr",{key:n,staticStyle:{"background-color":"rgb(252, 252, 252)"},attrs:{data:n}},[a("td",{staticClass:"text-center"},[e._v(e._s(t.cigar_line_no))]),e._v(" "),a("td",[a("el-input",{attrs:{type:"textarea",name:"note",disabled:!e.header.can.edit,rows:"1",maxlength:"240","show-word-limit":""},model:{value:t.cigar_description,callback:function(a){e.$set(t,"cigar_description",a)},expression:"cigarDtl.cigar_description"}})],1),e._v(" "),a("td",{staticClass:"text-right align-middle"},[a("button",{class:e.transBtn.delete.class+" btn-xs mb-0 btn-outline",attrs:{disabled:!e.header.can.edit},on:{click:function(a){return e.delDtlLine(t)}}},[a("i",{class:e.transBtn.delete.icon})])])])])]:e._e()}))],2)])])])])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"pdp0008-table-th-detail-color"},[a("th",{attrs:{width:"20px;"}}),e._v(" "),a("th",{attrs:{width:"200px;"}},[a("div",[e._v("รหัสบุหรี่")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[a("div",[e._v("รายละเอียด")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"130px;"}})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"pdp0008-table-th-detail-color"},[a("th",{attrs:{width:"10%"}},[a("div",[e._v("ลำดับ")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[a("div",[e._v("รายละเอียดวัตถุห่อมวน")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"10%"}})])])}],!1,null,"98bf464e",null).exports;function ae(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}var ne,re;const se={props:["header","url","transBtn","transDate","cigaretteAll","tabs"],computed:{},watch:{cigaretteAll:(ne=r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.lines=t;case 2:case"end":return e.stop()}}),e,this)})),re=function(){var e=this,t=arguments;return new Promise((function(a,n){var r=ne.apply(e,t);function s(e){ae(r,a,n,s,i,"next",e)}function i(e){ae(r,a,n,s,i,"throw",e)}s(void 0)}))},function(e,t){return re.apply(this,arguments)})},data:function(){return{loading:{page:!1,leaf_formula:!1},lines:[]}},mounted:function(){console.log("Cigarette All: Component mounted.")},methods:{}};const ie=(0,c.Z)(se,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.page,expression:"loading.page"}]},[a("div",{staticClass:"table-responsivex"},[a("table",{staticClass:"table",staticStyle:{"margin-bottom":"0px"}},[e._m(0),e._v(" "),a("tbody",{attrs:{id:"accordion"}},[e._l(e.lines,(function(t,n){return e.lines.length?[a("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[a("tr",{key:n,staticStyle:{"background-color":"rgb(252, 252, 252)"},attrs:{data:n}},[a("td",{staticClass:"text-center"},[e._v("\n                           "+e._s(t.tab)+"\n                        ")]),e._v(" "),a("td",{staticClass:"text-center"},[e._v("\n                           "+e._s(t.leaf_formula)+"\n                        ")]),e._v(" "),a("td",[e._v("\n                           "+e._s(t.item_number)+"\n                        ")]),e._v(" "),a("td",[e._v("\n                            "+e._s(t.item_description)+"\n                        ")]),e._v(" "),a("td",{staticClass:"text-right"},[e._v("\n                            "+e._s(t.lot_number)+"\n                        ")]),e._v(" "),a("td",{staticClass:"text-right"},[e._v("\n                            "+e._s(e._f("numberFormat")(t.qty))+"\n                        ")]),e._v(" "),a("td",{staticClass:"text-center"},[e._v("\n                            "+e._s(t.uom)+"\n                        ")])])])]:e._e()}))],2)]),e._v(" "),0===e.lines.length?a("div",{staticClass:"text-center"},[a("span",{staticClass:"lead"},[e._v("No Data.")])]):e._e()])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",{staticClass:"pdp0008-table-th-detail-color"},[a("th",{staticClass:"text-center",attrs:{width:"5%"}},[a("div",[e._v("กลุ่ม/ประเภท")])]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"5%"}},[a("div",[e._v("Leaf FML")])]),e._v(" "),a("th",{attrs:{width:"15%"}},[a("div",[e._v("รหัสวัตถุดิบ")])]),e._v(" "),a("th",{staticClass:"hidden-sm hidden-xs",attrs:{width:""}},[a("div",[e._v("รายละเอียด")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"5%"}},[a("div",[e._v("Lot")])]),e._v(" "),a("th",{staticClass:"text-right",attrs:{width:"10%"}},[a("div",[e._v("ปริมาณที่ใช้")])]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"5%"}},[a("div",[e._v("หน่วย")])])])])}],!1,null,"0b6d609b",null).exports;function oe(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function le(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){oe(s,n,r,i,o,"next",e)}function o(e){oe(s,n,r,i,o,"throw",e)}i(void 0)}))}}var ce;const de={props:["header","transBtn","transDate","url","countOpen","menu","data"],data:function(){return{newHeader:{},loading:!1,getParamlLoading:!1,transactionDateFormat:"",blendNo:"",requestHeaders:[],inputParams:{blend_no_list:[]},canSearch:[],defaultCanSearch:[],defaultCanSearchฺBlend:[]}},beforeMount:function(){this.newHeader=JSON.parse(JSON.stringify(this.header)),this.newHeader.blend_no="",this.checkFmlType()},mounted:function(){this.newHeader.formula_status="",this.newHeader.formula_type_code=""},computed:{},watch:{countOpen:(ce=le(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.openModal(),this.getParam(" ");case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ce.apply(this,arguments)})},methods:{checkFmlType:function(){var e=this;return le(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e,console.log("CP checkFmlType",a.newHeader.formula_type_code,!a.newHeader.formula_type_code),a.newHeader.formula_type_code){t.next=4;break}return t.abrupt("return");case 4:n=a.data.formula_type.findIndex((function(e){return e.lookup_code==a.newHeader.formula_type_code})),(n=a.data.formula_type[n]).lookup_code,a.newHeader.can.leaf_formulas.ingredient.add_lot_number="P"!=n.lookup_code,a.newHeader.can.is_standart_formula_type="S"==n.lookup_code,a.newHeader.can.is_actual_formula_type="A"==n.lookup_code,a.newHeader.can.is_chnp_formula_type="P"==n.lookup_code;case 11:case"end":return t.stop()}}),t)})))()},defRecipeFiscalYear:function(){var e=this;return le(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=e).newHeader.formula_type_code){t.next=3;break}return t.abrupt("return");case 3:n=a.data.formula_type.findIndex((function(e){return e.lookup_code==a.newHeader.formula_type_code})),n=a.data.formula_type[n],a.newHeader.has_tmp_table?a.newHeader.can.is_standart_formula_type?a.newHeader.recipe_fiscal_year=a.newHeader.recipe_fiscal_year?a.newHeader.recipe_fiscal_year:a.newHeader.def_recipe_fiscal_year:a.newHeader.recipe_fiscal_year=a.newHeader.recipe_fiscal_year?a.newHeader.recipe_fiscal_year:"":a.newHeader.can.is_standart_formula_type?a.newHeader.recipe_fiscal_year=a.newHeader.recipe_fiscal_year?a.newHeader.recipe_fiscal_year:a.newHeader.def_recipe_fiscal_year:a.newHeader.recipe_fiscal_year="";case 6:case"end":return t.stop()}}),t)})))()},setdate:function(e){var t=this;return le(r().mark((function a(){var n;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t,a.next=3,i()(e).format(n.transDate["js-format"]);case 3:n.transactionDateFormat=a.sent;case 4:case"end":return a.stop()}}),a)})))()},openModal:function(){$("#modal_search").modal("show"),$(".slimScroll").slimScroll({height:"250px",width:"100%"})},search:function(e){var t=this;t.loading=!0,axios.get(t.url.index,{params:e}).then((function(e){var a=e.data.data;t.loading=!1,t.requestHeaders=a.data}))},selectRow:function(e){var t=this;return le(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:$("#modal_search").modal("hide"),t.requestHeaders=[],t.$emit("selectRow",e);case 3:case"end":return a.stop()}}),a)})))()},searchForm:function(){var e=this;return le(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.search({action:"search",blend_no:e.newHeader.blend_no,tobacco_type_code:e.newHeader.tobacco_type_code,formula_type_code:e.newHeader.formula_type_code,recipe_fiscal_year:e.newHeader.recipe_fiscal_year,formula_status:e.newHeader.formula_status});case 1:case"end":return t.stop()}}),t)})))()},getParam:function(e){var t=arguments,a=this;return le(r().mark((function n(){var s,i,o,l,c,d,u;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:s=t.length>1&&void 0!==t[1]?t[1]:null,i=t.length>2&&void 0!==t[2]?t[2]:null,o=t.length>3&&void 0!==t[3]?t[3]:null,l=t.length>4&&void 0!==t[4]?t[4]:null,c=t.length>5&&void 0!==t[5]?t[5]:null,(d=a).getParamlLoading=!0,d.defaultCanSearchฺBlend=[],u={action:"search-get-param",blend_no:e,tobacco_type_code:s,formula_type_code:i,formula_status:o,recipe_fiscal_year:l},axios.get(d.url.index,{params:u}).then((function(e){var t=e.data.data;d.getParamlLoading=!1,d.inputParams.blend_no_list=t.blend_no_list,d.canSearch=t.can_search,d.defaultCanSearchฺBlend=t.default_can_searchฺ_blend,"search"==c&"S"!=d.newHeader.formula_type_code&&(d.newHeader.blend_no="")})).then((function(){d.newHeader.blend_no&&(d.newHeader.formula_status=d.defaultCanSearchฺBlend.formula_status,d.newHeader.formula_type_code=d.defaultCanSearchฺBlend.formula_type_code,d.newHeader.recipe_fiscal_year=d.defaultCanSearchฺBlend.recipe_fiscal_year,d.newHeader.tobacco_type_code=d.defaultCanSearchฺBlend.tobacco_type_code,d.newHeader.can.is_standart_formula_type=d.defaultCanSearchฺBlend.type_s)}));case 10:case"end":return n.stop()}}),n)})))()},canShow:function(e,t){var a=this;if(!a.canSearch||"undefined"==a.canSearch||""==a.canSearch||0==Object.keys(a.canSearch).length)return!0;if("tobacco_type_code"==e){var n=a.canSearch.tobacco_type_code.find((function(e){return e==t}));if(!n||"undefined"==n)return!1}if("formula_type_code"==e){var r=a.canSearch.formula_type_code.find((function(e){return e==t}));if(!r||"undefined"==r)return!1}if("status_list"==e){var s=a.canSearch.formula_status.find((function(e){return e.toUpperCase()==t.toUpperCase()}));if(!s||"undefined"==s)return!1}if("recipe_fiscal_year_list"==e){var i=a.canSearch.recipe_fiscal_year.find((function(e){return e==t}));if(!i||"undefined"==i)return!1}return!0},resetForm:function(){this.newHeader.blend_no="",this.newHeader.tobacco_type_code="",this.newHeader.formula_type_code="",this.newHeader.recipe_fiscal_year="",this.newHeader.formula_status="",this.newHeader.can.is_standart_formula_type=!1,this.getParam(" "),this.requestHeaders=[],this.defaultCanSearchฺBlend=[]}}};const ue=(0,c.Z)(de,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[a("div",{staticClass:"modal inmodal fade",attrs:{id:"modal_search",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-lg",staticStyle:{width:"90%","max-width":"1230px","padding-top":"1%"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"modal-content"},[e._m(0),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.getParamlLoading,expression:"getParamlLoading"}],staticClass:"modal-body text-left"},[e._e(),e._v(" "),a("div",{staticClass:"row col-12"},[a("div",{staticClass:"form-group pl-2 pr-2 mb-0 col-lg-4 col-md-2 col-sm-6 col-xs-6 mt-2"},[a("label",{staticClass:"text-left tw-font-bold tw-uppercase mb-1"},[e._v(" ยาเส้นปรุง Blend No. :")]),e._v(" "),a("div",{staticClass:"input-group "},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"โปรดเลือก ยาเส้นปรุง Blend No.",loading:e.getParamlLoading,"popper-append-to-body":!1,filterable:"",remote:"","remote-method":e.getParam},on:{change:function(t){return e.getParam(e.newHeader.blend_no)}},model:{value:e.newHeader.blend_no,callback:function(t){e.$set(e.newHeader,"blend_no",t)},expression:"newHeader.blend_no"}},e._l(e.inputParams.blend_no_list,(function(e){return a("el-option",{key:e.blend_no,attrs:{label:e.blend_no,value:e.blend_no}})})),1)],1)]),e._v(" "),a("div",{staticClass:"form-group pl-2 pr-2 mb-0 col-lg-4 col-md-2 col-sm-6 col-xs-6 mt-2"},[a("label",{staticClass:"text-left tw-font-bold tw-uppercase mb-1"},[e._v(" ประเภทยาเส้น :")]),e._v(" "),a("div",{staticClass:"input-group "},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","popper-append-to-body":!1,clearable:"",filterable:""},on:{change:function(t){return e.getParam(e.newHeader.blend_no,e.newHeader.tobacco_type_code,e.newHeader.formula_type_code,e.newHeader.formula_status,e.newHeader.recipe_fiscal_year,"search")}},model:{value:e.newHeader.tobacco_type_code,callback:function(t){e.$set(e.newHeader,"tobacco_type_code",t)},expression:"newHeader.tobacco_type_code"}},e._l(e.data.tobacco_type_code_list,(function(t){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.canShow("tobacco_type_code",t.value),expression:"canShow('tobacco_type_code', item.value)"}],key:t.value,attrs:{label:t.label,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1)],1)]),e._v(" "),a("div",{staticClass:"form-group pl-2 pr-2 mb-0 col-lg-4 col-md-2 col-sm-6 col-xs-6 mt-2"},[a("label",{staticClass:"text-left tw-font-bold tw-uppercase mb-1"},[e._v(" ประเภทสูตร :")]),e._v(" "),a("div",{staticClass:"input-group "},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"formula_type_code","popper-append-to-body":!1,clearable:""},on:{change:function(t){e.checkFmlType(),e.defRecipeFiscalYear(),e.getParam(e.newHeader.blend_no,e.newHeader.tobacco_type_code,e.newHeader.formula_type_code,e.newHeader.formula_status,e.newHeader.recipe_fiscal_year,"search")}},model:{value:e.newHeader.formula_type_code,callback:function(t){e.$set(e.newHeader,"formula_type_code",t)},expression:"newHeader.formula_type_code"}},e._l(e.data.formula_type,(function(t,n){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.canShow("formula_type_code",t.lookup_code),expression:"canShow('formula_type_code', fmlType.lookup_code)"}],key:t.lookup_code,attrs:{label:t.description,value:t.lookup_code}})})),1)],1)])]),e._v(" "),a("div",{staticClass:"row col-12"},[a("div",{staticClass:"form-group pl-2 pr-2 mb-0 col-lg-4 col-md-2 col-sm-6 col-xs-6 mt-2"},[a("label",{staticClass:"text-left tw-font-bold tw-uppercase mb-1"},[e._v(" ปีงบประมาณ :")]),e._v(" "),a("div",{staticClass:"input-group "},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"","value-key":"recipe_fiscal_year",disabled:!e.newHeader.can.is_standart_formula_type,"popper-append-to-body":!1},on:{change:function(t){e.getParam(e.newHeader.blend_no,e.newHeader.tobacco_type_code,e.newHeader.formula_type_code,e.newHeader.formula_status,e.newHeader.recipe_fiscal_year,"search")}},model:{value:e.newHeader.recipe_fiscal_year,callback:function(t){e.$set(e.newHeader,"recipe_fiscal_year",t)},expression:"newHeader.recipe_fiscal_year"}},[""!=e.newHeader.recipe_fiscal_year&&null!=e.newHeader.recipe_fiscal_year?e._l(e.data.recipe_fiscal_year_list,(function(t,n){return t.value>=e.newHeader.recipe_fiscal_year?a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.canShow("recipe_fiscal_year_list",t.value),expression:"canShow('recipe_fiscal_year_list', item.value)"}],key:t.value,attrs:{label:t.value,value:t.value}}):e._e()})):e._l(e.data.recipe_fiscal_year_list,(function(t,n){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.canShow("recipe_fiscal_year_list",t.value),expression:"canShow('recipe_fiscal_year_list', item.value)"}],key:t.value,attrs:{label:t.value,value:t.value}})}))],2)],1)]),e._v(" "),a("div",{staticClass:"form-group pl-2 pr-2 mb-0 col-lg-4 col-md-2 col-sm-6 col-xs-6 mt-2"},[a("label",{staticClass:"text-left tw-font-bold tw-uppercase mb-1"},[e._v("สถานะ :")]),e._v(" "),a("div",{staticClass:"input-group "},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"","popper-append-to-body":!1,"value-key":"formula_status"},on:{change:function(t){return e.getParam(e.newHeader.blend_no,e.newHeader.tobacco_type_code,e.newHeader.formula_type_code,e.newHeader.formula_status,e.newHeader.recipe_fiscal_year,"search")}},model:{value:e.newHeader.formula_status,callback:function(t){e.$set(e.newHeader,"formula_status",t)},expression:"newHeader.formula_status"}},e._l(e.data.status_list,(function(t,n){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:e.canShow("status_list",n),expression:"canShow('status_list', index)"}],key:n,attrs:{label:t,value:n}})})),1)],1)]),e._v(" "),a("div",{staticClass:"form-group text-right  pr-2 mb-0 col-lg-4 col-md-10 col-sm-12 col-xs-12"},[a("label",{staticClass:" tw-font-bold tw-uppercase mt-2 mb-1"},[e._v(" ")]),e._v(" "),a("div",{staticClass:"text-left"},[a("button",{class:e.transBtn.search.class+" btn-lg tw-w-25",attrs:{type:"button"},on:{click:e.searchForm}},[a("i",{class:e.transBtn.search.icon}),e._v("\n                                    "+e._s(e.transBtn.search.text)+"\n                                ")]),e._v(" "),a("button",{class:e.transBtn.reset.class+" btn-lg tw-w-25",attrs:{type:"button"},on:{click:e.resetForm}},[a("i",{class:e.transBtn.reset.icon}),e._v("\n                                    "+e._s(e.transBtn.reset.text)+"\n                                ")])])])]),e._v(" "),a("div",{staticClass:"ibox-content table-responsivex m-t mb-3 "},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("div",{staticClass:"slimScroll"},[a("table",{staticClass:"table table-hover"},[e._m(1),e._v(" "),a("tbody",e._l(e.requestHeaders,(function(t,n){return a("tr",{on:{click:function(a){return e.selectRow(t)}}},[a("td",{staticClass:"text-center"},[e._v(e._s(t.tobacco_type_desc))]),e._v(" "),a("td",{staticClass:"text-center"},[e._v(e._s(t.formula_type))]),e._v(" "),a("td",{staticClass:"text-center"},[e._v(e._s(t.recipe_fiscal_year))]),e._v(" "),a("td",{attrs:{title:"version: "+t.formula_vers}},[e._v(e._s(t.blend_no))]),e._v(" "),a("td",{staticClass:"text-center"},[e._v(e._s(t.formula_status))]),e._v(" "),a("td",{staticClass:"text-center"},[e._v(e._s(t.formula_approval_date_format))]),e._v(" "),a("td",{staticClass:"text-right"},[a("button",{class:e.transBtn.detail.class+" btn-lg tw-w-25",attrs:{type:"button"},on:{click:function(a){return e.selectRow(t)}}},[a("i",{class:e.transBtn.detail.icon}),e._v("\n                                                        "+e._s(e.transBtn.detail.text)+"\n                                                    ")])])])})),0)])])])])])]),e._v(" "),e._m(2)])])])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-header"},[a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")]),a("span",{staticClass:"sr-only"},[e._v("Close")])]),e._v(" "),a("h4",{staticClass:"modal-title"},[e._v("ค้นหา")]),e._v(" "),a("small",{staticClass:"font-bold"},[e._v("\n                         \n                    ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",[a("th",{staticClass:"text-center",attrs:{width:"90px"}},[e._v("ประเภทยาเส้น")]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"90px"}},[e._v("ประเภทสูตร")]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"90px"}},[e._v("ปีงบประมาณ")]),e._v(" "),a("th",{staticClass:"text-left",attrs:{width:""}},[e._v("ยาเส้นปรุง Blend No.")]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"90px"}},[e._v("สถานะ")]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"90px"}},[e._v("วันที่อนุมัติ")]),e._v(" "),a("th",{staticClass:"text-center",attrs:{width:"150px"}})])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-white",attrs:{type:"button","data-dismiss":"modal"}},[e._v("Close")])])}],!1,null,null,null).exports;function _e(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function fe(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){_e(s,n,r,i,o,"next",e)}function o(e){_e(s,n,r,i,o,"throw",e)}i(void 0)}))}}function pe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const ve={props:["header","data","transBtn","transDate","url","countOpen","menu"],data:function(){var e;return pe(e={newHeader:{},loading:!1,getParamlLoading:!1,transactionDateFormat:"",blendNo:"",requestHeaders:[],inputParams:{blend_no_list:[]}},"loading",{page:!1,before_mount:!1,product_item_id:!1,duplicate:!1}),pe(e,"can",{save:!1}),e},mounted:function(){this.newHeader=JSON.parse(JSON.stringify(this.header)),this.newHeader.formula_type_code="",this.newHeader.blend_no=""},computed:{},watch:{countOpen:function(){var e=fe(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.openModal();case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},methods:{checkFmlType:function(){var e=this;return fe(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(a=e).data.formula_type.findIndex((function(e){return e.lookup_code==a.newHeader.formula_type_code})),(n=a.data.formula_type[n]).description,a.newHeader.can.leaf_formulas.ingredient.add_lot_number="สูตรชนป."!=n.description,a.newHeader.can.is_standart_formula_type="S"==n.lookup_code,a.newHeader.can.is_actual_formula_type="A"==n.lookup_code;case 7:case"end":return t.stop()}}),t)})))()},defRecipeFiscalYear:function(){var e=this;return fe(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(a=e).data.formula_type.findIndex((function(e){return e.lookup_code==a.newHeader.formula_type_code})),n=a.data.formula_type[n],a.newHeader.has_tmp_table?a.newHeader.can.is_standart_formula_type?a.newHeader.recipe_fiscal_year=a.newHeader.recipe_fiscal_year?a.newHeader.recipe_fiscal_year:a.newHeader.def_recipe_fiscal_year:a.newHeader.recipe_fiscal_year=a.newHeader.recipe_fiscal_year?a.newHeader.recipe_fiscal_year:"":a.newHeader.can.is_standart_formula_type?a.newHeader.recipe_fiscal_year=a.newHeader.recipe_fiscal_year?a.newHeader.recipe_fiscal_year:a.newHeader.def_recipe_fiscal_year:a.newHeader.recipe_fiscal_year="";case 4:case"end":return t.stop()}}),t)})))()},stripNonNumber:function(e){return parseFloat(e.replace(/,/g,""))},setdate:function(e){var t=this;return fe(r().mark((function a(){var n;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t,a.next=3,i()(e).format(n.transDate["js-format"]);case 3:n.transactionDateFormat=a.sent;case 4:case"end":return a.stop()}}),a)})))()},openModal:function(){$("#modal_dup").modal("show"),$(".slimScroll").slimScroll({height:"250px",width:"100%"})},getProductItem:function(){var e=arguments,t=this;return fe(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.length>0&&void 0!==e[0]?e[0]:1,t.can.save=!0,a.abrupt("return");case 12:case"end":return a.stop()}}),a)})))()},duplicate:function(){var e=this;return fe(r().mark((function t(){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=e).loading.duplicate=!0,a.can.save=!1,t.next=5,axios.post(a.url.ajax_store,{new_header:a.newHeader,action:"duplicate"}).then((function(e){var t=e.data.data;"S"==t.status&&(swal({title:"&nbsp;",text:"บันทึกข้อมูลสำเร็จ",type:"success",html:!0}),a.selectRow(t.header)),"S"!=t.status&&swal({title:"Error !",text:t.msg,type:"error",showConfirmButton:!0})})).catch((function(e){var t=e.response.data;swal({title:"Error !",text:t.message,type:"error",showConfirmButton:!0})})).then((function(){a.loading.duplicate=!1,a.can.save=!0}));case 5:case"end":return t.stop()}}),t)})))()},selectRow:function(e){var t=this;return fe(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:$("#modal_dup").modal("hide"),t.$emit("selectRow",e);case 2:case"end":return a.stop()}}),a)})))()}}};function me(e,t,a,n,r,s,i){try{var o=e[s](i),l=o.value}catch(e){return void a(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function he(e){return function(){var t=this,a=arguments;return new Promise((function(n,r){var s=e.apply(t,a);function i(e){me(s,n,r,i,o,"next",e)}function o(e){me(s,n,r,i,o,"throw",e)}i(void 0)}))}}const ge={components:{SearchItem:d,TabLeafFormula:k,Casing:L,Flavor:R,Cigarette:te,CigaretteAll:ie,modalSearch:ue,modalDuplicate:(0,c.Z)(ve,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[a("div",{staticClass:"modal inmodal fade",attrs:{id:"modal_dup",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-lg",staticStyle:{"padding-top":"1%"}},[a("div",{staticClass:"modal-content"},[e._m(0),e._v(" "),a("div",{staticClass:"modal-body text-left",staticStyle:{"font-size":"14px"}},[a("div",{staticClass:"ibox"},[e._m(1),e._v(" "),a("div",{staticClass:"ibox-content no-padding"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-6 mb-2 mt-3 b-r"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-6 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            ประเภทยาเส้น:\n                                        ")]),e._v(" "),a("label",{staticClass:"col-5  pr-0 font-weight-boldx col-form-label"},[e._v("\n                                            "+e._s(e.header.tobacco_type_desc)+"\n                                        ")])]),e._v(" "),a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-6 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            ประเภทสูตร:\n                                        ")]),e._v(" "),a("label",{staticClass:"col-5  pr-0 font-weight-boldx col-form-label"},[e._v("\n                                            "+e._s(e.header.formula_type)+"\n                                        ")])]),e._v(" "),a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-6 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            ปีงบประมาณ:\n                                        ")]),e._v(" "),a("label",{staticClass:"col-5  pr-0 font-weight-boldx col-form-label"},[e._v("\n                                            "+e._s(e.header.recipe_fiscal_year)+"\n                                        ")])])]),e._v(" "),a("div",{staticClass:"col-6 mb-2 mt-3 b-r"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            Blend No.\n                                        ")]),e._v(" "),a("label",{staticClass:"col-5  pr-0 font-weight-boldx col-form-label"},[e._v("\n                                            "+e._s(e.header.blend_no)+"\n                                        ")])]),e._v(" "),a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            รหัสยาเส้น:\n                                        ")]),e._v(" "),a("label",{staticClass:"col-8  pr-0 font-weight-boldx col-form-label"},[e._v("\n                                            "+e._s(e.header.product_item_code)+" : "+e._s(e.header.product_item_desc)+"\n                                        ")])])])])]),e._v(" "),e._m(2),e._v(" "),a("div",{staticClass:"ibox-content ",staticStyle:{"border-top":"0px"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 mb-2 mt-3"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            ประเภทยาเส้น:\n                                        ")]),e._v(" "),a("div",{staticClass:"col-7 "},[a("el-select",{staticClass:"required",staticStyle:{width:"100%"},attrs:{"popper-append-to-body":!1,placeholder:"",clearable:"",filterable:""},on:{change:function(e){}},model:{value:e.newHeader.tobacco_type_code,callback:function(t){e.$set(e.newHeader,"tobacco_type_code",t)},expression:"newHeader.tobacco_type_code"}},e._l(e.data.tobacco_type_code_list,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))])])})),1)],1)])]),e._v(" "),a("div",{staticClass:"col-12 mb-2"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            ประเภทสูตร\n                                        ")]),e._v(" "),a("div",{staticClass:"col-7 "},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:""==e.newHeader.tobacco_type_code,"popper-append-to-body":!1,placeholder:""},on:{change:function(t){e.checkFmlType(),e.defRecipeFiscalYear()}},model:{value:e.newHeader.formula_type_code,callback:function(t){e.$set(e.newHeader,"formula_type_code",t)},expression:"newHeader.formula_type_code"}},e._l(e.data.formula_type,(function(e,t){return a("el-option",{key:e.lookup_code,attrs:{label:e.description,value:e.lookup_code}})})),1)],1)])]),e._v(" "),a("transition",{attrs:{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},["S"==e.newHeader.formula_type_code?a("div",{staticClass:"col-12 mb-2"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                                ปีงบประมาณ\n                                            ")]),e._v(" "),a("div",{staticClass:"col-7 "},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"","popper-append-to-body":!1,"value-key":"recipe_fiscal_year"},on:{change:function(e){}},model:{value:e.newHeader.recipe_fiscal_year,callback:function(t){e.$set(e.newHeader,"recipe_fiscal_year",t)},expression:"newHeader.recipe_fiscal_year"}},[e._l(e.data.recipe_fiscal_year_list,(function(e,t){return a("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})}))],2)],1)])]):e._e()]),e._v(" "),a("div",{staticClass:"col-12 mb-2"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            Blend No.\n                                        ")]),e._v(" "),a("div",{staticClass:"col-7 "},[a("el-input",{attrs:{placeholder:"",disabled:""==e.newHeader.formula_type_code},on:{input:function(t){e.newHeader.blend_no=t.toUpperCase()},change:function(t){e.getProductItem()}},model:{value:e.newHeader.blend_no,callback:function(t){e.$set(e.newHeader,"blend_no",t)},expression:"newHeader.blend_no"}})],1)])]),e._v(" "),a("div",{staticClass:"col-12 mb-2"},[a("div",{staticClass:"form-group mb-1 row"},[a("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[e._v("\n                                            ปริมาณ\n                                        ")]),e._v(" "),a("div",{staticClass:"col-4 "},[a("div",{staticClass:"input-group "},[a("input",{staticClass:"form-control text-right ",attrs:{type:"text"},domProps:{value:e._f("number2Digit")(e.newHeader.quantity)},on:{change:function(t){e.newHeader.quantity=e.stripNonNumber(t.target.value),e.newHeader.quantity<0&&(e.newHeader.quantity=0)}}})])])])])],1)])])]),e._v(" "),a("div",{staticClass:"modal-footer"},[a("button",{class:e.transBtn.save.class+" btn-lg tw-w-25",attrs:{type:"button",disabled:!e.can.save},on:{click:function(t){return t.preventDefault(),e.duplicate()}}},[a("i",{class:e.transBtn.save.icon}),e._v("\n                        "+e._s(e.transBtn.save.text)+"\n                    ")]),e._v(" "),a("button",{staticClass:"btn btn-white",attrs:{type:"button","data-dismiss":"modal"}},[e._v("Close")])])])])])])}),[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"modal-header"},[a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")]),a("span",{staticClass:"sr-only"},[e._v("Close")])]),e._v(" "),a("h4",{staticClass:"modal-title"},[e._v("คัดลอกสูตร")]),e._v(" "),a("small",{staticClass:"font-bold"},[e._v("\n                         \n                    ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ibox-title"},[a("h3",[e._v("ต้นฉบับ")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ibox-content text-success",staticStyle:{"border-top":"0px"}},[a("h3",{staticClass:"no-margins"},[a("i",{staticClass:"fa fa-copy"}),e._v(" คัดลอก")])])}],!1,null,null,null).exports},props:["pUrl","pMenu"],computed:{},watch:{},data:function(){return{url:this.pUrl,menu:this.pMenu,data:!1,header:!1,profile:!1,uomDesc:"",transBtn:{},transDate:{},isActive:!1,lines:[],originalData:[],originalDtlData:[],leafFormulas:[],casings:[],flavors:[],cigarettes:[],cigarDtl:[],cigaretteAll:[],leafFormulaHasChange:!1,loading:{page:!1,before_mount:!1,product_item_id:!1},firstLoad:!0,countOpenModal:0,countOpenModalDup:0,selTabName:"tab1",tabs:{leaf_formula_line:{loading:!1,refreshCount:1,has_change:!1},casings:{loading:!1,refreshCount:1,has_change:!1},flavors:{loading:!1,refreshCount:1,has_change:!1},cigarettes:{loading:!1,refreshCount:1,has_change:!1},cigarette_all:{loading:!1,refreshCount:1,has_change:!1}},rules:{name:[{required:!0,message:"Please input Activity name",trigger:"blur"},{min:3,max:5,message:"Length should be 3 to 5",trigger:"blur"}]},ruleForm:{name:""}}},beforeMount:function(){console.log("beforeMount"),this.getInfo()},mounted:function(){console.log("Component mounted. PDP0008");var e=new URLSearchParams(window.location.search).get("blend_no");e&&this.getInfo("",e,"","")},methods:{stripNonNumber:function(e){return parseFloat(e.replace(/,/g,""))},upper:function(e){e.target.value=e.target.value.toUpperCase()},getProductItem:function(){var e=arguments,t=this;return he(r().mark((function a(){var n,s,i;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.length>0&&void 0!==e[0]?e[0]:1,(s=t).data.blend_no_list=[],s.data.product_item_id_list=[],s.header.product_item_id="",""==s.header.tobacco_type_code||!s.header.can.select_product_item_id){a.next=10;break}return i={blend_no:s.header.blend_no,tobacco_type_code:s.header.tobacco_type_code,formula_type_code:s.header.formula_type_code,is_creation:n,action:"get-blend-no"},s.loading.product_item_id=!0,a.next=10,axios.get(s.url.index,{params:i}).then((function(e){var t=e.data.data;"S"==t.status&&(s.data.product_item_id_list=t.product_item_id_list),"E"==t.status&&(swal({title:"Error !",text:t.msg,type:"error",showConfirmButton:!0}),s.header.blend_no=""),s.loading.product_item_id=!1}));case 10:case"end":return a.stop()}}),a)})))()},validateBlendNo:function(){var e=this;return he(r().mark((function t(){var a,n,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e,n=JSON.parse(JSON.stringify(a.header)),s={header:n,action:"validate-blend-no"},t.next=5,axios.get(a.url.index,{params:s}).then((function(e){e.data.data}));case 5:case"end":return t.stop()}}),t)})))()},show:function(e){var t=this;return he(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.loading.before_mount=!1,t.getInfo(e.formula_id,e.blend_no,e.tobacco_organization_id,e.formula_no);case 2:case"end":return a.stop()}}),a)})))()},setdate:function(e,t){var a=this;return he(r().mark((function n(){var s;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=a,n.next=3,i()(e).format(s.transDate["js-format"]);case 3:s.header[t]=n.sent,s.getLines();case 5:case"end":return n.stop()}}),n)})))()},changeStatus:function(){return he(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},getInfo:function(){var e=arguments,t=this;return he(r().mark((function a(){var n,s,i,o,l,c,d;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.length>0&&void 0!==e[0]?e[0]:"",s=e.length>1&&void 0!==e[1]?e[1]:"",i=e.length>2&&void 0!==e[2]?e[2]:"",o=e.length>3&&void 0!==e[3]?e[3]:"",c={lookup_code:(l=t).header.lookup_code,formula_id:n,blend_no:s,formula_no:o,tobacco_organization_id:i},d=!1,l.loading.page=!0,l.loading.before_mount=!0,a.next=11,axios.get(l.url.index,{params:c}).then((function(e){"S"==(d=e.data.data).status&&(d=d.info),l.loading.page=!1}));case 11:if(!d){a.next=22;break}return console.log("xx",d),l.data=d.data,l.header=d.header,l.profile=d.profile,l.transBtn=d.transBtn,l.transDate=d.transDate,l.url=d.url,l.header.formula_id&&(l.uomDesc=l.header.uom_name),a.next=22,l.resetData();case 22:l.loading.before_mount=!1,""!=l.header.formula_id&&null!=l.header.formula_id||l.getProductItem(0),l.changeTab(l.selTabName,l.selTabName,!1),l.changeStatus(),l.defRecipeFiscalYear(),l.checkFmlType();case 28:case"end":return a.stop()}}),a)})))()},getLines:function(){var e=arguments;return he(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return!(e.length>0&&void 0!==e[0])||e[0],e.length>1&&void 0!==e[1]?e[1]:"search",t.abrupt("return");case 8:t.sent;case 9:case"end":return t.stop()}}),t)})))()},delay:function(e){return he(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(3e3!=e){t.next=2;break}throw"Error "+e;case 2:return a=new Promise((function(t,a){setTimeout((function(){return t("done!"+e)}),e)})),t.next=5,a;case 5:n=t.sent,console.log(n);case 7:case"end":return t.stop()}}),t)})))()},changeTab:function(e,t){var a=arguments,n=this;return he(r().mark((function s(){var i,o,l,c,d;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=!(a.length>2&&void 0!==a[2])||a[2],o=n,!0,l="","tab1"==e?l="leaf_formula_line":"tab2"==e?l="casings":"tab3"==e?l="flavors":"tab4"==e?l="cigarettes":"tab5"==e&&(l="cigarette_all"),!1,(e==t||"tab5"==t||!i)&&o.header.formula_id){r.next=36;break}return r.next=9,o.compareData(t);case 9:if(r.sent){r.next=36;break}return r.next=13,helperAlert.showProgressConfirm("ต้องการบันทึกข้อมูลที่แก้ไขหรือไม่ ?");case 13:if(!r.sent){r.next=36;break}return"",r.prev=16,o.loading.page=!0,r.next=20,n.validateTab();case 20:return r.sent,r.next=23,n.store(!1);case 23:return c=r.sent,r.next=26,o.show(c);case 26:r.next=35;break;case 28:return r.prev=28,r.t0=r.catch(16),o.loading.page=!1,console.log("catch error",r.t0),r.next=34,helperAlert.showGenericFailureDialog(r.t0);case 34:return r.abrupt("return");case 35:o.loading.page=!1;case 36:return o.selTabName=e,r.next=39,o.resetData();case 39:d={header:o.header,type:l},o.tabs[l].loading=!0,o.tabs[l].has_change=!1,axios.get(o.url.ajax_get_data,{params:d}).then((function(e){var t=e.data.data;"leaf_formula_line"==l&&(o.originalData=JSON.parse(JSON.stringify(t.leaf_formula_lines)),o.leafFormulas=t.leaf_formula_lines),"casings"==l&&(o.originalData=JSON.parse(JSON.stringify(t.casings)),o.casings=t.casings),"flavors"==l&&(o.originalData=JSON.parse(JSON.stringify(t.flavors)),o.flavors=t.flavors),"cigarettes"==l&&(o.originalData=JSON.parse(JSON.stringify(t.cigarettes)),o.originalDtlData=JSON.parse(JSON.stringify(t.cigar_dtl)),o.cigarettes=t.cigarettes,o.cigarDtl=t.cigar_dtl),"cigarette_all"==l&&(o.cigaretteAll=t[l]),o.tabs[l].loading=!1}));case 43:case"end":return r.stop()}}),s,null,[[16,28]])})))()},resetData:function(){var e=this;return he(r().mark((function t(){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=e).originalData=[],a.originalDtlData=[],a.leafFormulas=[],a.casings=[],a.flavors=[],a.cigarettes=[],a.cigarDtl=[],a.cigaretteAll=[];case 9:case"end":return t.stop()}}),t)})))()},compareData:function(e){var t=this;return he(r().mark((function a(){var n,s,i;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=t,s=!1,i="","tab1"==e?i="leaf_formula_line":"tab2"==e?i="casings":"tab3"==e?i="flavors":"tab4"==e?i="cigarettes":"tab5"==e&&(i="cigarette_all"),a.next=6,axios.post(n.url.ajax_compare_data,{header:n.header,original_data:n.originalData,original_dtl_data:n.originalDtlData,type:i,leaf_formulas:n.leafFormulas,casings:n.casings,flavors:n.flavors,cigarettes:n.cigarettes,cigar_dtl:n.cigarDtl}).then((function(e){var t=e.data.data;s=t.is_equal})).catch((function(e){var t=e.response.data;swal({title:"Error !",text:t.message,type:"error",showConfirmButton:!0})})).then((function(){n.loading.page=!1}));case 6:return console.log("compareData"),a.abrupt("return",s);case 8:case"end":return a.stop()}}),a)})))()},store:function(){var e=arguments,t=this;return he(r().mark((function a(){var n,s,i;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return!(e.length>0&&void 0!==e[0])||e[0],!0,!0,"",(n=t).loading.page=!0,s=new Promise(function(){var e=he(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.post(n.url.ajax_store,{header:n.header,leaf_formulas:n.leafFormulas,casings:n.casings,flavors:n.flavors,cigarettes:n.cigarettes,cigar_dtl:n.cigarDtl}).then((function(e){var r=e.data.data;"S"==r.status&&(n.hasChange=!1,swal({title:"&nbsp;",text:"บันทึกข้อมูลสำเร็จ",type:"success",html:!0}),t(r.header)),"S"!=r.status&&a(r.msg)})).catch((function(e){var t=e.response.data;a(t.message)})).then((function(){n.loading.page=!1}));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),a.next=9,s;case 9:return i=a.sent,a.abrupt("return",i);case 11:case"end":return a.stop()}}),a)})))()},save:function(){var e=arguments,t=this;return he(r().mark((function a(){var n,s,i;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=!(e.length>0&&void 0!==e[0])||e[0],s=t,!0,!0,a.prev=4,s.loading.page=!0,a.next=8,s.validateTab();case 8:if(!n){a.next=25;break}if(s.header.blend_no){a.next=11;break}throw"โปรดระบุยาเส้นปรุง Blend No.";case 11:if(!s.header.can.is_standart_formula_type||""!=s.header.recipe_fiscal_year){a.next=13;break}throw"โปรดระบุปีงบประมาณ";case 13:if("tab1"!=s.selTabName||""==s.header.product_item_id){a.next=16;break}if(0!=s.leafFormulas.filter((function(e){return 0==e.is_deleted})).length){a.next=16;break}throw"โปรดเพิ่ม Leaf Formula อย่างน้อง 1 รายการ";case 16:return a.next=18,helperAlert.showProgressConfirm("กรุณายืนยัน บันทึกสูตรผลิต");case 18:if(!a.sent){a.next=25;break}return a.next=22,t.store(!1);case 22:return i=a.sent,a.next=25,s.show(i);case 25:a.next=34;break;case 27:return a.prev=27,a.t0=a.catch(4),s.loading.page=!1,console.error(a.t0),a.next=33,helperAlert.showGenericFailureDialog(a.t0);case 33:return a.abrupt("return");case 34:s.loading.page=!1;case 35:case"end":return a.stop()}}),a,null,[[4,27]])})))()},sctProduct:function(){var e=this;return he(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=e).uomDesc="",a.header.description="",a.header.formula_no="",a.header.product_item_code="",a.header.uom_name="",a.header.uom="",n=a.data.product_item_id_list.findIndex((function(e){return e.value==a.header.product_item_id})),(n=a.data.product_item_id_list[n])&&(a.header.description="",a.header.formula_no=n.formula_no,a.header.product_item_code=n.product_item_code,a.header.uom=n.uom,a.header.uom_name=n.uom_name,a.uomDesc=n.uom,a.header.product_item_desc=n.description,a.data.recipe_routing_no_list.length>0&&!a.header.recipe_routing_no&&(a.header.recipe_routing_no=a.data.recipe_routing_no_list[0].value)),a.header.product_item_id||(a.header.formula_status="Inactive",a.header.recipe_routing_no="");case 11:case"end":return t.stop()}}),t)})))()},selectFlavour:function(){var e=this;return he(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(a=e).header.flavour="",a.header.formula_organization_code="",a.header.organization_code="",a.header.department="",n=a.data.flavour_list.findIndex((function(e){return e.value==a.header.flavour_code})),(n=a.data.flavour_list[n])&&(a.header.flavour=n.flavour,a.header.formula_organization_code=n.formula_organization_code,a.header.organization_code=n.organization_code,a.header.department=n.department);case 8:case"end":return t.stop()}}),t)})))()},checkFmlType:function(){var e=this;return he(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(a=e).data.formula_type.findIndex((function(e){return e.lookup_code==a.header.formula_type_code})),(n=a.data.formula_type[n]).description,a.header.can.leaf_formulas.ingredient.add_lot_number="สูตรชนป."!=n.description,a.header.can.is_standart_formula_type="S"==n.lookup_code,a.header.can.is_actual_formula_type="A"==n.lookup_code,a.header.can.is_chnp_formula_type="P"==n.lookup_code;case 8:case"end":return t.stop()}}),t)})))()},defRecipeFiscalYear:function(){var e=this;return he(r().mark((function t(){var a,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(a=e).data.formula_type.findIndex((function(e){return e.lookup_code==a.header.formula_type_code})),n=a.data.formula_type[n],a.header.has_tmp_table?"สูตรมาตรฐาน"==n.description?a.header.recipe_fiscal_year=a.header.recipe_fiscal_year?a.header.recipe_fiscal_year:a.header.def_recipe_fiscal_year:a.header.recipe_fiscal_year=a.header.recipe_fiscal_year?a.header.recipe_fiscal_year:"":"สูตรมาตรฐาน"==n.description?a.header.recipe_fiscal_year=a.header.recipe_fiscal_year?a.header.recipe_fiscal_year:a.header.def_recipe_fiscal_year:a.header.recipe_fiscal_year="";case 4:case"end":return t.stop()}}),t)})))()},validateTab:function(){var e=this;return he(r().mark((function t(){var a,n,s,i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e,!0,!0,n="",t.next=6,e.delay(500);case 6:return s=new Promise(function(){var e=he(r().mark((function e(t,s){var i,o,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("tab1"!=a.selTabName){e.next=13;break}return e.next=3,a.leafFormulas.forEach(function(){var e=he(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.is_deleted){e.next=5;break}if(0!=parseFloat(t.leaf_proportion)&&""!=t.leaf_proportion){e.next=5;break}return n="โปรดระบุ สัดส่วน % (Leaf Formula: ".concat(t.leaf_formula," ").concat(t.leaf_formula_desc,")"),s(n),e.abrupt("return");case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 3:if(!a.leafFormulas.length){e.next=13;break}return 0,!0,i=!1,o=0,l=0,e.next=12,a.leafFormulas.forEach(function(){var e=he(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!=t.is_deleted){e.next=3;break}return e.next=3,t.leaf_dtl.forEach(function(){var e=he(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0==t.is_deleted&&(i=!0,o=parseFloat(o)+parseFloat(t.ingredient_proportions),l=parseFloat(l)+parseFloat(t.quantity_used),""==t.lot_number&&a.header.can.leaf_formulas.ingredient.add_lot_number);case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 12:i&&parseFloat(l).toFixed(3)!=parseFloat(a.header.quantity).toFixed(3)&&(n="Leaf Detail: ยอดรวมปริมาณที่ใช้ (กก.): "+parseFloat(l)+"  ของวัตถุดิบ ไม่เท่ากับปริมาณของสูตร: "+parseFloat(a.header.quantity),s(n));case 13:"tab2"==a.selTabName&&a.casings.forEach(function(){var e=he(r().mark((function e(t,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0==t.is_deleted&&""==t.casing_id&&(n="โปรดระบุ casing (Leaf Formula: ".concat(t.leaf_formula," ").concat(t.leaf_formula_desc,")"),s(n));case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),""!=a.header.product_item_id&&(""!=a.header.recipe_routing_no&&null!=a.header.recipe_routing_no||s(n="โปรดระบุขั้นตอนการทำงาน")),t(!0);case 16:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),t.next=9,s;case 9:return i=t.sent,t.abrupt("return",i);case 11:case"end":return t.stop()}}),t)})))()}}};const be=(0,c.Z)(ge,(function(){var e=this,t=this,a=t.$createElement,n=t._self._c||a;return n("transition",{attrs:{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[t.loading.before_mount?t._e():n("div",[n("modal-search",{attrs:{data:t.data,transDate:t.transDate,menu:t.data.menu,header:t.header,transBtn:t.transBtn,url:t.url,countOpen:t.countOpenModal},on:{selectRow:t.show}}),t._v(" "),n("modal-duplicate",{attrs:{data:t.data,transDate:t.transDate,menu:t.data.menu,header:t.header,transBtn:t.transBtn,url:t.url,countOpen:t.countOpenModalDup},on:{selectRow:t.show}}),t._v(" "),n("div",{staticClass:"ibox float-e-margins"},[n("div",{staticClass:"ibox-content pb-1",staticStyle:{"border-bottom":"0px"}},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-3"}),t._v(" "),n("div",{staticClass:"col-9 text-right"},[n("button",{class:t.transBtn.create.class+" btn-lg tw-w-25",on:{click:function(e){return e.preventDefault(),t.getInfo()}}},[n("i",{class:t.transBtn.create.icon}),t._v("\n                        "+t._s(t.transBtn.create.text)+"\n                    ")]),t._v(" "),n("button",{class:t.transBtn.search.class+" btn-lg tw-w-25 mr-2",on:{click:function(e){e.preventDefault(),t.countOpenModal+=1}}},[n("i",{class:t.transBtn.search.icon}),t._v("\n                        "+t._s(t.transBtn.search.text)+"\n                    ")]),t._v(" "),n("button",{class:t.transBtn.save.class+" btn-lg tw-w-25",attrs:{type:"button"},on:{click:function(e){return e.preventDefault(),t.save()}}},[n("i",{class:t.transBtn.save.icon}),t._v("\n                        "+t._s(t.transBtn.save.text)+"\n                    ")]),t._v(" "),n("button",{class:t.transBtn.copy.class+" btn-lg tw-w-25 mr-2",attrs:{disabled:!t.header.can.copy_formula},on:{click:function(e){e.preventDefault(),t.countOpenModalDup+=1}}},[n("i",{class:t.transBtn.copy.icon}),t._v("\n                        "+t._s(t.transBtn.copy.text)+"สูตร\n                    ")]),t._v(" "),n("button",{staticClass:"btn btn-default",attrs:{"data-toggle":"modal","data-target":"#historyModal"}},[n("i",{staticClass:"fa fa-file-text-o"}),t._v(" ประวัติแก้ไข")])])])]),t._v(" "),n("div",{staticClass:"ibox-content"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-9"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-4 mb-2 mt-3"},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-5 pl-0 pr-0 font-weight-bold col-form-label required text-right"},[t._v("\n                                    ประเภทยาเส้น\n                                ")]),t._v(" "),n("div",{staticClass:"col-7"},[n("el-select",{staticClass:"required",staticStyle:{width:"100%"},attrs:{placeholder:"",disabled:t.header.has_tmp_table,clearable:"",filterable:""},on:{change:function(e){t.getProductItem()}},model:{value:t.header.tobacco_type_code,callback:function(e){t.$set(t.header,"tobacco_type_code",e)},expression:"header.tobacco_type_code"}},t._l(t.data.tobacco_type_code_list,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[n("span",{staticStyle:{float:"left"}},[t._v(t._s(e.label))])])})),1)],1)]),t._v(" "),n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-5 pl-0 pr-0 font-weight-bold col-form-label required text-right"},[t._v("\n                                    ประเภทสูตร\n                                ")]),t._v(" "),n("div",{staticClass:"col-7"},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"formula_type_code",disabled:t.header.has_tmp_table},on:{change:function(e){t.checkFmlType(),t.getProductItem(),t.defRecipeFiscalYear(),t.validateBlendNo()}},model:{value:t.header.formula_type_code,callback:function(e){t.$set(t.header,"formula_type_code",e)},expression:"header.formula_type_code"}},t._l(t.data.formula_type,(function(e,t){return n("el-option",{key:e.lookup_code,attrs:{label:e.description,value:e.lookup_code}})})),1)],1)]),t._v(" "),n("transition",{attrs:{"enter-active-class":"animated fadeIn","leave-active-class":"animated fadeOut"}},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{class:(t.header.can.is_standart_formula_type?"required":"")+" col-5 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                        ปีงบประมาณ\n                                    ")]),t._v(" "),n("div",{staticClass:"col-7"},[n("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"","value-key":"recipe_fiscal_year",disabled:!t.header.can.edit||!t.header.can.is_standart_formula_type||!t.header.can.select_product_item_id},on:{change:function(e){}},model:{value:t.header.recipe_fiscal_year,callback:function(e){t.$set(t.header,"recipe_fiscal_year",e)},expression:"header.recipe_fiscal_year"}},[""!=t.header.recipe_fiscal_year&&null!=t.header.recipe_fiscal_year?t._l(t.data.recipe_fiscal_year_list,(function(e,a){return e.value>=t.header.recipe_fiscal_year?n("el-option",{key:e.value,attrs:{label:e.value,value:e.value}}):t._e()})):t._l(t.data.recipe_fiscal_year_list,(function(e,t){return n("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})}))],2)],1)])]),t._v(" "),n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-5 pl-0 pr-0 font-weight-bold col-form-label text-right"},[t._v("\n                                    ขั้นตอนการทำงาน\n                                ")]),t._v(" "),n("div",{staticClass:"col-7"},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"recipe_fiscal_year",disabled:!t.header.can.edit||""==t.header.product_item_id},on:{change:function(e){}},model:{value:t.header.recipe_routing_no,callback:function(e){t.$set(t.header,"recipe_routing_no",e)},expression:"header.recipe_routing_no"}},t._l(t.data.recipe_routing_no_list,(function(e,t){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)])],1),t._v(" "),n("div",{staticClass:"col-4 mb-2 mt-3"},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label required text-right"},[t._v("\n                                    Blend No.\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},[n("el-input",{attrs:{placeholder:"",disabled:!t.header.can.edit||""==t.header.tobacco_type_code||""==t.header.formula_type_code||t.header.has_tmp_table},on:{input:function(e){t.header.blend_no=e.toUpperCase()},change:function(e){t.getProductItem(),t.validateBlendNo(),e&&t.changeTab(t.selTabName,t.selTabName,!1)}},model:{value:t.header.blend_no,callback:function(e){t.$set(t.header,"blend_no",e)},expression:"header.blend_no"}})],1)]),t._v(" "),n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                    รสชาติ\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"flavour_code",disabled:!t.header.can.edit,clearable:"",filterable:""},on:{change:function(e){return t.selectFlavour()}},model:{value:t.header.flavour_code,callback:function(e){t.$set(t.header,"flavour_code",e)},expression:"header.flavour_code"}},t._l(t.data.flavour_list,(function(e){return n("el-option",{key:String(e.value),attrs:{label:e.label,value:String(e.value)}})})),1)],1)]),t._v(" "),n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label text-right"},[t._v("\n                                    หมายเหตุ\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},[n("el-input",{attrs:{type:"textarea",name:"note",disabled:!t.header.can.edit,rows:"4",maxlength:"240","show-word-limit":""},model:{value:t.header.comments,callback:function(e){t.$set(t.header,"comments",e)},expression:"header.comments"}})],1)])]),t._v(" "),n("div",{staticClass:"col-4 mb-2 mt-3"},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                    รหัสยาเส้น\n                                ")]),t._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.product_item_id,expression:"loading.product_item_id"}],staticClass:"col-8"},[t.header.formula_id?n("el-input",{attrs:{disabled:!0},model:{value:t.header.product_item_code,callback:function(e){t.$set(t.header,"product_item_code",e)},expression:"header.product_item_code"}}):n("el-select",{staticClass:"required",staticStyle:{width:"100%"},attrs:{placeholder:"","value-key":"blend_no",disabled:!t.header.can.edit||""==t.header.blend_no||!t.header.can.select_product_item_id,clearable:"",filterable:""},on:{change:function(t){e.sctProduct()}},model:{value:t.header.product_item_id,callback:function(e){t.$set(t.header,"product_item_id",e)},expression:"header.product_item_id"}},t._l(t.data.product_item_id_list,(function(e){return n("el-option",{key:e.value,attrs:{label:e.cust_label,value:e.value}},[n("span",{staticStyle:{float:"left"}},[t._v(t._s(e.cust_label))])])})),1)],1)]),t._v(" "),n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                    ชื่อยาเส้น\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},[n("el-input",{staticStyle:{width:"100%"},attrs:{disabled:!0},model:{value:t.header.product_item_desc,callback:function(e){t.$set(t.header,"product_item_desc",e)},expression:"header.product_item_desc"}})],1)]),t._v(" "),n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label text-right"},[t._v("\n                                    ปริมาณ\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},[n("div",{staticClass:"input-group "},[n("input",{staticClass:"form-control text-right ",attrs:{type:"text",disabled:!t.header.can.edit},domProps:{value:t._f("number2Digit")(t.header.quantity)},on:{change:function(e){t.header.quantity=t.stripNonNumber(e.target.value),t.header.quantity<0&&(t.header.quantity=0)}}}),t._v(" "),n("div",{staticClass:"input-group-append",attrs:{title:t.header.uom}},[n("span",{staticClass:"input-group-addon"},[t.header.has_tmp_table?n("div",[t._v("\n                                                    "+t._s(t.uomDesc)+"\n                                                ")]):n("div",[t._v("\n                                                     "+t._s(t.header.def_uod_desc)+"\n                                                ")])])])])])])])])]),t._v(" "),n("div",{staticClass:"col-lg-3 mt-3"},[n("dl",{staticClass:"row mb-2"},[n("div",{staticClass:"col-sm-4 text-sm-right pt-2"},[n("dt",{attrs:{title:""}},[t._v("ผู้บันทึก: ")])]),t._v(" "),n("div",{staticClass:"col-sm-7 text-sm-left"},[n("dd",{staticClass:"mb-1"},[n("el-input",{attrs:{title:t.header.user_name,disabled:!0},model:{value:t.header.web_user_name,callback:function(e){t.$set(t.header,"web_user_name",e)},expression:"header.web_user_name"}})],1)])]),t._v(" "),n("dl",{staticClass:"row mb-2"},[n("div",{staticClass:"col-sm-4 text-sm-right pt-2"},[n("dt",{attrs:{title:""}},[t._v("วันที่สร้าง: ")])]),t._v(" "),n("div",{staticClass:"col-sm-7 text-sm-left"},[n("dd",{staticClass:"mb-1"},[n("el-input",{attrs:{disabled:!0},model:{value:t.header.formula_creation_date_format,callback:function(e){t.$set(t.header,"formula_creation_date_format",e)},expression:"header.formula_creation_date_format"}})],1)])]),t._v(" "),n("dl",{staticClass:"row mb-2"},[n("div",{staticClass:"col-sm-4 text-sm-right pt-2"},[n("dt",{attrs:{title:""}},[t._v("วันที่แก้ไขล่าสุด: ")])]),t._v(" "),n("div",{staticClass:"col-sm-7 text-sm-left"},[n("dd",{staticClass:"mb-1"},[n("el-input",{attrs:{disabled:!0},model:{value:t.header.formula_last_update_date_format,callback:function(e){t.$set(t.header,"formula_last_update_date_format",e)},expression:"header.formula_last_update_date_format"}})],1)])])])]),t._v(" "),n("div",{staticClass:"row"},[n("div",{staticClass:"col-lg-9"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-4 mb-2 mt-3"},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-5 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                    สถานะ\n                                ")]),t._v(" "),n("div",{staticClass:"col-7"},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"",disabled:(""==t.header.blend_no||""==t.header.product_item_id)&&!t.header.can.is_chnp_formula_type,"value-key":"formula_status"},on:{change:t.changeStatus},model:{value:t.header.formula_status,callback:function(e){t.$set(t.header,"formula_status",e)},expression:"header.formula_status"}},t._l(t.data.status_list,(function(e,t){return n("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1)])]),t._v(" "),n("div",{staticClass:"col-4 mb-2 mt-3"},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                    วันที่อนุมัติ\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},["ACTIVE"==t.header.formula_status.toUpperCase()?n("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%"},attrs:{placeholder:"โปรดเลือกวันที่",disabled:!t.header.can.edit,value:t.header.formula_approval_date_format,format:t.transDate["js-format"]},on:{dateWasSelected:function(e){for(var a=arguments.length,n=Array(a);a--;)n[a]=arguments[a];return t.setdate.apply(void 0,n.concat(["formula_approval_date_format"]))}}}):n("el-input",{attrs:{disabled:!0}})],1)])]),t._v(" "),n("div",{staticClass:"col-4 mb-2 mt-3"},[n("div",{staticClass:"form-group mb-2 row"},[n("label",{staticClass:"col-4 pl-0 pr-0 font-weight-bold col-form-label  text-right"},[t._v("\n                                    วันที่เริ่มใช้\n                                ")]),t._v(" "),n("div",{staticClass:"col-8"},["ACTIVE"==t.header.formula_status.toUpperCase()?n("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%"},attrs:{placeholder:"โปรดเลือกวันที่",disabled:!t.header.can.edit,value:t.header.formula_start_date_format,format:t.transDate["js-format"]},on:{dateWasSelected:function(e){for(var a=arguments.length,n=Array(a);a--;)n[a]=arguments[a];return t.setdate.apply(void 0,n.concat(["formula_start_date_format"]))}}}):n("el-input",{attrs:{disabled:!0}})],1)])])])]),t._v(" "),n("div",{staticClass:"col-lg-3 mt-3"},[t.header.can.is_standart_formula_type?n("dl",{staticClass:"row mb-2"},[n("div",{staticClass:"col-sm-4 text-sm-right pt-1"},[n("dt",{attrs:{title:""}},[t._v("กองบริหารต้นทุนนำไปใช้แล้ว: ")])]),t._v(" "),n("div",{staticClass:"col-sm-7 text-sm-left"},[n("dd",{staticClass:"mb-1 ",staticStyle:{"font-size":"1.5em"}},[n("div",{staticClass:"pt-2 pl-2",domProps:{innerHTML:t._s(t.header.invoice_flag_icon_html)}})])])]):t._e()])])])]),t._v(" "),n("transition",{attrs:{"enter-active-class":"animated fadeInUp","leave-active-class":"animated fadeOutDown"}},[t.header.blend_no?n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.page,expression:"loading.page"}],staticClass:"ibox float-e-margins"},[n("div",{staticClass:"ibox-content"},[n("div",{staticClass:"tabs-container"},[n("ul",{staticClass:"nav nav-tabs",attrs:{role:"tablist"}},[n("li",[n("a",{class:"tab1"==t.selTabName?"nav-link active":"nav-link",on:{click:function(e){return t.changeTab("tab1",t.selTabName)}}},[t._v("\n                            Leaf Formula\n                        ")])]),t._v(" "),n("li",[(t.header.formula_id,n("a",{class:"tab2"==t.selTabName?"nav-link active":"nav-link",on:{click:function(e){return t.changeTab("tab2",t.selTabName)}}},[t._v("\n                            Casing\n                        ")]))]),t._v(" "),n("li",[(t.header.formula_id,n("a",{class:"tab3"==t.selTabName?"nav-link active":"nav-link",on:{click:function(e){return t.changeTab("tab3",t.selTabName)}}},[t._v("\n                            Flavor\n                        ")]))]),t._v(" "),n("li",[(t.header.formula_id,n("a",{class:"tab4"==t.selTabName?"nav-link active":"nav-link",on:{click:function(e){return t.changeTab("tab4",t.selTabName)}}},[t._v("\n                            บุหรี่\n                        ")]))]),t._v(" "),n("li",[(t.header.formula_id,n("a",{class:"tab5"==t.selTabName?"nav-link active":"nav-link",on:{click:function(e){return t.changeTab("tab5",t.selTabName)}}},[t._v("\n                            ทั้งหมด\n                        ")]))])]),t._v(" "),n("div",{staticClass:"tab-content"},[n("div",{class:"tab1"==t.selTabName?"tab-pane active":"tab-pane",attrs:{role:"tabpanel"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tabs.leaf_formula_line.loading,expression:"tabs.leaf_formula_line.loading"}],staticClass:"panel-body pt-3 "},["tab1"==t.selTabName?n("tab-leaf-formula",{attrs:{header:t.header,url:t.url,transBtn:t.transBtn,transDate:t.transDate,data:t.data.tabs.leaf_formula_line,leafFormulas:t.leafFormulas,pRefresh:t.tabs.leaf_formula_line.refreshCount,tabs:t.tabs}}):t._e()],1)]),t._v(" "),n("div",{class:"tab2"==t.selTabName?"tab-pane active":"tab-pane",attrs:{role:"tabpanel"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tabs.casings.loading,expression:"tabs.casings.loading"}],staticClass:"panel-body pt-3"},["tab2"==t.selTabName&&(t.header.formula_id||t.header.blend_no)?n("casing",{attrs:{header:t.header,url:t.url,transBtn:t.transBtn,transDate:t.transDate,data:t.data.tabs.casings,casings:t.casings,tabs:t.tabs}}):t._e()],1)]),t._v(" "),n("div",{class:"tab3"==t.selTabName?"tab-pane active":"tab-pane",attrs:{role:"tabpanel"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tabs.flavors.loading,expression:"tabs.flavors.loading"}],staticClass:"panel-body pt-3"},["tab3"==t.selTabName&&t.header?n("flavor",{attrs:{header:t.header,url:t.url,transBtn:t.transBtn,transDate:t.transDate,data:t.data.tabs.flavors,flavors:t.flavors,tabs:t.tabs}}):t._e()],1)]),t._v(" "),n("div",{class:"tab4"==t.selTabName?"tab-pane active":"tab-pane",attrs:{role:"tabpanel"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tabs.cigarettes.loading,expression:"tabs.cigarettes.loading"}],staticClass:"panel-body pt-3"},["tab4"==t.selTabName&&t.header&&(t.header.formula_id||t.header.blend_no)?n("cigarette",{attrs:{header:t.header,url:t.url,transBtn:t.transBtn,transDate:t.transDate,data:t.data.tabs.cigarettes,cigarettes:t.cigarettes,cigarDtl:t.cigarDtl,tabs:t.tabs}}):t._e()],1)]),t._v(" "),n("div",{class:"tab5"==t.selTabName?"tab-pane active":"tab-pane",attrs:{role:"tabpanel"}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tabs.cigarette_all.loading,expression:"tabs.cigarette_all.loading"}],staticClass:"panel-body pt-3"},["tab5"==t.selTabName&&t.header&&(t.header.formula_id||t.header.blend_no)?n("cigarette-all",{attrs:{transBtn:t.transBtn,transDate:t.transDate,cigaretteAll:t.cigaretteAll,tabs:t.tabs}}):t._e()],1)])])])])]):t._e()])],1)])}),[],!1,null,null,null).exports}}]);