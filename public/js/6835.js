(self.webpackChunk=self.webpackChunk||[]).push([[6835],{36835:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>F});var a=s(87757),r=s.n(a),n=s(6602),o=s(9616),i=s(45513),l=s(30381),u=s.n(l),d=s(44489),c=s(34785);function m(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function p(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function f(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?p(Object(s),!0).forEach((function(e){v(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):p(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function v(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function g(t,e,s,a,r,n,o){try{var i=t[n](o),l=i.value}catch(t){return void s(t)}i.done?e(l):Promise.resolve(l).then(a,r)}function y(t){return function(){var e=this,s=arguments;return new Promise((function(a,r){var n=t.apply(e,s);function o(t){g(n,a,r,o,i,"next",t)}function i(t){g(n,a,r,o,i,"throw",t)}o(void 0)}))}}const b={components:{TableRow:n.Z,TableHeader:o.Z,Search:i.Z,TableCasingFlavor:d.Z,TableAll:c.Z},props:["url-get-mes-review-issue-v","url-opt","url-get-oprn-by-item","url-get-formulas","user-profile","trans-date","url-save-data","class-classification-code","url","trans-btn","sys-date","program-code"],data:function(){return{form:{date:""},issue_date:"",date_issue:u()(this.sysDate).add(543,"years").toDate(),date:"",action:"show",form_header:{date:"",blend_no:"",opt_no:"",oprn_no:"",item_id:"",org_id:"",lines:[],issue_header_id:"",submit:!1,program_code:this.programCode,total_quantity_from_wip:""},form_lines:[],waite:!1,mesReviewIssueV:[],blends:[],blendSelected:"",blend:"",opts:[],optSelected:"",opt:"",groupByOpts:[],oprnSeletected:"",oprns:[],oprnDescription:"",items:[],itemSelected:"",formulas:[],org_id:"",loading:{blend_no:!1,opt:!1,oprn:!1,table_line:!1,table_header:!1,form:!1},classification:"",job_type:"",defaultOprn:"",productByBlend:"",wipIssueNumber:"",dialog:!1,dialogVisible:!1,header_number:"",totalOptQuantityFromHeader:"",totalOptQuantityUomFromHeader:"",postTYpe:"create",mesReviewIssueHeaders:[],setHeader:!1,headerStatus:"",blendUom:"",transaction_quantity:"",totalQtyFromWip:"",reportDate:"",urlTestOpt:"http://web-service.test/pm/ajax/get-opt-from-blend-no?blend_no=98&date=07/06/2564",wipIssueHeader:"",canSave:!1,testUrl:"http://web-service.test/pm/ajax/get-formulas?date=22/06/2564&blend_no=64MG618-009&opt_no=&oprn_no=WIP03&item_id=146010&total_opt_quantity=0&classification=03&product_item_number%20=undefined&program_code=PMP0049"}},mounted:function(){},methods:{findItemClassification:function(){var t=this;axios.get(this.url.findClassification+"?classification_code="+this.classClassificationCode).then((function(e){var s=e.data.classification;t.classification=s}))},getMesReviewIssuesV:function(){var t=this;this.loading.blend_no=!0,axios.get(this.url.urlGetMesReviewIssuesV+"?date="+this.date+"&set_header="+this.setHeader+"&program_code="+this.programCode).then((function(e){var s=e.data.result;if("S"!=s.status)swal({title:"Error !",text:s.msg,type:"error",showConfirmButton:!0}),t.loading.blend_no=!1;else{var a=e.data.mesReviewIssueV,r=e.data.blends,n=e.data.jobType;t.mesReviewIssueV=a,t.blends=r,t.job_type=n,t.loading.blend_no=!1,t.blendSelected&&!0!==t.setHeader&&t.findBlend()}}))},getOpt:function(){var t=this;return y(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.loading.opt=!0,t.loading.oprn=!0,axios.get(t.url.urlOpt+"?blend_no="+t.blendSelected+"&date="+t.date+"&batch_no="+t.blendSelected+"&program_code="+t.programCode).then((function(e){var s=e.data.opts,a=e.data.productByBlend,r=e.data.groupByOpts;t.groupByOpts=r,t.opts=s,t.productByBlend=a,t.loading.opt=!1})).then((function(){t.optSelected&&(t.optQuantity=t.opts),!0!==t.setHeader&&(console.log("find blend by opt"),t.findBlend())})).then((function(){t.getOprn()}));case 3:case"end":return e.stop()}}),e)})))()},getOprn:function(){var t=this;return y(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:axios.get(t.url.urlGetOprnByItem+"?item_id="+t.blend.inventory_item_id+"&program_code="+t.programCode+"&tran_date="+t.date+"&set_header="+t.setHeader+"&batch_no="+t.blendSelected).then((function(e){var s=e.data.listOprnByItems;e.data.defaultOprn;t.oprns=s,t.loading.oprn=!1})).then((function(){t.loading.oprn=!1})).then((function(){}));case 1:case"end":return e.stop()}}),e)})))()},findOprn:function(){var t=this,e=this.oprns.find((function(e){return e.wip_step===t.oprnSeletected}));this.oprn=e,this.oprnDescription=this.oprn.wip_step_desc;var s=this.mesReviewIssueV.find((function(e){return e.wip_step===t.oprnSeletected&&e.batch_no===t.blendSelected}));this.totalQtyFromWip=s.transaction_quantity},findBlend:function(){var t=this,e=this.mesReviewIssueV.find((function(e){return e.batch_no==t.blendSelected}));this.blend=e},findOpt:function(){var t=this,e=this.opts.find((function(e){return e.opt===t.optSelected}));this.opt=e},getItemByOprn:function(){var t=this;axios.get(this.url.urlGetOprnByItem).then((function(e){var s=e.data.listOprnByItems;t.oprns=s}))},fitterFormula:function(){this.action="show-lines",this.validateFormHeader(),this.updateFormHeader(),this.getFormula()},validateFormHeader:function(){},updateFormHeader:function(){var t=this;return y(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.form_header.date=t.date,t.form_header.blend_no=t.blendSelected,t.form_header.opt=t.optSelected,t.form_header.oprn=t.oprnSeletected,t.form_header.item_id=t.itemSelected,t.form_header.issue_date=t.issue_date,t.form_header.opts=t.optSelected?[]:t.opts;case 7:case"end":return e.stop()}}),e)})))()},updateFormLine:function(){this.form_header.date=this.date,this.form_header.blend_no=this.blendSelected,this.form_header.opt_no=this.optSelected,this.form_header.oprn_no=this.oprnSeletected,this.form_header.item_id=this.blend.inventory_item_id},getFormula:function(){var t=this;this.formulas=[],!1===this.validateForm?swal({title:"Validation !",text:"โปรดระบุข้อมูลให้ครับ",type:"error",showConfirmButton:!0}):(this.form.table_line=!0,this.updateFormHeader(),this.action="show-lines",this.request_form="?date="+this.form_header.date+"&blend_no="+this.form_header.blend_no+"&opt_no="+this.optSelected+"&oprn_no="+this.oprnSeletected+"&item_id="+this.blend.inventory_item_id+"&total_opt_quantity="+this.totalOptQuantity+"&classification="+this.classClassificationCode+"&product_item_number ="+this.blend.product_item_number+"&program_code="+this.programCode,axios.get(this.url.urlFormulas+this.request_form).then((function(e){var s=e.data.formulas,a=e.data.header;t.formulas=s,t.form.table_line=!1,a?(t.header_number=a.request_number,t.headerStatus=a.issue_status.description,t.form_header.issue_header_id=a.issue_header_id,t.postTYpe="update"):(t.header_number=null,t.headerStatus=null,t.form_header.issue_header_id=null)})).catch((function(){console.log("catch"),t.loading.form=!1})).finally((function(){console.log("finally"),t.loading.form=!1})))},getLines:function(){var t=this;this.action="show-lines",axios.get(this.url.urlFormulas+"?request_line=1&issue_header_id="+this.form_header.issue_header_id+"&total_opt_quantity="+this.totalOptQuantityFromHeader+"&program_code="+this.programCode).then((function(e){var s=e.data.formulas;console.log(e),t.formulas=s,t.updateFormHeader(),t.form_header.lines=t.formulas}))},validateForm:function(){return""!=this.date&&(""!=this.date_issue&&(""!=this.blendSelected&&""!=this.oprnSeletected))},saveData:function(){var t=this;return y(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t.validateForm()),!1===t.validateForm()?swal({title:"Validation !",text:"โปรดระบุข้อมูลให้ครับ",type:"error",showConfirmButton:!0}):(console.log("xxx"),t.loading.form=!0,t.form_header.item_classification_code=t.classClassificationCode,t.form_header.total_opt_quantity=t.totalOptQuantity,t.form_header.total_quantity_from_wip=t.totalQtyFromWip,t.form_header.program_code=t.programCode,t.updateFormHeader(),"update"==t.postTYpe?(t.updateFormHeader(),axios.post(t.url.urlUpdateData+"?issue_header_id="+t.form_header.issue_header_id,f({},t.form_header)).then((function(e){t.loading.form=!1;var s=e.data.result,a=e.data;"S"===s.status?swal({title:"Success !",text:s.msg,type:"success",showConfirmButton:!0}):(swal({title:"Error !",text:s.msg,type:"error",showConfirmButton:!0}),console.log(s.msg)),t.wipIssueHeader=a.header,t.header_number=a.header.request_number,t.headerStatus=a.header.issue_status.description})).then((function(){})).catch((function(t){swal({title:"Error !",text:result.msg,type:"error",showConfirmButton:!0}),console.log(result.msg)}))):axios.post(t.url.urlSaveData,f({},t.form_header)).then((function(e){t.loading.form=!1;var s=e.data.result,a=e.data;"S"==s.status?swal({title:"Success !",text:s.msg,type:"success",showConfirmButton:!0}):swal({title:"Error !",text:s.msg,type:"error",showConfirmButton:!0}),t.wipIssueHeader=a.header,t.headerStatus=a.header.issue_status.description,t.form_header.issue_header_id=a.header.issue_header_id,t.header_number=a.header.request_number,t.postTYpe="update"})));case 2:case"end":return e.stop()}}),e)})))()},create:function(){location.reload(),this.action="create",this.formulas=[],this.blend="",this.blendSelected="",this.form_header.date="",this.form_header.blend_no="",this.form_header.opt_no="",this.form_header.oprn_no="",this.form_header.item_id="",this.form_header.org_id="",this.form_header.lines=[],this.form_header.issue_header_id="",this.form_header.submit=!1,this.form_lines=[],this.mesReviewIssueV=[],this.blends=[],this.blendSelected="",this.blend="",this.opts=[],this.optSelected="",this.opt="",this.oprnSeletected="",this.oprns=[],this.oprnDescription="",this.items=[],this.itemSelected="",this.formulas=[],this.org_id="",this.loading.blend_no=!1,this.loading.opt=!1,this.loading.oprn=!1,this.loading.table_line=!1,this.loading.table_header=!1,this.classification="",this.job_type="",this.defaultOprn="",this.productByBlend="",this.wipIssueNumber="",this.header_number="",this.totalOptQuantityFromHeader="",this.postTYpe="create",this.mesReviewIssueHeaders=[],this.date_issue=""},submit:function(){var t=this;if(0==this.formulas.length)return swal({title:"Error !",text:"จำนวนไม่ถูกต้อง ไม่มีสูตร",type:"error",showConfirmButton:!0});var e=[],s=_.groupBy(this.formulas,"item_number");this.formulas.forEach((function(a){var r=parseFloat(a.input_quantity_summary),n=0;if(""!=a.onhand_quantity){var o=a.onhand_quantity.toString();n=parseFloat(o.replace(",",""))}s[a.item_number].length>1&&(n=s[a.item_number].reduce((function(t,e){return t+parseFloat(a.onhand_quantity.toString().replace(",",""))}),0)),r>n&&(!1,e.push((e.length%2==0?" <br> ":"")+a.item_number)),"S"==a.header_interface_status&&(!0,t.can.submit=!1)}));m(new Set(e));this.loading.form=!0,this.form_header.lines=this.formulas,this.form_header.total_opt_quantity=this.totalOptQuantity,this.form_header.submit=!0,axios.post(this.url.urlSaveData,f({},this.form_header)).then((function(e){t.loading.form=!1;var s=e.data.result,a=e.data;"S"===a.header.interface_status?swal({title:"Success !!!",text:s.msg,type:"success",showConfirmButton:!0}):swal({title:"Error !",text:a.header.interface_msg,type:"error",showConfirmButton:!0}),t.wipIssueHeader=a.header,t.header_number=a.header.request_number,t.headerStatus=a.header.issue_status.description,t.form_header.issue_header_id=a.header.issue_header_id,t.totalOptQuantityFromHeader=a.total_qty,t.loading.form=!1}))},onClickChild:function(t){console.log("emit"),console.log(t),"set_header"==t.key?(console.log(t),this.form_header.issue_header_id=t.issue_header_id,this.selectHeader(t.header)):(this.form_header.lines=t,this.formulas=t)},selectHeader:function(t){var e=this;return y(r().mark((function s(){return r().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return e.formulas=[],e.waite=!0,e.date=t.complete_date,e.date_issue=t.issue_date,e.wipIssueHeader=t,e.headerStatus=t.status,e.postTYpe="update",e.setHeader=!0,e.header_number=t.request_number,e.blendSelected=t.batch_no,e.form_header.issue_header_id=t.issue_header_id,e.totalOptQuantityFromHeader=t.opt_plan_qty,e.optSelected=t.all_opt?"":t.opt,e.blend=t.blend,e.oprnSeletected=t.wip_step,e.blendUom=t.blend_uom,e.oprnDescription=t.wip.wip_step_desc,s.next=19,e.getMesReviewIssuesV();case 19:return s.next=21,e.getOpt();case 21:return s.next=23,e.getLines();case 23:e.totalQtyFromWip=t.opt_plan_qty;case 24:case"end":return s.stop()}}),s)})))()},getDate:function(t){console.log(t),this.date=u()(t).format(this.transDate["js-format"]),this.reportDate=u()(t).add(-543,"years").format("YYYY-MM-DD"),this.blendSelected="",this.oprnDescription="",this.blend="",this.productByBlend="",this.opts=[],this.optSelected="",this.opt="",this.groupByOpts=[],this.oprnSeletected="",this.oprns=[],this.items="",this.itemSelected="",this.formulas=[],this.headerStatus="",this.header_number="",this.getMesReviewIssuesV()},issueDate:function(t){this.issue_date=u()(t).format(this.transDate["js-format"])},modalOpen:function(){},cancel:function(t){var e=this;console.log(t),this.loading.form=!0,this.form_header.issue_header_id=t,axios.post(this.url.cancelData,f({},this.form_header)).then((function(t){e.loading.form=!1;var s=t.data,a=t.data.result;console.log(s),"S"===a.status?swal({title:"Success !",text:a.interface_status,type:"success",showConfirmButton:!0}):swal({title:"Error !",text:a.interface_status,type:"error",showConfirmButton:!0}),e.header_number=a.request_number,e.headerStatus=a.header_status}))},report:function(){var t=this.wipIssueHeader.report_date?this.wipIssueHeader.report_date:this.wipIssueHeader.complete_date,e=this.wipIssueHeader.issue_status.meaning?this.wipIssueHeader.issue_status.meaning:this.wipIssueHeader.issue_status;window.open("/pm/sample-report-inventory-pdf/"+this.blend.batch_no+"/"+this.userProfile.organization_code+"/"+t+"?issue_header_id="+this.wipIssueHeader.issue_header_id+"&transaction_type_code="+e+"&program_code="+this.programCode,"_blank")},numberFormat:function(t){return parseFloat(t).toLocaleString(void 0,{minimumFractionDigits:2})}},computed:{totalOptQuantity:function(){return this.blend?this.blend.transaction_quantity:0},totalOptQuantityUom:function(){return this.blend?this.BlendUom?this.blendUom:this.blend.uom?this.blend.uom.unit_of_measure:this.blend.transaction_uom:""},isChangeHeader:function(){return!(this.wipIssueHeader.length>0)&&(u()(this.wipIssueHeader.complete_date).format(this.transDate["js-format"])!==u()(this.wipIssueHeader.date).format(this.transDate["js-format"])||void 0)},inventory:function(){return 0===this.formulas.length?"":this.formulas[0].from_subinventory},orderedFormulas:function(){return 0===this.formulas.length?[]:_.orderBy(this.formulas,"formulaline_id")},canNotSubmit:function(){return""==this.form_header.issue_header_id||(0==this.formulas.length||void 0)},disabledSubmit:function(){return"ยังไม่ตัดใช้"!=this.headerStatus&&("ยังไม่ตัดใช้"!=this.wipIssueHeader.status&&((!this.wipIssueHeader.issue_status||1!=this.wipIssueHeader.issue_status.meaning)&&(this.headerStatus,!0)))},disabledSave:function(){if("ยังไม่ตัดใช้"==this.headerStatus)return!1;if("ยกเลิก"==this.headerStatus)return!0;if(this.formulas&this.formulas.length<=0)return!0;if("ตัดใช้แล้ว"==this.wipIssueHeader.status)return!0;if("ตัดใช้แล้ว"==this.wipIssueHeader.status)return!0;if("ยกเลิกตัดใช้"==this.wipIssueHeader.status)return!0;if(this.wipIssueHeader.issue_status){if(2==this.wipIssueHeader.issue_status.meaning)return!0;if(3==this.wipIssueHeader.issue_status.meaning)return!0}return"ตัดใช้แล้ว"==this.headerStatus},disabledCancel:function(){return"ยกเลิก"==this.headerStatus||"ตัดใช้แล้ว"!=this.headerStatus&&"ตัดใช้แล้ว"!=this.wipIssueHeader.status},disabledForm:function(){return"ตัดใช้แล้ว"==this.headerStatus||("ยกเลิก"==this.headerStatus||"ตัดใช้แล้ว"==this.wipIssueHeader.status)},disabledSearch:function(){return"ตัดใช้แล้ว"==this.headerStatus||("ยกเลิก"==this.headerStatus||"ตัดใช้แล้ว"==this.wipIssueHeader.status)}}};const F=(0,s(51900).Z)(b,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row"},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.form,expression:"loading.form"}],staticClass:"col-lg-12"},[s("div",{staticClass:"ibox float-e-margins"},[s("div",{staticClass:"ibox-content"},[s("div",{staticClass:"text-right"},[s("button",{class:t.transBtn.search.class+" btn-sm",attrs:{"data-toggle":"modal","data-target":"#myModal5"},on:{click:t.modalOpen}},[s("i",{class:t.transBtn.search.icon+" btn-lg tw-w-25"}),t._v("\n                        "+t._s(t.transBtn.search.text)+"\n                    ")]),t._v(" "),s("button",{class:t.transBtn.create.class+" btn-lg tw-w-25",on:{click:function(e){return e.preventDefault(),t.create(e)}}},[s("i",{class:t.transBtn.create.icon}),t._v("\n                        "+t._s(t.transBtn.create.text)+"\n                    ")]),t._v(" "),s("button",{class:t.transBtn.save.class+" btn-lg tw-w-25",attrs:{disabled:t.disabledSave},on:{click:function(e){return e.preventDefault(),t.saveData(e)}}},[s("i",{class:t.transBtn.save.icon}),t._v("\n                        "+t._s(t.transBtn.save.text)+"\n                    ")]),t._v(" "),s("button",{staticClass:"btn btn-primary btn-lg",attrs:{disabled:t.disabledSubmit},on:{click:t.submit}},[s("strong",[t._v("ตัดใช้วัตถุดิบ")])]),t._v(" "),s("button",{staticClass:"btn btn-w-m btn-danger btn-lg",attrs:{disabled:t.disabledCancel},on:{click:function(e){return t.cancel(t.form_header.issue_header_id)}}},[s("i",{staticClass:"fa fa-times"}),t._v(" ยกเลิกการตัดใช้วัตถุดิบ\n                    ")]),t._v(" "),s("button",{class:t.transBtn.print.class+" btn-lg tw-w-25",on:{click:t.report}},[s("i",{class:t.transBtn.print.icon}),t._v("\n                        "+t._s(t.transBtn.print.text)+"\n                    ")])]),t._v(" "),s("hr"),t._v(" "),s("div",{staticClass:"form-group"},[s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-2"},[t._v("หน่วยงาน")]),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-input",{staticClass:"w-100",attrs:{size:"small",readonly:"",disabled:"",value:t.userProfile.department.description}})],1),t._v(" "),s("div",{staticClass:"col-lg-2"},[t._v("เลขที่ตัดใช้วัตถุดิบ")]),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-input",{staticClass:"w-100",attrs:{disabled:"",size:"small","suffix-icon":"el-icon-search",readonly:""},model:{value:t.header_number,callback:function(e){t.header_number=e},expression:"header_number"}})],1)]),t._v(" "),s("div",{staticClass:"row m-2"},[t._m(0),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%","border-radius":"3px"},attrs:{placeholder:"เลือกวันที่ขอเบิก",name:"input_date",id:"input_date",value:t.date,format:t.transDate["js-format"]},on:{dateWasSelected:t.getDate}})],1),t._v(" "),s("div",{staticClass:"col-lg-2"},[t._v("สถานะตัดใช้")]),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-input",{staticClass:"w-100",attrs:{disabled:"",size:"small",value:t.headerStatus,readonly:""}})],1)]),t._v(" "),s("div",{staticClass:"row m-2"},[t._m(1),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.blend_no,expression:"loading.blend_no"}],staticClass:"w-100",attrs:{filterable:"",size:"small",disabled:0==t.blends.length||t.disabledForm},on:{change:function(e){return t.getOpt()}},model:{value:t.blendSelected,callback:function(e){t.blendSelected=e},expression:"blendSelected"}},t._l(t.blends,(function(t){return s("el-option",{key:t.batch_no,attrs:{label:t.batch_no+" : "+t.item_description,value:t.batch_no}})})),1)],1),t._v(" "),t._m(2),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.oprn,expression:"loading.oprn"}],attrs:{filterable:"",placeholder:"Select",size:"small","default-first-option":"",disabled:0==t.oprns.length||t.disabledForm},on:{change:function(e){return t.findOprn()}},model:{value:t.oprnSeletected,callback:function(e){t.oprnSeletected=e},expression:"oprnSeletected"}},t._l(t.oprns,(function(t){return s("el-option",{key:t.wip_step,attrs:{label:t.wip_step,value:t.wip_step}})})),1)],1),t._v(" "),s("div",{staticClass:"col-lg-2"},[s("el-input",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.oprn,expression:"loading.oprn"}],staticClass:"w-100",attrs:{size:"small",value:t.oprnDescription,disabled:0==t.oprns.length}})],1)]),t._v(" "),s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-2"},[t._v("สินค้าที่จะผลิต")]),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-input",{staticClass:"w-100",attrs:{size:"small",value:t.productByBlend?t.productByBlend.segment1:"",disabled:""}})],1),t._v(" "),s("div",{staticClass:"col-lg-2"},[t._v("รายละเอียดสินค้าที่จะผลิต")]),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-input",{attrs:{disabled:"",type:"textarea",rows:1,value:t.productByBlend?t.productByBlend.description:""}})],1)]),t._v(" "),s("div",{staticClass:"row m-2"}),t._v(" "),s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-2"},[t._v("ผลผลิตที่ได้")]),t._v(" "),s("div",{staticClass:"col-lg-4"},[s("el-input",{staticClass:"w-100",attrs:{disabled:"",size:"small",value:t.numberFormat(t.totalQtyFromWip)}},[s("template",{slot:"append"},[t._v(t._s(t.totalOptQuantityUom))])],2)],1)])]),t._v(" "),s("div",{staticClass:"row m-2"},[s("div",{staticClass:"col-lg-6"}),t._v(" "),s("div",{staticClass:"col-lg-6 text-right"},[s("button",{class:t.transBtn.search.class,attrs:{disabled:t.disabledSearch},on:{click:function(e){return e.preventDefault(),t.fitterFormula()}}},[s("i",{class:t.transBtn.search.icon+" btn-lg"}),t._v(" "),s("strong",[t._v("แสดงข้อมูล")])])])]),t._v(" "),t._m(3),t._v(" "),s("hr"),t._v(" "),t.form.table_line?s("div",[t._m(4)]):t._e(),t._v(" "),t.formulas.length>0&&"show-lines"===t.action?s("div",[s("TableAll",{attrs:{formulas:t.orderedFormulas,"opt-quantity":t.totalQtyFromWip,action:t.action},on:{input:t.onClickChild}})],1):t._e()]),t._v(" "),s("div",{staticClass:"modal inmodal fade",staticStyle:{display:"none"},attrs:{id:"myModal5",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog modal-xl"},[s("div",{staticClass:"modal-content"},[t._m(5),t._v(" "),s("div",{staticClass:"modal-body"},[t.loading.table_header?s("div",[t._m(6)]):t._e(),t._v(" "),s("TableHeader",{attrs:{headers:t.mesReviewIssueHeaders,"trans-btn":t.transBtn,"trans-date":t.transDate,sysDate:t.date_issue,url:t.url,"program-code":t.programCode},on:{click:t.onClickChild}})],1)])])])])])])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-lg-2"},[t._v("\n                            วันที่ตัดใช้ "),s("span",{staticClass:"tw-text-red-500"},[t._v("*")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-lg-2"},[t._v("เลขที่คำสั่งผลิต "),s("span",{staticClass:"tw-text-red-500"},[t._v("*")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-lg-2"},[t._v("\n                            ขั้นตอนการทำงาน\n                            "),s("span",{staticClass:"tw-text-red-500"},[t._v("*")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"row m-2"},[e("div",{staticClass:"col-lg-6"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sk-spinner sk-spinner-wave mb-4"},[s("div",{staticClass:"sk-rect1"}),t._v(" "),s("div",{staticClass:"sk-rect2"}),t._v(" "),s("div",{staticClass:"sk-rect3"}),t._v(" "),s("div",{staticClass:"sk-rect4"}),t._v(" "),s("div",{staticClass:"sk-rect5"})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal-header"},[s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[s("span",{attrs:{"aria-hidden":"true"}},[t._v("×")]),s("span",{staticClass:"sr-only"},[t._v("Close")])]),t._v(" "),s("h5",{staticClass:"modal-title m-0 p-0"},[t._v("\n                                    รายการตัดใช้ วัตถุดิบ\n                                ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"sk-spinner sk-spinner-wave mb-4"},[s("div",{staticClass:"sk-rect1"}),t._v(" "),s("div",{staticClass:"sk-rect2"}),t._v(" "),s("div",{staticClass:"sk-rect3"}),t._v(" "),s("div",{staticClass:"sk-rect4"}),t._v(" "),s("div",{staticClass:"sk-rect5"})])}],!1,null,null,null).exports},45513:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});const a={data:function(){return{dialogVisible:!1}},methods:{handleClose:function(t){this.$confirm("Are you sure to close this dialog?").then((function(e){t()})).catch((function(t){}))}}};const r=(0,s(51900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-button",{attrs:{type:"text"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("click to open the Dialog")]),t._v(" "),s("el-dialog",{attrs:{title:"Tips",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("span",[t._v("This is a message")])])],1)}),[],!1,null,null,null).exports},6602:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});const a={props:["formulas","opt-quantity","action"],data:function(){return{form_lines:[]}},mounted:function(){},methods:{updateFormLines:function(t,e){console.log(t,e)},onClickButton:function(t){this.$emit("input",this.formulas)},disabledRow:function(t){return null!=t.interface_status},numberFormat:function(t){return parseFloat(t).toLocaleString(void 0,{minimumFractionDigits:2})}},computed:{orderByFormulas:function(){return _.orderBy(this.formulas,"leaf_formula")}}};const r=(0,s(51900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("table",{staticClass:"table table-hover"},[t._m(0),t._v(" "),s("tbody",t._l(t.orderByFormulas,(function(e,a){return s("tr",{key:a},[s("td",{class:e.quantity_summary>parseFloat(e.onhand_quantity)?"tw-text-red-500":""},[s("small",[t._v(t._s(e.leaf_formula))])]),t._v(" "),s("td",{class:parseFloat(e.quantity_summary)>parseFloat(e.onhand_quantity)?"tw-text-red-500":""},[s("small",[t._v(t._s(e.item_number))])]),t._v(" "),s("td",{class:parseFloat(e.quantity_summary)>parseFloat(e.onhand_quantity)?"tw-text-red-500":""},[s("small",[t._v(t._s(e.item_desc))]),t._v(" "),s("p",{staticClass:"m-0 p-0 tw-text-2xs tw-text-red-800"},[t._v(t._s(e.cost_validate_msg))])]),t._v(" "),s("td",{class:parseFloat(e.quantity_summary)>parseFloat(e.onhand_quantity)?"tw-text-red-500":""},[s("small",[t._v(t._s(e.default_lot_no))])]),t._v(" "),s("td",{class:parseFloat(e.quantity_summary)>parseFloat(e.onhand_quantity)?"tw-text-red-500  text-right":" text-right"},[s("small",[t._v(t._s(t.numberFormat(e.quantity_summary.toString().replace(",",""))))])]),t._v(" "),s("td",{class:parseFloat(e.quantity_summary)>parseFloat(e.onhand_quantity)?"tw-text-red-500":" text-center"},[s("small",[t._v(t._s(e.unit_of_measure))])]),t._v(" "),s("td",{class:parseFloat(e.quantity_summary)>parseFloat(e.onhand_quantity)?"tw-text-red-500  text-right":" text-right"},[s("small",[t._v(t._s(t.numberFormat(e.onhand_quantity)))])]),t._v(" "),s("td",[s("small",[s("vue-numeric",{staticClass:"form-control text-right",attrs:{separator:",",size:"mini",precision:2,minus:!1,disabled:t.disabledRow(e)},model:{value:e.input_quantity_summary,callback:function(s){t.$set(e,"input_quantity_summary",s)},expression:"formula.input_quantity_summary"}})],1)]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",[t._v(t._s(e.unit_of_measure))])])])})),0)])])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{staticClass:"text-center"},[s("small",[t._v("กลุ่มใบยา")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รหัสวัตถุดิบ")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รายละเอียด")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("Lot No.")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณที่ต้องใช้+สูญเสีย")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณคงคลังโซนผลิต")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณที่ใช้จริง")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])])])])}],!1,null,null,null).exports},34785:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var a=s(30381),r=s.n(a);const n={props:["formulas","opt-quantity","action","trans-date","header-status"],data:function(){return{form_lines:[],onhand:{},form:[],lotOnHand:[],uFormulas:this.formulas}},mounted:function(){console.log(this.formulas)},methods:{updateFormLines:function(t,e){console.log(t,e)},onClickButton:function(t){console.log("emit"),this.$emit("input",this.uFormulas),this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},changeInput:function(){this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},addRow:function(t,e,s){this.onhand={};var a=s+1;this.onhand.default_lot_no=0,this.onhand.expiration_date="",this.onhand.formulaline_id=t.formulaline_id,this.onhand.from_location_code="",this.onhand.from_subinventory="",this.onhand.input_quantity_summary=0,this.onhand.interface_status=null,this.onhand.item_desc=t.item_desc,this.onhand.item_number=t.item_number,this.onhand.last_line=!0,this.onhand.leaf_formula="",this.onhand.line_disabled=!1,this.onhand.onhand_lists=t.onhand_lists,this.onhand.onhand_quantity=0,this.onhand.product_detail_uom=t.product_detail_uom,this.onhand.quantity_summary="",this.onhand.tobacco_ingrident_type=t.tobacco_ingrident_type,this.onhand.id=e+a,this.onhand.casting_flavor_name=t.casting_flavor_name,this.onhand.used_leaf_formula=t.used_leaf_formula,this.uFormulas.push(this.onhand),this.$emit("input",this.uFormulas)},delRow:function(t){(this.uFormulas.splice(this.uFormulas.indexOf(t),1),t.default_lot_no)&&(t.onhand_lists.find((function(e){return e.lot_number===t.default_lot_no})).flag="N");this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},selectOnhand:function(t,e,s,a){console.log(s);var r=s.onhand_lists.find((function(t){return t.lot_number==a}));this.groupByFormulas[t][e].default_lot_no=r.lot_number,this.groupByFormulas[t][e].input_quantity_summary=s.quantity_summary,this.groupByFormulas[t][e].onhand_quantity=r.onhand_quantity,this.groupByFormulas[t][e].expiration_date=s.expiration_date,this.groupByFormulas[t][e].from_location_code=s.from_location_code,this.groupByFormulas[t][e].from_subinventory=s.from_subinventory,this.groupByFormulas[t][e].interface_status=s.interface_status,this.groupByFormulas[t][e].item_desc=s.item_desc,this.groupByFormulas[t][e].item_number=s.item_number,this.groupByFormulas[t][e].last_line=s.last_line,this.groupByFormulas[t][e].leaf_formula=s.leaf_formula,this.groupByFormulas[t][e].line_disabled=s.line_disabled,this.groupByFormulas[t][e].casting_flavor_name=s.casting_flavor_name,this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},fitterFromFormula:function(t,e){this.formulas.filter((function(e){return e.formulaline_id==t}));var s=e.onhand_lists;console.log(s)},lotSum:function(t){return t.reduce((function(t,e){return t+parseFloat(e.input_quantity_summary)}),0)},disabledRow:function(t,e,s){return null!=t.interface_status},classTextRed:function(t,e,s){return"S"!=t.interface_status&&(parseInt(t.onhand_quantity)<parseInt(t.input_quantity_summary)||(""==t.default_lot_no||void 0))},dateExpire:function(t){return t.expiration_date?r()(t.expiration_date).add(543,"years").format(this.transDate["js-format"]):void 0},lotLists:function(t,e){e.forEach((function(e,s){var a=t.find((function(t){return t.default_lot_no==e.lot_number}));a&&a.default_lot_no==e.lot_number&&(e.flag="Y")})),e.filter((function(t){return"Y"!=t.flag})).forEach((function(t){t.flag="N"}))},saveLot:function(t){console.log(t)},changeType:function(t){var e=this.formulas.filter((function(e){return e.tobacco_ingrident_type==t}));this.uFormulas=e},numberFormat:function(t){return parseFloat(t).toLocaleString(void 0,{minimumFractionDigits:6})},disabledInput:function(t){return"ตัดใช้แล้ว"==this.headerStatus||"ยกเลิกตัดใช้"==this.headerStatus||"S"==t.header_interface_status}},computed:{orderByFormulas:function(){return _.orderBy(this.uFormulas,"item_number")},groupByFormulas:function(){return _.groupBy(this.orderByFormulas,"item_number")}}};const o=(0,s(51900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("table",{staticClass:"table table-bordered table-hover"},[t._m(0),t._v(" "),t._l(t.groupByFormulas,(function(e,a){return s("tbody",{key:a},t._l(e,(function(e,r){return s("tr",{key:r},[s("td",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500 text-center":" text-center"},[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:""},[t._v("\n                        "+t._s(t.groupByFormulas[a][r].item_number)+"\n                     ")]),t._v("\n                     "+t._s(t.lotLists(t.groupByFormulas[a],t.groupByFormulas[a][r].onhand_lists))+"\n                ")]),t._v(" "),s("td",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:""},[t._v(t._s(t.groupByFormulas[a][r].item_desc))])]),t._v(" "),s("td",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500 text-right":" text-right"},[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:""},[t._v("\n                        "+t._s(t.numberFormat(t.groupByFormulas[a][r].quantity_summary))+"\n                    ")])]),t._v(" "),s("td",{staticClass:"pr-lg-5 text-nowrap"},[s("small",[s("el-select",{staticClass:"form-control-file",attrs:{placeholder:"Select",size:"mini",disabled:t.disabledInput(t.groupByFormulas[a][r])},on:{input:t.onClickButton,change:function(e){return t.selectOnhand(a,r,t.groupByFormulas[a][r],t.groupByFormulas[a][r].default_lot_no)}},model:{value:t.groupByFormulas[a][r].default_lot_no,callback:function(e){t.$set(t.groupByFormulas[a][r],"default_lot_no",e)},expression:"groupByFormulas[line][index].default_lot_no"}},t._l(t.groupByFormulas[a][r].onhand_lists,(function(e){return s("el-option",{key:e.lot_number,attrs:{label:e.lot_number,value:e.lot_number}},[s("span",{staticStyle:{float:"left"}},[t._v(t._s("lot: "+e.lot_number+" "))]),t._v(" "),s("span",{staticClass:"ml-4",staticStyle:{float:"right"}},[t._v(t._s(" onhand: "+t.numberFormat(e.onhand_quantity)))])])})),1),t._v(" "),t.disabledInput(t.groupByFormulas[a][r])?t._e():s("span",{staticClass:"text-right mr-2"},[t.groupByFormulas[a].length===r+1?s("a",{on:{click:function(e){return t.addRow(t.groupByFormulas[a][r])},input:t.onClickButton}},[s("i",{staticClass:"fa fa-plus-square"})]):t._e(),t._v(" "),0!==r?s("a",{on:{click:function(e){return e.preventDefault(),t.delRow(t.groupByFormulas[a][r])}}},[s("i",{staticClass:"fa fa-minus-square"})]):t._e()])],1)]),t._v(" "),s("td",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500 text-right":" text-right"},[s("small",{class:""},[t._v("\n\n                        "+t._s(t.numberFormat(t.groupByFormulas[a][r].onhand_quantity))+"\n                    ")])]),t._v(" "),s("td",[s("small",[s("vue-numeric",{staticClass:"form-control text-right",attrs:{separator:",",size:"mini",precision:6,minus:!1,disabled:t.disabledInput(t.groupByFormulas[a][r])},on:{input:t.onClickButton},model:{value:t.groupByFormulas[a][r].input_quantity_summary,callback:function(e){t.$set(t.groupByFormulas[a][r],"input_quantity_summary",e)},expression:"groupByFormulas[line][index].input_quantity_summary"}})],1)]),t._v(" "),s("td",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500 text-center":" text-center"},[s("small",{class:""},[t._v(t._s(t.groupByFormulas[a][r].product_unit_of_measure))])])])})),0)}))],2)])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("tr",[s("th",{staticClass:"text-center"},[s("small",[t._v("รหัสวัตถุดิบ")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("รายละเอียด")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณที่ต้องใช้+สูญเสีย")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("Lot No. "),s("span",{staticClass:"tw-text-red-500"},[t._v("*")])])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณคงคลังโซนผลิต")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณที่ใช้จริง")]),s("span",{staticClass:"tw-text-red-500"},[t._v("*")])]),t._v(" "),s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])])])])}],!1,null,null,null).exports},44489:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});const a={props:["formulas","opt-quantity","action"],data:function(){return{form_lines:[],onhand:{},form:[],lotOnHand:[],uFormulas:this.formulas,allFormulas:this.formulas,defaultType:"CASING",mapLines:[]}},mounted:function(){this.changeType("CASING",!1)},created:function(){this.changeType("CASING",!1)},methods:{updateFormLines:function(t,e){console.log(t,e)},onClickButton:function(t){this.$emit("input",this.allFormulas),this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},changeInput:function(){this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},addRow:function(t,e,s){this.onhand={};var a=s+1;this.onhand.default_lot_no=0,this.onhand.expiration_date="",this.onhand.formulaline_id=t.formulaline_id,this.onhand.from_location_code="",this.onhand.from_subinventory="",this.onhand.input_quantity_summary=0,this.onhand.interface_status=null,this.onhand.item_desc="",this.onhand.item_number=t.item_number,this.onhand.last_line=!0,this.onhand.leaf_formula="",this.onhand.line_disabled=!1,this.onhand.onhand_lists=t.onhand_lists,this.onhand.onhand_quantity=0,this.onhand.product_detail_uom=t.product_detail_uom,this.onhand.quantity_summary="",this.onhand.tobacco_ingrident_type=t.tobacco_ingrident_type,this.onhand.id=e+a,this.onhand.casting_flavor_name=t.casting_flavor_name,this.onhand.used_leaf_formula=t.used_leaf_formula,this.onhand.group_line=t.group_line,this.allFormulas.push(this.onhand),this.uFormulas.push(this.onhand)},delRow:function(t){(this.uFormulas.splice(this.uFormulas.indexOf(t),1),this.allFormulas.splice(this.allFormulas.indexOf(t),1),t.default_lot_no)&&(t.onhand_lists.find((function(e){return e.lot_number===t.default_lot_no})).flag="N");this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},selectOnhand:function(t,e,s,a){var r=s.onhand_lists.find((function(t){return t.lot_number==a}));this.groupByFormulas[t][e].default_lot_no=r.lot_number,this.groupByFormulas[t][e].onhand_quantity=r.onhand_quantity,this.groupByFormulas[t][e].expiration_date=s.expiration_date,this.groupByFormulas[t][e].from_location_code=s.from_location_code,this.groupByFormulas[t][e].from_subinventory=s.from_subinventory,this.groupByFormulas[t][e].interface_status=s.interface_status,this.groupByFormulas[t][e].item_desc=s.item_desc,this.groupByFormulas[t][e].item_number=s.item_number,this.groupByFormulas[t][e].last_line=s.last_line,this.groupByFormulas[t][e].leaf_formula=s.leaf_formula,this.groupByFormulas[t][e].line_disabled=s.line_disabled,this.groupByFormulas[t][e].casting_flavor_name=s.casting_flavor_name,this.groupByFormulas[t][e].onhand_quantity_display=r.onhand_quantity,this.lotLists(this.groupByFormulas[t],this.groupByFormulas[t][e].onhand_lists),this.uFormulas.push({}),this.uFormulas.splice(this.uFormulas.indexOf({}),1)},fitterFromFormula:function(t,e){this.formulas.filter((function(e){return e.formulaline_id==t})),e.onhand_lists},saveLot:function(t){},changeType:function(t,e){this.defaultType=t;var s=this.allFormulas.filter((function(e){return e.tobacco_ingrident_type==t}));setTimeout((function(){console.log((function(t,e){return t.item_number-e.item_number}))}),1e3),this.uFormulas=s},lotSum:function(t){return t.reduce((function(t,e){return t+parseFloat(e.input_quantity_summary)}),0)},disabledRow:function(t,e,s){return null!=t.interface_status||"S"==t.header_interface_status},classTextRed:function(t,e,s){return"S"!=t.interface_status&&(parseInt(t.onhand_quantity)<parseInt(t.input_quantity_summary)||(""==t.default_lot_no||void 0))},lotLists:function(t,e){console.log(e),e.forEach((function(e,s){var a=t.find((function(t){return t.default_lot_no==e.lot_number}));a&&a.default_lot_no==e.lot_number&&(e.flag="Y")})),e.filter((function(t){return"Y"!=t.flag})).forEach((function(t){t.flag="N"}))},numberFormat:function(t){return parseFloat(t).toLocaleString(void 0,{minimumFractionDigits:6})}},computed:{orderByFormulas:function(){return"FLAVOR"==this.defaultType?_.orderBy(this.uFormulas,"item_number"):_.orderBy(this.uFormulas,"used_leaf_formula")},groupByFormulas:function(){return"FLAVOR"==this.defaultType?_.groupBy(this.orderByFormulas,"item_number"):_.groupBy(this.orderByFormulas,"group_line")},sumOnhand:function(t){}}};const r=(0,s(51900).Z)(a,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("button",{staticClass:"btn btn-primary",on:{click:function(e){return t.changeType("CASING",!0)}}},[t._v("\n            สารปรุง\n        ")]),t._v(" "),s("button",{staticClass:"btn btn-info",on:{click:function(e){return t.changeType("FLAVOR",!0)}}},[t._v("\n            สารหอม\n        ")]),t._v(" "),s("table",{staticClass:"table table-bordered table-hover"},[s("thead",[s("tr",[s("th",{staticClass:"text-center"},[s("small",[t._v(t._s("CASING"==t.defaultType?"กลุ่มใบยา":"Flavor No.")+"\n                        ")])]),t._v(" "),"CASING"==t.defaultType?s("th",{staticClass:"text-center"},[s("small",[t._v("Casing No.")])]):t._e(),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7)])]),t._v(" "),t._l(t.groupByFormulas,(function(e,a){return s("tbody",{key:a},t._l(e,(function(e,r){return s("tr",{key:r},[s("td",[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v("\n                            "+t._s("CASING"==t.defaultType?t.groupByFormulas[a][r].used_leaf_formula:t.groupByFormulas[a][r].casting_flavor_name)+"\n                            "),t._v("\n                            "+t._s(t.lotLists(t.groupByFormulas[a],t.groupByFormulas[a][r].onhand_lists))+"\n                        ")])]),t._v(" "),"CASING"==t.defaultType?s("td",[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v(t._s(t.groupByFormulas[a][r].casting_flavor_name))])]):t._e(),t._v(" "),s("td",[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v("\n                            "+t._s(t.groupByFormulas[a][r].item_number)+"\n                        ")])]),t._v(" "),s("td",[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v(t._s(t.groupByFormulas[a][r].item_desc))])]),t._v(" "),s("td",{staticClass:"pr-lg-5 text-nowrap"},[s("small",[s("el-select",{staticClass:"form-control-file",attrs:{placeholder:"Select",size:"mini",disabled:t.disabledRow(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)},on:{input:t.onClickButton,change:function(e){return t.selectOnhand(a,r,t.groupByFormulas[a][r],t.groupByFormulas[a][r].default_lot_no)}},model:{value:t.groupByFormulas[a][r].default_lot_no,callback:function(e){t.$set(t.groupByFormulas[a][r],"default_lot_no",e)},expression:"groupByFormulas[line][index].default_lot_no"}},t._l(t.groupByFormulas[a][r].onhand_lists,(function(e){return s("el-option",{key:e.lot_number+r,attrs:{label:e.lot_number,value:e.lot_number,disabled:"Y0"==e.flag}},[s("span",{staticStyle:{float:"left"}},[t._v(t._s("lot: "+e.lot_number+" "))]),t._v(" "),s("span",{staticClass:"ml-4",staticStyle:{float:"right"}},[t._v(t._s(" onhand: "+t.numberFormat(e.onhand_quantity)))])])})),1),t._v(" "),s("span",{staticClass:"text-center mr-2"},[t.groupByFormulas[a].length===r+1?s("a",{on:{click:function(s){return s.preventDefault(),t.addRow(e,a,r)}}},[s("i",{staticClass:"fa fa-plus-square"})]):t._e(),t._v(" "),0!==r?s("a",{on:{click:function(s){return s.preventDefault(),t.delRow(e)}}},[s("i",{staticClass:"fa fa-minus-square"})]):t._e()])],1)]),t._v(" "),s("td",{staticClass:"text-right"},[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v(t._s(t.numberFormat(t.groupByFormulas[a][r].quantity_summary)))])]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",{directives:[{name:"show",rawName:"v-show",value:0==r,expression:"index ==0"}],class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v(t._s(t.groupByFormulas[a][r].product_unit_of_measure))])]),t._v(" "),s("td",{staticClass:"text-right"},[s("small",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v(t._s(t.numberFormat(t.groupByFormulas[a][r].onhand_quantity_display)))])]),t._v(" "),s("td",[s("small",[s("vue-numeric",{staticClass:"form-control text-right",attrs:{separator:",",size:"mini",precision:6,minus:!1,disabled:t.disabledRow(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)},on:{input:t.onClickButton},model:{value:t.groupByFormulas[a][r].input_quantity_summary,callback:function(e){t.$set(t.groupByFormulas[a][r],"input_quantity_summary",e)},expression:"groupByFormulas[line][index].input_quantity_summary"}})],1)]),t._v(" "),s("td",{staticClass:"text-center"},[s("small",{class:t.classTextRed(t.groupByFormulas[a][r],t.groupByFormulas[a],t.groupByFormulas[a][r].quantity_summary)?"tw-text-red-500":""},[t._v(t._s(t.groupByFormulas[a][r].product_unit_of_measure))])])])})),0)}))],2)])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("รหัสวัตถุดิบ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("รายละเอียด")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("Lot No.")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณที่ต้องใช้+สูญเสีย")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณคงคลังโซนผลิต")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("ปริมาณที่ใช้จริง")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",{staticClass:"text-center"},[s("small",[t._v("หน่วยนับ")])])}],!1,null,null,null).exports},9616:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var a=s(30381),r=s.n(a);const n={props:["headers","trans-btn","trans-date","url","class-classification-code","program-code","sys-date"],data:function(){return{return_data:{key:"set_header",header:"",issue_header_id:"",uom:""},form:{start_date:"",end_date:"",batch_no:"",status:"",product:"",blend:"",request_number:"",job:""},loading:{table:!1,list:!1},start_date:"",end_date:"",key_type:"",statuses:[],uHeaders:this.headers,dHeaders:this.headers,blends:[],products:[]}},mounted:function(){console.log("xxxxxxxx"),this.getHeaderFromMonth()},methods:{updateFormLines:function(t,e){console.log(t,e)},onClickButton:function(t){var e=this;axios.get("/pm/ajax/find-header/"+t.issue_header_id).then((function(t){var s=t.data.header;console.log(t),e.return_data.header=s,e.return_data.issue_header_id=s.issue_header_id,e.$emit("click",e.return_data)})).catch((function(t){console.log("error"),e.loading.table=!1}))},startDate:function(t){this.form.start_date=t,this.search()},endDate:function(t){this.form.end_date=t,this.search()},fitterHeaders:function(){var t=this,e=this.dHeaders.filter((function(e){return e.request_number==t.form.request_number}));this.uHeaders=e},search:function(){var t=this;this.loading.table=!0,this.start_date=r()(this.form.start_date).add(-543,"years").format(this.transDate["js-format"]),this.end_date=r()(this.form.end_date).add(-543,"years").format(this.transDate["js-format"]),axios.get(this.url.searchHeader+"?start_date="+this.start_date+"&end_date="+this.end_date+"&batch_no="+this.form.batch_no+"&item_classification_code="+this.classClassificationCode+"&program_code="+this.programCode+"&job="+this.form.job+"&status="+this.form.status+"&product="+this.form.product).then((function(e){console.log(e.data.header),t.uHeaders=e.data.mesReviewIssueHeaders,t.dHeaders=e.data.mesReviewIssueHeaders,t.products=_.groupBy(t.uHeaders,"blend.item_description"),t.blends=_.groupBy(t.uHeaders,"blend.batch_no"),t.statuses=_.groupBy(t.uHeaders,"status"),t.loading.table=!1})).catch((function(e){t.loading.table=!1}))},fitterProduct:function(t){var e=this.dHeaders.filter((function(e){return e.item_number==t}));this.uHeaders=e},keyType:function(t){console.log("xxx")},getHeaderFromMonth:function(){var t=this,e=this.start_date=r()(this.sysDate).add(543).format(this.transDate["js-format"]),s=this.start_date=r()(this.sysDate).add(543).format(this.transDate["js-format"]);this.form.start_date=r()(this.sysDate).format(this.transDate["js-format"]),axios.get(this.url.searchHeader+"?start_date="+e+"&end_date="+s+"&item_classification_code="+this.classClassificationCode+"&program_code="+this.programCode).then((function(e){console.log(e.data.header),t.uHeaders=e.data.mesReviewIssueHeaders,t.dHeaders=e.data.mesReviewIssueHeaders,t.products=_.groupBy(t.uHeaders,"item_description"),t.blends=_.groupBy(t.uHeaders,"batch_no"),t.statuses=_.groupBy(t.uHeaders,"status"),t.loading.table=!1})).catch((function(e){t.loading.table=!1}))}}};const o=(0,s(51900).Z)(n,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"p-2"},[s("div",{staticClass:"shadow-sm tw-bg-white p-2"},[s("div",{staticClass:"row mb-2"},[s("div",{staticClass:"col-md-1"},[t._v("วันที่")]),t._v(" "),s("div",{staticClass:"col-md-2"},[s("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%","border-radius":"3px"},attrs:{name:"input_date",id:"input_date",value:t.form.start_date,format:t.transDate["js-format"]},on:{dateWasSelected:t.startDate},model:{value:t.form.start_date,callback:function(e){t.$set(t.form,"start_date",e)},expression:"form.start_date"}})],1),t._v(" "),s("div",{staticClass:"col-md-1"},[t._v("ถึง")]),t._v(" "),s("div",{staticClass:"col-md-2"},[s("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",staticStyle:{width:"100%","border-radius":"3px"},attrs:{name:"input_date",id:"input_date",value:t.form.end_date,format:t.transDate["js-format"]},on:{dateWasSelected:t.endDate},model:{value:t.form.end_date,callback:function(e){t.$set(t.form,"end_date",e)},expression:"form.end_date"}})],1),t._v(" "),s("div",{staticClass:"col-md-2 text-right"},[t._v("สินค้าที่จะผลิต")]),t._v(" "),s("div",{staticClass:"col-md-2"},[s("el-select",{directives:[{name:"loading",rawName:"v-loading",value:!1,expression:"false"}],staticClass:"w-100",attrs:{filterable:"",placeholder:"สินค้าที่จะผลิต",clearable:"","popper-append-to-body":!1},on:{change:t.search},model:{value:t.form.product,callback:function(e){t.$set(t.form,"product",e)},expression:"form.product"}},t._l(t.products,(function(t,e){return s("el-option",{key:e,attrs:{label:e,value:t[0].item_number}})})),1)],1)]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-md-1"},[t._v("เลขที่คำสั่งผลิต")]),t._v(" "),s("div",{staticClass:"col-md-2"},[s("el-select",{directives:[{name:"loading",rawName:"v-loading",value:!1,expression:"false"}],staticClass:"w-100",attrs:{filterable:"",placeholder:"เลขที่คำสั่งผลิต","popper-append-to-body":!1,clearable:""},on:{change:t.search},model:{value:t.form.job,callback:function(e){t.$set(t.form,"job",e)},expression:"form.job"}},t._l(t.blends,(function(t,e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t._v(" "),s("div",{staticClass:"col-md-1"},[t._v("เลขที่ตัดใช้")]),t._v(" "),s("div",{staticClass:"col-md-2"},[s("el-select",{directives:[{name:"loading",rawName:"v-loading",value:!1,expression:"false"}],staticClass:"w-100",attrs:{filterable:"",placeholder:"เลขที่ตัดใช้","popper-append-to-body":!1,clearable:""},model:{value:t.form.request_number,callback:function(e){t.$set(t.form,"request_number",e)},expression:"form.request_number"}},t._l(t.dHeaders,(function(t,e){return s("el-option",{key:e,attrs:{label:t.request_number,value:t.request_number}})})),1)],1),t._v(" "),s("div",{staticClass:"col-md-2 text-right"},[t._v("สถานะ")]),t._v(" "),s("div",{staticClass:"col-md-2"},[s("el-select",{directives:[{name:"loading",rawName:"v-loading",value:!1,expression:"false"}],staticClass:"w-100",attrs:{filterable:"",placeholder:"สถานะ","popper-append-to-body":!1,clearable:""},on:{change:t.search},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.statuses,(function(t,e){return s("el-option",{key:e,attrs:{label:e,value:t[0].issue_status}})})),1)],1),t._v(" "),s("button",{staticClass:"text-right",class:t.transBtn.search.class,on:{click:function(e){return t.fitterHeaders()}}},[s("i",{class:t.transBtn.search.icon+" btn-lg"}),t._v(" "),s("strong",[t._v(t._s(t.transBtn.search.text))])])])]),t._v(" "),s("table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.table,expression:"loading.table"}],staticClass:"table table-hover"},[s("thead",[s("tr",[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),"PMP0051"==t.programCode?s("th",[s("small",[t._v("สินค้าที่จะผลิต")])]):t._e(),t._v(" "),t._m(3),t._v(" "),s("th")])]),t._v(" "),s("tbody",t._l(t.uHeaders,(function(e){return s("tr",{key:e.issue_header_id},[s("td",[s("small",[s("span",{class:e.badge_status.class},[t._v("\n                            "+t._s(e.badge_status.description)+"\n                        ")])])]),t._v(" "),s("td",[s("small",[t._v(t._s(e.request_number))])]),t._v(" "),s("td",[s("small",[t._v(t._s(e.batch_no))])]),t._v(" "),"PMP0051"==t.programCode?s("td",[s("small",[t._v(t._s(e.blend.item_description))])]):t._e(),t._v(" "),s("td",[s("small",[t._v(" "+t._s(e.show_date_th))])]),t._v(" "),s("td",[s("button",{class:t.transBtn.edit.class+" btn-sm",attrs:{"data-dismiss":"modal","aria-hidden":"true"},on:{click:function(s){return t.onClickButton(e)}}},[s("i",{class:t.transBtn.edit.icon}),t._v(" รายละเอียด\n                    ")])])])})),0)])])}),[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("สถานะ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("เลขที่ตัดใช้")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("เลขที่คำสั่งการผลิต")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("th",[s("small",[t._v("วันที่ตัดใช้")])])}],!1,null,null,null).exports}}]);