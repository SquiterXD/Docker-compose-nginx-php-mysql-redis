(self.webpackChunk=self.webpackChunk||[]).push([[5121],{93228:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var n=s(87757),r=s.n(n);function i(e,t,s,n,r,i,a){try{var o=e[i](a),l=o.value}catch(e){return void s(e)}o.done?t(l):Promise.resolve(l).then(n,r)}function a(e){return function(){var t=this,s=arguments;return new Promise((function(n,r){var a=e.apply(t,s);function o(e){i(a,n,r,o,l,"next",e)}function l(e){i(a,n,r,o,l,"throw",e)}o(void 0)}))}}const o={props:["pModuleList","pRole","pMenuByModuleRoute","pPermissionRoute","pAssignPermissionRoute","pRoleRoute","pRoleStoreRoute","pRoleUpdateRoute"],data:function(){return{roleId:null!=this.pRole&&""!=this.pRole?parseInt(this.pRole.role_id):"",roleName:null!=this.pRole&&""!=this.pRole?this.pRole.name:"",moduleName:null!=this.pRole&&""!=this.pRole?this.pRole.module_name:"",loading:!1,menus:[],disabled:!!this.pDisabled,roleHasPermisions:[],permissionList:{}}},mounted:function(){""!==this.roleId?this.getRoleHasPermision():this.roleHasPermisions=[]},methods:{getMenus:function(){var e=this;return a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.permissionList={},!e.moduleName){t.next=7;break}return e.loading=!0,t.next=5,axios.get(e.pMenuByModuleRoute+"?module="+e.moduleName).then((function(t){var s=t.data.data;for(var n in s){e.loopPerm(s[n].permissions);var r=s[n].children_menus;for(var i in r){e.loopPerm(r[i].permissions);var a=r[i].children_menus;for(var o in a)e.loopPerm(a[o].permissions)}}e.menus=s,e.loading=!1}));case 5:t.next=8;break;case 7:e.menus=[];case 8:case"end":return t.stop()}}),t)})))()},getRoleHasPermision:function(){var e=this;return a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,axios.get(e.pPermissionRoute+"?role_id="+e.roleId).then((function(t){var s=t.data;e.roleHasPermisions=s.data,e.getMenus()}));case 2:case"end":return t.stop()}}),t)})))()},loopPerm:function(e){var t=this;return a(r().mark((function s(){var n;return r().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(0!=e.length){s.next=2;break}return s.abrupt("return");case 2:for(n in e)t.checkHasPerm(e[n]);case 3:case"end":return s.stop()}}),s)})))()},checkHasPerm:function(e){var t=this;return a(r().mark((function s(){var n,i;return r().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(null==e.has_permission){s.next=2;break}return s.abrupt("return");case 2:if(n=!1,!(t.roleHasPermisions.length>0)){s.next=10;break}return s.next=6,t.roleHasPermisions.filter((function(t){return t.name===e.name}));case 6:i=s.sent,n=i.length>0,s.next=11;break;case 10:n=!1;case 11:t.$set(e,"has_permission",n);case 12:case"end":return s.stop()}}),s)})))()},changePerm:function(e){var t=this;return a(r().mark((function s(){var n;return r().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(""!=t.roleId){s.next=3;break}return e.has_permission?t.permissionList[e.permission_id]=e:delete t.permissionList[e.permission_id],s.abrupt("return");case 3:return n=t.pAssignPermissionRoute,s.next=6,axios.post(n,{permission_id:e.permission_id,is_checked:e.has_permission}).then((function(s){"S"!=s.data.data.status&&t.$set(e,"has_permission",!e.has_permission)}));case 6:case"end":return s.stop()}}),s)})))()},save:function(){var e=this;return a(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.roleId){t.next=5;break}return t.next=3,axios.post(e.pRoleStoreRoute,{role_name:e.roleName,module_name:e.moduleName,permission_list:e.permissionList}).then((function(t){"S"==t.data.data.status&&(location.href=e.pRoleRoute)}));case 3:t.next=7;break;case 5:return t.next=7,axios.patch(e.pRoleUpdateRoute,{role_name:e.roleName}).then((function(t){"S"==t.data.data.status&&(location.href=e.pRoleRoute)}));case 7:case"end":return t.stop()}}),t)})))()}}};const l=(0,s(51900).Z)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-sm-4 b-r"},[s("form",{attrs:{role:"form"}},[s("div",{staticClass:"form-group"},[s("label",[e._v("Role Name")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.roleName,expression:"roleName"}],staticClass:"form-control",attrs:{type:"text",placeholder:""},domProps:{value:e.roleName},on:{input:function(t){t.target.composing||(e.roleName=t.target.value)}}})]),e._v(" "),s("div",{staticClass:"form-group"},[s("label",[e._v("Module Name ")]),e._v(" "),s("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",disabled:""!=e.roleId,remote:"",clearable:"",placeholder:"",loading:e.loading},on:{change:e.getMenus},model:{value:e.moduleName,callback:function(t){e.moduleName=t},expression:"moduleName"}},e._l(e.pModuleList,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)])]),e._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"col-sm-8"},[s("table",{staticClass:"table"},[e._m(0),e._v(" "),s("tbody",[e._l(e.menus,(function(t){return[s("tr",[s("td",[s("h3",{staticClass:"no-margins pb-2"},[s("strong",{staticClass:"text-navy"},[e._v(e._s(t.menu_title))])])]),e._v(" "),s("td",{staticClass:"text-center"},[0==t.children_menus.length?s("div",[e._l(t.permissions,(function(t){return[s("el-switch",{on:{change:function(s){return e.changePerm(t)}},model:{value:t.has_permission,callback:function(s){e.$set(t,"has_permission",s)},expression:"perm.has_permission"}}),e._v("  \n                                    ")]}))],2):e._e()])]),e._v(" "),e._l(t.children_menus,(function(t){return[s("tr",[s("td",[s("div",{staticClass:"pl-4"},[s("div",{staticClass:"pb-1"},[s("i",{staticClass:"fa fa-arrow-circle-o-right text-muted"}),e._v("\n                                        "+e._s(t.program_code)+"\n                                        "+e._s(t.menu_title)+"\n                                    ")])])]),e._v(" "),s("td",{staticClass:"text-center"},[0==t.children_menus.length?s("div",[e._l(t.permissions,(function(t){return[s("el-switch",{on:{change:function(s){return e.changePerm(t)}},model:{value:t.has_permission,callback:function(s){e.$set(t,"has_permission",s)},expression:"perm.has_permission"}}),e._v("  \n                                    ")]}))],2):e._e()])]),e._v(" "),e._l(t.children_menus,(function(t){return[s("tr",[s("td",[s("div",{staticClass:"pl-4 ml-4"},[s("div",{staticClass:"pb-1"},[s("i",{staticClass:"fa fa-arrow-circle-o-right text-muted"}),e._v("\n                                            "+e._s(t.program_code)+"\n                                            "+e._s(t.menu_title)+"\n                                        ")])])]),e._v(" "),s("td",{staticClass:"text-center"},[e._l(t.permissions,(function(t){return[s("el-switch",{on:{change:function(s){return e.changePerm(t)}},model:{value:t.has_permission,callback:function(s){e.$set(t,"has_permission",s)},expression:"perm.has_permission"}}),e._v("  \n                                    ")]}))],2)])]}))]}))]}))],2)])]),e._v(" "),s("div",{staticClass:"col-12 mt-3"},[s("hr"),e._v(" "),s("div",{staticClass:"row clearfix m-t-lg text-right"},[s("div",{staticClass:"col-sm-12"},[s("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:e.save}},[e._v(" Save ")]),e._v(" "),s("a",{staticClass:"btn btn-sm btn-white",attrs:{href:e.pRoleRoute,type:"button"}},[e._v(" Cancel ")])])])])])])}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("thead",[s("tr",[s("th",[e._v("Menu")]),e._v(" "),s("th",{staticClass:"text-center",attrs:{width:"20%"}},[e._v("\n                            Enter | View\n                        ")])])])}],!1,null,null,null).exports}}]);