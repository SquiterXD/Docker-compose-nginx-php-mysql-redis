(self.webpackChunk=self.webpackChunk||[]).push([[5914],{35914:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>v});var s=a(87757),n=a.n(s),r=a(80455),l=a.n(r),o=a(7398),i=a.n(o);a(19371);function c(t,e,a,s,n,r,l){try{var o=t[r](l),i=o.value}catch(t){return void a(t)}o.done?e(i):Promise.resolve(i).then(s,n)}function u(t){return function(){var e=this,a=arguments;return new Promise((function(s,n){var r=t.apply(e,a);function l(t){c(r,s,n,l,o,"next",t)}function o(t){c(r,s,n,l,o,"throw",t)}l(void 0)}))}}function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function _(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(Object(a),!0).forEach((function(e){p(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const d={props:["authUser","showType","searchInputs","sample","items","resultItems","listBrands","listMakers","approvalData"],components:{Loading:i(),VueNumeric:l()},data:function(){var t=this;return{sampleData:this.sample,specifications:this.items,sampleResults:this.resultItems.map((function(e){var a=e.result_value;return"BRAND"!=e.qtm_test_code||e.result_value||(a=t.sample.brand),"MAKER"!=e.qtm_test_code||e.result_value||(a=t.sample.maker),_(_({},e),{},{result_value:a,optimal_value:t.getOptimalValue(t.items,e),result_status:t.calResultStatus(_(_({},e),{},{result_value:e.result_value})),failed_status:t.calFailedStatus(_(_({},e),{},{result_value:e.result_value})),cause_of_defect:e.cause_of_defect?e.cause_of_defect:""})})),isLoading:!1}},methods:{getOptimalValue:function(t,e){var a=t.find((function(t){return t.test_id==e.test_id}));return a?a.optimal_value:""},getResultValue:function(t){var e=this.resultItems.find((function(e){return e.test_id==t.test_id}));return e?e.result_value:""},onSampleResultChanged:function(t,e){e.result_value=t},calResultStatus:function(t){var e="";return t.min_value&&t.max_value&&t.result_value&&(e=parseFloat(t.result_value)>=parseFloat(t.min_value)&&parseFloat(t.result_value)<=parseFloat(t.max_value)?"PASSED":"FAILED",this.calFailedStatus(t)),t.result_status=e,e},calFailedStatus:function(t){var e="";return t.min_value&&t.max_value&&t.result_value&&(parseFloat(t.result_value)<parseFloat(t.min_value)&&(e="UNDER"),parseFloat(t.result_value)>parseFloat(t.max_value)&&(e="OVER")),t.failed_status=e,e},onSubmitSampleResult:function(t){var e=this;return u(n().mark((function t(){var a,s,r,l,o,i,c,u,m,_,p;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.sampleResults.map((function(t){return{result_id:t.result_id,test_id:t.test_id,test_code:t.test_code,test_desc:t.test_desc,optimal_value:t.optimal_value,min_value:t.min_value,max_value:t.max_value,result_value:t.result_value?t.result_value:""}})),s={organization_code:e.sampleData.organization_code,oracle_sample_id:e.sampleData.oracle_sample_id,sample_no:e.sampleData.sample_no,sample_desc:e.sampleData.sample_desc,inventory_item_id:e.sampleData.inventory_item_id,item_number:e.sampleData.item_number,item_desc:e.sampleData.item_desc,date_drawn:e.sampleData.date_drawn,sample_disposition:e.sampleData.sample_disposition,sample_disposition_desc:e.sampleData.sample_disposition_desc,sample_id:e.sampleData.sample_id,department_code:e.sampleData.department_code,qm_group:e.sampleData.qm_group,organization_id:e.sampleData.organization_id,subinventory_code:e.sampleData.subinventory_code,locator_id:e.sampleData.locator_id,sample_date:e.sampleData.sample_date,batch_id:e.sampleData.batch_id,qc_area:e.sampleData.qc_area,machine_set:e.sampleData.machine_set,program_code:e.sampleData.program_code,result_quality_lines:JSON.stringify(a)},e.isLoading=!0,r="success",l=e.sampleData.sample_disposition,o=e.sampleData.sample_disposition_desc,i=e.sampleData.severity_level_minor,c=e.sampleData.severity_level_major,u=e.sampleData.severity_level_critical,m=e.sampleData.brand,_=e.sampleData.maker,p=e.sampleData.test_time,t.next=14,axios.post("/qm/ajax/qtm-machines/result",s).then((function(t){var a=t.data.data,s=a.message,n=a.sample?JSON.parse(a.sample):null;return r=a.status,n&&(l=n.sample_disposition,o=n.sample_disposition_desc,i=n.severity_level_minor,c=n.severity_level_major,u=n.severity_level_critical,m=n.brand,_=n.maker,p=n.test_time),"success"==a.status&&swal("Success","บันทึกลงผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no," )"),"success"),"error"==a.status&&swal("Error","บันทึกลงผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no,") | ").concat(s),"error"),a})).catch((function(t){console.log(t),r="error",swal("Error","บันทึกลงผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no,")  | ").concat(t.message),"error")}));case 14:e.isLoading=!1,e.$emit("onSampleResultSubmitted",{status:r,sample_no:e.sampleData.sample_no,sample_disposition:l,brand:m,maker:_,test_time:p,sample_disposition_desc:o,severity_level_minor:i,severity_level_major:c,severity_level_critical:u});case 16:case"end":return t.stop()}}),t)})))()},onSubmitCauseOfDefect:function(t){var e=this;return u(n().mark((function t(){var a,s;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.sampleResults.map((function(t){return{result_id:t.result_id,test_id:t.test_id,test_code:t.test_code,test_desc:t.test_desc,cause_of_defect:t.cause_of_defect?t.cause_of_defect:""}})),s={organization_code:e.sampleData.organization_code,oracle_sample_id:e.sampleData.oracle_sample_id,sample_no:e.sampleData.sample_no,result_quality_lines:JSON.stringify(a)},e.isLoading=!0,"success",t.next=6,axios.post("/qm/ajax/qtm-machines/defect",s).then((function(t){var a=t.data.data,s=a.message;a.sample&&JSON.parse(a.sample);return a.status,"success"==a.status&&swal("Success","บันทึกสาเหตุความผิดปกติการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no," )"),"success"),"error"==a.status&&swal("Error","บันทึกสาเหตุความผิดปกติการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no,") | ").concat(s),"error"),a})).catch((function(t){console.log(t),"error",swal("Error","บันทึกสาเหตุความผิดปกติการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no,")  | ").concat(t.message),"error")}));case 6:e.isLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},onConfirmSampleResult:function(t){var e=this;swal({title:"",text:"ต้องการ ยืนยันการใช้ข้อมูล ?",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"ยืนยัน",cancelButtonText:"ปิด",closeOnConfirm:!1},function(){var t=u(n().mark((function t(a){var s;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=5;break}return t.next=3,e.confirmSampleResult();case 3:s=t.sent,e.$emit("onConfirmSampleResult",{sample_no:e.sampleData.sample_no,confirm_code:s.confirm_code});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},confirmSampleResult:function(){var t=this;return u(n().mark((function e(){var a,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={sample_no:t.sampleData.sample_no},t.isLoading=!0,e.next=4,axios.post("/qm/ajax/qtm-machines/confirm",a).then((function(e){var a=e.data.data,s=a.message;return"success"==a.status&&swal("Success","ยืนยันผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(t.sampleData.sample_no," )"),"success"),"error"==a.status&&swal("Error","ยืนยันผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(t.sampleData.sample_no,") | ").concat(s),"error"),a})).catch((function(e){console.log(e),swal("Error","บันทึกลงผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(t.sampleData.sample_no,")  | ").concat(e.message),"error")}));case 4:return s=e.sent,t.isLoading=!1,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e)})))()},onRejectSampleResult:function(t){var e=this;swal({title:"ต้องการ ยกเลิกการใช้ข้อมูล ?",type:"input",text:"กรุณากรอกเหตุผลการยกเลิก",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"ยกเลิกการใช้ข้อมูล",cancelButtonText:"ปิด",closeOnConfirm:!1},function(){var t=u(n().mark((function t(a){var s,r;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==a&&""!==a){t.next=3;break}return swal.showInputError("กรุณากรอกเหตุผลการยกเลิก ! "),t.abrupt("return",!1);case 3:return s=a,t.next=6,e.rejectSampleResult(s);case 6:r=t.sent,e.$emit("onRejectSampleResult",{sample_no:e.sampleData.sample_no,confirm_code:r.confirm_code,reject_reason:s});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},rejectSampleResult:function(t){var e=this;return u(n().mark((function a(){var s,r;return n().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s={sample_no:e.sampleData.sample_no,reject_reason:t},e.isLoading=!0,a.next=4,axios.post("/qm/ajax/qtm-machines/reject",s).then((function(t){var a=t.data.data,s=a.message;return"success"==a.status&&swal("Success","ยกเลิกการใช้ข้อมูลผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no," )"),"success"),"error"==a.status&&swal("Error","ยกเลิกการใช้ข้อมูลผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no,") | ").concat(s),"error"),a})).catch((function(t){console.log(t),swal("Error","บันทึกลงผลการตรวจสอบด้วยเครื่อง QTM (เลขที่การตรวจสอบ\t: ".concat(e.sampleData.sample_no,")  | ").concat(t.message),"error")}));case 4:return r=a.sent,e.isLoading=!1,a.abrupt("return",r);case 7:case"end":return a.stop()}}),a)})))()},onCancelSampleResult:function(t){this.$emit("onCancelSampleResult",t)}}};const v=(0,a(51900).Z)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tw-ml-10 tw-mr-20 tw-py-2"},[a("table",{staticClass:"table table-borderless-horizontal mb-0"},[a("thead",[a("tr",[a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center",staticStyle:{"z-index":"auto"},attrs:{width:"7%"}},[t._v("\n                    ลำดับที่\n                ")]),t._v(" "),a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100",staticStyle:{"z-index":"auto"},attrs:{width:"25%"}},[t._v("\n                    ชื่อการทดสอบ\n                ")]),t._v(" "),a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center tw-text-xs md:tw-table-cell tw-hidden",staticStyle:{"z-index":"auto"},attrs:{width:"12%"}},[t._v("\n                    ค่ามาตรฐาน\n                ")]),t._v(" "),a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center tw-text-xs md:tw-table-cell tw-hidden",staticStyle:{"z-index":"auto"},attrs:{width:"10%"}},[t._v("\n                    ค่าOPTIMAL\n                ")]),t._v(" "),a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center",staticStyle:{"z-index":"auto"},attrs:{width:"12%"}},[t._v("\n                    ผลการทดสอบ\n                ")]),t._v(" "),a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center tw-text-xs md:tw-table-cell tw-hidden",staticStyle:{"z-index":"auto"},attrs:{width:"8%"}},[t._v("\n                    อยู่ในเกณฑ์มาตรฐาน\n                ")]),t._v(" "),a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center tw-text-xs md:tw-table-cell tw-hidden",staticStyle:{"z-index":"auto"},attrs:{width:"5%"}}),t._v(" "),"defect"==t.showType?a("th",{staticClass:"tw-text-gray-600 tw-bg-opacity-40 tw-bg-blue-100 text-center tw-text-xs md:tw-table-cell tw-hidden",staticStyle:{"z-index":"auto"},attrs:{width:"20%"}},[t._v("\n                    สาเหตุ\n                ")]):t._e()])]),t._v(" "),t.sampleResults.length>0?a("tbody",[t._l(t.sampleResults,(function(e,s){return[a("tr",{directives:[{name:"show",rawName:"v-show",value:!t.searchInputs.show_test_id||t.searchInputs.show_test_id==e.test_id,expression:"!searchInputs.show_test_id || searchInputs.show_test_id == sampleResult.test_id"}],key:s,class:"Y"==e.read_only?"tw-bg-gray-100 tw-bg-opacity-60":""},[a("td",{staticClass:"text-center"},[t._v("\n                        "+t._s(e.seq)+"\n                    ")]),t._v(" "),a("td",{},[t._v("\n                        "+t._s(e.test_code)+" "+t._s(e.test_desc)+"\n                        "+t._s(e.test_unit?"("+e.test_unit+")":"")+"\n                        "),"Y"!=e.optional_ind?a("span",{staticClass:"tw-text-red-600"},[t._v(" * ")]):t._e()]),t._v(" "),a("td",{staticClass:"text-center tw-text-xs md:tw-table-cell tw-text-blue-600 tw-font-bold tw-hidden"},[t._v("\n                        "+t._s(e.min_value)+" -\n                        "+t._s(e.max_value)+"\n                    ")]),t._v(" "),a("td",{staticClass:"text-center tw-text-xs md:tw-table-cell tw-text-green-600 tw-font-bold tw-hidden"},[t._v("\n                        "+t._s(e.optimal_value)+"\n                    ")]),t._v(" "),a("td",{staticClass:"text-center"},["result"!=t.showType||"Y"==e.read_only||t.sampleData.file_name?t._e():a("div",["Y"==e.brand_flag?[a("input",{directives:[{name:"model",rawName:"v-model",value:t.sampleData.brand,expression:"sampleData.brand"}],staticClass:"form-control input-sm text-left",attrs:{type:"text",disabled:""},domProps:{value:t.sampleData.brand},on:{input:function(e){e.target.composing||t.$set(t.sampleData,"brand",e.target.value)}}})]:"MAKER"==e.qtm_test_code?[a("input",{directives:[{name:"model",rawName:"v-model",value:t.sampleData.maker,expression:"sampleData.maker"}],staticClass:"form-control input-sm text-left",attrs:{type:"text",disabled:""},domProps:{value:t.sampleData.maker},on:{input:function(e){e.target.composing||t.$set(t.sampleData,"maker",e.target.value)}}})]:e.test&&"Y"==e.test.time_flag?[a("qm-timepicker",{attrs:{id:"input_result_value_"+s,name:"result_value_"+s,value:e.result_value},on:{change:function(a){return t.onSampleResultChanged(a,e)}}})]:"N"==e.data_type_code?[a("input",{directives:[{name:"model",rawName:"v-model",value:e.result_value,expression:"sampleResult.result_value"}],staticClass:"form-control input-sm text-center",attrs:{id:"input_result_value_"+s,type:"number",name:"result_value_"+s,placeholder:""},domProps:{value:e.result_value},on:{change:function(a){return t.calResultStatus(e)},input:function(a){a.target.composing||t.$set(e,"result_value",a.target.value)}}})]:[a("input",{directives:[{name:"model",rawName:"v-model",value:e.result_value,expression:"sampleResult.result_value"}],staticClass:"form-control input-sm text-center",attrs:{id:"input_result_value_"+s,type:"text",name:"result_value_"+s,placeholder:""},domProps:{value:e.result_value},on:{change:function(a){return t.calResultStatus(e)},input:function(a){a.target.composing||t.$set(e,"result_value",a.target.value)}}})]],2),t._v(" "),"result"!=t.showType||"Y"==e.read_only||t.sampleData.file_name?a("div",{staticClass:"tw-px-2"},["Y"==e.brand_flag?[t._v("\n                                "+t._s(t.sampleData.brand)+"\n                            ")]:"MAKER"==e.qtm_test_code?[t._v("\n                                "+t._s(t.sampleData.maker)+"\n                            ")]:[t._v("\n                                "+t._s(e.result_value?e.result_value:"-")+"\n                            ")]],2):t._e()]),t._v(" "),a("td",{staticClass:"text-center tw-text-xs md:tw-table-cell tw-hidden"},["PASSED"==e.result_status?a("span",{staticClass:"fa fa-2x fa-check-circle tw-text-green-500"}):t._e(),t._v(" "),"FAILED"==e.result_status?a("span",{staticClass:"fa fa-2x fa-times tw-text-red-500"}):t._e(),t._v(" "),e.result_status?t._e():a("span",{staticClass:"fa fa-2x fa-minus"})]),t._v(" "),a("td",{staticClass:"text-center tw-text-xs md:tw-table-cell tw-hidden"},["UNDER"==e.failed_status?a("span",{staticClass:"fa fa-2x fa-arrow-down tw-text-blue-500"}):t._e(),t._v(" "),"OVER"==e.failed_status?a("span",{staticClass:"fa fa-2x fa-arrow-up tw-text-red-500"}):t._e()]),t._v(" "),"defect"==t.showType?a("td",{staticClass:"text-left tw-text-xs md:tw-table-cell",staticStyle:{"padding-right":"0px"}},["FAILED"==e.result_status?[a("input",{directives:[{name:"model",rawName:"v-model",value:e.cause_of_defect,expression:"sampleResult.cause_of_defect"}],staticClass:"form-control input-sm text-left",attrs:{type:"text",placeholder:"ระบุสาเหตุ"},domProps:{value:e.cause_of_defect},on:{input:function(a){a.target.composing||t.$set(e,"cause_of_defect",a.target.value)}}})]:[a("input",{staticClass:"form-control input-sm text-left",attrs:{type:"text",disabled:""}})]],2):t._e()])]})),t._v(" "),"3"==t.sampleData.confirm_code?a("tr",[a("td"),t._v(" "),a("td",[t._v("เหตุผลการยกเลิก")]),t._v(" "),a("td",{attrs:{colspan:"5"}},[t._v(" "+t._s(t.sampleData.reject_reason)+" ")])]):t._e(),t._v(" "),"result"==t.showType||"defect"==t.showType?a("tr",[a("td",{attrs:{colspan:"8"}},[a("div",{staticClass:"row justify-content-center clearfix tw-my-4"},[a("div",{staticClass:"col text-center"},["result"!=t.showType||t.sampleData.file_name||"1"!=t.sampleData.confirm_code?t._e():a("button",{staticClass:"btn btn-md btn-success tw-w-32 tw-mr-4",attrs:{type:"button"},on:{click:function(e){return t.onSubmitSampleResult(e)}}},[a("i",{staticClass:"fa fa-save"}),t._v(" บันทึก\n                            ")]),t._v(" "),"defect"==t.showType?a("button",{staticClass:"btn btn-md btn-success tw-w-32 tw-mr-4",attrs:{type:"button"},on:{click:function(e){return t.onSubmitCauseOfDefect(e)}}},[a("i",{staticClass:"fa fa-save"}),t._v(" บันทึก\n                            ")]):t._e(),t._v(" "),"result"==t.showType?a("button",{staticClass:"btn btn-md btn-outline btn-success tw-w-32",attrs:{type:"button",disabled:"2"==t.sampleData.confirm_code},on:{click:function(e){return t.onConfirmSampleResult(e)}}},[a("i",{staticClass:"fa fa-check-square-o"}),t._v(" ยืนยันการใช้ข้อมูล\n                            ")]):t._e(),t._v(" "),"result"==t.showType?a("button",{staticClass:"btn btn-md btn-outline btn-danger tw-w-32 tw-ml-2",attrs:{type:"button"},on:{click:function(e){return t.onRejectSampleResult(e)}}},[a("i",{staticClass:"fa fa-times"}),t._v(" ยกเลิกการใช้ข้อมูล\n                            ")]):t._e(),t._v(" "),"defect"==t.showType||!t.sampleData.file_name&&"1"==t.sampleData.confirm_code?a("button",{staticClass:"btn btn-md btn-danger tw-w-32 tw-ml-4",attrs:{type:"button"},on:{click:t.onCancelSampleResult}},[a("i",{staticClass:"fa fa-times"}),t._v(" ปิด\n                            ")]):t._e()])])])]):t._e()],2):a("tbody",[t._m(0)])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}})],1)}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[a("td",{attrs:{colspan:"8"}},[a("h2",{staticClass:"p-5 text-center text-muted"},[t._v("ไม่พบข้อมูล")])])])}],!1,null,null,null).exports}}]);