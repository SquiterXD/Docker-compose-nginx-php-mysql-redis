(self.webpackChunk=self.webpackChunk||[]).push([[3214],{71453:(t,a,e)=>{"use strict";e.r(a),e.d(a,{default:()=>l});var n=e(14766),i=e(1550);const s={components:{dateInput:n.Z,yearInput:i.Z},name:"ir-calculate-insurance-index",props:["policyLists","companyLists","yearLists","effectDateLists"],data:function(){return{loading:!1,disableForm:!1,disableReport:!1,disableInterface:!0,amountInReport:0,dateStart:"",dateEnd:"",invoiceDate:"",invalidInvoiceDate:!1,batchNo:"",invalidBatchNo:!1,year:0,insuranceNo:"",company:"",pickerOptions:{disabledDate:this.pickerYearOptions}}},created:function(){var t=(new Date).getFullYear(),a=new Date(t,8,30),e=(new Date).getTime()>a.getTime()?544:543;this.year=(t+e).toString(),this.dateStart="30/09/"+(t+e-1),this.dateEnd="30/09/"+(t+e)},methods:{pickerYearOptions:function(t){return!this.yearLists.includes(t.getFullYear())},callReport:function(){var t=this;t.loading=!0,axios.post("/ir/calculate-insurance/check-report",{company:t.company,insuranceNo:t.insuranceNo,year:t.year,dateStart:t.dateStart,dateEnd:t.dateEnd}).then((function(a){"C"==a.data.status?(t.amountInReport=a.data.amount,t.printReport()):swal({html:!0,title:"Error",text:'<h2 class="m-t-sm m-b-lg"><span style="font-size: 18px">'+a.data.msg+"</span></h2>"})})).catch((function(t){})).then((function(){t.loading=!1}))},printReport:function(){var t=this,a="/ir/calculate-insurance/report?company="+t.company+"&insuranceNo="+t.insuranceNo+"&year="+t.year+"&dateStart="+t.dateStart+"&dateEnd="+t.dateEnd;window.open(a,"_blank"),t.disableInterface=!1,t.disableForm=t.disableReport=!0},clickInterface:function(){var t=this,a=!0;t.invalidBatchNo=!1,t.invalidInvoiceDate=!1,t.amountInReport>=0&&(t.batchNo||(t.invalidBatchNo=!0,a=!1)),t.invoiceDate||(t.invalidInvoiceDate=!0,a=!1),a&&(t.loading=!0,axios.post("/ir/calculate-insurance/interface",{company:t.company,insuranceNo:t.insuranceNo,year:t.year,dateStart:t.dateStart,dateEnd:t.dateEnd,invoiceDate:t.invoiceDate,invoiceBatch:t.batchNo}).then((function(a){"S"==a.data.status?(swal({html:!0,title:"Success",text:'<h2 class="m-t-sm m-b-lg"><span style="font-size: 18px">Interface Complete</span></h2>'}),t.disableInterface=!0):swal({html:!0,title:"Error",text:'<h2 class="m-t-sm m-b-lg"><span style="font-size: 18px">'+a.data.msg+"</span></h2>"})})).catch((function(t){})).then((function(){t.loading=!1})))},clickCancel:function(){var t=this;t.insuranceNo="",t.dateStart="",t.dateEnd="",t.year=((new Date).getFullYear()+543).toString()},handleChange:function(){},getDateStart:function(t){this.dateStart=t.value},getDateEnd:function(t){this.dateEnd=t.value},getinvoiceDate:function(t){this.invoiceDate=t.value},getYear:function(t){var a=this,e=t.getFullYear()-543,n=a.effectDateLists.find((function(t,a){if(t.lookup_code==e)return!0})),i=new Date(n.start_date_active);a.year=t.getFullYear().toString(),a.dateStart=("0"+i.getDate()).slice(-2)+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+(i.getFullYear()+543),a.dateEnd=("0"+i.getDate()).slice(-2)+"/"+("0"+(i.getMonth()+1)).slice(-2)+"/"+(i.getFullYear()+544)}}};const l=(0,e(51900).Z)(s,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("div",{staticClass:"row my-3"},[e("div",{staticClass:"col-md-4"}),t._v(" "),e("div",{staticClass:"col-md-4"},[t._m(0),t._v(" "),e("el-select",{staticClass:"w-100",attrs:{placeholder:"บริษัท",clearable:"",disabled:t.disableForm},model:{value:t.company,callback:function(a){t.company=a},expression:"company"}},t._l(t.companyLists,(function(t){return e("el-option",{key:t.company_number,attrs:{label:t.company_name,value:t.company_number}})})),1)],1)]),t._v(" "),e("div",{staticClass:"row my-3"},[e("div",{staticClass:"col-md-4"}),t._v(" "),e("div",{staticClass:"col-md-2"},[t._m(1),t._v(" "),e("el-select",{staticClass:"w-100",attrs:{placeholder:"กรมธรรม์ชุดที่",clearable:"",disabled:t.disableForm},model:{value:t.insuranceNo,callback:function(a){t.insuranceNo=a},expression:"insuranceNo"}},t._l(t.policyLists,(function(t){return e("el-option",{key:t.policy_set_header_id,attrs:{label:t.policy_set_number+" : "+t.policy_set_description,value:t.policy_set_header_id}})})),1)],1),t._v(" "),e("div",{staticClass:"col-md-2"},[t._m(2),t._v(" "),e("el-date-picker",{staticClass:"w-100 text-center",attrs:{"picker-options":t.pickerOptions,clearable:!1,type:"year",placeholder:"ปี",disabled:t.disableForm},on:{change:t.getYear},model:{value:t.year,callback:function(a){t.year=a},expression:"year"}})],1)]),t._v(" "),e("div",{staticClass:"row my-3"},[e("div",{staticClass:"col-md-4"}),t._v(" "),e("div",{staticClass:"col-md-2"},[t._m(3),t._v(" "),e("date-input",{attrs:{attrName:"start_date",sizeSmall:!1,value:t.dateStart,disabled:!0,placeholder:"วันที่คุ้มครอง"},on:{"change-date":t.getDateStart},model:{value:t.dateStart,callback:function(a){t.dateStart=a},expression:"dateStart"}})],1),t._v(" "),e("div",{staticClass:"col-md-2"},[t._m(4),t._v(" "),e("date-input",{attrs:{attrName:"start_end",sizeSmall:!1,value:t.dateEnd,disabled:!0,placeholder:"ถึง"},on:{"change-date":t.getDateEnd},model:{value:t.dateEnd,callback:function(a){t.dateEnd=a},expression:"dateEnd"}})],1)]),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 padding_12 text-center"},[e("button",{staticClass:"btn btn-info m-1",attrs:{disabled:t.disableReport},on:{click:function(a){return t.callReport()}}},[e("i",{staticClass:"fa fa-file"}),t._v(" Print Report")]),t._v(" "),e("button",{staticClass:"btn m-1",staticStyle:{color:"#fff","background-color":"#13abad","border-color":"#13abad"},attrs:{disabled:t.disableInterface,"data-toggle":"modal","data-target":"#modal-interface"}},[e("i",{staticClass:"fa fa-exchange"}),t._v(" \n                Interface\n            ")]),t._v(" "),e("button",{staticClass:"btn btn-danger m-1",on:{click:function(a){return t.clickCancel()}}},[e("i",{staticClass:"fa fa-times"}),t._v(" Cancel")])])]),t._v(" "),e("div",{staticClass:"modal fade",attrs:{id:"modal-interface","aria-hidden":"true"}},[e("div",{staticClass:"modal-dialog pt-0 modal-lg"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-body"},[e("div",{staticClass:"m-l-xs m-r-lg mm-xs"},[e("div",{staticClass:"row my-3"},[t._m(5),t._v(" "),e("div",{staticClass:"col-md-5"},[t.invalidInvoiceDate?e("span",{staticClass:"text-danger"},[t._v("required")]):t._e(),t._v(" "),e("date-input",{attrs:{attrName:"invoice_date",sizeSmall:!1,value:t.invoiceDate,placeholder:"วันที่คุ้มครอง"},on:{"change-date":t.getinvoiceDate},model:{value:t.invoiceDate,callback:function(a){t.invoiceDate=a},expression:"invoiceDate"}})],1)]),t._v(" "),e("div",{staticClass:"row my-3"},[e("label",{staticClass:"col-md-4 col-form-label lable_align"},[e("strong",[t._v("Invoice Batch "),t.amountInReport>=0?e("span",{staticClass:"text-danger"},[t._v("*")]):t._e()])]),t._v(" "),e("div",{staticClass:"col-md-5"},[t.invalidBatchNo?e("span",{staticClass:"text-danger"},[t._v("required")]):t._e(),t._v(" "),e("el-input",{attrs:{placeholder:"Invoice Batch",disabled:t.amountInReport<0},model:{value:t.batchNo,callback:function(a){t.batchNo=a},expression:"batchNo"}})],1)]),t._v(" "),e("hr",{staticClass:"m-t-sm m-b-sm"}),t._v(" "),e("div",{staticClass:"row"},[e("div",{staticClass:"col-sm-12 text-right"},[e("button",{staticClass:"btn btn-danger",attrs:{type:"button","data-dismiss":"modal"}},[t._v("Cancel")]),t._v(" "),e("button",{staticClass:"btn btn-primary",attrs:{type:"button","data-dismiss":"modal"},on:{click:function(a){return t.clickInterface()}}},[t._v("Confirm")])])])])])])])])])}),[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",[e("strong",[t._v("บริษัท")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",[e("strong",[t._v("กรมธรรม์ชุดที่")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",[e("strong",[t._v("ปี")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",[e("strong",[t._v("วันที่คุ้มครอง")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",[e("strong",[t._v("ถึง")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("label",{staticClass:"col-md-4 col-form-label lable_align"},[e("strong",[t._v("วันที่ใบแจ้งหนี้ "),e("span",{staticClass:"text-danger"},[t._v("*")])])])}],!1,null,null,null).exports}}]);