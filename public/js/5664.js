(self.webpackChunk=self.webpackChunk||[]).push([[5664],{9348:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var o=a(23645),r=a.n(o)()((function(t){return t[1]}));r.push([t.id,".v--modal-overlay[data-v-1e322f7a]{z-index:2000;padding-top:3rem;padding-bottom:3rem}.vm--overlay[data-modal=modal-search-allocate-year][data-v-1e322f7a]{height:100%!important}",""]);const s=r},14185:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var o=a(23645),r=a.n(o)()((function(t){return t[1]}));r.push([t.id,".v--modal-overlay[data-v-8a93200e]{z-index:2000;padding-top:3rem;padding-bottom:3rem}.vm--overlay[data-modal=modal-create-allocate-accounts][data-v-8a93200e]{height:100%!important}",""]);const s=r},18405:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var o=a(23645),r=a.n(o)()((function(t){return t[1]}));r.push([t.id,".v--modal-overlay[data-v-7f7b3aa0]{z-index:2000;padding-top:3rem;padding-bottom:3rem}.vm--overlay[data-modal=modal-create-allocate-targets][data-v-7f7b3aa0]{height:100%!important}",""]);const s=r},61075:(t,e,a)=>{"use strict";a.d(e,{Z:()=>s});var o=a(23645),r=a.n(o)()((function(t){return t[1]}));r.push([t.id,".v--modal-overlay[data-v-52c0bcaf]{z-index:2000;padding-top:3rem;padding-bottom:3rem}.vm--overlay[data-modal=modal-search-allocate-year][data-v-52c0bcaf]{height:100%!important}",""]);const s=r},95664:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>ct});var o=a(87757),r=a.n(o),s=a(7398),c=a.n(s),l=(a(19371),a(30381)),n=a.n(l),i=a(80455),u=a.n(i);function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){_(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function _(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function g(t,e,a,o,r,s,c){try{var l=t[s](c),n=l.value}catch(t){return void a(t)}l.done?e(n):Promise.resolve(n).then(o,r)}function h(t){return function(){var e=this,a=arguments;return new Promise((function(o,r){var s=t.apply(e,a);function c(t){g(s,o,r,c,l,"next",t)}function l(t){g(s,o,r,c,l,"throw",t)}c(void 0)}))}}const f={props:["periodYearValue","allocateGroupValue","deptCodeValue","costCodeValue","costGroupCodeValue","allocateYear","allocateAccountItem","targetAccountCode","allocateTargets"],components:{VueNumeric:u()},watch:{periodYearValue:function(t){this.periodYear=t},allocateGroupValue:function(t){this.allocateGroup=t},deptCodeValue:function(t){this.deptCode=t},costCodeValue:function(t){this.costCode=t},costGroupCodeValue:function(t){this.costGroupCode=t},allocateYear:function(t){this.allocateYearData=t},allocateAccountItem:function(t){this.allocateAccountItemData=t},targetAccountCode:function(t){this.targetAccountCodeData=t},allocateTargets:function(t){this.allocateTargetItems=t}},data:function(){return{periodYear:this.periodYearValue,allocateGroup:this.allocateGroupValue,deptCode:this.deptCodeValue,costCode:this.costCodeValue,costGroupCode:this.costGroupCodeValue,allocateYearData:this.allocateYear,allocateAccountItemData:this.allocateAccountItem,targetAccountCodeData:this.targetAccountCode,allocateTargetItems:this.allocateTargets}},mounted:function(){},computed:{},methods:{isAllowAddAllocateTarget:function(t){var e=!0;return t.filter((function(t){return t.is_new_line&&(!t.quantity||!t.ratio_rate)})).length>0&&(e=!1),e},updateAllocateTargets:function(t,e){var a=this;return h(r().mark((function o(){var s,c;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return s={period_year:a.periodYear,input_allocate_year:JSON.stringify(a.allocateYear),input_allocate_account:JSON.stringify(t),input_allocate_targets:JSON.stringify(e)},a.isLoading=!0,o.next=4,axios.post("/ajax/ct/allocate-ratios/update-targets",s).then((function(t){var e=t.data.data,a=e.message;return"success"==e.status&&swal("Success","บันทึกข้อมูลเป้าหมายที่รับปัน","success"),"error"==e.status&&swal("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลเป้าหมายที่รับปัน | ".concat(a),"error"),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถบันทึกข้อมูลเป้าหมายที่รับปัน | ".concat(t.message),"error")}));case 4:return c=o.sent,a.isLoading=!1,o.abrupt("return",c);case 7:case"end":return o.stop()}}),o)})))()},onDeleteAllocateTargetItem:function(t){swal({title:"",text:"ต้องการลบรายการ ".concat(t.target_code?t.target_code:""," ?"),showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",closeOnConfirm:!0},(function(t){}))},validateBeforeUpdateTargets:function(t,e){var a={valid:!0,message:""};e.find((function(t){return!t.quantity||!t.ratio_rate}))&&(a.valid=!1,a.message="กรอกข้อมูลรายการเป้าหมายการปันส่วนไม่ครบถ้วน กรุณาตรวจสอบ"),e.reduce((function(t,e){return t+parseFloat(e.quantity)}),0)>parseFloat(t.quantity)&&(a.valid=!1,a.message="กรอกข้อมูลสัดส่วนเป้าหมายการปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ");var o=e.reduce((function(t,e){return t+parseFloat(e.ratio_rate)}),0);return o>parseFloat(t.ratio_rate)&&(a.valid=!1,a.message="กรอกข้อมูล % เป้าหมายการปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ"),"PRODUCT"==this.allocateGroup&&"P"==this.costGroupCode||100!=o&&(a.valid=!1,a.message="ผลรวม สัดส่วน % ไม่ครบ 100% กรุณาตรวจสอบ"),a},onAllocateTargetQuantityChanged:function(t){var e=this;return h(r().mark((function a(){var o,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=e.allocateTargetItems,"PRODUCT"==e.allocateGroup&&"P"==e.costGroupCode||(t.ratio_rate=t.quantity,(s=e.validateTargetQuantity(100,o,t)).valid||(swal("เกิดข้อผิดพลาด","".concat(s.message),"error"),e.$nextTick((function(){t.quantity=0,t.ratio_rate=0})))),"PRODUCT"==e.allocateGroup&&"P"==e.costGroupCode&&e.autoCalTargetProductGroupRatioRate();case 3:case"end":return a.stop()}}),a)})))()},onAllocateTargetRatioRateChanged:function(t){var e=this;return h(r().mark((function a(){var o,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:o=e.allocateTargetItems,"PRODUCT"==e.allocateGroup&&"P"==e.costGroupCode||(t.quantity=t.ratio_rate,(s=e.validateTargetRatioRate(100,o,t)).valid||(swal("เกิดข้อผิดพลาด","".concat(s.message),"error"),e.$nextTick((function(){t.quantity=0,t.ratio_rate=0})))),"PRODUCT"==e.allocateGroup&&e.costGroupCode;case 3:case"end":return a.stop()}}),a)})))()},autoCalTargetProductGroupRatioRate:function(){var t=this.allocateTargetItems.reduce((function(t,e){return t+parseFloat(e.quantity)}),0);this.allocateTargetItems=this.allocateTargetItems.map((function(e){var a=e.quantity?e.quantity:0,o=t>0?100*a/t:0;return p(p({},e),{},{ratio_rate:o})}))},validateTargetQuantity:function(t,e,a){var o={valid:!0,message:""};return e.reduce((function(t,e){return t+parseFloat(e.quantity)}),0)>parseFloat(t)&&(o.valid=!1,o.message="กรอกข้อมูลสัดส่วนเป้าหมายการปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ"),o},validateTargetRatioRate:function(t,e,a){var o={valid:!0,message:""};return e.reduce((function(t,e){return t+parseFloat(e.ratio_rate)}),0)>parseFloat(t)&&(o.valid=!1,o.message="กรอกข้อมูล % เป้าหมายการปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ"),o},validateTargetSummarizedRatioRate:function(t,e){var a={valid:!0,message:""};return e.reduce((function(t,e){return t+parseFloat(e.ratio_rate)}),0)!=t&&(a.valid=!1,a.message="ผลรวม สัดส่วน % ไม่ครบ ".concat(t,"% กรุณาตรวจสอบ")),a},onSubmitUpdateAllocateTargets:function(){var t=this;return h(r().mark((function e(){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t.validateBeforeUpdateTargets(t.allocateAccountItemData,t.allocateTargetItems)).valid){e.next=8;break}return e.next=4,t.updateAllocateTargets(t.allocateAccountItemData,t.allocateTargetItems);case 4:"success"==e.sent.status&&(t.emitAllocateTargetsChanged(),t.onCloseAllocateTargets()),e.next=9;break;case 8:swal("เกิดข้อผิดพลาด","".concat(a.message),"error");case 9:case"end":return e.stop()}}),e)})))()},onCloseAllocateTargets:function(){this.$emit("onCloseAllocateTargets")},emitAllocateTargetsChanged:function(){this.$emit("onAllocateTargetsChanged",{allocateTargets:this.allocateTargetItems})},formatNumber:function(t){return t.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")},isNumber:function(t){var e=(t=t||window.event).which?t.which:t.keyCode;if(!(e>31&&(e<48||e>57)&&46!==e))return!0;t.preventDefault()}}};var v=a(51900);const m=(0,v.Z)(f,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tw-pl-20"},[a("div",{staticClass:"table-responsive",staticStyle:{"max-height":"400px"}},[a("table",{staticClass:"table table-bordered table-sticky mb-0"},[t._m(0),t._v(" "),t.allocateTargetItems.length>0?a("tbody",[t._l(t.allocateTargetItems,(function(e,o){return[a("tr",{key:o},[a("td",{staticClass:"text-center md:tw-table-cell",staticStyle:{"border-left":"0","border-right":"0"}},[t._v("\n                            "+t._s(e.target_code)+"\n                        ")]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell",staticStyle:{"border-left":"0","border-right":"0"}},[t._v("\n                            "+t._s(e.target_code_desc)+"\n                        ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell",staticStyle:{"border-left":"0","border-right":"0"}},[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"quantity_"+o,id:"input_quantity_"+o},on:{blur:function(a){return t.onAllocateTargetQuantityChanged(e)}},model:{value:e.quantity,callback:function(a){t.$set(e,"quantity",a)},expression:"allocateTargetItem.quantity"}})],1),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell",staticStyle:{"border-left":"0","border-right":"0"}},["PRODUCT"!=t.allocateGroup||"P"!=t.costGroupCode?[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"ratio_rate_"+o,id:"input_ratio_rate_"+o},on:{blur:function(a){return t.onAllocateTargetRatioRateChanged(e)}},model:{value:e.ratio_rate,callback:function(a){t.$set(e,"ratio_rate",a)},expression:"allocateTargetItem.ratio_rate"}})]:[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?"P"==t.costGroupCode?Number.parseFloat(e.ratio_rate).toFixed(4):Number.parseFloat(e.ratio_rate).toFixed(2):""}})]],2)])]})),t._v(" "),a("tr",[a("td",{attrs:{colspan:"4"}},[a("div",{staticClass:"text-center tw-my-4"},[a("button",{staticClass:"btn btn-primary tw-w-32",attrs:{type:"button"},on:{click:t.onSubmitUpdateAllocateTargets}},[t._v(" \n                                บันทึก \n                            ")]),t._v(" "),a("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:t.onCloseAllocateTargets}},[t._v(" \n                                ยกเลิก \n                            ")])])])])],2):a("tbody",[t._m(1)])])])])}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",staticStyle:{"background-color":"#fff0e0","border-left":"0px","border-right":"0px"},attrs:{width:"20%"}},[t._v(" เป้าหมายที่รับปัน ")]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",staticStyle:{"background-color":"#fff0e0","border-left":"0px","border-right":"0px"},attrs:{width:"30%"}},[t._v(" คำอธิบาย ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",staticStyle:{"background-color":"#fff0e0","border-left":"0px","border-right":"0px"},attrs:{width:"20%"}},[t._v("  สัดส่วน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",staticStyle:{"background-color":"#fff0e0","border-left":"0px","border-right":"0px"},attrs:{width:"15%"}},[t._v(" % ")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[a("td",{attrs:{colspan:"7"}},[a("h2",{staticClass:"p-5 text-center text-muted"},[t._v("ไม่พบข้อมูล")])])])}],!1,null,null,null).exports;function C(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,o=new Array(e);a<e;a++)o[a]=t[a];return o}function w(t,e,a,o,r,s,c){try{var l=t[s](c),n=l.value}catch(t){return void a(t)}l.done?e(n):Promise.resolve(n).then(o,r)}function A(t){return function(){var e=this,a=arguments;return new Promise((function(o,r){var s=t.apply(e,a);function c(t){w(s,o,r,c,l,"next",t)}function l(t){w(s,o,r,c,l,"throw",t)}c(void 0)}))}}function y(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function x(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?y(Object(a),!0).forEach((function(e){Y(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function Y(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const G={props:["periodYearValue","allocateGroupValue","deptCodeValue","costCodeValue","costGroupCodeValue","allocateYear","allocateAccounts"],components:{Loading:c(),VueNumeric:u(),TableAllocateTargets:m},watch:{periodYearValue:function(t){this.periodYear=t},allocateGroupValue:function(t){this.allocateGroup=t},deptCodeValue:function(t){this.deptCode=t},costCodeValue:function(t){this.costCode=t},costGroupCodeValue:function(t){this.costGroupCode=t},allocateYear:function(t){this.allocateYearData=t},allocateAccounts:function(t){this.allocateAccountItems=t.map((function(t){return x(x({},t),{},{is_show_targets:!1,marked_as_deleted:!1})}))}},data:function(){return{periodYear:this.periodYearValue,allocateGroup:this.allocateGroupValue,deptCode:this.deptCodeValue,costCode:this.costCodeValue,costGroupCode:this.costGroupCodeValue,allocateYearData:this.allocateYear,allocateAccountItems:this.allocateAccounts.map((function(t){return x(x({},t),{},{is_show_targets:!1,marked_as_deleted:!1})})),allocateTargets:[],isLoading:!1}},mounted:function(){},computed:{},methods:{onGetAllocateTargets:function(t,e){var a=this;return A(r().mark((function t(){var o,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o=a.validateBeforeGetTargets(e)).valid){t.next=11;break}if(a.allocateTargets=[],s=!e.is_show_targets,e.is_show_targets=s,a.allocateAccountItems=a.allocateAccountItems.map((function(t){return x(x({},t),{},{is_show_targets:t.target_account_code==e.target_account_code&&t.is_show_targets})})),!s){t.next=9;break}return t.next=9,a.getAllocateTargets(a.allocateYearData,e);case 9:t.next=12;break;case 11:swal("เกิดข้อผิดพลาด","".concat(o.message),"error");case 12:case"end":return t.stop()}}),t)})))()},getAllocateTargets:function(t,e){var a=this;return A(r().mark((function o(){var s;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return a.isLoading=!0,s={period_year:t.period_year,version:t.version_no,allocate_group:e.allocate_group,allocate_type:e.allocate_type,dept_code:e.dept_code,cost_code:e.cost_code,target_account_code:e.target_account_code,input_allocate_year:JSON.stringify(t)},o.next=4,axios.get("/ajax/ct/allocate-ratios/targets",{params:s}).then((function(t){var e=t.data.data;return"success"==e.status?a.allocateTargets=e.allocate_targets?JSON.parse(e.allocate_targets):[]:swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน | ".concat(e.message),"error"),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน | ".concat(t.message),"error")}));case 4:a.isLoading=!1;case 5:case"end":return o.stop()}}),o)})))()},isAllowAddAllocateAccount:function(t){var e=!0;return t.filter((function(t){return t.is_new_line&&(!t.quantity||!t.ratio_rate)})).length>0&&(e=!1),e},onAddAllocateAccountItem:function(){var t=this,e=x({},this.allocateAccountItems.find((function(e,a){return a==t.allocateAccountItems.length-1})));Object.keys(e).forEach((function(t){return e[t]=null})),this.allocateAccountItems=[].concat(C(this.allocateAccountItems),[x(x({},e),{},{quantity:100,ratio_rate:100,is_new_line:!0,marked_as_deleted:!1})]),this.emitAllocateAccountsChanged()},saveAllocateAccount:function(t){var e=this;return A(r().mark((function a(){var o,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o={period_year:e.periodYear,input_allocate_year:JSON.stringify(e.allocateYear),input_allocate_account:JSON.stringify(t)},e.isLoading=!0,!(s=e.validateBeforeSaveGroup(t)).valid){a.next=8;break}return a.next=6,axios.post("/ajax/ct/allocate-ratios/account",o).then((function(e){var a=e.data.data,o=a.message;return a.status,"error"==a.status&&swal("เกิดข้อผิดพลาด","บันทึกข้อมูลบัญชีที่รับปัน : ".concat(t.target_account_code," | ").concat(o),"error"),a})).catch((function(e){console.log(e),swal("เกิดข้อผิดพลาด","บันทึกข้อมูลบัญชีที่รับปัน : ".concat(t.target_account_code," | ").concat(e.message),"error")}));case 6:a.next=9;break;case 8:swal("เกิดข้อผิดพลาด","บันทึกข้อมูลบัญชีที่รับปัน : ".concat(t.target_account_code," | ").concat(s.message),"error");case 9:e.isLoading=!1;case 10:case"end":return a.stop()}}),a)})))()},onDeleteAllocateAccountItem:function(t,e){var a=this;swal({title:"",text:"ต้องการลบรายการบัญชี ".concat(e.target_acc_code).concat(e.target_sub_acc_code," : ").concat(e.target_sub_acc_code_desc," ?"),showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",closeOnConfirm:!0},(function(t){t&&(e.marked_as_deleted=!0,a.deleteAllocateAccount(e))}))},deleteAllocateAccount:function(t){var e=this;return A(r().mark((function a(){var o;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o={period_year:e.periodYear,input_allocate_year:JSON.stringify(e.allocateYear),input_allocate_account:JSON.stringify(t)},e.isLoading=!0,a.next=4,axios.post("/ajax/ct/allocate-ratios/delete-account",o).then((function(e){var a=e.data.data,o=a.message;return"success"==a.status&&swal("Success","ลบข้อมูลบัญชีที่รับปัน : ".concat(t.target_account_code," )"),"success"),"error"==a.status&&swal("เกิดข้อผิดพลาด","ลบข้อมูลบัญชีที่รับปัน : ".concat(t.target_account_code," | ").concat(o),"error"),a})).catch((function(e){console.log(e),swal("เกิดข้อผิดพลาด","ลบข้อมูลบัญชีที่รับปัน : ".concat(t.target_account_code," | ").concat(e.message),"error")}));case 4:e.isLoading=!1;case 5:case"end":return a.stop()}}),a)})))()},validateBeforeGetTargets:function(t){var e={valid:!0,message:""};return t.quantity&&t.ratio_rate||(e.valid=!1,e.message="กรอกข้อมูลรายการบัญชีที่รับปันไม่ครบถ้วน กรุณาตรวจสอบ"),e},validateBeforeSaveGroup:function(t){var e={valid:!0,message:""};return t.quantity&&t.ratio_rate||(e.valid=!1,e.message="กรอกข้อมูลรายการกำหนดเกณฑ์การปันส่วนไม่ครบถ้วน กรุณาตรวจสอบ"),e},onAllocateAccountQuantityChanged:function(t){var e=this;return A(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.ratio_rate=t.quantity,a.next=3,e.saveAllocateAccount(t);case 3:e.emitAllocateAccountsChanged();case 4:case"end":return a.stop()}}),a)})))()},onAllocateAccountRatioRateChanged:function(t){var e=this;return A(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.quantity=t.ratio_rate,a.next=3,e.saveAllocateAccount(t);case 3:e.emitAllocateAccountsChanged();case 4:case"end":return a.stop()}}),a)})))()},onAllocateTargetsChanged:function(t){this.allocateTargets=t.allocateTargets},onCloseAllocateTargets:function(){this.allocateAccountItems=this.allocateAccountItems.map((function(t){return x(x({},t),{},{is_show_targets:!1})}))},emitAllocateAccountsChanged:function(){this.$emit("onAllocateAccountsChanged",{allocateAccounts:this.allocateAccountItems})},formatNumber:function(t){return t.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")},isNumber:function(t){var e=(t=t||window.event).which?t.which:t.keyCode;if(!(e>31&&(e<48||e>57)&&46!==e))return!0;t.preventDefault()}}};const T=(0,v.Z)(G,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("h4",[t._v(" บัญชีที่รับปัน ")]),t._v(" "),a("div",{staticClass:"table-responsive",staticStyle:{"max-height":"600px"}},[a("table",{staticClass:"table table-bordered table-sticky mb-0"},[t._m(0),t._v(" "),t.allocateAccountItems.length>0?a("tbody",[t._l(t.allocateAccountItems,(function(e,o){return[e.marked_as_deleted?t._e():a("tr",{key:o},[a("td",{staticClass:"text-center md:tw-table-cell"},[t._v("\n                            "+t._s(e.target_acc_code)+"\n                        ")]),t._v(" "),a("td",{staticClass:"text-center md:tw-table-cell"},[t._v("\n                            "+t._s(e.target_sub_acc_code)+"\n                        ")]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell"},[t._v("\n                            "+t._s(e.target_sub_acc_code_desc)+"\n                        ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell"},[e.is_show_targets?a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"quantity",id:"input_quantity",disabled:""},domProps:{value:e.quantity?Number.parseFloat(e.quantity).toFixed(2):""}})]):a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"quantity_"+o,id:"input_quantity_"+o},on:{blur:function(a){return t.onAllocateAccountQuantityChanged(e)}},model:{value:e.quantity,callback:function(a){t.$set(e,"quantity",a)},expression:"allocateAccountItem.quantity"}})],1)]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell"},[e.is_show_targets?a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?Number.parseFloat(e.ratio_rate).toFixed(2):""}})]):a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"ratio_rate_"+o,id:"input_ratio_rate_"+o},on:{blur:function(a){return t.onAllocateAccountRatioRateChanged(e)}},model:{value:e.ratio_rate,callback:function(a){t.$set(e,"ratio_rate",a)},expression:"allocateAccountItem.ratio_rate"}})],1)]),t._v(" "),a("td",{staticClass:"text-center text-nowrap"},[a("button",{staticClass:"btn btn-inline-block btn-xs btn-white",on:{click:function(a){return t.onGetAllocateTargets(a,e)}}},[a("i",{staticClass:"fa fa-list tw-mr-1"}),t._v(" เป้าหมายที่รับปัน\n                            ")])]),t._v(" "),a("td",{staticClass:"text-center text-nowrap"},[a("button",{staticClass:"btn btn-inline-block btn-xs btn-danger",on:{click:function(a){return t.onDeleteAllocateAccountItem(a,e)}}},[a("i",{staticClass:"fa fa-times"})])])]),t._v(" "),!e.marked_as_deleted&&e.is_show_targets?a("tr",{key:"targets_"+o},[a("td",{attrs:{colspan:"7"}},[a("table-allocate-targets",{attrs:{"period-year-value":t.periodYear,"allocate-group-value":t.allocateGroup,"dept-code-value":t.deptCode,"cost-code-value":t.costCode,"cost-group-code-value":t.costGroupCode,"allocate-year":t.allocateYearData,"allocate-account-item":e,"target-account-code":e.target_account_code,"allocate-targets":t.allocateTargets},on:{onAllocateTargetsChanged:t.onAllocateTargetsChanged,onCloseAllocateTargets:t.onCloseAllocateTargets}})],1)]):t._e()]}))],2):a("tbody",[t._m(1)])])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}})],1)}),[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" รหัสบัญชี ")]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" รหัสบัญชีย่อย ")]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"25%"}},[t._v(" ชื่อบัญชี ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" สัดส่วน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" % ")]),t._v(" "),a("th",{attrs:{width:"15%"}}),t._v(" "),a("th",{attrs:{width:"5%"}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[a("td",{attrs:{colspan:"7"}},[a("h2",{staticClass:"p-5 text-center text-muted"},[t._v("ไม่พบข้อมูล")])])])}],!1,null,null,null).exports;function P(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function k(t,e,a,o,r,s,c){try{var l=t[s](c),n=l.value}catch(t){return void a(t)}l.done?e(n):Promise.resolve(n).then(o,r)}function O(t){return function(){var e=this,a=arguments;return new Promise((function(o,r){var s=t.apply(e,a);function c(t){k(s,o,r,c,l,"next",t)}function l(t){k(s,o,r,c,l,"throw",t)}c(void 0)}))}}const V={props:["modalName","modalWidth","modalHeight","organizationCode","listAllocateGroups","allocateGroupValue","periodYears","periodYearValue","allocateYearVersionValue","accountCodes"],components:{Loading:c()},watch:{periodYears:function(t){this.periodYearOptions=t},periodYearValue:function(t){this.periodYearLabel=this.getPeriodYearLabel(this.periodYearOptions,t),this.periodYearLabel&&(this.periodYear=t,this.getAllocateYearData(this.periodYear),this.getDeptCodes(this.periodYear,this.allocateGroup),this.getCostCodes(this.periodYear))},allocateGroupValue:function(t){this.allocateGroup=t,this.allocateGroupLevel=this.getAllocateGroupLevel(this.listAllocateGroups,t),this.allocateGroupLabel=this.getAllocateGroupLabel(this.listAllocateGroups,t),this.getDeptCodes(this.periodYear,this.allocateGroup)},allocateYearVersionValue:function(t){this.allocateYearVersion=t},accountCodes:function(t){this.accountCodeOptions=t}},data:function(){return{isLoading:!1,width:this.modalWidth,periodYear:this.periodYearValue,periodYearLabel:this.getPeriodYearLabel(this.periodYears,this.periodYearValue),periodYearOptions:this.periodYears,allocateYearVersion:this.allocateYearVersionValue,allocateYearVersionOptions:[],allocateGroup:this.allocateGroupValue,allocateGroupLevel:this.getAllocateGroupLevel(this.listAllocateGroups,this.allocateGroupValue),allocateGroupLabel:this.getAllocateGroupLabel(this.listAllocateGroups,this.allocateGroupValue),deptCodeOptions:[],deptCode:null,costCodeOptions:[],costCode:null,costGroupCode:null,accountCodeOptions:this.accountCodes,transferAccountCode:null}},created:function(){this.handleResize()},mounted:function(){this.periodYearOptions=this.periodYears,this.periodYearLabel=this.getPeriodYearLabel(this.periodYears,this.periodYearValue),this.periodYearLabel&&(this.periodYear=this.periodYearValue,this.getAllocateYearData(this.periodYear),this.getDeptCodes(this.periodYear,this.allocateGroup),this.getCostCodes(this.periodYear))},methods:{handleResize:function(){window.innerWidth<768?this.width="90%":window.innerWidth<992?this.width="80%":this.width=this.modalWidth},onPeriodYearChanged:function(t){var e=this;return O(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.periodYear=t,e.periodYearLabel=e.getPeriodYearLabel(e.periodYearOptions,e.periodYear),e.getAllocateYearData(e.periodYear),e.getDeptCodes(e.periodYear,e.allocateGroup),e.getCostCodes(e.periodYear);case 5:case"end":return a.stop()}}),a)})))()},onListAllocateGroupChanged:function(t){var e=this;return O(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.allocateGroup=t,e.allocateGroupLevel=e.getAllocateGroupLevel(e.listAllocateGroups,t),e.allocateGroupLabel=e.getAllocateGroupLabel(e.listAllocateGroups,t),e.getDeptCodes(e.periodYear,e.allocateGroup),"DEPT"!=e.allocateGroup&&"COST"!=e.allocateGroup||(e.costCode=null,e.costGroupCode=null),"PRODUCT"==e.allocateGroup&&(e.deptCode=null);case 6:case"end":return a.stop()}}),a)})))()},onDeptCodeChanged:function(t){var e=this;return O(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.deptCode=t;case 1:case"end":return a.stop()}}),a)})))()},onCostCodeChanged:function(t){var e=this;return O(r().mark((function a(){var o;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.costCode=t,o=e.costCodeOptions.find((function(e){return e.cost_code_value==t})),e.costGroupCode=o?o.cost_group_code:null;case 3:case"end":return a.stop()}}),a)})))()},onTransferAccountCodeChanged:function(t){var e=this;return O(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.transferAccountCode=t;case 1:case"end":return a.stop()}}),a)})))()},getAllocateGroupLevel:function(t,e){var a=t.find((function(t){return t.allocate_group==e}));return a?a.level_no:""},getAllocateGroupLabel:function(t,e){var a=t.find((function(t){return t.allocate_group==e}));return a?a.allocate_group_label:""},onAllocateYearVersionChanged:function(t){this.allocateYearVersion=t},getPeriodYearLabel:function(t,e){var a=null;return t&&e&&t.length>0&&(a=t.find((function(t){return t.period_year_value==e}))),a?a.period_year_label:""},getAllocateYearData:function(t){var e=this;return O(r().mark((function a(){var o,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.isLoading=!0,e.allocateYearVersionOptions=[],o={period_year:t,version:null},s=null,e.periodYearOptions&&t&&e.periodYearOptions.length>0&&(s=e.periodYearOptions.find((function(e){return e.period_year_value==t}))),!s){a.next=8;break}return a.next=8,axios.get("/ajax/ct/allocate-ratios/year",{params:o}).then((function(t){var a=t.data.data;return"error"==a.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลปันส่วนของปีปัญชี ไม่ถูกต้อง | ".concat(a.message),"error"):e.allocateYearVersionOptions=a.versions?JSON.parse(a.versions):[],a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลปันส่วนของปีปัญชี ไม่ถูกต้อง | ".concat(t.message),"error")}));case 8:e.isLoading=!1;case 9:case"end":return a.stop()}}),a)})))()},getDeptCodes:function(t,e){var a=this;return O(r().mark((function o(){var s,c;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a.isLoading=!0,a.deptCodeOptions=[],s={period_year:t,allocate_group:e,only_exist:!0},c=null,a.periodYearOptions&&t&&a.periodYearOptions.length>0&&(c=a.periodYearOptions.find((function(e){return e.period_year_value==t}))),!c){o.next=8;break}return o.next=8,axios.get("/ajax/ct/allocate-ratios/dept-codes",{params:s}).then((function(t){var e=t.data.data;return"error"==e.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(e.message),"error"):a.deptCodeOptions=e.dept_codes?JSON.parse(e.dept_codes):[],e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(t.message),"error")}));case 8:a.isLoading=!1;case 9:case"end":return o.stop()}}),o)})))()},getCostCodes:function(t){var e=this;return O(r().mark((function a(){var o,s;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.isLoading=!0,e.costCodeOptions=[],o={period_year:t,only_exist:!0},s=null,e.periodYearOptions&&t&&e.periodYearOptions.length>0&&(s=e.periodYearOptions.find((function(e){return e.period_year_value==t}))),!s){a.next=8;break}return a.next=8,axios.get("/ajax/ct/allocate-ratios/cost-codes",{params:o}).then((function(t){var a=t.data.data;return"error"==a.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(a.message),"error"):e.costCodeOptions=a.cost_codes?JSON.parse(a.cost_codes):[],a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(t.message),"error")}));case 8:e.isLoading=!1;case 9:case"end":return a.stop()}}),a)})))()},onSearchAllocateYearVersion:function(){var t;this.$modal.hide(this.modalName),this.$emit("onSearchAllocateYearVersion",(P(t={period_year:this.periodYear,version_no:this.allocateYearVersion,allocate_group:this.allocateGroup},"allocate_group",this.allocateGroup),P(t,"dept_code",this.deptCode),P(t,"cost_code",this.costCode),P(t,"cost_group_code",this.costGroupCode),P(t,"transfer_account_code",this.transferAccountCode),t))}}};var S=a(93379),L=a.n(S),D=a(61075),I={insert:"head",singleton:!1};L()(D.Z,I);D.Z.locals;const q=(0,v.Z)(V,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"fixed","z-index":"100"}},[a("modal",{attrs:{name:t.modalName,width:t.width,scrollable:!0,height:t.modalHeight,shiftX:.3,shiftY:.3}},[a("div",{staticClass:"p-4"},[a("h4",[t._v(" ค้นหากำหนดเกณฑ์การปันส่วน ")]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ปีบัญชี ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"period_year",id:"input_period_year","select-options":t.periodYearOptions,"option-key":"period_year_value","option-value":"period_year_value","option-label":"period_year_label",value:t.periodYear,filterable:!0},on:{onSelected:t.onPeriodYearChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" ครั้งที่ ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"yearly_plan_version",id:"input_yearly_plan_version","select-options":t.allocateYearVersionOptions,"option-key":"version_no","option-value":"version_no","option-label":"version_no",value:t.allocateYearVersion,filterable:!0},on:{onSelected:t.onAllocateYearVersionChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ประเภทการปัน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"allocate_group",id:"input_allocate_group","select-options":t.listAllocateGroups,"option-key":"allocate_group_value","option-value":"allocate_group_value","option-label":"allocate_group_full_label",value:t.allocateGroup,filterable:!0},on:{onSelected:t.onListAllocateGroupChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},["DEPT"==t.allocateGroup||"COST"==t.allocateGroup?[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" หน่วยงานที่ปัน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"dept_code",id:"input_dept_code","select-options":t.deptCodeOptions,"option-key":"dept_code_value","option-value":"dept_code_value","option-label":"dept_code_label",value:t.deptCode,filterable:!0},on:{onSelected:t.onDeptCodeChanged}})],1)]:"PRODUCT"==t.allocateGroup?[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ศูนย์ต้นทุน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"cost_code",id:"input_cost_code","select-options":t.costCodeOptions,"option-key":"cost_code_value","option-value":"cost_code_value","option-label":"cost_code_label",value:t.costCode,filterable:!0},on:{onSelected:t.onCostCodeChanged}})],1)]:[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" หน่วยงานที่ปัน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("input",{staticClass:"input-sm form-control",attrs:{type:"text",name:"cost_code",id:"input_cost_code",disabled:""}})])]],2),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" บัญชีที่รับโอน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"transfer_account_code",id:"input_transfer_account_code","select-options":t.accountCodeOptions,"option-key":"account_code_value","option-value":"account_code_value","option-label":"account_code_label",value:t.transferAccountCode,filterable:!0},on:{onSelected:t.onTransferAccountCodeChanged}})],1)]),t._v(" "),a("div",{staticClass:"text-right tw-mt-8"},[a("button",{staticClass:"btn btn-primary tw-w-32",attrs:{type:"button",disabled:!t.periodYear||!t.allocateYearVersion},on:{click:t.onSearchAllocateYearVersion}},[t._v(" \n                    เลือก \n                ")]),t._v(" "),a("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$modal.hide(t.modalName)}}},[t._v(" \n                    ยกเลิก \n                ")])])])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}})],1)}),[],!1,null,"52c0bcaf",null).exports;function N(t,e,a,o,r,s,c){try{var l=t[s](c),n=l.value}catch(t){return void a(t)}l.done?e(n):Promise.resolve(n).then(o,r)}function R(t){return function(){var e=this,a=arguments;return new Promise((function(o,r){var s=t.apply(e,a);function c(t){N(s,o,r,c,l,"next",t)}function l(t){N(s,o,r,c,l,"throw",t)}c(void 0)}))}}const j={props:["modalName","modalWidth","modalHeight","organizationCode","planHeader","listAllocateGroups","allocateGroupValue","periodYears","periodYearValue","toAllocateYearVersionValue"],components:{Loading:c()},watch:{periodYears:function(t){this.fromPeriodYearOptions=t,this.toPeriodYearOptions=t},periodYearValue:function(t){this.fromPeriodYear=(parseInt(t)-1).toString(),this.fromPeriodYearLabel=this.getPeriodYearLabel(this.periodYears,this.fromPeriodYear),this.toPeriodYear=t,this.toPeriodYearLabel=this.getPeriodYearLabel(this.periodYears,this.toPeriodYear),this.getAllocateYearData(this.fromPeriodYear,"from"),this.getAllocateYearData(this.toPeriodYear,"to")},toAllocateYearVersionValue:function(t){this.toAllocateYearVersion=t}},mounted:function(){this.periodYearValue&&(this.fromPeriodYear=(parseInt(this.periodYearValue)-1).toString(),this.fromPeriodYearLabel=this.getPeriodYearLabel(this.periodYears,this.fromPeriodYear),this.toPeriodYear=this.periodYearValue,this.toPeriodYearLabel=this.getPeriodYearLabel(this.periodYears,this.toPeriodYear),this.getAllocateYearData(this.fromPeriodYear,"from"),this.getAllocateYearData(this.toPeriodYear,"to"))},data:function(){return{isLoading:!1,width:this.modalWidth,fromPeriodYearOptions:this.periodYears,toPeriodYearOptions:this.periodYears,fromPeriodYear:this.periodYearValue?(parseInt(this.periodYearValue)-1).toString():null,fromPeriodYearLabel:this.periodYearValue?this.getPeriodYearLabel(this.periodYears,(parseInt(this.periodYearValue)-1).toString()):"",fromAllocateYearVersionOptions:[],fromAllocateYearVersion:null,toPeriodYear:this.periodYearValue,toPeriodYearLabel:this.getPeriodYearLabel(this.periodYears,this.periodYearValue),toAllocateYearVersion:null,toAllocateYearVersionOptions:[]}},created:function(){this.handleResize()},methods:{handleResize:function(){window.innerWidth<768?this.width="90%":window.innerWidth<992?this.width="80%":this.width=this.modalWidth},onFromPeriodYearChanged:function(t){var e=this;return R(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.fromPeriodYear=t,e.fromPeriodYearLabel=e.getPeriodYearLabel(e.fromPeriodYearOptions,e.fromPeriodYear),a.next=4,e.getAllocateYearData(e.fromPeriodYear,"from");case 4:case"end":return a.stop()}}),a)})))()},onToPeriodYearChanged:function(t){var e=this;return R(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.toPeriodYear=t,e.toPeriodYearLabel=e.getPeriodYearLabel(e.toPeriodYearOptions,e.toPeriodYear),a.next=4,e.getAllocateYearData(e.toPeriodYear,"to");case 4:case"end":return a.stop()}}),a)})))()},onFromAllocateYearVersionChanged:function(t){this.fromAllocateYearVersion=t},getPeriodYearLabel:function(t,e){var a=t.find((function(t){return t.period_year_value==e}));return a?a.period_year_label:""},getAllocateYearData:function(t,e){var a=this;return R(r().mark((function o(){var s;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a.isLoading=!0,"from"==e?a.fromAllocateYearVersionOptions=[]:a.toAllocateYearVersionOptions=[],s={period_year:t,version:null},!t){o.next=6;break}return o.next=6,axios.get("/ajax/ct/allocate-ratios/year",{params:s}).then((function(t){var o=t.data.data;return"error"==o.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลปันส่วนของปีปัญชี ไม่ถูกต้อง | ".concat(o.message),"error"):"from"==e?(a.fromAllocateYearVersionOptions=o.versions?JSON.parse(o.versions):[],a.fromAllocateYearVersionOptions.length>0&&(a.fromAllocateYearVersion=a.fromAllocateYearVersionOptions[0].version_no)):(a.toAllocateYearVersionOptions=o.versions?JSON.parse(o.versions):[],a.toAllocateYearVersionOptions.length>0?a.toAllocateYearVersion=(parseInt(a.toAllocateYearVersionOptions[0].version_no)+1).toString():a.toAllocateYearVersion=1),o})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลปันส่วนของปีปัญชี ไม่ถูกต้อง | ".concat(t.message),"error")}));case 6:a.isLoading=!1;case 7:case"end":return o.stop()}}),o)})))()},onCopyAllocateYearNewVersion:function(){this.$modal.hide(this.modalName),this.$emit("onCopyAllocateYearNewVersion",{from_period_year:this.fromPeriodYear,from_version_no:this.fromAllocateYearVersion,to_period_year:this.toPeriodYear,to_version_no:this.toAllocateYearVersion})}}};var $=a(9348),F={insert:"head",singleton:!1};L()($.Z,F);$.Z.locals;const B=(0,v.Z)(j,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"fixed","z-index":"100"}},[a("modal",{attrs:{name:t.modalName,width:t.width,scrollable:!0,height:t.modalHeight,shiftX:.3,shiftY:.3}},[a("div",{staticClass:"p-4"},[a("h4",[t._v(" คัดลอกข้อมูล ")]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"tw-p-4 tw-bg-yellow-100"},[a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" จาก ปีบัญชี ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"from_period_year",id:"input_from_period_year","select-options":t.fromPeriodYearOptions,"option-key":"period_year_value","option-value":"period_year_value","option-label":"period_year_label",value:t.fromPeriodYear,filterable:!0},on:{onSelected:t.onFromPeriodYearChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" ครั้งที่ ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"from_allocate_year_version",id:"input_from_allocate_year_version","select-options":t.fromAllocateYearVersionOptions,"option-key":"version_no","option-value":"version_no","option-label":"version_no",value:t.fromAllocateYearVersion,filterable:!0},on:{onSelected:t.onFromAllocateYearVersionChanged}})],1)])]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"tw-p-4"},[a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ไปที่ ปีบัญชี ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"to_period_year",id:"input_to_period_year","select-options":t.toPeriodYearOptions,"option-key":"period_year_value","option-value":"period_year_value","option-label":"period_year_label",value:t.toPeriodYear,filterable:!0},on:{onSelected:t.onToPeriodYearChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" ครั้งที่ ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.toAllocateYearVersion,expression:"toAllocateYearVersion"}],staticClass:"input-sm form-control",attrs:{type:"text",name:"to_allocate_year_version",id:"input_to_allocate_year_version",disabled:""},domProps:{value:t.toAllocateYearVersion},on:{input:function(e){e.target.composing||(t.toAllocateYearVersion=e.target.value)}}})])])]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"text-right tw-mt-4"},[a("button",{staticClass:"btn btn-primary tw-w-32",attrs:{type:"button",disabled:!(t.fromPeriodYear&&t.toPeriodYear&&t.fromAllocateYearVersion&&t.toAllocateYearVersion)},on:{click:t.onCopyAllocateYearNewVersion}},[t._v(" \n                    เลือก \n                ")]),t._v(" "),a("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$modal.hide(t.modalName)}}},[t._v(" \n                    ยกเลิก \n                ")])])])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}})],1)}),[],!1,null,"1e322f7a",null).exports;function J(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function E(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?J(Object(a),!0).forEach((function(e){U(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function U(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const z={props:["modalName","modalWidth","modalHeight","organizationCode","planHeader","periodYears","periodYearValue","allocateGroupValue","allocateGroupLevelValue","deptCodeValue","costCodeValue","costGroupCodeValue","targetAccounts","allocateAccounts"],components:{VueNumeric:u(),Loading:c()},watch:{planHeader:function(t){this.planHeaderData=t},periodYears:function(t){this.periodYearOptions=t},periodYearValue:function(t){this.periodYear=t,this.periodYearLabel=this.getPeriodYearLabel(this.periodYearOptions,t)},allocateGroupValue:function(t){this.allocateGroup=t,this.selectAll=!1},allocateGroupLevelValue:function(t){this.allocateGroupLevel=t},deptCodeValue:function(t){this.deptCode=t,this.selectAll=!1},costCodeValue:function(t){this.costCode=t,this.selectAll=!1},costGroupCodeValue:function(t){this.costGroupCode=t},targetAccounts:function(t){this.targetAccountItems=t,this.availableTargetAccountItems=this.getAvailableTargetAccountItems(t,this.allocateAccountItems)},allocateAccounts:function(t){this.allocateAccountItems=t,this.availableTargetAccountItems=this.getAvailableTargetAccountItems(this.targetAccountItems,t)}},data:function(){return{isLoading:!1,width:this.modalWidth,selectAll:!1,planHeaderData:this.planHeader,periodYear:this.periodYearValue,periodYearLabel:this.getPeriodYearLabel(this.periodYears,this.periodYearValue),periodYearOptions:this.periodYears,allocateGroup:this.allocateGroupValue,allocateGroupLevel:this.allocateGroupLevelValue,deptCode:this.deptCodeValue,costCode:this.costCodeValue,costGroupCode:this.costGroupCodeValue,targetAccountItems:this.targetAccounts,allocateAccountItems:this.allocateAccounts,availableTargetAccountItems:this.getAvailableTargetAccountItems(this.targetAccounts,this.allocateAccounts)}},created:function(){this.handleResize()},mounted:function(){this.selectAll=!1},methods:{handleResize:function(){window.innerWidth<768?this.width="90%":window.innerWidth<992?this.width="80%":this.width=this.modalWidth},onSelectAll:function(t,e){var a=this;this.availableTargetAccountItems=e.map((function(t){return E(E({},t),{},{selected:a.selectAll})}))},onToggleSelection:function(t,e){},getAvailableTargetAccountItems:function(t,e){var a=e.map((function(t){return t.target_account_code}));return t.filter((function(t){return!a.find((function(e){return e=="".concat(t.acc_code).concat(t.sub_acc_code)}))})).map((function(t){return E(E({},t),{},{target_account_code:t.target_account_code?t.target_account_code:"".concat(t.acc_code).concat(t.sub_acc_code),target_acc_code:t.target_acc_code?t.target_acc_code:t.acc_code,target_acc_code_desc:t.target_acc_code_desc?t.target_acc_code_desc:t.acc_code_desc,target_sub_acc_code:t.target_sub_acc_code?t.target_sub_acc_code:t.sub_acc_code,target_sub_acc_code_desc:t.target_sub_acc_code_desc?t.target_sub_acc_code_desc:t.sub_acc_code_desc,selected:!1,quantity:100,ratio_rate:100})}))},getPeriodYearLabel:function(t,e){var a=t.find((function(t){return t.period_year_value==e}));return a?a.period_year_label:""},onTargetAccountItemChanged:function(t){},onTargetAccountQtyChanged:function(t){t.ratio_rate=t.quantity},onTargetAccountRatioRateChanged:function(t){t.quantity=t.ratio_rate},onSubmitCreateAllocateAccounts:function(){this.$modal.hide(this.modalName);var t=this.availableTargetAccountItems.filter((function(t){return t.selected}));this.$emit("onSubmitCreateAllocateAccounts",{period_year:this.periodYear,version:this.allocateRatioVersion,targetAccounts:t})}}};var W=a(14185),H={insert:"head",singleton:!1};L()(W.Z,H);W.Z.locals;const Z=(0,v.Z)(z,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"fixed","z-index":"100"}},[a("modal",{attrs:{name:t.modalName,width:t.width,scrollable:!0,height:t.modalHeight,shiftX:.3,shiftY:.3}},[a("div",{staticClass:"p-4"},[a("h4",[t._v(" สร้างรายการบัญชี ")]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"table-responsive",staticStyle:{"max-height":"300px"}},[a("table",{staticClass:"table table-bordered table-sticky mb-0"},[a("thead",[a("tr",[a("th",{staticClass:"text-center md:tw-table-cell",attrs:{width:"10%"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.selectAll,expression:"selectAll"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(t.selectAll)?t._i(t.selectAll,null)>-1:t.selectAll},on:{change:[function(e){var a=t.selectAll,o=e.target,r=!!o.checked;if(Array.isArray(a)){var s=t._i(a,null);o.checked?s<0&&(t.selectAll=a.concat([null])):s>-1&&(t.selectAll=a.slice(0,s).concat(a.slice(s+1)))}else t.selectAll=r},function(e){return t.onSelectAll(e,t.availableTargetAccountItems)}]}})]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" รหัสบัญชี ")]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell tw-hidden",attrs:{width:"10%"}},[t._v(" รหัสบัญชีย่อย ")]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"30%"}},[t._v(" ชื่อบัญชี ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" สัดส่วน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v(" % ")])])]),t._v(" "),a("tbody",[t.allocateAccountItems.length>0?[t._l(t.allocateAccountItems,(function(e,o){return[a("tr",{key:"allocate_"+o},[a("td",{staticClass:"text-center md:tw-table-cell"},[a("i",{staticClass:"fa fa-check-square",staticStyle:{"font-size":"1rem"}})]),t._v(" "),a("td",{staticClass:"text-center md:tw-table-cell"},[t._v("\n                                        "+t._s(e.target_acc_code)+"\n                                    ")]),t._v(" "),a("td",{staticClass:"text-center md:tw-table-cell tw-hidden"},[t._v("\n                                        "+t._s(e.target_sub_acc_code)+"\n                                    ")]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell"},[t._v("\n                                        "+t._s(e.target_sub_acc_code_desc)+"\n                                    ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell"},[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"quantity",id:"input_quantity",disabled:""},domProps:{value:e.quantity?Number.parseFloat(e.quantity).toFixed(2):""}})]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell"},[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?Number.parseFloat(e.ratio_rate).toFixed(2):""}})])])]}))]:t._e(),t._v(" "),t.availableTargetAccountItems.length>0?[t._l(t.availableTargetAccountItems,(function(e,o){return[a("tr",{key:o},[a("td",{staticClass:"text-center md:tw-table-cell"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"availableTargetAccountItem.selected"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(e.selected)?t._i(e.selected,null)>-1:e.selected},on:{change:[function(a){var o=e.selected,r=a.target,s=!!r.checked;if(Array.isArray(o)){var c=t._i(o,null);r.checked?c<0&&t.$set(e,"selected",o.concat([null])):c>-1&&t.$set(e,"selected",o.slice(0,c).concat(o.slice(c+1)))}else t.$set(e,"selected",s)},function(a){return t.onToggleSelection(a,e)}]}})]),t._v(" "),a("td",{staticClass:"text-center md:tw-table-cell"},[t._v("\n                                        "+t._s(e.target_acc_code)+"\n                                    ")]),t._v(" "),a("td",{staticClass:"text-center md:tw-table-cell tw-hidden"},[t._v("\n                                        "+t._s(e.target_sub_acc_code)+"\n                                    ")]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell"},[t._v("\n                                        "+t._s(e.target_sub_acc_code_desc)+"\n                                    ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell"},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"quantity_"+o,id:"input_quantity_"+o},on:{blur:function(a){return t.onTargetAccountQtyChanged(e)}},model:{value:e.quantity,callback:function(a){t.$set(e,"quantity",a)},expression:"availableTargetAccountItem.quantity"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"quantity",id:"input_quantity",disabled:""},domProps:{value:e.quantity?Number.parseFloat(e.quantity).toFixed(2):""}})])]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell"},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"ratio_rate_"+o,id:"input_ratio_rate_"+o},on:{blur:function(a){return t.onTargetAccountRatioRateChanged(e)}},model:{value:e.ratio_rate,callback:function(a){t.$set(e,"ratio_rate",a)},expression:"availableTargetAccountItem.ratio_rate"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?Number.parseFloat(e.ratio_rate).toFixed(2):""}})])])])]}))]:t._e()],2)])]),t._v(" "),a("div",{staticClass:"text-right tw-mt-8"},[a("button",{staticClass:"btn btn-primary tw-w-32",attrs:{type:"button"},on:{click:t.onSubmitCreateAllocateAccounts}},[t._v(" \n                    บันทึก \n                ")]),t._v(" "),a("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$modal.hide(t.modalName)}}},[t._v(" \n                    ยกเลิก \n                ")])])])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}})],1)}),[],!1,null,"8a93200e",null).exports;function Q(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function M(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(a),!0).forEach((function(e){K(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Q(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function K(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const X={props:["modalName","modalWidth","modalHeight","organizationCode","planHeader","periodYears","periodYearValue","allocateGroupValue","allocateGroupLevelValue","deptCodeValue","costCodeValue","costGroupCodeValue","targetDeptCodes","targetCostCodes","targetProductGroups","previousAllocateTargets"],components:{VueNumeric:u(),Loading:c()},watch:{planHeader:function(t){this.planHeaderData=t},periodYears:function(t){this.periodYearOptions=t},periodYearValue:function(t){this.periodYear=t,this.periodYearLabel=this.getPeriodYearLabel(this.periodYearOptions,t)},allocateGroupValue:function(t){this.allocateGroup=t,this.selectAll=!1},allocateGroupLevelValue:function(t){this.allocateGroupLevel=t},deptCodeValue:function(t){this.deptCode=t,this.selectAll=!1},costCodeValue:function(t){this.costCode=t,this.selectAll=!1},costGroupCodeValue:function(t){this.costGroupCode=t},targetDeptCodes:function(t){var e=this;this.targetDeptCodeItems=t?t.map((function(t){var a=e.previousAllocateTargets.find((function(e){return e.target_dept_code==t.dept_code}));return M(M({},t),{},{target_dept_code:t.target_dept_code?t.target_dept_code:t.dept_code,selected:!!a,quantity:a?a.quantity:0,ratio_rate:a?a.ratio_rate:0})})):[]},targetCostCodes:function(t){var e=this;this.targetCostCodeItems=t?t.map((function(t){var a=e.previousAllocateTargets.find((function(e){return e.target_cost_code==t.cost_code}));return M(M({},t),{},{target_cost_code:t.target_cost_code?t.target_cost_code:t.cost_code,selected:!!a,quantity:a?a.quantity:0,ratio_rate:a?a.ratio_rate:0})})):[]},targetProductGroups:function(t){var e=this;this.targetProductGroupItems=t?t.map((function(t){var a=e.previousAllocateTargets.find((function(e){return e.target_product_group==t.product_group}));return M(M({},t),{},{target_product_group:t.target_product_group?t.target_product_group:t.product_group,selected:!!a,quantity:a?a.quantity:t.quantity,ratio_rate:a?a.ratio_rate:t.ratio_rate})})):[]},previousAllocateTargets:function(t){"DEPT"==this.allocateGroup?this.targetDeptCodeItems=this.targetDeptCodeItems?this.targetDeptCodeItems.map((function(e){var a=t.find((function(t){return t.target_dept_code==e.dept_code}));return M(M({},e),{},{target_dept_code:e.target_dept_code?e.target_dept_code:e.dept_code,selected:!!a,quantity:a?a.quantity:0,ratio_rate:a?a.ratio_rate:0})})):[]:"COST"==this.allocateGroup?this.targetCostCodeItems=this.targetCostCodeItems?this.targetCostCodeItems.map((function(e){var a=t.find((function(t){return t.target_cost_code==e.cost_code}));return M(M({},e),{},{target_cost_code:e.target_cost_code?e.target_cost_code:e.cost_code,selected:!!a,quantity:a?a.quantity:0,ratio_rate:a?a.ratio_rate:0})})):[]:"PRODUCT"==this.allocateGroup&&(this.targetProductGroupItems=this.targetProductGroupItems?this.targetProductGroupItems.map((function(e){var a=t.find((function(t){return t.target_product_group==e.product_group}));return M(M({},e),{},{target_product_group:e.target_product_group?e.target_product_group:e.product_group,selected:!!a,quantity:a?a.quantity:e.quantity,ratio_rate:a?a.ratio_rate:e.ratio_rate})})):[])}},data:function(){var t=this;return{isLoading:!1,width:this.modalWidth,keyword:"",selectAll:!1,planHeaderData:this.planHeader,periodYear:this.periodYearValue,periodYearLabel:this.getPeriodYearLabel(this.periodYears,this.periodYearValue),periodYearOptions:this.periodYears,allocateGroup:this.allocateGroupValue,allocateGroupLevel:this.allocateGroupLevelValue,deptCode:this.deptCodeValue,costCode:this.costCodeValue,costGroupCode:this.costGroupCodeValue,targetDeptCodeItems:this.targetDeptCodes?this.targetDeptCodes.map((function(e){var a=t.previousAllocateTargets.find((function(t){return t.target_dept_code==e.dept_code}));return M(M({},e),{},{target_dept_code:e.target_dept_code?e.target_dept_code:e.dept_code,selected:!!a,quantity:a?a.quantity:0,ratio_rate:a?a.ratio_rate:0})})):[],targetCostCodeItems:this.targetCostCodes?this.targetCostCodes.map((function(e){var a=t.previousAllocateTargets.find((function(t){return t.target_cost_code==e.cost_code}));return M(M({},e),{},{target_cost_code:e.target_cost_code?e.target_cost_code:e.cost_code,selected:!!a,quantity:a?a.quantity:0,ratio_rate:a?a.ratio_rate:0})})):[],targetProductGroupItems:this.targetProductGroups?this.targetProductGroups.map((function(e){var a=t.previousAllocateTargets.find((function(t){return t.target_product_group==e.product_group}));return M(M({},e),{},{target_product_group:e.target_product_group?e.target_product_group:e.product_group,selected:!!a,quantity:a?a.quantity:e.quantity,ratio_rate:a?a.ratio_rate:e.ratio_rate})})):[]}},created:function(){this.handleResize()},mounted:function(){this.selectAll=!1},methods:{handleResize:function(){window.innerWidth<768?this.width="90%":window.innerWidth<992?this.width="80%":this.width=this.modalWidth},filterShowingByKeyword:function(t){if(!this.keyword)return!0;if("DEPT"==this.allocateGroup){var e=t.dept_code?t.dept_code:"",a=t.dept_code_desc?t.dept_code_desc:"";return!(!e.includes(this.keyword)&&!a.includes(this.keyword))}if("COST"==this.allocateGroup){var o=t.cost_code?t.cost_code:"",r=t.cost_code_desc?t.cost_code_desc:"";return!(!o.includes(this.keyword)&&!r.includes(this.keyword))}if("PRODUCT"==this.allocateGroup){var s=t.product_group?t.product_group:"",c=t.description?t.description:"";return!(!s.includes(this.keyword)&&!c.includes(this.keyword))}},onSelectAll:function(t,e){var a=this,o=t.target.checked;"DEPT"==this.allocateGroup?this.targetDeptCodeItems=e.map((function(t){return M(M({},t),{},{quantity:o?t.quantity:"",ratio_rate:o?t.ratio_rate:"",selected:a.selectAll})})):"COST"==this.allocateGroup?this.targetCostCodeItems=e.map((function(t){return M(M({},t),{},{quantity:o?t.quantity:"",ratio_rate:o?t.ratio_rate:"",selected:a.selectAll})})):"PRODUCT"==this.allocateGroup&&(this.targetProductGroupItems=e.map((function(t){return M(M({},t),{},{quantity:o?t.quantity:"",ratio_rate:o?t.ratio_rate:"",selected:a.selectAll})})))},onToggleSelection:function(t,e){t.target.checked||(e.quantity="",e.ratio_rate=""),this.onAllocateTargetQuantityChanged(e,!1),this.onAllocateTargetRatioRateChanged(e,!1)},getPeriodYearLabel:function(t,e){var a=t.find((function(t){return t.period_year_value==e}));return a?a.period_year_label:""},autoCalTargetProductGroupRatioRate:function(){var t=this.targetProductGroupItems.filter((function(t){return t.selected})).reduce((function(t,e){return t+parseFloat(e.quantity)}),0);this.targetProductGroupItems=this.targetProductGroupItems.map((function(e){var a=e.quantity?e.quantity:0,o=e.selected&&t>0?100*a/t:0;return M(M({},e),{},{ratio_rate:o})}))},onAllocateTargetQuantityChanged:function(t,e){var a=[];if("DEPT"==this.allocateGroup?a=this.targetDeptCodeItems.filter((function(t){return t.selected})):"COST"==this.allocateGroup?a=this.targetCostCodeItems.filter((function(t){return t.selected})):"PRODUCT"==this.allocateGroup&&(a=this.targetProductGroupItems.filter((function(t){return t.selected}))),"PRODUCT"!=this.allocateGroup||"P"!=this.costGroupCode){t.ratio_rate=t.quantity;var o=this.validateTargetQuantity(100,a,t);o.valid||(e&&swal("เกิดข้อผิดพลาด","".concat(o.message),"error"),this.$nextTick((function(){t.quantity=0,t.ratio_rate=0})))}"PRODUCT"==this.allocateGroup&&"P"==this.costGroupCode&&this.autoCalTargetProductGroupRatioRate()},onAllocateTargetRatioRateChanged:function(t,e){var a=[];if("DEPT"==this.allocateGroup?a=this.targetDeptCodeItems.filter((function(t){return t.selected})):"COST"==this.allocateGroup?a=this.targetCostCodeItems.filter((function(t){return t.selected})):"PRODUCT"==this.allocateGroup&&(a=this.targetProductGroupItems.filter((function(t){return t.selected}))),"PRODUCT"!=this.allocateGroup||"P"!=this.costGroupCode){t.quantity=t.ratio_rate;var o=this.validateTargetRatioRate(100,a,t);o.valid||(e&&swal("เกิดข้อผิดพลาด","".concat(o.message),"error"),this.$nextTick((function(){t.quantity=0,t.ratio_rate=0})))}"PRODUCT"==this.allocateGroup&&this.costGroupCode},validateTargetQuantity:function(t,e,a){var o={valid:!0,message:""};return e.reduce((function(t,e){return t+parseFloat(e.quantity)}),0)>parseFloat(t)&&(o.valid=!1,o.message="กรอกข้อมูลสัดส่วนเป้าหมายการปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ"),o},validateTargetRatioRate:function(t,e,a){var o={valid:!0,message:""};return e.reduce((function(t,e){return t+parseFloat(e.ratio_rate)}),0)>parseFloat(t)&&(o.valid=!1,o.message="กรอกข้อมูล % เป้าหมายการปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ"),o},validateTargetSummarizedRatioRate:function(t,e){var a={valid:!0,message:""},o=e.reduce((function(t,e){return t+parseFloat(e.ratio_rate)}),0);return"PRODUCT"==this.allocateGroup&&"P"==this.costGroupCode||o!=t&&(a.valid=!1,a.message="ผลรวม สัดส่วน % ไม่ครบ ".concat(t,"% กรุณาตรวจสอบ")),a},onSubmitCreateAllocateTargets:function(){var t=[];"DEPT"==this.allocateGroup?t=this.targetDeptCodeItems.filter((function(t){return t.selected})):"COST"==this.allocateGroup?t=this.targetCostCodeItems.filter((function(t){return t.selected})):"PRODUCT"==this.allocateGroup&&(t=this.targetProductGroupItems.filter((function(t){return t.selected})));var e=this.validateTargetSummarizedRatioRate(100,t);if(e.valid){this.$modal.hide(this.modalName);var a=this.targetDeptCodeItems.filter((function(t){return t.selected})),o=this.targetCostCodeItems.filter((function(t){return t.selected})),r=this.targetProductGroupItems.filter((function(t){return t.selected}));this.$emit("onSubmitCreateAllocateTargets",{period_year:this.periodYear,targetDeptCodes:a,targetCostCodes:o,targetProductGroups:r})}else swal("เกิดข้อผิดพลาด","".concat(e.message),"error")}}};var tt=a(18405),et={insert:"head",singleton:!1};L()(tt.Z,et);tt.Z.locals;const at=(0,v.Z)(X,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"fixed","z-index":"100"}},[a("modal",{attrs:{name:t.modalName,width:t.width,scrollable:!0,height:t.modalHeight,shiftX:.3,shiftY:.3}},[a("div",{staticClass:"p-4"},[a("h4",[t._v(" สร้างรายการปันส่วน ")]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"row tw-my-2"},[a("label",{staticClass:"col-2 col-form-label tw-font-bold text-right"},[t._v(" ค้นหา : ")]),t._v(" "),a("div",{staticClass:"col-10"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],staticClass:"input-sm form-control",attrs:{type:"text",name:"keyword",id:"input_keyword"},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}})])]),t._v(" "),"DEPT"==t.allocateGroup?a("div",{staticClass:"table-responsive",staticStyle:{"min-height":"200px","max-height":"360px"}},[a("table",{staticClass:"table table-bordered table-sticky mb-0"},[a("thead",[a("tr",[a("th",{staticClass:"text-center md:tw-table-cell",attrs:{width:"10%"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.selectAll,expression:"selectAll"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(t.selectAll)?t._i(t.selectAll,null)>-1:t.selectAll},on:{change:[function(e){var a=t.selectAll,o=e.target,r=!!o.checked;if(Array.isArray(a)){var s=t._i(a,null);o.checked?s<0&&(t.selectAll=a.concat([null])):s>-1&&(t.selectAll=a.slice(0,s).concat(a.slice(s+1)))}else t.selectAll=r},function(e){return t.onSelectAll(e,t.targetDeptCodeItems)}]}})]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"20%"}},[t._v(" เป้าหมายที่รับปัน ")]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"30%"}},[t._v(" คำอธิบาย ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"15%"}},[t._v("  สัดส่วน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell tw-hidden",attrs:{width:"15%"}},[t._v(" % ")])])]),t._v(" "),t.targetDeptCodeItems.length>0?a("tbody",[t._l(t.targetDeptCodeItems,(function(e,o){return[a("tr",{directives:[{name:"show",rawName:"v-show",value:t.filterShowingByKeyword(e),expression:"filterShowingByKeyword(targetDeptCode)"}],key:o},[a("td",{staticClass:"text-center md:tw-table-cell"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"targetDeptCode.selected"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(e.selected)?t._i(e.selected,null)>-1:e.selected},on:{change:[function(a){var o=e.selected,r=a.target,s=!!r.checked;if(Array.isArray(o)){var c=t._i(o,null);r.checked?c<0&&t.$set(e,"selected",o.concat([null])):c>-1&&t.$set(e,"selected",o.slice(0,c).concat(o.slice(c+1)))}else t.$set(e,"selected",s)},function(a){return t.onToggleSelection(a,e)}]}})]),t._v(" "),a("td",{staticClass:"text-center md:tw-table-cell"},[t._v("\n                                    "+t._s(e.dept_code)+"\n                                ")]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell"},[t._v("\n                                    "+t._s(e.dept_code_desc)+"\n                                ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell tw-hidden"},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"quantity_"+o,id:"input_quantity_"+o},on:{blur:function(a){return t.onAllocateTargetQuantityChanged(e,!0)}},model:{value:e.quantity,callback:function(a){t.$set(e,"quantity",a)},expression:"targetDeptCode.quantity"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"quantity",id:"input_quantity",disabled:""},domProps:{value:e.quantity?Number.parseFloat(e.quantity).toFixed(2):""}})])]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell tw-hidden"},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"ratio_rate_"+o,id:"input_ratio_rate_"+o},on:{blur:function(a){return t.onAllocateTargetRatioRateChanged(e,!0)}},model:{value:e.ratio_rate,callback:function(a){t.$set(e,"ratio_rate",a)},expression:"targetDeptCode.ratio_rate"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?Number.parseFloat(e.ratio_rate).toFixed(2):""}})])])])]}))],2):a("tbody",[a("tr",[a("td",{attrs:{colspan:"5"}},[a("h2",{staticClass:"p-5 text-center text-muted"},[t._v("ไม่พบข้อมูล")])])])])])]):t._e(),t._v(" "),"COST"==t.allocateGroup?a("div",{staticClass:"table-responsive",staticStyle:{"min-height":"200px","max-height":"360px"}},[a("table",{staticClass:"table table-bordered table-sticky mb-0"},[a("thead",[a("tr",[a("th",{staticClass:"text-center md:tw-table-cell",attrs:{width:"10%"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.selectAll,expression:"selectAll"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(t.selectAll)?t._i(t.selectAll,null)>-1:t.selectAll},on:{change:[function(e){var a=t.selectAll,o=e.target,r=!!o.checked;if(Array.isArray(a)){var s=t._i(a,null);o.checked?s<0&&(t.selectAll=a.concat([null])):s>-1&&(t.selectAll=a.slice(0,s).concat(a.slice(s+1)))}else t.selectAll=r},function(e){return t.onSelectAll(e,t.targetCostCodeItems)}]}})]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"30%"}},[t._v(" เป้าหมายที่รับปัน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"30%"}},[t._v("  สัดส่วน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell tw-hidden",attrs:{width:"30%"}},[t._v(" % ")])])]),t._v(" "),t.targetCostCodeItems.length>0?a("tbody",[t._l(t.targetCostCodeItems,(function(e,o){return[a("tr",{directives:[{name:"show",rawName:"v-show",value:t.filterShowingByKeyword(e),expression:"filterShowingByKeyword(targetCostCode)"}],key:o},[a("td",{staticClass:"text-center md:tw-table-cell",attrs:{width:"10%"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"targetCostCode.selected"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(e.selected)?t._i(e.selected,null)>-1:e.selected},on:{change:[function(a){var o=e.selected,r=a.target,s=!!r.checked;if(Array.isArray(o)){var c=t._i(o,null);r.checked?c<0&&t.$set(e,"selected",o.concat([null])):c>-1&&t.$set(e,"selected",o.slice(0,c).concat(o.slice(c+1)))}else t.$set(e,"selected",s)},function(a){return t.onToggleSelection(a,e)}]}})]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell",attrs:{width:"30%"}},[t._v("\n                                    "+t._s(e.cost_code)+" : "+t._s(e.cost_code_desc)+"\n                                ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell tw-hidden",attrs:{width:"30%"}},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"quantity_"+o,id:"input_quantity_"+o},on:{blur:function(a){return t.onAllocateTargetQuantityChanged(e,!0)}},model:{value:e.quantity,callback:function(a){t.$set(e,"quantity",a)},expression:"targetCostCode.quantity"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"quantity",id:"input_quantity",disabled:""},domProps:{value:e.quantity?Number.parseFloat(e.quantity).toFixed(2):""}})])]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell tw-hidden",attrs:{width:"30%"}},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"ratio_rate_"+o,id:"input_ratio_rate_"+o},on:{blur:function(a){return t.onAllocateTargetRatioRateChanged(e,!0)}},model:{value:e.ratio_rate,callback:function(a){t.$set(e,"ratio_rate",a)},expression:"targetCostCode.ratio_rate"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?Number.parseFloat(e.ratio_rate).toFixed(2):""}})])])])]}))],2):a("tbody",[a("tr",[a("td",{attrs:{colspan:"5"}},[a("h2",{staticClass:"p-5 text-center text-muted"},[t._v("ไม่พบข้อมูล")])])])])])]):t._e(),t._v(" "),"PRODUCT"==t.allocateGroup?a("div",{staticClass:"table-responsive",staticStyle:{"min-height":"200px","max-height":"360px"}},[a("table",{staticClass:"table table-bordered table-sticky mb-0"},[a("thead",[a("tr",[a("th",{staticClass:"text-center md:tw-table-cell",attrs:{width:"10%"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.selectAll,expression:"selectAll"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(t.selectAll)?t._i(t.selectAll,null)>-1:t.selectAll},on:{change:[function(e){var a=t.selectAll,o=e.target,r=!!o.checked;if(Array.isArray(a)){var s=t._i(a,null);o.checked?s<0&&(t.selectAll=a.concat([null])):s>-1&&(t.selectAll=a.slice(0,s).concat(a.slice(s+1)))}else t.selectAll=r},function(e){return t.onSelectAll(e,t.targetProductGroupItems)}]}})]),t._v(" "),a("th",{staticClass:"text-center tw-text-xs md:tw-table-cell",attrs:{width:"40%"}},[t._v(" เป้าหมายที่รับปัน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell",attrs:{width:"20%"}},[t._v("  สัดส่วน ")]),t._v(" "),a("th",{staticClass:"text-right tw-text-xs md:tw-table-cell tw-hidden",attrs:{width:"30%"}},[t._v(" % ")])])]),t._v(" "),t.targetProductGroupItems.length>0?a("tbody",[t._l(t.targetProductGroupItems,(function(e,o){return[a("tr",{directives:[{name:"show",rawName:"v-show",value:t.filterShowingByKeyword(e),expression:"filterShowingByKeyword(targetProductGroup)"}],key:o},[a("td",{staticClass:"text-center md:tw-table-cell",attrs:{width:"10%"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.selected,expression:"targetProductGroup.selected"}],staticClass:"i-checks",attrs:{type:"checkbox",name:"selected"},domProps:{checked:Array.isArray(e.selected)?t._i(e.selected,null)>-1:e.selected},on:{change:[function(a){var o=e.selected,r=a.target,s=!!r.checked;if(Array.isArray(o)){var c=t._i(o,null);r.checked?c<0&&t.$set(e,"selected",o.concat([null])):c>-1&&t.$set(e,"selected",o.slice(0,c).concat(o.slice(c+1)))}else t.$set(e,"selected",s)},function(a){return t.onToggleSelection(a,e)}]}})]),t._v(" "),a("td",{staticClass:"text-left md:tw-table-cell",attrs:{width:"30%"}},[t._v("\n                                    "+t._s(e.product_group)+" : "+t._s(e.description)+"\n                                ")]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell tw-hidden",attrs:{width:"30%"}},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",precision:2,minus:!1,name:"quantity_"+o,id:"input_quantity_"+o},on:{blur:function(a){return t.onAllocateTargetQuantityChanged(e,!0)}},model:{value:e.quantity,callback:function(a){t.$set(e,"quantity",a)},expression:"targetProductGroup.quantity"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"quantity",id:"input_quantity",disabled:""},domProps:{value:e.quantity?Number.parseFloat(e.quantity).toFixed(2):""}})])]),t._v(" "),a("td",{staticClass:"text-right md:tw-table-cell tw-hidden",attrs:{width:"30%"}},[e.selected?a("div",[a("vue-numeric",{staticClass:"form-control input-sm text-right",attrs:{separator:",",minus:!1,precision:"P"==t.costGroupCode?4:2,name:"ratio_rate_"+o,id:"input_ratio_rate_"+o,disabled:"P"==t.costGroupCode},on:{blur:function(a){return t.onAllocateTargetRatioRateChanged(e,!0)}},model:{value:e.ratio_rate,callback:function(a){t.$set(e,"ratio_rate",a)},expression:"targetProductGroup.ratio_rate"}})],1):a("div",[a("input",{staticClass:"input-sm text-right form-control",attrs:{type:"text",name:"ratio_rate",id:"input_ratio_rate",disabled:""},domProps:{value:e.ratio_rate?"P"==t.costGroupCode?Number.parseFloat(e.ratio_rate).toFixed(4):Number.parseFloat(e.ratio_rate).toFixed(2):""}})])])])]}))],2):a("tbody",[a("tr",[a("td",{attrs:{colspan:"5"}},[a("h2",{staticClass:"p-5 text-center text-muted"},[t._v("ไม่พบข้อมูล")])])])])])]):t._e(),t._v(" "),a("div",{staticClass:"text-right tw-mt-8"},[a("button",{staticClass:"btn btn-primary tw-w-32",attrs:{type:"button"},on:{click:t.onSubmitCreateAllocateTargets}},[t._v(" \n                    บันทึก \n                ")]),t._v(" "),a("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$modal.hide(t.modalName)}}},[t._v(" \n                    ยกเลิก \n                ")])])])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}})],1)}),[],!1,null,"7f7b3aa0",null).exports;function ot(t,e,a,o,r,s,c){try{var l=t[s](c),n=l.value}catch(t){return void a(t)}l.done?e(n):Promise.resolve(n).then(o,r)}function rt(t){return function(){var e=this,a=arguments;return new Promise((function(o,r){var s=t.apply(e,a);function c(t){ot(s,o,r,c,l,"next",t)}function l(t){ot(s,o,r,c,l,"throw",t)}c(void 0)}))}}const st={components:{Loading:c(),TableAllocateAccounts:T,ModalSearchAllocateYear:q,ModalCopyNewVersion:B,ModalCreateAllocateAccounts:Z,ModalCreateAllocateTargets:at},props:["defaultData","periodYearValue","allocateGroupValue","allocateTypeValue","transferAccountCodeValue","deptCodeValue","costCodeValue","versionValue","periodYears","existPeriodYears","approveStatuses","listAllocateGroups","allocateTypes","accountCodes","existAccountCodes"],mounted:function(){var t=this;return rt(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getDeptCodes(t.periodYearValue);case 2:return e.next=4,t.getCostCodes(t.periodYearValue);case 4:return e.next=6,t.getAllocateYearData(t.periodYearValue,t.versionValue);case 6:return e.next=8,t.getTargetAccounts(t.periodYearValue,t.allocateGroupValue,t.deptCodeValue,t.costCodeValue);case 8:case"end":return e.stop()}}),e)})))()},data:function(){return{organizationId:this.defaultData?JSON.parse(this.defaultData).organization_id:null,organizationCode:this.defaultData?JSON.parse(this.defaultData).organization_code:null,department:this.defaultData?JSON.parse(this.defaultData).department:null,periodYear:this.periodYearValue,periodYearLabel:this.getPeriodYearLabel(this.periodYears,this.periodYearValue),periodYearStartDate:null,periodYearEndDate:null,existPeriodYearOptions:this.existPeriodYears,allocateYear:null,allocateYearVersion:this.versionValue,allocateYearVersions:[],allocateGroup:this.allocateGroupValue,allocateGroupLevel:this.getAllocateGroupLevel(this.listAllocateGroups,this.allocateGroupValue),allocateGroupLabel:this.getAllocateGroupLabel(this.listAllocateGroups,this.allocateGroupValue),allocateType:this.allocateTypeValue,allocateTypeLabel:this.getAllocateTypeLabel(this.allocateTypes,this.allocateTypeValue),transferAccountCode:this.transferAccountCodeValue,transferAccCode:this.getTransferAccCode(this.accountCodes,this.transferAccountCodeValue),transferSubAccCode:this.getTransferSubAccCode(this.accountCodes,this.transferAccountCodeValue),deptCodes:[],deptCode:this.deptCodeValue,costCodes:[],costCode:this.costCodeValue,costGroupCode:null,existAccountCodeOptions:this.existAccountCodes,targetAccounts:[],targetDeptCodes:[],targetCostCodes:[],targetProductGroups:[],allocateAccounts:[],previousAllocateTargets:[],nextAllocateYearVersion:1,isLoading:!1}},computed:{},methods:{setUrlParams:function(){var t=new URLSearchParams(window.location.search);t.set("period_year",this.periodYear?this.periodYear:""),t.set("allocate_group",this.allocateGroup?this.allocateGroup:""),t.set("allocate_type",this.allocateType?this.allocateType:""),t.set("transfer_account_code",this.transferAccountCode?this.transferAccountCode:""),t.set("dept_code",this.deptCode?this.deptCode:""),t.set("cost_code",this.costCode?this.costCode:""),t.set("version",this.allocateYearVersion?this.allocateYearVersion:""),window.history.replaceState(null,null,"?"+t.toString())},onPeriodYearChanged:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.periodYear=t,e.periodYearLabel=e.getPeriodYearLabel(e.periodYears,e.periodYear),e.setUrlParams(),e.deptCode=null,e.costCode=null,e.costGroupCode=null,e.transferAccountCode="",e.allocateAccounts=[],e.getAllocateYearData(e.periodYear,null),e.getDeptCodes(e.periodYear),e.getCostCodes(e.periodYear),e.getTargetAccounts(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getAllocateAccounts(),e.allocateAccounts.length>0&&(e.getTargetDeptCodes(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getTargetCostCodes(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getTargetProductGroups(e.periodYear,e.allocateGroup,e.deptCode,e.costCode));case 14:case"end":return a.stop()}}),a)})))()},onListAllocateGroupChanged:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.allocateGroup=t,e.allocateGroupLevel=e.getAllocateGroupLevel(e.listAllocateGroups,t),e.allocateGroupLabel=e.getAllocateGroupLabel(e.listAllocateGroups,t),e.allocateAccounts=[],"1"!=e.allocateGroupLevel&&"2"!=e.allocateGroupLevel||(e.costCode=null,e.costGroupCode=null),"3"==e.allocateGroupLevel&&(e.deptCode=null),e.getTargetAccounts(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getAllocateAccounts(),e.setUrlParams();case 9:case"end":return a.stop()}}),a)})))()},onAllocateTypeChanged:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.allocateType=t,e.allocateTypeLabel=e.getAllocateTypeLabel(e.allocateTypes,e.allocateType),e.allocateAccounts.length>0&&(e.onSaveAllocateAccounts(e.allocateAccounts,!1),e.getAllocateAccounts()),e.setUrlParams();case 4:case"end":return a.stop()}}),a)})))()},onTransferAccountCodeChanged:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.transferAccountCode=t,e.transferAccCode=e.getTransferAccCode(e.accountCodes,e.transferAccountCode),e.transferSubAccCode=e.getTransferSubAccCode(e.accountCodes,e.transferAccountCode),e.allocateAccounts.length>0&&(e.onSaveAllocateAccounts(e.allocateAccounts,!1),e.getAllocateAccounts()),e.setUrlParams();case 5:case"end":return a.stop()}}),a)})))()},onDeptCodeChanged:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.deptCode=t,e.allocateAccounts=[],e.isLoading=!0,e.getTargetAccounts(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getAllocateAccounts(),e.isLoading=!1,e.setUrlParams();case 7:case"end":return a.stop()}}),a)})))()},onCostCodeChanged:function(t){var e=this;return rt(r().mark((function a(){var o;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.costCode=t,o=e.costCodes.find((function(e){return e.cost_code_value==t})),e.costGroupCode=o?o.cost_group_code:null,e.allocateAccounts=[],e.isLoading=!0,e.getTargetProductGroups(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getTargetAccounts(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getAllocateAccounts(),e.isLoading=!1,e.setUrlParams();case 10:case"end":return a.stop()}}),a)})))()},onSearchAllocateYearVersion:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.periodYear=t.period_year,e.periodYearLabel=e.getPeriodYearLabel(e.periodYears,e.periodYear),t.transfer_account_code&&(e.transferAccountCode=t.transfer_account_code,e.transferAccCode=e.getTransferAccCode(e.accountCodes,e.transferAccountCode),e.transferSubAccCode=e.getTransferSubAccCode(e.accountCodes,e.transferAccountCode)),a.next=5,e.getAllocateYearData(e.periodYear,t.version_no);case 5:return a.next=7,e.getDeptCodes(e.periodYear);case 7:return a.next=9,e.getCostCodes(e.periodYear);case 9:t.allocate_group&&(e.allocateGroup=t.allocate_group,e.allocateGroupLevel=e.getAllocateGroupLevel(e.listAllocateGroups,e.allocateGroup),e.allocateGroupLabel=e.getAllocateGroupLabel(e.listAllocateGroups,e.allocateGroup),(t.dept_code||t.cost_code)&&(e.deptCode=t.dept_code,e.costCode=t.cost_code,e.costGroupCode=t.cost_group_code,e.allocateAccounts=[],e.getTargetAccounts(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getAllocateAccounts())),e.setUrlParams();case 11:case"end":return a.stop()}}),a)})))()},onCopyAllocateYearNewVersion:function(t){var e=this;return rt(r().mark((function a(){return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.periodYear=t.to_period_year,e.periodYearLabel=e.getPeriodYearLabel(e.periodYears,e.periodYear),e.deptCode=null,e.costCode=null,e.costGroupCode=null,e.transferAccountCode="",e.allocateAccounts=[],a.next=9,e.onCopyNewVersion(t.from_period_year,t.from_version_no,t.to_period_year,t.to_version_no);case 9:return a.next=11,e.getAllocateYearData(e.periodYear,null);case 11:return a.next=13,e.getDeptCodes(e.periodYear);case 13:return a.next=15,e.getCostCodes(e.periodYear);case 15:e.getTargetAccounts(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getAllocateAccounts(),e.allocateAccounts.length>0&&(e.getTargetDeptCodes(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getTargetCostCodes(e.periodYear,e.allocateGroup,e.deptCode,e.costCode),e.getTargetProductGroups(e.periodYear,e.allocateGroup,e.deptCode,e.costCode)),e.setUrlParams();case 19:case"end":return a.stop()}}),a)})))()},onShowModalCreateAllocateAccounts:function(){window.scrollTo(0,120),this.$modal.show("modal-create-allocate-accounts")},onShowModalCreateAllocateTargets:function(){window.scrollTo(0,120),this.$modal.show("modal-create-allocate-targets")},onSubmitCreateAllocateAccounts:function(t){var e=t.targetAccounts;this.onSaveAllocateAccounts(e,!0)},onSubmitCreateAllocateTargets:function(t){var e=[];"1"==this.allocateGroupLevel?e=t.targetDeptCodes:"2"==this.allocateGroupLevel?e=t.targetCostCodes:"3"==this.allocateGroupLevel&&(e=t.targetProductGroups),this.onSaveAllocateTargets(this.allocateAccounts,e)},getPeriodYearLabel:function(t,e){var a=t.find((function(t){return t.period_year_value==e}));return a?a.period_year_label:""},getAllocateGroupLevel:function(t,e){var a=t.find((function(t){return t.allocate_group==e}));return a?a.level_no:""},getAllocateGroupLabel:function(t,e){var a=t.find((function(t){return t.allocate_group==e}));return a?a.allocate_group_label:""},getAllocateTypeLabel:function(t,e){var a="";if(t.length>0&&e){var o=t.find((function(t){return t.allocate_type_value==e}));a=o?o.allocate_type_label:""}return a},getTransferAccCode:function(t,e){var a="";if(e){var o=t.find((function(t){return t.account_code_value==e}));a=o?o.acc_code:""}return a},getTransferSubAccCode:function(t,e){var a="";if(e){var o=t.find((function(t){return t.account_code_value==e}));a=o?o.sub_acc_code:""}return a},validateBeforeGetAllocateYear:function(t){var e=!1;return t&&(e=!0),e},validateBeforeGetDeptCodes:function(t){var e=!1;return t&&(e=!0),e},validateBeforeGetCostCodes:function(t){var e=!1;return t&&(e=!0),e},validateBeforeGetTargetAccounts:function(t,e,a,o){var r=!1,s=this.getAllocateGroupLevel(this.listAllocateGroups,e);return t&&e&&("1"==s||"2"==s?a&&(r=!0):"3"==s&&o&&(r=!0)),r},validateBeforeGetAllocateAccounts:function(t,e,a,o,r){var s=!1;if(t&&e){var c=this.getAllocateGroupLevel(this.listAllocateGroups,e);"1"!=c&&"2"!=c||o&&(s=!0),"3"==c&&r&&(s=!0)}return s},validateBeforeGetTargetDeptCodes:function(t,e,a,o){var r=!1;if(t&&e){var s=this.getAllocateGroupLevel(this.listAllocateGroups,e);"1"!=s&&"2"!=s||a&&(r=!0),"3"==s&&o&&(r=!0)}return r},validateBeforeGetTargetCostCodes:function(t,e,a,o){var r=this.getAllocateGroupLevel(this.listAllocateGroups,e),s=!1;return t&&("1"!=r&&"2"!=r||a&&(s=!0),"3"==r&&o&&(s=!0)),s},validateBeforeGetTargetProductGroups:function(t,e,a,o){var r=this.getAllocateGroupLevel(this.listAllocateGroups,e),s=!1;return t&&"3"==r&&o&&(s=!0),s},getAllocateYearData:function(t,e){var a=this;return rt(r().mark((function o(){var s;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(a.isLoading=!0,a.allocateYear=null,a.allocateYearVersion=e,a.allocateYearVersions=[],s={period_year:t,version:e},!a.validateBeforeGetAllocateYear(t)){o.next=18;break}return o.next=9,axios.get("/ajax/ct/allocate-ratios/year",{params:s}).then((function(t){var e=t.data.data;return"error"==e.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลปันส่วนของปีปัญชี ไม่ถูกต้อง | ".concat(e.message),"error"):(a.allocateYear=e.allocate_year?JSON.parse(e.allocate_year):null,a.periodYearStartDate=e.start_date?a.formatDateTh(e.start_date):null,a.periodYearEndDate=e.end_date?a.formatDateTh(e.end_date):null,a.allocateYearVersions=e.versions?JSON.parse(e.versions):[],a.allocateYearVersions.length>0?a.nextAllocateYearVersion=(parseInt(a.allocateYearVersions[0].version_no)+1).toString():a.nextAllocateYearVersion=1),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลปันส่วนของปีปัญชี ไม่ถูกต้อง | ".concat(t.message),"error")}));case 9:if(!a.allocateYear){o.next=16;break}return a.allocateYearVersion=a.allocateYear.version_no,o.next=13,a.getAllocateAccounts();case 13:a.setUrlParams(),o.next=18;break;case 16:a.allocateYearVersion=null,a.onSaveAllocateYear();case 18:a.isLoading=!1;case 19:case"end":return o.stop()}}),o)})))()},getDeptCodes:function(t){var e=this;return rt(r().mark((function a(){var o;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.isLoading=!0,e.deptCodes=[],o={period_year:t},!t){a.next=6;break}return a.next=6,axios.get("/ajax/ct/allocate-ratios/dept-codes",{params:o}).then((function(t){var a=t.data.data;return"error"==a.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(a.message),"error"):e.deptCodes=a.dept_codes?JSON.parse(a.dept_codes):[],a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(t.message),"error")}));case 6:e.isLoading=!1;case 7:case"end":return a.stop()}}),a)})))()},getCostCodes:function(t){var e=this;return rt(r().mark((function a(){var o;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.isLoading=!0,e.costCodes=[],o={period_year:t},!t){a.next=6;break}return a.next=6,axios.get("/ajax/ct/allocate-ratios/cost-codes",{params:o}).then((function(t){var a=t.data.data;if("error"==a.status)swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(a.message),"error");else if(e.costCodes=a.cost_codes?JSON.parse(a.cost_codes):[],e.costCode){var o=e.costCodes.find((function(t){return t.cost_code_value==e.costCode}));e.costGroupCode=o?o.cost_group_code:null}return a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลหน่วยงานที่ปัน | ".concat(t.message),"error")}));case 6:e.isLoading=!1;case 7:case"end":return a.stop()}}),a)})))()},getTargetAccounts:function(t,e,a,o){var s=this;return rt(r().mark((function c(){var l;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s.isLoading=!0,s.targetAccounts=[],l={period_year:t,allocate_group:e,dept_code:a,cost_code:o},!s.validateBeforeGetTargetAccounts(t,e,a,o)){r.next=7;break}return r.next=7,axios.get("/ajax/ct/allocate-ratios/target-accounts",{params:l}).then((function(t){var e=t.data.data;return"error"==e.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลบัญชีรับปัน ".concat(s.allocateGroupLabel," | ").concat(e.message),"error"):s.targetAccounts=e.target_accounts?JSON.parse(e.target_accounts):[],e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลบัญชีรับปัน ".concat(s.allocateGroupLabel," | ").concat(t.message),"error")}));case 7:s.isLoading=!1;case 8:case"end":return r.stop()}}),c)})))()},getTargetDeptCodes:function(t,e,a,o){var s=this;return rt(r().mark((function c(){var l;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s.isLoading=!0,s.targetDeptCodes=[],l={period_year:t,allocate_group:e,dept_code:a,cost_code:o},!s.validateBeforeGetTargetDeptCodes(t,e,a,o)){r.next=7;break}return r.next=7,axios.get("/ajax/ct/allocate-ratios/target-dept-codes",{params:l}).then((function(t){var e=t.data.data;return"error"==e.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน ".concat(s.allocateGroupLabel," | ").concat(e.message),"error"):s.targetDeptCodes=e.target_dept_codes?JSON.parse(e.target_dept_codes):[],e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน ".concat(s.allocateGroupLabel," | ").concat(t.message),"error")}));case 7:s.isLoading=!1;case 8:case"end":return r.stop()}}),c)})))()},getTargetCostCodes:function(t,e,a,o){var s=this;return rt(r().mark((function c(){var l;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s.isLoading=!0,s.targetCostCodes=[],l={period_year:t,allocate_group:e,dept_code:a,cost_code:o},!s.validateBeforeGetTargetCostCodes(t,e,a,o)){r.next=7;break}return r.next=7,axios.get("/ajax/ct/allocate-ratios/target-cost-codes",{params:l}).then((function(t){var e=t.data.data;return"error"==e.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน ".concat(s.allocateGroupLabel," | ").concat(e.message),"error"):s.targetCostCodes=e.target_cost_codes?JSON.parse(e.target_cost_codes):[],e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน ".concat(s.allocateGroupLabel," | ").concat(t.message),"error")}));case 7:s.isLoading=!1;case 8:case"end":return r.stop()}}),c)})))()},getTargetProductGroups:function(t,e,a,o){var s=this;return rt(r().mark((function c(){var l;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s.isLoading=!0,s.targetProductGroups=[],l={period_year:t,allocate_group:e,dept_code:a,cost_code:o},!s.validateBeforeGetTargetProductGroups(t,e,a,o)){r.next=7;break}return r.next=7,axios.get("/ajax/ct/allocate-ratios/target-product-groups",{params:l}).then((function(t){var e=t.data.data;return"error"==e.status?swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน ".concat(s.allocateGroupLabel," | ").concat(e.message),"error"):s.targetProductGroups=e.target_product_groups?JSON.parse(e.target_product_groups):[],e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน ".concat(s.allocateGroupLabel," | ").concat(t.message),"error")}));case 7:s.isLoading=!1;case 8:case"end":return r.stop()}}),c)})))()},getApproveStatusDesc:function(t){var e="-";if(t){var a=this.approveStatuses.find((function(e){return e.lookup_code==t.toUpperCase()}));e=a?a.description:"-"}return e},getAllocateAccounts:function(){var t=this;return rt(r().mark((function e(){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isLoading=!0,a={period_year:t.periodYear,version:t.allocateYearVersion,allocate_group:t.allocateGroup,allocate_type:t.allocateType,dept_code:t.deptCode,cost_code:t.costCode,transfer_account_code:t.transferAccountCode,input_allocate_year:JSON.stringify(t.allocateYear)},!t.validateBeforeGetAllocateAccounts(t.periodYear,t.allocateGroup,t.allocateType,t.deptCode,t.costCode)){e.next=28;break}return e.next=6,axios.get("/ajax/ct/allocate-ratios/accounts",{params:a}).then((function(e){var a=e.data.data;return"success"==a.status?t.allocateAccounts=a.allocate_accounts?JSON.parse(a.allocate_accounts):[]:swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลบัญชีที่รับปัน | ".concat(a.message),"error"),a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลบัญชีที่รับปัน  | ".concat(t.message),"error")}));case 6:if(!(t.allocateAccounts.length>0)){e.next=28;break}if(t.allocateType=t.allocateAccounts[0].allocate_type,t.allocateTypeLabel=t.getAllocateTypeLabel(t.allocateTypes,t.allocateType),t.transferAccountCode=t.allocateAccounts[0].transfer_account_code?t.allocateAccounts[0].transfer_account_code:"",t.transferAccCode=t.getTransferAccCode(t.accountCodes,t.transferAccountCode),t.transferSubAccCode=t.getTransferSubAccCode(t.accountCodes,t.transferAccountCode),"DEPT"!=t.allocateGroup){e.next=17;break}return e.next=15,t.getTargetDeptCodes(t.periodYear,t.allocateGroup,t.deptCode,t.costCode);case 15:e.next=25;break;case 17:if("COST"!=t.allocateGroup){e.next=22;break}return e.next=20,t.getTargetCostCodes(t.periodYear,t.allocateGroup,t.deptCode,t.costCode);case 20:e.next=25;break;case 22:if("PRODUCT"!=t.allocateGroup){e.next=25;break}return e.next=25,t.getTargetProductGroups(t.periodYear,t.allocateGroup,t.deptCode,t.costCode);case 25:return e.next=27,t.getPreviousAllocateTargets(t.allocateYear,t.allocateAccounts[0]);case 27:t.setUrlParams();case 28:t.isLoading=!1;case 29:case"end":return e.stop()}}),e)})))()},getPreviousAllocateTargets:function(t,e){var a=this;return rt(r().mark((function o(){var s;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return a.isLoading=!0,s={period_year:t.period_year,version:t.version_no,allocate_group:e.allocate_group,allocate_type:e.allocate_type,dept_code:e.dept_code,cost_code:e.cost_code,target_account_code:e.target_account_code,input_allocate_year:JSON.stringify(t)},o.next=4,axios.get("/ajax/ct/allocate-ratios/targets",{params:s}).then((function(t){var e=t.data.data;return"success"==e.status?a.previousAllocateTargets=e.allocate_targets?JSON.parse(e.allocate_targets):[]:swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน | ".concat(e.message),"error"),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถดึงข้อมูลเป้าหมายที่รับปัน | ".concat(t.message),"error")}));case 4:a.isLoading=!1;case 5:case"end":return o.stop()}}),o)})))()},onAllocateAccountsChanged:function(t){this.allocateAccounts=t.allocateAccounts},validateBeforeSaveAccounts:function(t,e,a,o,r,s,c,l){var n={valid:!0,message:""};return t&&e&&o||(n.valid=!1,n.message="กรอกข้อมูลรายการกำหนดเกณฑ์การปันส่วนไม่ครบถ้วน กรุณาตรวจสอบ"),"DEPT"!=e&&"COST"!=e||r||(n.valid=!1,n.message="กรอกข้อมูลรายการกำหนดเกณฑ์การปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ"),"PRODUCT"==e&&(s||(n.valid=!1,n.message="กรอกข้อมูลรายการกำหนดเกณฑ์การปันส่วนไม่ถูกต้อง กรุณาตรวจสอบ")),l.filter((function(t){return t.is_new_line&&(!t.quantity||!t.ratio_rate)})).length>0&&(n.valid=!1,n.message="กรอกข้อมูลรายการกำหนดเกณฑ์การปันส่วนไม่ครบถ้วน กรุณาตรวจสอบ"),n},validateBeforeSaveTargets:function(t,e,a,o,r,s,c,l){var n={valid:!0,message:""};return t&&e&&o||(n.valid=!1),"DEPT"!=e&&"COST"!=e||r||(n.valid=!1),"PRODUCT"==e&&(s||(n.valid=!1)),l.filter((function(t){return t.is_new_line&&(!t.quantity||!t.ratio_rate)})).length>0&&(n.valid=!1,n.message="กรอกข้อมูลรายการกำหนดเกณฑ์การปันส่วนไม่ครบถ้วน กรุณาตรวจสอบ"),n},onCopyNewVersion:function(t,e,a,o){var s=this;return rt(r().mark((function c(){var l;return r().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return l={from_period_year:t,from_version_no:e,to_period_year:a,to_version_no:o},s.isLoading=!0,r.next=4,axios.post("/ajax/ct/allocate-ratios/copy-new-version",l).then((function(t){var e=t.data.data,a=e.message;return"success"==e.status&&(s.allocateYear=e.allocate_year?JSON.parse(e.allocate_year):null,s.allocateYearVersion=e.version_no,s.allocateYearVersions=e.versions?JSON.parse(e.versions):[],s.periodYearStartDate=e.start_date?s.formatDateTh(e.start_date):null,s.periodYearEndDate=e.end_date?s.formatDateTh(e.end_date):null),"error"==e.status&&swal("เกิดข้อผิดพลาด","คัดลอกข้อมูลกำหนดเกณฑ์การปันส่วน | ".concat(a),"error"),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","คัดลอกข้อมูลกำหนดเกณฑ์การปันส่วน | ".concat(t.message),"error")}));case 4:s.isLoading=!1;case 5:case"end":return r.stop()}}),c)})))()},onSaveAllocateYear:function(){var t=this;return rt(r().mark((function e(){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={period_year:t.periodYear},t.isLoading=!0,e.next=4,axios.post("/ajax/ct/allocate-ratios/year",a).then((function(e){var a=e.data.data,o=a.message;return"success"==a.status&&(t.allocateYear=a.allocate_year?JSON.parse(a.allocate_year):null,t.allocateYearVersion=a.version_no,t.allocateYearVersions=a.versions?JSON.parse(a.versions):[],t.periodYearStartDate=a.start_date?t.formatDateTh(a.start_date):null,t.periodYearEndDate=a.end_date?t.formatDateTh(a.end_date):null,t.existPeriodYearOptions=a.exist_period_years?JSON.parse(a.exist_period_years):[]),"error"==a.status&&swal("เกิดข้อผิดพลาด","บันทึกกำหนดเกณฑ์การปันส่วน | ".concat(o),"error"),a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","บันทึกกำหนดเกณฑ์การปันส่วน | ".concat(t.message),"error")}));case 4:t.isLoading=!1;case 5:case"end":return e.stop()}}),e)})))()},onSaveAllocateAccounts:function(t,e){var a=this;return rt(r().mark((function o(){var s,c;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(s={period_year:a.periodYear,allocate_group:a.allocateGroup,allocate_type:a.allocateType,dept_code:a.deptCode,cost_code:a.costCode,transfer_account_code:a.transferAccountCode,transfer_acc_code:a.transferAccCode,transfer_sub_acc_code:a.transferSubAccCode,input_allocate_year:JSON.stringify(a.allocateYear),input_allocate_accounts:JSON.stringify(t)},a.isLoading=!0,!(c=a.validateBeforeSaveAccounts(a.allocateYear,a.allocateGroup,a.allocateGroupLevel,a.allocateType,a.deptCode,a.costCode,a.transferAccountCode,t)).valid){o.next=10;break}return o.next=6,axios.post("/ajax/ct/allocate-ratios/accounts",s).then((function(t){var o=t.data.data,r=o.message;return"success"==o.status&&(a.allocateAccounts=o.allocate_accounts?JSON.parse(o.allocate_accounts):null,a.existAccountCodeOptions=o.exist_account_codes?JSON.parse(o.exist_account_codes):[],e&&swal("Success","สร้างรายการข้อมูลบัญชีที่รับปันสำเร็จ","success")),"error"==o.status&&swal("เกิดข้อผิดพลาด","ไม่สามารถสร้างรายการข้อมูลบัญชีที่รับปัน | ".concat(r),"error"),o})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถสร้างรายการข้อมูลบัญชีที่รับปัน | ".concat(t.message),"error")}));case 6:return o.next=8,a.getAllocateAccounts();case 8:o.next=11;break;case 10:swal("เกิดข้อผิดพลาด","ไม่สามารถสร้างรายการข้อมูลบัญชีที่รับปัน | ".concat(c.message),"error");case 11:a.isLoading=!1;case 12:case"end":return o.stop()}}),o)})))()},onSaveAllocateTargets:function(t,e){var a=this;return rt(r().mark((function o(){var s,c;return r().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(s={period_year:a.periodYear,allocate_group:a.allocateGroup,allocate_type:a.allocateType,dept_code:a.deptCode,cost_code:a.costCode,input_allocate_year:JSON.stringify(a.allocateYear),input_allocate_accounts:JSON.stringify(t),input_allocate_targets:JSON.stringify(e)},a.isLoading=!0,!(c=a.validateBeforeSaveTargets(a.allocateYear,a.allocateGroup,a.allocateGroupLevel,a.allocateType,a.deptCode,a.costCode,t,e)).valid){o.next=10;break}return o.next=6,axios.post("/ajax/ct/allocate-ratios/targets",s).then((function(t){var e=t.data.data,a=e.message;return"success"==e.status&&swal("Success","สร้างรายการปันส่วนสำเร็จ","success"),"error"==e.status&&swal("เกิดข้อผิดพลาด","ไม่สามารถสร้างรายการปันส่วน | ".concat(a),"error"),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถสร้างรายการปันส่วน | ".concat(t.message),"error")}));case 6:return o.next=8,a.getAllocateAccounts();case 8:o.next=11;break;case 10:swal("เกิดข้อผิดพลาด","บันทึกข้อมูลบัญชีที่รับปัน | ".concat(c.message),"error");case 11:a.isLoading=!1;case 12:case"end":return o.stop()}}),o)})))()},onCreateNewAllocateYearVersion:function(){var t=this;return rt(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:swal({title:"",text:"ต้องการสร้าง กำหนดเกณฑ์การปันส่วน เวอร์ชั่นใหม่ ?",showCancelButton:!0,confirmButtonClass:"btn-primary",confirmButtonText:"ยืนยัน",cancelButtonText:"ยกเลิก",closeOnConfirm:!0},(function(e){e&&(t.allocateAccounts=[],t.createNewPlanVersion())}));case 1:case"end":return e.stop()}}),e)})))()},isAllowCreateAllocateAccounts:function(){var t=!0;return this.periodYear&&this.allocateGroup&&this.allocateType||(t=!1),"DEPT"==this.allocateGroup||"COST"==this.allocateGroup?this.deptCode||(t=!1):"PRODUCT"==this.allocateGroup&&(this.costCode||(t=!1)),t},isAllowCreateAllocateTargets:function(){var t=!0;return this.periodYear&&this.allocateGroup&&this.allocateType||(t=!1),"DEPT"==this.allocateGroup||"COST"==this.allocateGroup?this.deptCode||(t=!1):"PRODUCT"==this.allocateGroup&&(this.costCode||(t=!1)),this.allocateAccounts.length<=0&&(t=!1),t},isAllowCreateNewVersion:function(t){var e=!0;return 0==t.length&&(e=!1),e},createNewPlanVersion:function(){var t=this;return rt(r().mark((function e(){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={period_year:t.periodYear},t.isLoading=!0,e.next=4,axios.post("/ajax/ct/allocate-ratios/create-new-version",a).then((function(e){var a=e.data.data,o=a.message;return"success"==a.status&&(t.allocateYear=a.allocate_year?JSON.parse(a.allocate_year):null,t.allocateYearVersion=a.version_no,t.allocateYearVersions=a.versions?JSON.parse(a.versions):[],swal("Success","สร้าง กำหนดเกณฑ์การปันส่วน","success")),"error"==a.status&&swal("เกิดข้อผิดพลาด","สร้าง กำหนดเกณฑ์การปันส่วน | ".concat(o),"error"),a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","สร้าง กำหนดเกณฑ์การปันส่วน | ".concat(t.message),"error")}));case 4:t.isLoading=!1;case 5:case"end":return e.stop()}}),e)})))()},onDeleteAllAllocateAccountItem:function(t){var e=this;swal({title:"",text:"ต้องการลบรายการบัญชีทั้งหมด ?",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",closeOnConfirm:!0},(function(t){t&&e.deleteAllAllocateAccount()}))},deleteAllAllocateAccount:function(){var t=this;return rt(r().mark((function e(){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.deptCode,"3"==t.allocateGroupLevel&&(a=t.costCode),o={period_year:t.periodYear,input_allocate_year:JSON.stringify(t.allocateYear),allocate_group:t.allocateGroup,allocate_group_code:a},t.isLoading=!0,e.next=6,axios.post("/ajax/ct/allocate-ratios/delete-all-accounts",o).then((function(t){var e=t.data.data,a=e.message;return"success"==e.status&&swal("Success","ลบข้อมูลบัญชีทั้งหมด","success"),"error"==e.status&&swal("เกิดข้อผิดพลาด","ลบข้อมูลบัญชีทั้งหมด | ".concat(a),"error"),e})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ลบข้อมูลบัญชีทั้งหมด | ".concat(t.message),"error")}));case 6:return t.isLoading=!1,e.next=9,t.getAllocateAccounts();case 9:case"end":return e.stop()}}),e)})))()},formatDateTh:function(t){return t?n()(t).add(543,"years").format("DD/MM/YYYY"):""}}};const ct=(0,v.Z)(st,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"ibox"},[a("div",{staticClass:"ibox-content",staticStyle:{"min-height":"600px"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-6"},[a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ปีบัญชี ")]),t._v(" "),a("div",{staticClass:"col-md-3"},[a("pm-el-select",{attrs:{name:"period_year",id:"input_period_year","select-options":t.periodYears,"option-key":"period_year_value","option-value":"period_year_value","option-label":"period_year_label",value:t.periodYear,filterable:!0},on:{onSelected:t.onPeriodYearChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" วันที่เริ่ม ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[t.periodYearStartDate?a("p",{staticClass:"col-form-label"},[t._v(" "+t._s(t.periodYearStartDate)+" ")]):t._e(),t._v(" "),t.periodYearStartDate?t._e():a("p",{staticClass:"col-form-label"},[t._v(" - ")])])]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" สถานะ ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[t.allocateYear?a("p",{staticClass:"col-form-label"},[t._v(" "+t._s(t.getApproveStatusDesc(t.allocateYear.approved_status))+" ")]):t._e(),t._v(" "),t.allocateYear?t._e():a("p",{staticClass:"col-form-label"},[t._v(" - ")])])])]),t._v(" "),a("div",{staticClass:"col-md-6"},[a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" ครั้งที่ ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[t.allocateYear?a("p",{staticClass:"col-form-label"},[t._v(" "+t._s(t.allocateYear.version_no?t.allocateYear.version_no:"-")+" ")]):t._e(),t._v(" "),t.allocateYear?t._e():a("p",{staticClass:"col-form-label"},[t._v(" - ")])])]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[t._v(" วันที่สิ้นสุด ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[t.periodYearEndDate?a("p",{staticClass:"col-form-label"},[t._v(" "+t._s(t.periodYearEndDate)+" ")]):t._e(),t._v(" "),t.periodYearEndDate?t._e():a("p",{staticClass:"col-form-label"},[t._v(" - ")])])])])]),t._v(" "),a("div",{staticClass:"tw-mb-4"},[a("div",{staticClass:"text-right tw-mr-6 tw-mb-2"},[a("button",{staticClass:"btn btn-inline-block btn-sm btn-white tw-w-32",on:{click:function(e){return t.$modal.show("modal-search-allocate-year")}}},[a("i",{staticClass:"fa fa-search tw-mr-1"}),t._v(" ค้นหา \n                ")]),t._v(" "),a("button",{staticClass:"btn btn-inline-block btn-sm btn-primary tw-w-32",attrs:{disabled:!t.isAllowCreateNewVersion(t.allocateYearVersions)},on:{click:t.onCreateNewAllocateYearVersion}},[a("i",{staticClass:"fa fa-plus tw-mr-1"}),t._v(" สร้าง \n                ")]),t._v(" "),a("button",{staticClass:"btn btn-inline-block btn-sm btn-warning tw-w-32",on:{click:function(e){return t.$modal.show("modal-copy-new-version")}}},[a("i",{staticClass:"fa fa-copy tw-mr-1"}),t._v(" คัดลอกข้อมูล \n                ")]),t._v(" "),a("a",{staticClass:"btn btn-inline-block btn-sm btn-danger tw-w-32",attrs:{href:"/ct/allocate-ratios"}},[t._v(" ล้าง ")])])]),t._v(" "),a("hr"),t._v(" "),a("div",{staticClass:"row tw-mt-6"},[a("div",{staticClass:"offset-md-2 col-md-4"},[a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ประเภทการปัน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"allocate_group",id:"input_allocate_group","select-options":t.listAllocateGroups,"option-key":"allocate_group_value","option-value":"allocate_group_value","option-label":"allocate_group_full_label",value:t.allocateGroup,filterable:!0},on:{onSelected:t.onListAllocateGroupChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" เกณฑ์การปัน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"allocate_type",id:"input_allocate_type","select-options":t.allocateTypes,"option-key":"allocate_type_value","option-value":"allocate_type_value","option-label":"allocate_type_full_label",value:t.allocateType,filterable:!0},on:{onSelected:t.onAllocateTypeChanged}})],1)]),t._v(" "),a("div",{staticClass:"row form-group"},[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" บัญชีที่รับโอน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"transfer_account_code",id:"input_transfer_account_code","select-options":t.accountCodes,"option-key":"account_code_value","option-value":"account_code_value","option-label":"account_code_label",value:t.transferAccountCode,filterable:!0},on:{onSelected:t.onTransferAccountCodeChanged}})],1)])]),t._v(" "),a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"row form-group"},["1"==t.allocateGroupLevel||"2"==t.allocateGroupLevel?[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" หน่วยงานที่ปัน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"dept_code",id:"input_dept_code","select-options":t.deptCodes,"option-key":"dept_code_value","option-value":"dept_code_value","option-label":"dept_code_full_label",value:t.deptCode,filterable:!0},on:{onSelected:t.onDeptCodeChanged}})],1)]:"3"==t.allocateGroupLevel?[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" ศูนย์ต้นทุน ")]),t._v(" "),a("div",{staticClass:"col-md-8"},[a("pm-el-select",{attrs:{name:"cost_code",id:"input_cost_code","select-options":t.costCodes,"option-key":"cost_code_value","option-value":"cost_code_value","option-label":"cost_code_full_label",value:t.costCode,filterable:!0},on:{onSelected:t.onCostCodeChanged}})],1)]:[a("label",{staticClass:"col-md-4 col-form-label tw-font-bold tw-pt-0"},[t._v(" หน่วยงานที่ปัน ")]),t._v(" "),t._m(0)]],2),t._v(" "),a("div",{staticClass:"row form-group"},[t._v("   ")]),t._v(" "),a("div",{staticClass:"row form-group"},[a("div",{staticClass:"offset-md-4 col-md-8"},[a("div",{staticClass:"text-right tw-mb-2"},[a("button",{staticClass:"btn btn-sm btn-primary tw-w-full",attrs:{disabled:!t.isAllowCreateAllocateAccounts()},on:{click:t.onShowModalCreateAllocateAccounts}},[a("i",{staticClass:"fa fa-plus tw-mr-1"}),t._v(" สร้างรายการบัญชี \n                            ")])])])])])]),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("hr"),t._v(" "),a("div",{staticClass:"row tw-mb-5"},[a("div",{staticClass:"col-12"},[a("div",{staticClass:"text-right tw-mb-2"},[a("button",{staticClass:"btn btn-inline-block btn-sm btn-warning tw-w-52",attrs:{disabled:!t.isAllowCreateAllocateTargets()},on:{click:t.onShowModalCreateAllocateTargets}},[a("i",{staticClass:"fa fa-plus tw-mr-1"}),t._v(" สร้างรายการปันส่วน\n                            ")]),t._v(" "),a("button",{staticClass:"btn btn-inline-block btn-sm btn-danger tw-ml-2",attrs:{disabled:t.allocateAccounts.length<=0},on:{click:function(e){return t.onDeleteAllAllocateAccountItem(e)}}},[a("i",{staticClass:"fa fa-times"}),t._v(" ลบบัญชีทั้งหมด\n                            ")])])]),t._v(" "),a("div",{staticClass:"col-12"},[a("table-allocate-accounts",{attrs:{"period-year-value":t.periodYear,"allocate-year":t.allocateYear,"allocate-accounts":t.allocateAccounts,"allocate-group-value":t.allocateGroup,"dept-code-value":t.deptCode,"cost-code-value":t.costCode,"cost-group-code-value":t.costGroupCode},on:{onAllocateAccountsChanged:t.onAllocateAccountsChanged}})],1)])])])]),t._v(" "),a("loading",{attrs:{active:t.isLoading,"is-full-page":!0},on:{"update:active":function(e){t.isLoading=e}}}),t._v(" "),a("modal-search-allocate-year",{attrs:{"modal-name":"modal-search-allocate-year","modal-width":"640","modal-height":"auto","organization-code":t.organizationCode,"allocate-group-value":t.allocateGroup,"list-allocate-groups":t.listAllocateGroups,"period-years":t.existPeriodYearOptions,"period-year-value":t.periodYear,"allocate-year-version-value":t.allocateYearVersion,"allocate-year-versions":t.allocateYearVersions,"account-codes":t.existAccountCodeOptions},on:{onSearchAllocateYearVersion:t.onSearchAllocateYearVersion}}),t._v(" "),a("modal-copy-new-version",{attrs:{"modal-name":"modal-copy-new-version","modal-width":"640","modal-height":"auto","organization-code":t.organizationCode,"period-year-value":t.periodYear,"period-years":t.periodYears,"to-allocate-year-version-value":t.nextAllocateYearVersion},on:{onCopyAllocateYearNewVersion:t.onCopyAllocateYearNewVersion}}),t._v(" "),a("modal-create-allocate-accounts",{attrs:{"modal-name":"modal-create-allocate-accounts","modal-width":"960","modal-height":"auto","organization-code":t.organizationCode,"period-years":t.periodYears,"period-year-value":t.periodYear,"allocate-group-value":t.allocateGroup,"allocate-group-level-value":t.allocateGroupLevel,"dept-code-value":t.deptCode,"cost-code-value":t.costCode,"cost-group-code-value":t.costGroupCode,"target-accounts":t.targetAccounts,"allocate-accounts":t.allocateAccounts},on:{onSubmitCreateAllocateAccounts:t.onSubmitCreateAllocateAccounts}}),t._v(" "),a("modal-create-allocate-targets",{attrs:{"modal-name":"modal-create-allocate-targets","modal-width":"960","modal-height":"auto","organization-code":t.organizationCode,"period-years":t.periodYears,"period-year-value":t.periodYear,"allocate-group-value":t.allocateGroup,"allocate-group-level-value":t.allocateGroupLevel,"dept-code-value":t.deptCode,"cost-code-value":t.costCode,"cost-group-code-value":t.costGroupCode,"target-dept-codes":t.targetDeptCodes,"target-cost-codes":t.targetCostCodes,"target-product-groups":t.targetProductGroups,"previous-allocate-targets":t.previousAllocateTargets},on:{onSubmitCreateAllocateTargets:t.onSubmitCreateAllocateTargets}})],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-md-8"},[e("input",{staticClass:"input-sm form-control",attrs:{type:"text",name:"cost_code",id:"input_cost_code",disabled:""}})])}],!1,null,null,null).exports}}]);