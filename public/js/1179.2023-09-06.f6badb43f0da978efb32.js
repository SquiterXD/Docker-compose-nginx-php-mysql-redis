(self.webpackChunk=self.webpackChunk||[]).push([[1179],{27318:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});var a=n(23645),s=n.n(a)()((function(e){return e[1]}));s.push([e.id,".v--modal-overlay[data-v-78f94c53]{z-index:2000;padding-top:3rem;padding-bottom:3rem}",""]);const r=s},17413:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var a=n(87757),s=n.n(a),r=n(71170),i=(n(60244),n(30381)),o=n.n(i);function c(e,t,n,a,s,r,i){try{var o=e[r](i),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,s)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var r=e.apply(t,n);function i(e){c(r,a,s,i,o,"next",e)}function o(e){c(r,a,s,i,o,"throw",e)}i(void 0)}))}}var l,m;const d={props:["value","name","id","inputClass","placeholder","disabledDateTo","format","pType"],mounted:function(){},watch:{disabledDateTo:(m=u(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o()(t,this.format).toDate();case 2:if(e.t0=e.sent,e.t1=this.date,!(e.t0>e.t1)){e.next=6;break}this.date=null;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)}),value:(l=u(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.date=t&&t?o()(t,this.format).toDate():null;case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},components:{DatePicker:r.Z},data:function(){var e=this;return{type:null!=this.pType&&""!=this.pType?this.pType:"date",date:this.value?o()(this.value,this.format).toDate():null,defaultDate:this.value?o()(this.value,this.format).toDate():o()().add(543,"years").toDate(),lang:{formatLocale:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],monthsShort:["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],weekdays:["พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์","จันทร์","อังคาร","อังคาร"],weekdaysShort:["พฤหัสบดี","ศุกร์","เสาร์","อาทิตย์","จันทร์","อังคาร","อังคาร"],weekdaysMin:["พฤ.","ศ.","ส.","อา.","จ.","อ.","พ."],firstDayOfWeek:3},yearFormat:"YYYY",monthFormat:"MMM",monthBeforeYear:!0},disabledDate:function(t){if(e.disabledDateTo)return t<o()(e.disabledDateTo,e.format).toDate()}}},methods:{dateWasSelected:function(e){this.date=e,this.$emit("dateWasSelected",e)}}};const h=(0,n(51900).Z)(d,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("date-picker",{attrs:{"input-class":[e.inputClass],"default-value":e.defaultDate,"input-attr":{name:e.name,id:e.id},placeholder:e.placeholder,lang:e.lang,type:e.type,"disabled-date":e.disabledDate,format:e.format},on:{change:e.dateWasSelected},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})}),[],!1,null,null,null).exports},61179:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>M});var a=n(87757),s=n.n(a),r=n(7398),i=n.n(r),o=(n(2223),n(30381)),c=n.n(o),u=n(80455);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const h={props:["requestDateValue","machineRequests","itemOptions","uomCodes"],components:{VueNumeric:n.n(u)()},watch:{machineRequests:function(e){this.machineRequestItems=e}},data:function(){var e=this;return{requestDate:this.requestDateValue,machineRequestItems:this.machineRequests.map((function(t){return m(m({},t),{},{request_qty:t.request_qty?t.request_qty:0,uom2:t.uom2?t.uom2:t.uom,uom_desc:e.getUomCodeDescriptionByCode(e.uomCodes,t.uom),uom2_desc:e.getUomCodeDescriptionByCode(e.uomCodes,t.uom2?t.uom2:t.uom),is_new_line:"Y"==t.attribute10,marked_as_deleted:!1})}))}},mounted:function(){this.emitMachineRequestChanged()},computed:{},methods:{onRequestQtyChanged:function(e){this.emitMachineRequestChanged()},onUOM2Changed:function(e,t){t.uom2=e,t.uom2_desc=this.getUomCodeDescription(this.uomCodes,e)},onDeleteItem:function(e){var t=this;swal({title:"",text:"ต้องการลบรายการ ".concat(e.inv_item_desc?e.inv_item_desc:""," ?"),showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",closeOnConfirm:!0},(function(n){n&&(e.marked_as_deleted=!0,t.emitMachineRequestChanged())}))},onInvItemChanged:function(e,t){t.inventory_item_id=e;var n=this.itemOptions.find((function(t){return t.inventory_item_id==e}));t.inv_item_number=n.item_number,t.inv_item_desc=n.item_desc,t.uom=this.getUomCodeDescriptionByCode(this.uomCodes,n.primary_uom_code),t.uom_desc=this.getUomCodeDescriptionByCode(this.uomCodes,n.primary_uom_code),t.uom2=this.getUomCodeDescriptionByCode(this.uomCodes,n.primary_uom_code),t.uom2_desc=this.getUomCodeDescriptionByCode(this.uomCodes,n.primary_uom_code),this.emitMachineRequestChanged()},getUomCodeDescriptionByCode:function(e,t){var n=e.find((function(e){return e.uom_code_value==t}));return n?n.uom_code_label:""},getUomCodeDescription:function(e,t){var n=e.find((function(e){return e.uom_code_label==t}));return n?n.uom_code_label:""},emitMachineRequestChanged:function(){this.$emit("onMachineRequestChanged",{machineRequestItems:this.machineRequestItems})}}};var v=n(51900);const f=(0,v.Z)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"table-responsive",staticStyle:{"max-height":"600px"}},[n("table",{staticClass:"table table-bordered table-sticky mb-0",staticStyle:{"min-width":"800px"}},[e._m(0),e._v(" "),e.machineRequestItems.length>0?n("tbody",{staticClass:"yearly-lines"},[e._l(e.machineRequestItems,(function(t,a){return[t.marked_as_deleted?e._e():n("tr",{key:""+a},[n("td",{staticClass:"scroll-col text-center",staticStyle:{"min-width":"60px"}},[e._v(" \n                            "+e._s(a+1)+"\n                        ")]),e._v(" "),n("td",{staticClass:"scroll-col text-center",staticStyle:{"min-width":"100px"}},[t.is_new_line?n("div",[n("pm-el-select",{attrs:{name:"inventory_item_id",id:"input_inventory_item_id","select-options":e.itemOptions,"option-key":"inventory_item_id","option-value":"inventory_item_id","option-label":"full_item_desc",value:t.inventory_item_id,filterable:!0},on:{onSelected:function(n){return e.onInvItemChanged(n,t)}}})],1):n("div",[e._v("\n                                "+e._s(t.inv_item_number)+"\n                            ")])]),e._v(" "),n("td",{staticClass:"scroll-col text-left",staticStyle:{"min-width":"300px"}},[e._v(" \n                            "+e._s(t.inv_item_desc)+"\n                        ")]),e._v(" "),n("td",{staticClass:"scroll-col text-center",staticStyle:{"min-width":"100px"}},[e._v(" \n                            "+e._s(t.uom_desc)+"\n                        ")]),e._v(" "),n("td",{staticClass:"scroll-col text-right",staticStyle:{"min-width":"160px"}},[n("vue-numeric",{staticClass:"form-control input-sm text-right",staticStyle:{"min-width":"120px"},attrs:{separator:",",precision:2,minus:!1,id:"input_request_qty_"+a,name:"request_qty_"+a},on:{change:function(n){return e.onRequestQtyChanged(t)}},model:{value:t.request_qty,callback:function(n){e.$set(t,"request_qty",n)},expression:"machineRequestItem.request_qty"}})],1),e._v(" "),n("td",{staticClass:"scroll-col text-center",staticStyle:{"min-width":"60px"}},[n("pm-el-select",{attrs:{name:"uom2",id:"input_uom2","select-options":e.uomCodes,"option-key":"uom_code_value","option-value":"uom_code_value","option-label":"uom_code_label",value:t.uom2,filterable:!0},on:{onSelected:function(n){return e.onUOM2Changed(n,t)}}})],1),e._v(" "),n("td",{staticClass:"scroll-col text-center",staticStyle:{"min-width":"60px"}},[t.is_new_line?n("button",{staticClass:"btn btn-sm btn-danger",attrs:{type:"button"},on:{click:function(n){return e.onDeleteItem(t)}}},[n("i",{staticClass:"fa fa-trash"})]):e._e()])])]}))],2):n("tbody",[e._m(1)])])])])}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("thead",[n("tr",[n("th",{staticClass:"text-center",staticStyle:{"min-width":"60px"}},[e._v(" ลำดับที่ ")]),e._v(" "),n("th",{staticClass:"text-center",staticStyle:{"min-width":"100px"}},[e._v(" รหัสวัตถุดิบ ")]),e._v(" "),n("th",{staticClass:"text-center",staticStyle:{"min-width":"300px"}},[e._v(" รายละเอียด ")]),e._v(" "),n("th",{staticClass:"text-center",staticStyle:{"min-width":"100px"}},[e._v(" หน่วยนับ ")]),e._v(" "),n("th",{staticClass:"text-center",staticStyle:{"min-width":"160px"}},[e._v(" จำนวนที่ขอเบิกจากกองซ่อม ")]),e._v(" "),n("th",{staticClass:"text-center",staticStyle:{"min-width":"60px"}},[e._v(" หน่วยเบิก ")]),e._v(" "),n("th",{staticClass:"text-center",staticStyle:{"min-width":"60px"}})])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("tr",[n("td",{attrs:{colspan:"9"}},[n("h2",{staticClass:"p-5 text-center text-muted"},[e._v(" ไม่พบข้อมูล ")])])])}],!1,null,null,null).exports;var p=n(17413);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t,n,a,s,r,i){try{var o=e[r](i),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,s)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var r=e.apply(t,n);function i(e){y(r,a,s,i,o,"next",e)}function o(e){y(r,a,s,i,o,"throw",e)}i(void 0)}))}}const g={props:["modalName","modalWidth","modalHeight"],components:{Loading:i(),DatepickerTh:p.Z},watch:{},data:function(){return{isLoading:!1,width:this.modalWidth,requestDate:null,headerRequests:[]}},created:function(){this.handleResize()},methods:{handleResize:function(){window.innerWidth<768?this.width="90%":window.innerWidth<992?this.width="80%":this.width=this.modalWidth},requestDateWasSelected:function(e){var t=this;return w(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.requestDate=e;case 1:case"end":return n.stop()}}),n)})))()},onSearchMachineRequests:function(){var e=this;return w(s().mark((function t(){var n,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.headerRequests=[],e.isLoading=!0,n=e.requestDate?c()(e.requestDate).format("DD/MM/YYYY"):"",a={request_date:n},t.next=6,axios.get("/ajax/pm/products/machine-requests/search-request-headers",{params:a}).then((function(t){var a=t.data.data;return"error"==a.status?swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(n," ไม่ถูกต้อง | ").concat(a.message),"error"):e.headerRequests=a.header_requests?JSON.parse(a.header_requests).map((function(e){return b(b({},e),{},{request_date_formatted:e.request_date?c()(e.request_date).add(543,"years").format("DD/MM/YYYY"):""})})):[],a})).catch((function(e){console.log(e),swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(n," ไม่ถูกต้อง | ").concat(e.message),"error")}));case 6:e.isLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},onSelectedSearchMachineRequest:function(e,t){this.$modal.hide(this.modalName),this.$emit("onSelectedSearchMachineRequest",{request_date:e,request_number:t})}}};n(71223);const C=(0,v.Z)(g,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{position:"fixed","z-index":"100"}},[n("modal",{attrs:{name:e.modalName,width:e.width,scrollable:!0,height:e.modalHeight,shiftX:.3,shiftY:.3}},[n("div",{staticClass:"p-4"},[n("h4",[e._v(" ค้นหาประมาณการวัตถุดิบประจำปี ")]),e._v(" "),n("hr"),e._v(" "),n("div",{staticClass:"row form-group"},[n("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[e._v(" วันที่ ")]),e._v(" "),n("div",{staticClass:"col-md-4"},[n("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",attrs:{name:"request_date",id:"input_request_date",placeholder:"โปรดเลือกวันที่",format:"DD/MM/YYYY",value:e.requestDate},on:{dateWasSelected:e.requestDateWasSelected}})],1),e._v(" "),n("div",{staticClass:"col-md-4"},[n("button",{staticClass:"btn btn-white tw-w-32",attrs:{type:"button"},on:{click:e.onSearchMachineRequests}},[n("i",{staticClass:"fa fa-search"}),e._v(" ค้นหา \n                    ")]),e._v(" "),n("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(t){return e.$modal.hide(e.modalName)}}},[e._v(" \n                        ยกเลิก \n                    ")])])]),e._v(" "),n("hr"),e._v(" "),n("div",{staticClass:"table-responsive",staticStyle:{"max-height":"300px"}},[n("table",{staticClass:"table table-bordered mb-0"},[n("thead",[n("tr",[n("th",{staticClass:"text-center",attrs:{width:"20%"}},[e._v(" ลำดับที่ ")]),e._v(" "),n("th",{staticClass:"text-center",attrs:{width:"30%"}},[e._v(" วันที่เบิก ")]),e._v(" "),n("th",{staticClass:"text-center",attrs:{width:"30%"}},[e._v(" เลขที่ใบเบิก ")]),e._v(" "),n("th",{staticClass:"text-center",attrs:{width:"20%"}})])]),e._v(" "),e.headerRequests.length>0?n("tbody",[e._l(e.headerRequests,(function(t,a){return[n("tr",{key:""+a},[n("td",{staticClass:"text-center"},[e._v(" "+e._s(a+1)+" ")]),e._v(" "),n("td",{staticClass:"text-center"},[e._v(" "+e._s(t.request_date_formatted)+" ")]),e._v(" "),n("td",{staticClass:"text-center"},[e._v(" "+e._s(t.request_number)+" ")]),e._v(" "),n("td",{staticClass:"text-center"},[n("button",{staticClass:"btn btn-xs btn-primary",attrs:{type:"button"},on:{click:function(n){return e.onSelectedSearchMachineRequest(t.request_date_formatted,t.request_number)}}},[e._v(" \n                                        เลือก \n                                    ")])])])]}))],2):n("tbody",[n("tr",[n("td",{attrs:{colspan:"4"}},[n("h2",{staticClass:"p-5 text-center text-muted"},[e._v(" ไม่พบข้อมูล ")])])])])])])])]),e._v(" "),n("loading",{attrs:{active:e.isLoading,"is-full-page":!0},on:{"update:active":function(t){e.isLoading=t}}})],1)}),[],!1,null,"78f94c53",null).exports;function x(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e,t,n,a,s,r,i){try{var o=e[r](i),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(a,s)}function I(e){return function(){var t=this,n=arguments;return new Promise((function(a,s){var r=e.apply(t,n);function i(e){j(r,a,s,i,o,"next",e)}function o(e){j(r,a,s,i,o,"throw",e)}i(void 0)}))}}const k={components:{Loading:i(),TableMachineRequests:f,ModalSearch:C,DatepickerTh:p.Z},props:["requestNumberValue","requestDateValue","objectiveRequestValue","inventoryItemIdValue","machineNameValue","itemOptions","uomCodes","objectiveRequests"],mounted:function(){if(this.requestNumberValue&&this.getMachineRequests(this.requestNumberValue),this.requestDateValue){var e=c()(this.requestDateValue,"DD/MM/YYYY").toDate();this.getInvItems(e),this.inventoryItemIdValue&&this.getItemMachineName(e,this.inventoryItemIdValue)}},data:function(){return{requestNumber:this.requestNumberValue,requestDate:this.requestDateValue?c()(this.requestDateValue,"DD/MM/YYYY").toDate():null,requestDateFormatted:this.requestDateValue,objectiveRequest:this.objectiveRequestValue,inventoryItemId:this.inventoryItemIdValue,machineName:this.machineNameValue,invItems:[],machineRequests:[],isNewlyCreate:!1,isLoading:!1}},computed:{},methods:{setUrlParams:function(){var e=new URLSearchParams(window.location.search);e.set("request_number",this.requestNumber?this.requestNumber:""),e.set("request_date",this.requestDateFormatted?this.requestDateFormatted:""),e.set("objective_request",this.objectiveRequest?this.objectiveRequest:""),e.set("inventory_item_id",this.inventoryItemId?this.inventoryItemId:""),e.set("machine_name",this.machineName?this.machineName:""),window.history.replaceState(null,null,"?"+e.toString())},requestDateWasSelected:function(e){var t=this;return I(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.inventoryItemId=null,t.machineName=null,t.invItems=[],t.requestNumber=null,t.machineRequests=[],t.requestDate=e,t.requestDateFormatted=t.getRequestDateFormatted(t.requestDate),n.next=9,t.getInvItems(t.requestDate);case 9:t.setUrlParams();case 10:case"end":return n.stop()}}),n)})))()},onObjectiveRequestWasSelected:function(e){var t=this;return I(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.requestNumber=null,t.machineRequests=[],t.objectiveRequest=e,t.setUrlParams();case 4:case"end":return n.stop()}}),n)})))()},onInventoryItemIdWasSelected:function(e){var t=this;return I(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.inventoryItemId=null,t.machineName=null,t.requestNumber=null,t.machineRequests=[],t.inventoryItemId=e,n.next=7,t.getItemMachineName(t.requestDate,t.inventoryItemId);case 7:t.setUrlParams();case 8:case"end":return n.stop()}}),n)})))()},onSelectedSearchMachineRequest:function(e){var t=this;return I(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.requestNumber=e.request_number,t.requestDateFormatted=e.request_date,t.requestDate=c()(t.requestDateFormatted,"DD/MM/YYYY").toDate(),n.next=5,t.getInvItems(t.requestDate);case 5:if(!t.requestNumber){n.next=8;break}return n.next=8,t.getMachineRequests(t.requestNumber);case 8:t.setUrlParams();case 9:case"end":return n.stop()}}),n)})))()},getRequestDateFormatted:function(e){return c()(e).format("DD/MM/YYYY")},getPeriodNameLabel:function(e,t){var n=e.find((function(e){return e.period_name_value==t}));return n?n.period_name_label:""},getInvItems:function(e){var t=this;return I(s().mark((function n(){var a,r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.isLoading=!0,t.invItems=[],a=c()(e).format("DD/MM/YYYY"),r={request_date:a},n.next=6,axios.get("/ajax/pm/products/machine-requests/get-items",{params:r}).then((function(e){var n=e.data.data;return"error"==n.status?swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(a," ไม่ถูกต้อง | ").concat(n.message),"error"):t.invItems=n.inv_items?JSON.parse(n.inv_items):[],n})).catch((function(e){console.log(e),swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(a," ไม่ถูกต้อง | ").concat(e.message),"error")}));case 6:t.isLoading=!1;case 7:case"end":return n.stop()}}),n)})))()},getItemMachineName:function(e,t){var n=this;return I(s().mark((function a(){var r,i;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n.isLoading=!0,n.machineName="",r=c()(e).format("DD/MM/YYYY"),i={request_date:r,inventory_item_id:t},a.next=6,axios.get("/ajax/pm/products/machine-requests/get-item-machine-name",{params:i}).then((function(e){var t=e.data.data;return"error"==t.status?swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(r," ไม่ถูกต้อง | ").concat(t.message),"error"):n.machineName=t.machine_name,t})).catch((function(e){console.log(e),swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(r," ไม่ถูกต้อง | ").concat(e.message),"error")}));case 6:n.isLoading=!1;case 7:case"end":return a.stop()}}),a)})))()},getMachineRequests:function(e){var t=this;return I(s().mark((function n(){var a;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.isLoading=!0,t.machineRequests=[],a={request_number:e},n.next=5,axios.get("/ajax/pm/products/machine-requests/get-requests",{params:a}).then((function(n){var a=n.data.data;return"error"==a.status?swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(e," ไม่ถูกต้อง | ").concat(a.message),"error"):(t.machineRequests=a.machine_requests?JSON.parse(a.machine_requests):[],t.machineRequests.length>0&&(t.machineName=t.machineRequests[0].machine_name,t.inventoryItemId=t.machineRequests[0].inventory_item_id,t.machineRequests[0].objective_request&&(t.objectiveRequest=t.machineRequests[0].objective_request))),a})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร ".concat(e," ไม่ถูกต้อง | ").concat(t.message),"error")}));case 5:t.isLoading=!1;case 6:case"end":return n.stop()}}),n)})))()},onGenerateMachineRequests:function(){var e=this;return I(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,n={request_date:e.requestDateFormatted,objective_request:e.objectiveRequest,machine_name:e.machineName,inventory_item_id:e.inventoryItemId},t.next=4,axios.post("/ajax/pm/products/machine-requests/generate-requests",n).then((function(t){var n=t.data.data;return"success"==n.status?(e.machineRequests=n.machine_requests?JSON.parse(n.machine_requests):[],e.machineRequests.length<=0&&swal("ไม่พบข้อมูล","ไม่พบข้อมูลจากแผน วันที่ : ".concat(e.requestDateFormatted),"error"),e.isNewlyCreate=n.is_newly_create):swal("เกิดข้อผิดพลาด","ไม่สามารถเรียกข้อมูลจากแผน วันที่ : ".concat(e.requestDateFormatted," | ").concat(n.message),"error"),n})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ไม่สามารถเรียกข้อมูลจากแผน วันที่ : ".concat(e.requestDateFormatted," | ").concat(t.message),"error")}));case 4:e.isLoading=!1;case 5:case"end":return t.stop()}}),t)})))()},onMachineRequestChanged:function(e){this.machineRequests=e.machineRequestItems},validateBeforeSave:function(e){var t={valid:!0,message:""};return e.filter((function(e){return e.is_new_line&&(!e.inventory_item_id||!e.request_qty)&&0==e.marked_as_deleted})).length>0&&(t.valid=!1,t.message="กรอกข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักรไม่ครบถ้วน กรุณาตรวจสอบ"),t},onAddMachineRequest:function(){var e=this,t=S({},this.machineRequests.find((function(t,n){return n==e.machineRequests.length-1})));Object.keys(t).forEach((function(e){"request_number"==e&&"creation_date"==e&&"request_date"==e&&"organization_id"==e||(t[e]=null)})),this.machineRequests=[].concat(x(this.machineRequests),[S(S({},t),{},{request_qty:0,is_new_line:!0,marked_as_deleted:!1})])},onSaveMachineRequests:function(){var e=this;return I(s().mark((function t(){var n,a;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={request_date:e.requestDateFormatted,machine_requests:JSON.stringify(e.machineRequests)},e.isLoading=!0,!(a=e.validateBeforeSave(e.machineRequests)).valid){t.next=8;break}return t.next=6,axios.post("/ajax/pm/products/machine-requests/store-requests",n).then((function(t){var n=t.data.data,a=n.message;return"success"==n.status&&(e.isNewlyCreate=!1,swal("Success","บันทึกข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร : ".concat(e.requestDateFormatted," )"),"success")),"error"==n.status&&swal("เกิดข้อผิดพลาด","บันทึกข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร : วันที่ : ".concat(e.requestDateFormatted," | ").concat(a),"error"),n})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","บันทึกข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร : วันที่ : ".concat(e.requestDateFormatted," | ").concat(t.message),"error")}));case 6:t.next=9;break;case 8:swal("เกิดข้อผิดพลาด","บันทึกข้อมูลเบิกวัตถุดิบหข้าหน้าเครื่องจักร : วันที่ : ".concat(e.requestDateFormatted," | ").concat(a.message),"error");case 9:e.isLoading=!1;case 10:case"end":return t.stop()}}),t)})))()},onSubmitMachineRequests:function(){var e=this;return I(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={request_date:e.requestDateFormatted,machine_requests:JSON.stringify(e.machineRequests)},e.isLoading=!0,t.next=4,axios.post("/ajax/pm/products/machine-requests/store-requests",n).then((function(e){var t=e.data.data;return"error"==t.status&&console.log(t.message),t})).catch((function(e){console.log(e)}));case 4:return t.next=6,axios.post("/ajax/pm/products/machine-requests/submit-requests",n).then((function(t){var n=t.data.data,a=n.message;return"success"==n.status&&swal("Success","ยืนยันส่งข้อมูลไป WMS (วันที่ : ".concat(e.requestDateFormatted,")"),"success"),"error"==n.status&&swal("เกิดข้อผิดพลาด","ยืนยันส่งข้อมูลไป WMS (วันที่ : ".concat(e.requestDateFormatted,") | ").concat(a),"error"),n})).catch((function(t){console.log(t),swal("เกิดข้อผิดพลาด","ยืนยันส่งข้อมูลไป WMS (วันที่ : ".concat(e.requestDateFormatted,") | ").concat(t.message),"error")}));case 6:e.isLoading=!1;case 7:case"end":return t.stop()}}),t)})))()},onExportPdf:function(){var e=this;return I(s().mark((function t(){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={request_date:e.requestDateFormatted,machine_requests:JSON.stringify(e.machineRequests)},e.isLoading=!0,t.next=4,axios.post("/ajax/pm/products/machine-requests/export-pdf",n).then((function(t){var n=t.data.data;return"error"==n.status?swal("เกิดข้อผิดพลาด","ไม่สามารถพิมพ์รายงาน (วันที่ : ".concat(e.requestDateFormatted,") | ").concat(resMsg),"error"):window.open("/pm/files/download/pm/products/machine-requests/pdf/".concat(n.file_name),"_blank"),n})).catch((function(e){console.log(e)}));case 4:e.isLoading=!1;case 5:case"end":return t.stop()}}),t)})))()}}};const M=(0,v.Z)(k,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ibox"},[n("div",{staticClass:"ibox-content",staticStyle:{"min-height":"600px"}},[n("div",{staticClass:"tw-mb-4"},[n("div",{staticClass:"text-right tw-mb-2"},[n("button",{staticClass:"btn btn-inline-block btn-sm btn-info tw-w-40",attrs:{disabled:!e.requestDate||!e.objectiveRequest||!e.inventoryItemId||e.machineRequests.length>0},on:{click:e.onGenerateMachineRequests}},[n("i",{staticClass:"fa fa-calculator tw-mr-1"}),e._v(" เรียกข้อมูลจากแผน \n                ")]),e._v(" "),n("button",{staticClass:"btn btn-inline-block btn-sm btn-white tw-w-40",on:{click:function(t){return e.$modal.show("modal-search")}}},[n("i",{staticClass:"fa fa-search tw-mr-1"}),e._v(" ค้นหา \n                ")])]),e._v(" "),n("div",{staticClass:"text-right"},[n("button",{staticClass:"btn btn-inline-block btn-sm btn-primary tw-w-40",attrs:{disabled:!e.requestDate||0==e.machineRequests.length},on:{click:e.onSaveMachineRequests}},[n("i",{staticClass:"fa fa-save tw-mr-1"}),e._v(" บันทึก \n                ")]),e._v(" "),n("button",{staticClass:"btn btn-inline-block btn-sm btn-warning tw-w-40",attrs:{disabled:0==e.machineRequests.length||e.isNewlyCreate},on:{click:e.onSubmitMachineRequests}},[n("i",{staticClass:"fa fa-check-square tw-mr-1"}),e._v(" ยืนยันส่งข้อมูลไป WMS \n                ")]),e._v(" "),n("button",{staticClass:"btn btn-inline-block btn-sm btn-primary tw-w-40",attrs:{disabled:0==e.machineRequests.length},on:{click:e.onExportPdf}},[n("i",{staticClass:"fa fa-print tw-mr-1"}),e._v(" พิมพ์รายงาน \n                ")])])]),e._v(" "),n("hr"),e._v(" "),n("div",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-6"},[n("div",{staticClass:"row form-group"},[n("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[e._v(" วันที่ ")]),e._v(" "),n("div",{staticClass:"col-md-8"},[n("datepicker-th",{staticClass:"form-control md:tw-mb-0 tw-mb-2",attrs:{name:"request_date",id:"input_request_date",placeholder:"โปรดเลือกวันที่",format:"DD/MM/YYYY",value:e.requestDate},on:{dateWasSelected:e.requestDateWasSelected}})],1)]),e._v(" "),n("div",{staticClass:"row form-group"},[n("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[e._v(" วัตถุประสงค์ในการเบิก ")]),e._v(" "),n("div",{staticClass:"col-md-8"},[n("pm-el-select",{attrs:{name:"objective_request",id:"objective_request","select-options":e.objectiveRequests,"option-key":"objective_request_value","option-value":"objective_request_value","option-label":"objective_request_label",value:e.objectiveRequest,filterable:!0},on:{onSelected:e.onObjectiveRequestWasSelected}})],1)]),e._v(" "),n("div",{staticClass:"row form-group"},[n("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[e._v(" เลขที่ใบเบิก ")]),e._v(" "),n("div",{staticClass:"col-md-8"},[0==e.machineRequests.length?n("p",{staticClass:"col-form-label"},[e._v(" - ")]):e._e(),e._v(" "),e.machineRequests.length>0?n("p",{staticClass:"col-form-label"},[e._v(" "+e._s(e.machineRequests[0].request_number)+" ")]):e._e()])])]),e._v(" "),n("div",{staticClass:"col-md-6"},[n("div",{staticClass:"row form-group"},[n("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[e._v(" สินค้าที่จะผลิต ")]),e._v(" "),n("div",{staticClass:"col-md-8"},[n("pm-el-select",{attrs:{name:"inventory_item_id",id:"inventory_item_id","select-options":e.invItems,"option-key":"inventory_item_id","option-value":"inventory_item_id","option-label":"inv_item_fulldesc",value:e.inventoryItemId,filterable:!0},on:{onSelected:e.onInventoryItemIdWasSelected}})],1)]),e._v(" "),n("div",{staticClass:"row form-group"},[n("label",{staticClass:"col-md-4 col-form-label tw-font-bold"},[e._v(" เครื่องจักร ")]),e._v(" "),n("div",{staticClass:"col-md-8"},[n("p",{staticClass:"col-form-label"},[e._v(" "+e._s(e.machineName?e.machineName:"-")+" ")])])])])])]),e._v(" "),n("hr"),e._v(" "),e.machineRequests.length>0?n("div",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("table-machine-requests",{attrs:{"machine-requests":e.machineRequests,"uom-codes":e.uomCodes,"item-options":e.itemOptions},on:{onMachineRequestChanged:e.onMachineRequestChanged}})],1)])]):e._e()]),e._v(" "),n("loading",{attrs:{active:e.isLoading,"is-full-page":!0},on:{"update:active":function(t){e.isLoading=t}}}),e._v(" "),n("modal-search",{attrs:{"modal-name":"modal-search","modal-width":"720","modal-height":"auto","plan-date-value":e.requestDate},on:{onSelectedSearchMachineRequest:e.onSelectedSearchMachineRequest}})],1)}),[],!1,null,null,null).exports},71223:(e,t,n)=>{var a=n(27318);a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.id,a,""]]),a.locals&&(e.exports=a.locals);(0,n(45346).Z)("6caf4925",a,!0,{})}}]);